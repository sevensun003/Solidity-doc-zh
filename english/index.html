

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Solidity 0.4.24 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://solidity.readthedocs.io/en/v0.4.23/" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'index'
</script>

<script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction-to-smart-contracts">Introduction to Smart Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#a-simple-smart-contract">A Simple Smart Contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blockchain-basics">Blockchain Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#index-6">The Ethereum Virtual Machine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installing-solidity">Installing the Solidity Compiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#remix">Remix</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#npm-node-js">npm / Node.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#binary-packages">Binary Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#building-from-source">Building from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cmake-options">CMake options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-version-string-in-detail">The version string in detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#important-information-about-versioning">Important information about versioning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-solidity-by-example">Solidity by Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#voting">Voting</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blind-auction">Blind Auction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#safe-remote-purchase">Safe Remote Purchase</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#micropayment-channel">Micropayment Channel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-solidity-in-depth">Solidity in Depth</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-layout-of-source-files">Layout of a Solidity Source File</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-structure-of-a-contract">Structure of a Contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-types">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-units-and-global-variables">Units and Globally Available Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-control-structures">Expressions and Control Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contracts">Contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-assembly">Solidity Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security-considerations">Security Considerations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#pitfalls">Pitfalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#recommendations">Recommendations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#formal-verification">Formal Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-using-the-compiler">Using the compiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-the-commandline-compiler">Using the Commandline Compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#compiler-input-and-output-json-description">Compiler Input and Output JSON Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-metadata">Contract Metadata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#encoding-of-the-metadata-hash-in-the-bytecode">Encoding of the Metadata Hash in the Bytecode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#usage-for-automatic-interface-generation-and-natspec">Usage for Automatic Interface Generation and NatSpec</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#usage-for-source-code-verification">Usage for Source Code Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-abi-spec">Application Binary Interface Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-design">Basic Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#function-selector">Function Selector</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#argument-encoding">Argument Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#types">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#formal-specification-of-the-encoding">Formal Specification of the Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#function-selector-and-argument-encoding">Function Selector and Argument Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#use-of-dynamic-types">Use of Dynamic Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#events">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#json">JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#non-standard-packed-mode">Non-standard Packed Mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-julia">Joyfully Universal Language for (Inline) Assembly</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#specification-of-julia">Specification of JULIA</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#specification-of-julia-object">Specification of JULIA Object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-style-guide">Style Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-layout">Code Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#naming-conventions">Naming Conventions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-common-patterns">Common Patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#withdrawal-from-contracts">Withdrawal from Contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#restricting-access">Restricting Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#state-machine">State Machine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-bugs">List of Known Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-to-report-issues">How to Report Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#workflow-for-pull-requests">Workflow for Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-the-compiler-tests">Running the compiler tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-the-fuzzer-via-afl">Running the Fuzzer via AFL</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#whiskers">Whiskers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-frequently-asked-questions">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-questions">Basic Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-questions">Advanced Questions</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">Solidity</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>Solidity 0.4.24 documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ethereum/solidity/blob/develop/docs/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="solidity">
<h1>Solidity<a class="headerlink" href="#solidity" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="_images/logo.svg"><div align="center" class="align-center"><img alt="Solidity logo" src="_images/logo.svg" width="120px" /></div>
</a>
<p>Solidity is a contract-oriented, high-level language for implementing smart contracts.
It was influenced by C++, Python and JavaScript
and is designed to target the Ethereum Virtual Machine (EVM).</p>
<p>Solidity is statically typed, supports inheritance, libraries and complex
user-defined types among other features.</p>
<p>As you will see, it is possible to create contracts for voting,
crowdfunding, blind auctions, multi-signature wallets and more.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The best way to try out Solidity right now is using
<a class="reference external" href="https://remix.ethereum.org/">Remix</a>
(it can take a while to load, please be patient). Remix is a web browser
based IDE that allows you to write Solidity smart contracts, then deploy
and run the smart contracts.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since software is written by humans, it can have bugs. Thus, also
smart contracts should be created following well-known best-practices in
software development. This includes code review, testing, audits and correctness proofs.
Also note that users are sometimes more confident in code than its authors.
Finally, blockchains have their own things to watch out for, so please take
a look at the section <a class="reference internal" href="index.html#security-considerations"><span class="std std-ref">Security Considerations</span></a>.</p>
</div>
<div class="section" id="translations">
<h2>Translations<a class="headerlink" href="#translations" title="Permalink to this headline">¶</a></h2>
<p>This documentation is translated into several languages by community volunteers, but the English version stands as a reference.</p>
<ul class="simple">
<li><a class="reference external" href="http://solidity-cn.readthedocs.io">Simplified Chinese</a> (in progress)</li>
<li><a class="reference external" href="https://solidity-es.readthedocs.io">Spanish</a></li>
<li><a class="reference external" href="https://github.com/ethereum/wiki/wiki/%5BRussian%5D-%D0%A0%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE-%D0%BF%D0%BE-Solidity">Russian</a> (rather outdated)</li>
<li><a class="reference external" href="http://solidity-kr.readthedocs.io">Korean</a> (in progress)</li>
</ul>
</div>
<div class="section" id="useful-links">
<h2>Useful links<a class="headerlink" href="#useful-links" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://ethereum.org">Ethereum</a></li>
<li><a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/Changelog.md">Changelog</a></li>
<li><a class="reference external" href="https://www.pivotaltracker.com/n/projects/1189488">Story Backlog</a></li>
<li><a class="reference external" href="https://github.com/ethereum/solidity/">Source Code</a></li>
<li><a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum Stackexchange</a></li>
<li><a class="reference external" href="https://gitter.im/ethereum/solidity/">Gitter Chat</a></li>
</ul>
</div>
<div class="section" id="available-solidity-integrations">
<h2>Available Solidity Integrations<a class="headerlink" href="#available-solidity-integrations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://remix.ethereum.org/">Remix</a></dt>
<dd>Browser-based IDE with integrated compiler and Solidity runtime environment without server-side components.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://plugins.jetbrains.com/plugin/9475-intellij-solidity">IntelliJ IDEA plugin</a></dt>
<dd>Solidity plugin for IntelliJ IDEA (and all other JetBrains IDEs)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://visualstudiogallery.msdn.microsoft.com/96221853-33c4-4531-bdd5-d2ea5acc4799/">Visual Studio Extension</a></dt>
<dd>Solidity plugin for Microsoft Visual Studio that includes the Solidity compiler.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://packagecontrol.io/packages/Ethereum/">Package for SublimeText — Solidity language syntax</a></dt>
<dd>Solidity syntax highlighting for SublimeText editor.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/0mkara/etheratom">Etheratom</a></dt>
<dd>Plugin for the Atom editor that features syntax highlighting, compilation and a runtime environment (Backend node &amp; VM compatible).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://atom.io/packages/linter-solidity">Atom Solidity Linter</a></dt>
<dd>Plugin for the Atom editor that provides Solidity linting.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://atom.io/packages/linter-solium">Atom Solium Linter</a></dt>
<dd>Configurable Solidty linter for Atom using Solium as a base.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/duaraghav8/Solium/">Solium</a></dt>
<dd>Linter to identify and fix style and security issues in Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/protofire/solhint">Solhint</a></dt>
<dd>Solidity linter that provides security, style guide and best practice rules for smart contract validation.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="http://juan.blanco.ws/solidity-contracts-in-visual-studio-code/">Visual Studio Code extension</a></dt>
<dd>Solidity plugin for Microsoft Visual Studio Code that includes syntax highlighting and the Solidity compiler.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ethereum/emacs-solidity/">Emacs Solidity</a></dt>
<dd>Plugin for the Emacs editor providing syntax highlighting and compilation error reporting.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/tomlion/vim-solidity/">Vim Solidity</a></dt>
<dd>Plugin for the Vim editor providing syntax highlighting.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/scrooloose/syntastic">Vim Syntastic</a></dt>
<dd>Plugin for the Vim editor providing compile checking.</dd>
</dl>
</li>
</ul>
<p>Discontinued:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ethereum/mix/">Mix IDE</a></dt>
<dd>Qt based IDE for designing, debugging and testing solidity smart contracts.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://live.ether.camp/">Ethereum Studio</a></dt>
<dd>Specialized web IDE that also provides shell access to a complete Ethereum environment.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="solidity-tools">
<h2>Solidity Tools<a class="headerlink" href="#solidity-tools" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://dapp.readthedocs.io">Dapp</a></dt>
<dd>Build tool, package manager, and deployment assistant for Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/raineorshine/solidity-repl">Solidity REPL</a></dt>
<dd>Try Solidity instantly with a command-line Solidity console.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/raineorshine/solgraph">solgraph</a></dt>
<dd>Visualize Solidity control flow and highlight potential security vulnerabilities.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/Arachnid/evmdis">evmdis</a></dt>
<dd>EVM Disassembler that performs static analysis on the bytecode to provide a higher level of abstraction than raw EVM operations.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/DigixGlobal/doxity">Doxity</a></dt>
<dd>Documentation Generator for Solidity.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="third-party-solidity-parsers-and-grammars">
<h2>Third-Party Solidity Parsers and Grammars<a class="headerlink" href="#third-party-solidity-parsers-and-grammars" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ConsenSys/solidity-parser">solidity-parser</a></dt>
<dd>Solidity parser for JavaScript</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/federicobond/solidity-antlr4">Solidity Grammar for ANTLR 4</a></dt>
<dd>Solidity grammar for the ANTLR 4 parser generator</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="language-documentation">
<h2>Language Documentation<a class="headerlink" href="#language-documentation" title="Permalink to this headline">¶</a></h2>
<p>On the next pages, we will first see a <a class="reference internal" href="index.html#simple-smart-contract"><span class="std std-ref">simple smart contract</span></a> written
in Solidity followed by the basics about <a class="reference internal" href="index.html#blockchain-basics"><span class="std std-ref">blockchains</span></a>
and the <a class="reference internal" href="index.html#the-ethereum-virtual-machine"><span class="std std-ref">Ethereum Virtual Machine</span></a>.</p>
<p>The next section will explain several <em>features</em> of Solidity by giving
useful <a class="reference internal" href="index.html#voting"><span class="std std-ref">example contracts</span></a>
Remember that you can always try out the contracts
<a class="reference external" href="https://remix.ethereum.org">in your browser</a>!</p>
<p>The last and most extensive section will cover all aspects of Solidity in depth.</p>
<p>If you still have questions, you can try searching or asking on the
<a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum Stackexchange</a>
site, or come to our <a class="reference external" href="https://gitter.im/ethereum/solidity/">gitter channel</a>.
Ideas for improving Solidity or this documentation are always welcome!</p>
</div>
</div>
<div class="section" id="contents">
<h1>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="genindex.html"><span class="std std-ref">Keyword Index</span></a>, <a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p>
<div class="toctree-wrapper compound">
<span id="document-introduction-to-smart-contracts"></span><div class="section" id="introduction-to-smart-contracts">
<h2>Introduction to Smart Contracts<a class="headerlink" href="#introduction-to-smart-contracts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-simple-smart-contract">
<span id="simple-smart-contract"></span><h3>A Simple Smart Contract<a class="headerlink" href="#a-simple-smart-contract" title="Permalink to this headline">¶</a></h3>
<p>Let us begin with the most basic example. It is fine if you do not understand everything
right now, we will go into more detail later.</p>
<div class="section" id="storage">
<h4>Storage<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h4>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleStorage</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">storedData</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">set</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">storedData</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">get</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">storedData</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first line simply tells that the source code is written for
Solidity version 0.4.0 or anything newer that does not break functionality
(up to, but not including, version 0.5.0). This is to ensure that the
contract does not suddenly behave differently with a new compiler version. The keyword <code class="docutils literal"><span class="pre">pragma</span></code> is called that way because, in general,
pragmas are instructions for the compiler about how to treat the
source code (e.g. <a class="reference external" href="https://en.wikipedia.org/wiki/Pragma_once">pragma once</a>).</p>
<p>A contract in the sense of Solidity is a collection of code (its <em>functions</em>) and
data (its <em>state</em>) that resides at a specific address on the Ethereum
blockchain. The line <code class="docutils literal"><span class="pre">uint</span> <span class="pre">storedData;</span></code> declares a state variable called <code class="docutils literal"><span class="pre">storedData</span></code> of
type <code class="docutils literal"><span class="pre">uint</span></code> (unsigned integer of 256 bits). You can think of it as a single slot
in a database that can be queried and altered by calling functions of the
code that manages the database. In the case of Ethereum, this is always the owning
contract. And in this case, the functions <code class="docutils literal"><span class="pre">set</span></code> and <code class="docutils literal"><span class="pre">get</span></code> can be used to modify
or retrieve the value of the variable.</p>
<p>To access a state variable, you do not need the prefix <code class="docutils literal"><span class="pre">this.</span></code> as is common in
other languages.</p>
<p>This contract does not do much yet (due to the infrastructure
built by Ethereum) apart from allowing anyone to store a single number that is accessible by
anyone in the world without a (feasible) way to prevent you from publishing
this number. Of course, anyone could just call <code class="docutils literal"><span class="pre">set</span></code> again with a different value
and overwrite your number, but the number will still be stored in the history
of the blockchain. Later, we will see how you can impose access restrictions
so that only you can alter the number.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All identifiers (contract names, function names and variable names) are restricted to
the ASCII character set. It is possible to store UTF-8 encoded data in string variables.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful with using Unicode text as similarly looking (or even identical) characters can
have different code points and as such will be encoded as a different byte array.</p>
</div>
</div>
<div class="section" id="subcurrency-example">
<span id="index-0"></span><h4>Subcurrency Example<a class="headerlink" href="#subcurrency-example" title="Permalink to this headline">¶</a></h4>
<p>The following contract will implement the simplest form of a
cryptocurrency. It is possible to generate coins out of thin air, but
only the person that created the contract will be able to do that (it is trivial
to implement a different issuance scheme).
Furthermore, anyone can send coins to each other without any need for
registering with username and password - all you need is an Ethereum keypair.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">21</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Coin</span> <span class="p">{</span>
    <span class="c1">// The keyword &quot;public&quot; makes those variables</span>
    <span class="c1">// readable from outside.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">minter</span><span class="p">;</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="nx">balances</span><span class="p">;</span>

    <span class="c1">// Events allow light clients to react on</span>
    <span class="c1">// changes efficiently.</span>
    <span class="kd">event</span> <span class="nx">Sent</span><span class="p">(</span><span class="kt">address</span> <span class="nx">from</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>

    <span class="c1">// This is the constructor whose code is</span>
    <span class="c1">// run only when the contract is created.</span>
    <span class="kd">function</span> <span class="nx">Coin</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">minter</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">mint</span><span class="p">(</span><span class="kt">address</span> <span class="nx">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">minter</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nx">receiver</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">send</span><span class="p">(</span><span class="kt">address</span> <span class="nx">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nx">receiver</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="nx">emit</span> <span class="nx">Sent</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">receiver</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This contract introduces some new concepts, let us go through them one by one.</p>
<p>The line <code class="docutils literal"><span class="pre">address</span> <span class="pre">public</span> <span class="pre">minter;</span></code> declares a state variable of type address
that is publicly accessible. The <code class="docutils literal"><span class="pre">address</span></code> type is a 160-bit value
that does not allow any arithmetic operations. It is suitable for
storing addresses of contracts or keypairs belonging to external
persons. The keyword <code class="docutils literal"><span class="pre">public</span></code> automatically generates a function that
allows you to access the current value of the state variable
from outside of the contract.
Without this keyword, other contracts have no way to access the variable.
The code of the function generated by the compiler is roughly equivalent
to the following:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">minter</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">minter</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Of course, adding a function exactly like that will not work
because we would have a
function and a state variable with the same name, but hopefully, you
get the idea - the compiler figures that out for you.</p>
<p id="index-1">The next line, <code class="docutils literal"><span class="pre">mapping</span> <span class="pre">(address</span> <span class="pre">=&gt;</span> <span class="pre">uint)</span> <span class="pre">public</span> <span class="pre">balances;</span></code> also
creates a public state variable, but it is a more complex datatype.
The type maps addresses to unsigned integers.
Mappings can be seen as <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a> which are
virtually initialized such that every possible key exists and is mapped to a
value whose byte-representation is all zeros. This analogy does not go
too far, though, as it is neither possible to obtain a list of all keys of
a mapping, nor a list of all values. So either keep in mind (or
better, keep a list or use a more advanced data type) what you
added to the mapping or use it in a context where this is not needed,
like this one. The <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a> created by the <code class="docutils literal"><span class="pre">public</span></code> keyword
is a bit more complex in this case. It roughly looks like the
following:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">balances</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_account</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">balances</span><span class="p">[</span><span class="nx">_account</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you see, you can use this function to easily query the balance of a
single account.</p>
<p id="index-2">The line <code class="docutils literal"><span class="pre">event</span> <span class="pre">Sent(address</span> <span class="pre">from,</span> <span class="pre">address</span> <span class="pre">to,</span> <span class="pre">uint</span> <span class="pre">amount);</span></code> declares
a so-called “event” which is emitted in the last line of the function
<code class="docutils literal"><span class="pre">send</span></code>. User interfaces (as well as server applications of course) can
listen for those events being emitted on the blockchain without much
cost. As soon as it is emitted, the listener will also receive the
arguments <code class="docutils literal"><span class="pre">from</span></code>, <code class="docutils literal"><span class="pre">to</span></code> and <code class="docutils literal"><span class="pre">amount</span></code>, which makes it easy to track
transactions. In order to listen for this event, you would use</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">Coin</span><span class="p">.</span><span class="nx">Sent</span><span class="p">().</span><span class="nx">watch</span><span class="p">({},</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Coin transfer: &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+</span>
            <span class="s2">&quot; coins were sent from &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">from</span> <span class="o">+</span>
            <span class="s2">&quot; to &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">to</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Balances now:\n&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;Sender: &quot;</span> <span class="o">+</span> <span class="nx">Coin</span><span class="p">.</span><span class="nx">balances</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">from</span><span class="p">)</span> <span class="o">+</span>
            <span class="s2">&quot;Receiver: &quot;</span> <span class="o">+</span> <span class="nx">Coin</span><span class="p">.</span><span class="nx">balances</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">args</span><span class="p">.</span><span class="nx">to</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Note how the automatically generated function <code class="docutils literal"><span class="pre">balances</span></code> is called from
the user interface.</p>
<p id="index-3">The special function <code class="docutils literal"><span class="pre">Coin</span></code> is the
constructor which is run during creation of the contract and
cannot be called afterwards. It permanently stores the address of the person creating the
contract: <code class="docutils literal"><span class="pre">msg</span></code> (together with <code class="docutils literal"><span class="pre">tx</span></code> and <code class="docutils literal"><span class="pre">block</span></code>) is a magic global variable that
contains some properties which allow access to the blockchain. <code class="docutils literal"><span class="pre">msg.sender</span></code> is
always the address where the current (external) function call came from.</p>
<p>Finally, the functions that will actually end up with the contract and can be called
by users and contracts alike are <code class="docutils literal"><span class="pre">mint</span></code> and <code class="docutils literal"><span class="pre">send</span></code>.
If <code class="docutils literal"><span class="pre">mint</span></code> is called by anyone except the account that created the contract,
nothing will happen. On the other hand, <code class="docutils literal"><span class="pre">send</span></code> can be used by anyone (who already
has some of these coins) to send coins to anyone else. Note that if you use
this contract to send coins to an address, you will not see anything when you
look at that address on a blockchain explorer, because the fact that you sent
coins and the changed balances are only stored in the data storage of this
particular coin contract. By the use of events it is relatively easy to create
a “blockchain explorer” that tracks transactions and balances of your new coin.</p>
</div>
</div>
<div class="section" id="blockchain-basics">
<span id="id1"></span><h3>Blockchain Basics<a class="headerlink" href="#blockchain-basics" title="Permalink to this headline">¶</a></h3>
<p>Blockchains as a concept are not too hard to understand for programmers. The reason is that
most of the complications (mining, <a class="reference external" href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">hashing</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography">elliptic-curve cryptography</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Peer-to-peer">peer-to-peer networks</a>, etc.)
are just there to provide a certain set of features and promises. Once you accept these
features as given, you do not have to worry about the underlying technology - or do you have
to know how Amazon’s AWS works internally in order to use it?</p>
<div class="section" id="transactions">
<span id="index-4"></span><h4>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h4>
<p>A blockchain is a globally shared, transactional database.
This means that everyone can read entries in the database just by participating in the network.
If you want to change something in the database, you have to create a so-called transaction
which has to be accepted by all others.
The word transaction implies that the change you want to make (assume you want to change
two values at the same time) is either not done at all or completely applied. Furthermore,
while your transaction is applied to the database, no other transaction can alter it.</p>
<p>As an example, imagine a table that lists the balances of all accounts in an
electronic currency. If a transfer from one account to another is requested,
the transactional nature of the database ensures that if the amount is
subtracted from one account, it is always added to the other account. If due
to whatever reason, adding the amount to the target account is not possible,
the source account is also not modified.</p>
<p>Furthermore, a transaction is always cryptographically signed by the sender (creator).
This makes it straightforward to guard access to specific modifications of the
database. In the example of the electronic currency, a simple check ensures that
only the person holding the keys to the account can transfer money from it.</p>
</div>
<div class="section" id="blocks">
<span id="index-5"></span><h4>Blocks<a class="headerlink" href="#blocks" title="Permalink to this headline">¶</a></h4>
<p>One major obstacle to overcome is what, in Bitcoin terms, is called a “double-spend attack”:
What happens if two transactions exist in the network that both want to empty an account,
a so-called conflict?</p>
<p>The abstract answer to this is that you do not have to care. An order of the transactions
will be selected for you, the transactions will be bundled into what is called a “block”
and then they will be executed and distributed among all participating nodes.
If two transactions contradict each other, the one that ends up being second will
be rejected and not become part of the block.</p>
<p>These blocks form a linear sequence in time and that is where the word “blockchain”
derives from. Blocks are added to the chain in rather regular intervals - for
Ethereum this is roughly every 17 seconds.</p>
<p>As part of the “order selection mechanism” (which is called “mining”) it may happen that
blocks are reverted from time to time, but only at the “tip” of the chain. The more
blocks that are added on top, the less likely it is. So it might be that your transactions
are reverted and even removed from the blockchain, but the longer you wait, the less
likely it will be.</p>
<span class="target" id="the-ethereum-virtual-machine"></span></div>
</div>
<div class="section" id="index-6">
<span id="id2"></span><h3>The Ethereum Virtual Machine<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h3>
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>The Ethereum Virtual Machine or EVM is the runtime environment
for smart contracts in Ethereum. It is not only sandboxed but
actually completely isolated, which means that code running
inside the EVM has no access to network, filesystem or other processes.
Smart contracts even have limited access to other smart contracts.</p>
</div>
<div class="section" id="accounts">
<span id="index-7"></span><h4>Accounts<a class="headerlink" href="#accounts" title="Permalink to this headline">¶</a></h4>
<p>There are two kinds of accounts in Ethereum which share the same
address space: <strong>External accounts</strong> that are controlled by
public-private key pairs (i.e. humans) and <strong>contract accounts</strong> which are
controlled by the code stored together with the account.</p>
<p>The address of an external account is determined from
the public key while the address of a contract is
determined at the time the contract is created
(it is derived from the creator address and the number
of transactions sent from that address, the so-called “nonce”).</p>
<p>Regardless of whether or not the account stores code, the two types are
treated equally by the EVM.</p>
<p>Every account has a persistent key-value store mapping 256-bit words to 256-bit
words called <strong>storage</strong>.</p>
<p>Furthermore, every account has a <strong>balance</strong> in
Ether (in “Wei” to be exact) which can be modified by sending transactions that
include Ether.</p>
</div>
<div class="section" id="index-8">
<span id="id3"></span><h4>Transactions<a class="headerlink" href="#index-8" title="Permalink to this headline">¶</a></h4>
<p>A transaction is a message that is sent from one account to another
account (which might be the same or the special zero-account, see below).
It can include binary data (its payload) and Ether.</p>
<p>If the target account contains code, that code is executed and
the payload is provided as input data.</p>
<p>If the target account is the zero-account (the account with the
address <code class="docutils literal"><span class="pre">0</span></code>), the transaction creates a <strong>new contract</strong>.
As already mentioned, the address of that contract is not
the zero address but an address derived from the sender and
its number of transactions sent (the “nonce”). The payload
of such a contract creation transaction is taken to be
EVM bytecode and executed. The output of this execution is
permanently stored as the code of the contract.
This means that in order to create a contract, you do not
send the actual code of the contract, but in fact code that
returns that code when executed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While a contract is being created, its code is still empty.
Because of that, you should not call back into the
contract under construction until its constructor has
finished executing.</p>
</div>
</div>
<div class="section" id="gas">
<span id="index-9"></span><h4>Gas<a class="headerlink" href="#gas" title="Permalink to this headline">¶</a></h4>
<p>Upon creation, each transaction is charged with a certain amount of <strong>gas</strong>,
whose purpose is to limit the amount of work that is needed to execute
the transaction and to pay for this execution. While the EVM executes the
transaction, the gas is gradually depleted according to specific rules.</p>
<p>The <strong>gas price</strong> is a value set by the creator of the transaction, who
has to pay <code class="docutils literal"><span class="pre">gas_price</span> <span class="pre">*</span> <span class="pre">gas</span></code> up front from the sending account.
If some gas is left after the execution, it is refunded in the same way.</p>
<p>If the gas is used up at any point (i.e. it is negative),
an out-of-gas exception is triggered, which reverts all modifications
made to the state in the current call frame.</p>
</div>
<div class="section" id="storage-memory-and-the-stack">
<span id="index-10"></span><h4>Storage, Memory and the Stack<a class="headerlink" href="#storage-memory-and-the-stack" title="Permalink to this headline">¶</a></h4>
<p>Each account has a persistent memory area which is called <strong>storage</strong>.
Storage is a key-value store that maps 256-bit words to 256-bit words.
It is not possible to enumerate storage from within a contract
and it is comparatively costly to read and even more so, to modify
storage. A contract can neither read nor write to any storage apart
from its own.</p>
<p>The second memory area is called <strong>memory</strong>, of which a contract obtains
a freshly cleared instance for each message call. Memory is linear and can be
addressed at byte level, but reads are limited to a width of 256 bits, while writes
can be either 8 bits or 256 bits wide. Memory is expanded by a word (256-bit), when
accessing (either reading or writing) a previously untouched memory word (ie. any offset
within a word). At the time of expansion, the cost in gas must be paid. Memory is more
costly the larger it grows (it scales quadratically).</p>
<p>The EVM is not a register machine but a stack machine, so all
computations are performed on an area called the <strong>stack</strong>. It has a maximum size of
1024 elements and contains words of 256 bits. Access to the stack is
limited to the top end in the following way:
It is possible to copy one of
the topmost 16 elements to the top of the stack or swap the
topmost element with one of the 16 elements below it.
All other operations take the topmost two (or one, or more, depending on
the operation) elements from the stack and push the result onto the stack.
Of course it is possible to move stack elements to storage or memory,
but it is not possible to just access arbitrary elements deeper in the stack
without first removing the top of the stack.</p>
</div>
<div class="section" id="instruction-set">
<span id="index-11"></span><h4>Instruction Set<a class="headerlink" href="#instruction-set" title="Permalink to this headline">¶</a></h4>
<p>The instruction set of the EVM is kept minimal in order to avoid
incorrect implementations which could cause consensus problems.
All instructions operate on the basic data type, 256-bit words.
The usual arithmetic, bit, logical and comparison operations are present.
Conditional and unconditional jumps are possible. Furthermore,
contracts can access relevant properties of the current block
like its number and timestamp.</p>
</div>
<div class="section" id="message-calls">
<span id="index-12"></span><h4>Message Calls<a class="headerlink" href="#message-calls" title="Permalink to this headline">¶</a></h4>
<p>Contracts can call other contracts or send Ether to non-contract
accounts by the means of message calls. Message calls are similar
to transactions, in that they have a source, a target, data payload,
Ether, gas and return data. In fact, every transaction consists of
a top-level message call which in turn can create further message calls.</p>
<p>A contract can decide how much of its remaining <strong>gas</strong> should be sent
with the inner message call and how much it wants to retain.
If an out-of-gas exception happens in the inner call (or any
other exception), this will be signalled by an error value put onto the stack.
In this case, only the gas sent together with the call is used up.
In Solidity, the calling contract causes a manual exception by default in
such situations, so that exceptions “bubble up” the call stack.</p>
<p>As already said, the called contract (which can be the same as the caller)
will receive a freshly cleared instance of memory and has access to the
call payload - which will be provided in a separate area called the <strong>calldata</strong>.
After it has finished execution, it can return data which will be stored at
a location in the caller’s memory preallocated by the caller.</p>
<p>Calls are <strong>limited</strong> to a depth of 1024, which means that for more complex
operations, loops should be preferred over recursive calls.</p>
</div>
<div class="section" id="delegatecall-callcode-and-libraries">
<span id="index-13"></span><h4>Delegatecall / Callcode and Libraries<a class="headerlink" href="#delegatecall-callcode-and-libraries" title="Permalink to this headline">¶</a></h4>
<p>There exists a special variant of a message call, named <strong>delegatecall</strong>
which is identical to a message call apart from the fact that
the code at the target address is executed in the context of the calling
contract and <code class="docutils literal"><span class="pre">msg.sender</span></code> and <code class="docutils literal"><span class="pre">msg.value</span></code> do not change their values.</p>
<p>This means that a contract can dynamically load code from a different
address at runtime. Storage, current address and balance still
refer to the calling contract, only the code is taken from the called address.</p>
<p>This makes it possible to implement the “library” feature in Solidity:
Reusable library code that can be applied to a contract’s storage, e.g. in
order to  implement a complex data structure.</p>
</div>
<div class="section" id="logs">
<span id="index-14"></span><h4>Logs<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h4>
<p>It is possible to store data in a specially indexed data structure
that maps all the way up to the block level. This feature called <strong>logs</strong>
is used by Solidity in order to implement <strong>events</strong>.
Contracts cannot access log data after it has been created, but they
can be efficiently accessed from outside the blockchain.
Since some part of the log data is stored in <a class="reference external" href="https://en.wikipedia.org/wiki/Bloom_filter">bloom filters</a>, it is
possible to search for this data in an efficient and cryptographically
secure way, so network peers that do not download the whole blockchain
(“light clients”) can still find these logs.</p>
</div>
<div class="section" id="create">
<span id="index-15"></span><h4>Create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h4>
<p>Contracts can even create other contracts using a special opcode (i.e.
they do not simply call the zero address). The only difference between
these <strong>create calls</strong> and normal message calls is that the payload data is
executed and the result stored as code and the caller / creator
receives the address of the new contract on the stack.</p>
</div>
<div class="section" id="self-destruct">
<span id="index-16"></span><h4>Self-destruct<a class="headerlink" href="#self-destruct" title="Permalink to this headline">¶</a></h4>
<p>The only possibility that code is removed from the blockchain is
when a contract at that address performs the <code class="docutils literal"><span class="pre">selfdestruct</span></code> operation.
The remaining Ether stored at that address is sent to a designated
target and then the storage and code is removed from the state.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Even if a contract’s code does not contain a call to <code class="docutils literal"><span class="pre">selfdestruct</span></code>,
it can still perform that operation using <code class="docutils literal"><span class="pre">delegatecall</span></code> or <code class="docutils literal"><span class="pre">callcode</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The pruning of old contracts may or may not be implemented by Ethereum
clients. Additionally, archive nodes could choose to keep the contract storage
and code indefinitely.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently <strong>external accounts</strong> cannot be removed from the state.</p>
</div>
</div>
</div>
</div>
<span id="document-installing-solidity"></span><div class="section" id="installing-the-solidity-compiler">
<span id="installing-solidity"></span><span id="index-0"></span><h2>Installing the Solidity Compiler<a class="headerlink" href="#installing-the-solidity-compiler" title="Permalink to this headline">¶</a></h2>
<div class="section" id="versioning">
<h3>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h3>
<p>Solidity versions follow <a class="reference external" href="https://semver.org">semantic versioning</a> and in addition to
releases, <strong>nightly development builds</strong> are also made available.  The nightly builds
are not guaranteed to be working and despite best efforts they might contain undocumented
and/or broken changes. We recommend using the latest release. Package installers below
will use the latest release.</p>
</div>
<div class="section" id="remix">
<h3>Remix<a class="headerlink" href="#remix" title="Permalink to this headline">¶</a></h3>
<p><em>We recommend Remix for small contracts and for quickly learning Solidity.</em></p>
<p><a class="reference external" href="https://remix.ethereum.org/">Access Remix online</a>, you don’t need to install anything.
If you want to use it without connection to the Internet, go to
<a class="reference external" href="https://github.com/ethereum/browser-solidity/tree/gh-pages">https://github.com/ethereum/browser-solidity/tree/gh-pages</a> and download the .ZIP file as
explained on that page.</p>
<p>Further options on this page detail installing commandline Solidity compiler software
on your computer. Choose a commandline compiler if you are working on a larger contract
or if you require more compilation options.</p>
</div>
<div class="section" id="npm-node-js">
<span id="solcjs"></span><h3>npm / Node.js<a class="headerlink" href="#npm-node-js" title="Permalink to this headline">¶</a></h3>
<p>Use <cite>npm</cite> for a convenient and portable way to install <cite>solcjs</cite>, a Solidity compiler. The
<cite>solcjs</cite> program has fewer features than all options further down this page. Our
<a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> documentation assumes you are using
the full-featured compiler, <cite>solc</cite>. So if you install <cite>solcjs</cite> from <cite>npm</cite> then you will
stop reading the documentation here and then continue to <a class="reference external" href="https://github.com/ethereum/solc-js">solc-js</a>.</p>
<p>Note: The solc-js project is derived from the C++
<cite>solc</cite> by using Emscripten. <cite>solc-js</cite> can be used in JavaScript projects directly (such as Remix).
Please refer to the solc-js repository for instructions.</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">solc</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The commandline is named <cite>solcjs</cite>.</p>
<p class="last">The comandline options of <cite>solcjs</cite> are not compatible with <cite>solc</cite> and tools (such as <cite>geth</cite>)
expecting the behaviour of <cite>solc</cite> will not work with <cite>solcjs</cite>.</p>
</div>
</div>
<div class="section" id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h3>
<p>We provide up to date docker builds for the compiler. The <code class="docutils literal"><span class="pre">stable</span></code>
repository contains released versions while the <code class="docutils literal"><span class="pre">nightly</span></code>
repository contains potentially unstable changes in the develop branch.</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">docker</span> <span class="nx">run</span> <span class="nx">ethereum</span><span class="o">/</span><span class="nx">solc</span><span class="o">:</span><span class="nx">stable</span> <span class="nx">solc</span> <span class="o">--</span><span class="nx">version</span>
</pre></div>
</div>
<p>Currently, the docker image only contains the compiler executable,
so you have to do some additional work to link in the source and
output directories.</p>
</div>
<div class="section" id="binary-packages">
<h3>Binary Packages<a class="headerlink" href="#binary-packages" title="Permalink to this headline">¶</a></h3>
<p>Binary packages of Solidity are available at
<a class="reference external" href="https://github.com/ethereum/solidity/releases">solidity/releases</a>.</p>
<p>We also have PPAs for Ubuntu.  For the latest stable version.</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">solc</span>
</pre></div>
</div>
<p>If you want to use the cutting edge developer version:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span>
<span class="nx">sudo</span> <span class="nx">add</span><span class="o">-</span><span class="nx">apt</span><span class="o">-</span><span class="nx">repository</span> <span class="nx">ppa</span><span class="o">:</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span><span class="o">-</span><span class="nx">dev</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">update</span>
<span class="nx">sudo</span> <span class="nx">apt</span><span class="o">-</span><span class="nx">get</span> <span class="nx">install</span> <span class="nx">solc</span>
</pre></div>
</div>
<p>We are also releasing a <a class="reference external" href="https://snapcraft.io/">snap package</a>, which is installable in all the <a class="reference external" href="https://snapcraft.io/docs/core/install">supported Linux distros</a>. To install the latest stable version of solc:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">snap</span> <span class="nx">install</span> <span class="nx">solc</span>
</pre></div>
</div>
<p>Or if you want to help testing the unstable solc with the most recent changes from the development branch:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">snap</span> <span class="nx">install</span> <span class="nx">solc</span> <span class="o">--</span><span class="nx">edge</span>
</pre></div>
</div>
<p>Arch Linux also has packages, albeit limited to the latest development version:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">pacman</span> <span class="o">-</span><span class="nx">S</span> <span class="nx">solidity</span>
</pre></div>
</div>
<p>Homebrew is missing pre-built bottles at the time of writing,
following a Jenkins to TravisCI migration, but Homebrew
should still work just fine as a means to build-from-source.
We will re-add the pre-built bottles soon.</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">brew</span> <span class="nx">update</span>
<span class="nx">brew</span> <span class="nx">upgrade</span>
<span class="nx">brew</span> <span class="nx">tap</span> <span class="nx">ethereum</span><span class="o">/</span><span class="nx">ethereum</span>
<span class="nx">brew</span> <span class="nx">install</span> <span class="nx">solidity</span>
</pre></div>
</div>
<p>If you need a specific version of Solidity you can install a
Homebrew formula directly from Github.</p>
<p>View
<a class="reference external" href="https://github.com/ethereum/homebrew-ethereum/commits/master/solidity.rb">solidity.rb commits on Github</a>.</p>
<p>Follow the history links until you have a raw file link of a
specific commit of <code class="docutils literal"><span class="pre">solidity.rb</span></code>.</p>
<p>Install it using <code class="docutils literal"><span class="pre">brew</span></code>:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">brew</span> <span class="nx">unlink</span> <span class="nx">solidity</span>
<span class="err">#</span> <span class="nx">Install</span> <span class="mf">0.4</span><span class="p">.</span><span class="mi">8</span>
<span class="nx">brew</span> <span class="nx">install</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//raw.githubusercontent.com/ethereum/homebrew-ethereum/77cce03da9f289e5a3ffe579840d3c5dc0a62717/solidity.rb</span>
</pre></div>
</div>
<p>Gentoo Linux also provides a solidity package that can be installed using <code class="docutils literal"><span class="pre">emerge</span></code>:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">emerge</span> <span class="nx">dev</span><span class="o">-</span><span class="nx">lang</span><span class="o">/</span><span class="nx">solidity</span>
</pre></div>
</div>
</div>
<div class="section" id="building-from-source">
<span id="id1"></span><h3>Building from Source<a class="headerlink" href="#building-from-source" title="Permalink to this headline">¶</a></h3>
<div class="section" id="clone-the-repository">
<h4>Clone the Repository<a class="headerlink" href="#clone-the-repository" title="Permalink to this headline">¶</a></h4>
<p>To clone the source code, execute the following command:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">clone</span> <span class="o">--</span><span class="nx">recursive</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//github.com/ethereum/solidity.git</span>
<span class="nx">cd</span> <span class="nx">solidity</span>
</pre></div>
</div>
<p>If you want to help developing Solidity,
you should fork Solidity and add your personal fork as a second remote:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">cd</span> <span class="nx">solidity</span>
<span class="nx">git</span> <span class="nx">remote</span> <span class="nx">add</span> <span class="nx">personal</span> <span class="nx">git</span><span class="err">@</span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">:</span><span class="p">[</span><span class="nx">username</span><span class="p">]</span><span class="o">/</span><span class="nx">solidity</span><span class="p">.</span><span class="nx">git</span>
</pre></div>
</div>
<p>Solidity has git submodules.  Ensure they are properly loaded:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">git</span> <span class="nx">submodule</span> <span class="nx">update</span> <span class="o">--</span><span class="nx">init</span> <span class="o">--</span><span class="nx">recursive</span>
</pre></div>
</div>
</div>
<div class="section" id="prerequisites-macos">
<h4>Prerequisites - macOS<a class="headerlink" href="#prerequisites-macos" title="Permalink to this headline">¶</a></h4>
<p>For macOS, ensure that you have the latest version of
<a class="reference external" href="https://developer.apple.com/xcode/download/">Xcode installed</a>.
This contains the <a class="reference external" href="https://en.wikipedia.org/wiki/Clang">Clang C++ compiler</a>, the
<a class="reference external" href="https://en.wikipedia.org/wiki/Xcode">Xcode IDE</a> and other Apple development
tools which are required for building C++ applications on OS X.
If you are installing Xcode for the first time, or have just installed a new
version then you will need to agree to the license before you can do
command-line builds:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">sudo</span> <span class="nx">xcodebuild</span> <span class="o">-</span><span class="nx">license</span> <span class="nx">accept</span>
</pre></div>
</div>
<p>Our OS X builds require you to <a class="reference external" href="http://brew.sh">install the Homebrew</a>
package manager for installing external dependencies.
Here’s how to <a class="reference external" href="https://github.com/Homebrew/homebrew/blob/master/share/doc/homebrew/FAQ.md#how-do-i-uninstall-homebrew">uninstall Homebrew</a>,
if you ever want to start again from scratch.</p>
</div>
<div class="section" id="prerequisites-windows">
<h4>Prerequisites - Windows<a class="headerlink" href="#prerequisites-windows" title="Permalink to this headline">¶</a></h4>
<p>You will need to install the following dependencies for Windows builds of Solidity:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Software</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="https://git-scm.com/download/win">Git for Windows</a></td>
<td>Command-line tool for retrieving source from Github.</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://cmake.org/download/">CMake</a></td>
<td>Cross-platform build file generator.</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://www.visualstudio.com/downloads/#build-tools-for-visual-studio-2017">Visual Studio 2017 Build Tools</a></td>
<td>C++ compiler</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://www.visualstudio.com/vs/">Visual Studio 2017</a>  (Optional)</td>
<td>C++ compiler and dev environment.</td>
</tr>
</tbody>
</table>
<p>If you’ve already had one IDE and only need compiler and libraries,
you could install Visual Studio 2017 Build Tools.</p>
<p>Visual Studio 2017 provides both IDE and necessary compiler and libraries.
So if you have not got an IDE and prefer to develop solidity, Visual Studio 2017
may be an choice for you to get everything setup easily.</p>
<p>Here is the list of components that should be installed
in Visual Studio 2017 Build Tools or Visual Studio 2017:</p>
<ul class="simple">
<li>Visual Studio C++ core features</li>
<li>VC++ 2017 v141 toolset (x86,x64)</li>
<li>Windows Universal CRT SDK</li>
<li>Windows 8.1 SDK</li>
<li>C++/CLI support</li>
</ul>
</div>
<div class="section" id="external-dependencies">
<h4>External Dependencies<a class="headerlink" href="#external-dependencies" title="Permalink to this headline">¶</a></h4>
<p>We now have a “one button” script which installs all required external dependencies
on macOS, Windows and on numerous Linux distros.  This used to be a multi-step
manual process, but is now a one-liner:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">install_deps</span><span class="p">.</span><span class="nx">sh</span>
</pre></div>
</div>
<p>Or, on Windows:</p>
<div class="code bat highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">scripts</span><span class="err">\</span><span class="nx">install_deps</span><span class="p">.</span><span class="nx">bat</span>
</pre></div>
</div>
</div>
<div class="section" id="command-line-build">
<h4>Command-Line Build<a class="headerlink" href="#command-line-build" title="Permalink to this headline">¶</a></h4>
<p><strong>Be sure to install External Dependencies (see above) before build.</strong></p>
<p>Solidity project uses CMake to configure the build.
Building Solidity is quite similar on Linux, macOS and other Unices:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">mkdir</span> <span class="nx">build</span>
<span class="nx">cd</span> <span class="nx">build</span>
<span class="nx">cmake</span> <span class="p">..</span> <span class="o">&amp;&amp;</span> <span class="nx">make</span>
</pre></div>
</div>
<p>or even easier:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="err">#</span><span class="nx">note</span><span class="o">:</span> <span class="k">this</span> <span class="nx">will</span> <span class="nx">install</span> <span class="nx">binaries</span> <span class="nx">solc</span> <span class="nx">and</span> <span class="nx">soltest</span> <span class="nx">at</span> <span class="nx">usr</span><span class="o">/</span><span class="nx">local</span><span class="o">/</span><span class="nx">bin</span>
<span class="p">.</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">build</span><span class="p">.</span><span class="nx">sh</span>
</pre></div>
</div>
<p>And even for Windows:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">mkdir</span> <span class="nx">build</span>
<span class="nx">cd</span> <span class="nx">build</span>
<span class="nx">cmake</span> <span class="o">-</span><span class="nx">G</span> <span class="s2">&quot;Visual Studio 15 2017 Win64&quot;</span> <span class="p">..</span>
</pre></div>
</div>
<p>This latter set of instructions should result in the creation of
<strong>solidity.sln</strong> in that build directory.  Double-clicking on that file
should result in Visual Studio firing up.  We suggest building
<strong>RelWithDebugInfo</strong> configuration, but all others work.</p>
<p>Alternatively, you can build for Windows on the command-line, like so:</p>
<div class="code bash highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">cmake</span> <span class="o">--</span><span class="nx">build</span> <span class="p">.</span> <span class="o">--</span><span class="nx">config</span> <span class="nx">RelWithDebInfo</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cmake-options">
<h3>CMake options<a class="headerlink" href="#cmake-options" title="Permalink to this headline">¶</a></h3>
<p>If you are interested what CMake options are available run <code class="docutils literal"><span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-LH</span></code>.</p>
</div>
<div class="section" id="the-version-string-in-detail">
<h3>The version string in detail<a class="headerlink" href="#the-version-string-in-detail" title="Permalink to this headline">¶</a></h3>
<p>The Solidity version string contains four parts:</p>
<ul class="simple">
<li>the version number</li>
<li>pre-release tag, usually set to <code class="docutils literal"><span class="pre">develop.YYYY.MM.DD</span></code> or <code class="docutils literal"><span class="pre">nightly.YYYY.MM.DD</span></code></li>
<li>commit in the format of <code class="docutils literal"><span class="pre">commit.GITHASH</span></code></li>
<li>platform has arbitrary number of items, containing details about the platform and compiler</li>
</ul>
<p>If there are local modifications, the commit will be postfixed with <code class="docutils literal"><span class="pre">.mod</span></code>.</p>
<p>These parts are combined as required by Semver, where the Solidity pre-release tag equals to the Semver pre-release
and the Solidity commit and platform combined make up the Semver build metadata.</p>
<p>A release example: <code class="docutils literal"><span class="pre">0.4.8+commit.60cc1668.Emscripten.clang</span></code>.</p>
<p>A pre-release example: <code class="docutils literal"><span class="pre">0.4.9-nightly.2017.1.17+commit.6ecb4aa3.Emscripten.clang</span></code></p>
</div>
<div class="section" id="important-information-about-versioning">
<h3>Important information about versioning<a class="headerlink" href="#important-information-about-versioning" title="Permalink to this headline">¶</a></h3>
<p>After a release is made, the patch version level is bumped, because we assume that only
patch level changes follow. When changes are merged, the version should be bumped according
to semver and the severity of the change. Finally, a release is always made with the version
of the current nightly build, but without the <code class="docutils literal"><span class="pre">prerelease</span></code> specifier.</p>
<p>Example:</p>
<ol class="arabic simple" start="0">
<li>the 0.4.0 release is made</li>
<li>nightly build has a version of 0.4.1 from now on</li>
<li>non-breaking changes are introduced - no change in version</li>
<li>a breaking change is introduced - version is bumped to 0.5.0</li>
<li>the 0.5.0 release is made</li>
</ol>
<p>This behaviour works well with the  <a class="reference internal" href="index.html#version-pragma"><span class="std std-ref">version pragma</span></a>.</p>
</div>
</div>
<span id="document-solidity-by-example"></span><div class="section" id="solidity-by-example">
<h2>Solidity by Example<a class="headerlink" href="#solidity-by-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="voting">
<span id="index-0"></span><span id="id1"></span><h3>Voting<a class="headerlink" href="#voting" title="Permalink to this headline">¶</a></h3>
<p>The following contract is quite complex, but showcases
a lot of Solidity’s features. It implements a voting
contract. Of course, the main problems of electronic
voting is how to assign voting rights to the correct
persons and how to prevent manipulation. We will not
solve all problems here, but at least we will show
how delegated voting can be done so that vote counting
is <strong>automatic and completely transparent</strong> at the
same time.</p>
<p>The idea is to create one contract per ballot,
providing a short name for each option.
Then the creator of the contract who serves as
chairperson will give the right to vote to each
address individually.</p>
<p>The persons behind the addresses can then choose
to either vote themselves or to delegate their
vote to a person they trust.</p>
<p>At the end of the voting time, <code class="docutils literal"><span class="pre">winningProposal()</span></code>
will return the proposal with the largest number
of votes.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="cs">/// </span><span class="k">@title</span><span class="cs"> Voting with delegation.</span>
<span class="kd">contract</span> <span class="nx">Ballot</span> <span class="p">{</span>
    <span class="c1">// This declares a new complex type which will</span>
    <span class="c1">// be used for variables later.</span>
    <span class="c1">// It will represent a single voter.</span>
    <span class="kd">struct</span> <span class="nx">Voter</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">weight</span><span class="p">;</span> <span class="c1">// weight is accumulated by delegation</span>
        <span class="kt">bool</span> <span class="nx">voted</span><span class="p">;</span>  <span class="c1">// if true, that person already voted</span>
        <span class="kt">address</span> <span class="nx">delegate</span><span class="p">;</span> <span class="c1">// person delegated to</span>
        <span class="kt">uint</span> <span class="nx">vote</span><span class="p">;</span>   <span class="c1">// index of the voted proposal</span>
    <span class="p">}</span>

    <span class="c1">// This is a type for a single proposal.</span>
    <span class="kd">struct</span> <span class="nx">Proposal</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="nx">name</span><span class="p">;</span>   <span class="c1">// short name (up to 32 bytes)</span>
        <span class="kt">uint</span> <span class="nx">voteCount</span><span class="p">;</span> <span class="c1">// number of accumulated votes</span>
    <span class="p">}</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">chairperson</span><span class="p">;</span>

    <span class="c1">// This declares a state variable that</span>
    <span class="c1">// stores a `Voter` struct for each possible address.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="nx">Voter</span><span class="p">)</span> <span class="k">public</span> <span class="nx">voters</span><span class="p">;</span>

    <span class="c1">// A dynamically-sized array of `Proposal` structs.</span>
    <span class="nx">Proposal</span><span class="p">[]</span> <span class="k">public</span> <span class="nx">proposals</span><span class="p">;</span>

    <span class="cs">/// Create a new ballot to choose one of `proposalNames`.</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">proposalNames</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">chairperson</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">voters</span><span class="p">[</span><span class="nx">chairperson</span><span class="p">].</span><span class="nx">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1">// For each of the provided proposal names,</span>
        <span class="c1">// create a new proposal object and add it</span>
        <span class="c1">// to the end of the array.</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">proposalNames</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// `Proposal({...})` creates a temporary</span>
            <span class="c1">// Proposal object and `proposals.push(...)`</span>
            <span class="c1">// appends it to the end of `proposals`.</span>
            <span class="nx">proposals</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Proposal</span><span class="p">({</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">proposalNames</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
                <span class="nx">voteCount</span><span class="o">:</span> <span class="mi">0</span>
            <span class="p">}));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Give `voter` the right to vote on this ballot.</span>
    <span class="c1">// May only be called by `chairperson`.</span>
    <span class="kd">function</span> <span class="nx">giveRightToVote</span><span class="p">(</span><span class="kt">address</span> <span class="nx">voter</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// If the first argument of `require` evaluates</span>
        <span class="c1">// to `false`, execution terminates and all</span>
        <span class="c1">// changes to the state and to Ether balances</span>
        <span class="c1">// are reverted.</span>
        <span class="c1">// This used to consume all gas in old EVM versions, but</span>
        <span class="c1">// not anymore.</span>
        <span class="c1">// It is often a good idea to use `require` to check if</span>
        <span class="c1">// functions are called correctly.</span>
        <span class="c1">// As a second argument, you can also provide an</span>
        <span class="c1">// explanation about what went wrong.</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">chairperson</span><span class="p">,</span>
            <span class="s2">&quot;Only chairperson can give right to vote.&quot;</span>
        <span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="o">!</span><span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">voted</span><span class="p">,</span>
            <span class="s2">&quot;The voter already voted.&quot;</span>
        <span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nx">voters</span><span class="p">[</span><span class="nx">voter</span><span class="p">].</span><span class="nx">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Delegate your vote to the voter `to`.</span>
    <span class="kd">function</span> <span class="nx">delegate</span><span class="p">(</span><span class="kt">address</span> <span class="nx">to</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// assigns reference</span>
        <span class="nx">Voter</span> <span class="k">storage</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span><span class="p">,</span> <span class="s2">&quot;You already voted.&quot;</span><span class="p">);</span>

        <span class="nb">require</span><span class="p">(</span><span class="nx">to</span> <span class="o">!=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="s2">&quot;Self-delegation is disallowed.&quot;</span><span class="p">);</span>

        <span class="c1">// Forward the delegation as long as</span>
        <span class="c1">// `to` also delegated.</span>
        <span class="c1">// In general, such loops are very dangerous,</span>
        <span class="c1">// because if they run too long, they might</span>
        <span class="c1">// need more gas than is available in a block.</span>
        <span class="c1">// In this case, the delegation will not be executed,</span>
        <span class="c1">// but in other situations, such loops might</span>
        <span class="c1">// cause a contract to get &quot;stuck&quot; completely.</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nx">delegate</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">to</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nx">delegate</span><span class="p">;</span>

            <span class="c1">// We found a loop in the delegation, not allowed.</span>
            <span class="nb">require</span><span class="p">(</span><span class="nx">to</span> <span class="o">!=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="s2">&quot;Found loop in delegation.&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Since `sender` is a reference, this</span>
        <span class="c1">// modifies `voters[msg.sender].voted`</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">delegate</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
        <span class="nx">Voter</span> <span class="k">storage</span> <span class="nx">delegate_</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nx">to</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">delegate_</span><span class="p">.</span><span class="nx">voted</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// If the delegate already voted,</span>
            <span class="c1">// directly add to the number of votes</span>
            <span class="nx">proposals</span><span class="p">[</span><span class="nx">delegate_</span><span class="p">.</span><span class="nx">vote</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// If the delegate did not vote yet,</span>
            <span class="c1">// add to her weight.</span>
            <span class="nx">delegate_</span><span class="p">.</span><span class="nx">weight</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cs">/// Give your vote (including votes delegated to you)</span>
    <span class="cs">/// to proposal `proposals[proposal].name`.</span>
    <span class="kd">function</span> <span class="nx">vote</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">proposal</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">Voter</span> <span class="k">storage</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">voters</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span><span class="p">,</span> <span class="s2">&quot;Already voted.&quot;</span><span class="p">);</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">sender</span><span class="p">.</span><span class="nx">vote</span> <span class="o">=</span> <span class="nx">proposal</span><span class="p">;</span>

        <span class="c1">// If `proposal` is out of the range of the array,</span>
        <span class="c1">// this will throw automatically and revert all</span>
        <span class="c1">// changes.</span>
        <span class="nx">proposals</span><span class="p">[</span><span class="nx">proposal</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">+=</span> <span class="nx">sender</span><span class="p">.</span><span class="nx">weight</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// </span><span class="k">@dev</span><span class="cs"> Computes the winning proposal taking all</span>
    <span class="cs">/// previous votes into account.</span>
    <span class="kd">function</span> <span class="nx">winningProposal</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">winningProposal_</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">winningVoteCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">p</span> <span class="o">&lt;</span> <span class="nx">proposals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">proposals</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">voteCount</span> <span class="o">&gt;</span> <span class="nx">winningVoteCount</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">winningVoteCount</span> <span class="o">=</span> <span class="nx">proposals</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">voteCount</span><span class="p">;</span>
                <span class="nx">winningProposal_</span> <span class="o">=</span> <span class="nx">p</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Calls winningProposal() function to get the index</span>
    <span class="c1">// of the winner contained in the proposals array and then</span>
    <span class="c1">// returns the name of the winner</span>
    <span class="kd">function</span> <span class="nx">winnerName</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span> <span class="nx">winnerName_</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">winnerName_</span> <span class="o">=</span> <span class="nx">proposals</span><span class="p">[</span><span class="nx">winningProposal</span><span class="p">()].</span><span class="nx">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="possible-improvements">
<h4>Possible Improvements<a class="headerlink" href="#possible-improvements" title="Permalink to this headline">¶</a></h4>
<p>Currently, many transactions are needed to assign the rights
to vote to all participants. Can you think of a better way?</p>
</div>
</div>
<div class="section" id="blind-auction">
<span id="index-1"></span><h3>Blind Auction<a class="headerlink" href="#blind-auction" title="Permalink to this headline">¶</a></h3>
<p>In this section, we will show how easy it is to create a
completely blind auction contract on Ethereum.
We will start with an open auction where everyone
can see the bids that are made and then extend this
contract into a blind auction where it is not
possible to see the actual bid until the bidding
period ends.</p>
<div class="section" id="simple-open-auction">
<span id="simple-auction"></span><h4>Simple Open Auction<a class="headerlink" href="#simple-open-auction" title="Permalink to this headline">¶</a></h4>
<p>The general idea of the following simple auction contract
is that everyone can send their bids during
a bidding period. The bids already include sending
money / ether in order to bind the bidders to their
bid. If the highest bid is raised, the previously
highest bidder gets her money back.
After the end of the bidding period, the
contract has to be called manually for the
beneficiary to receive his money - contracts cannot
activate themselves.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleAuction</span> <span class="p">{</span>
    <span class="c1">// Parameters of the auction. Times are either</span>
    <span class="c1">// absolute unix timestamps (seconds since 1970-01-01)</span>
    <span class="c1">// or time periods in seconds.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">auctionEnd</span><span class="p">;</span>

    <span class="c1">// Current state of the auction.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">highestBid</span><span class="p">;</span>

    <span class="c1">// Allowed withdrawals of previous bids</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">pendingReturns</span><span class="p">;</span>

    <span class="c1">// Set to true at the end, disallows any change</span>
    <span class="kt">bool</span> <span class="nx">ended</span><span class="p">;</span>

    <span class="c1">// Events that will be fired on changes.</span>
    <span class="kd">event</span> <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>
    <span class="kd">event</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="nx">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span>

    <span class="c1">// The following is a so-called natspec comment,</span>
    <span class="c1">// recognizable by the three slashes.</span>
    <span class="c1">// It will be shown when the user is asked to</span>
    <span class="c1">// confirm a transaction.</span>

    <span class="cs">/// Create a simple auction with `_biddingTime`</span>
    <span class="cs">/// seconds bidding time on behalf of the</span>
    <span class="cs">/// beneficiary address `_beneficiary`.</span>
    <span class="nx">constructor</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="nx">_biddingTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="nx">_beneficiary</span>
    <span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">beneficiary</span> <span class="o">=</span> <span class="nx">_beneficiary</span><span class="p">;</span>
        <span class="nx">auctionEnd</span> <span class="o">=</span> <span class="nb">now</span> <span class="o">+</span> <span class="nx">_biddingTime</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Bid on the auction with the value sent</span>
    <span class="cs">/// together with this transaction.</span>
    <span class="cs">/// The value will only be refunded if the</span>
    <span class="cs">/// auction is not won.</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// No arguments are necessary, all</span>
        <span class="c1">// information is already part of</span>
        <span class="c1">// the transaction. The keyword payable</span>
        <span class="c1">// is required for the function to</span>
        <span class="c1">// be able to receive Ether.</span>

        <span class="c1">// Revert the call if the bidding</span>
        <span class="c1">// period is over.</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">now</span> <span class="o">&lt;=</span> <span class="nx">auctionEnd</span><span class="p">,</span>
            <span class="s2">&quot;Auction already ended.&quot;</span>
        <span class="p">);</span>

        <span class="c1">// If the bid is not higher, send the</span>
        <span class="c1">// money back.</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">highestBid</span><span class="p">,</span>
            <span class="s2">&quot;There already is a higher bid.&quot;</span>
        <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">highestBid</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Sending back the money by simply using</span>
            <span class="c1">// highestBidder.send(highestBid) is a security risk</span>
            <span class="c1">// because it could execute an untrusted contract.</span>
            <span class="c1">// It is always safer to let the recipients</span>
            <span class="c1">// withdraw their money themselves.</span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nx">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">highestBid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">highestBidder</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">highestBid</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
        <span class="nx">emit</span> <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cs">/// Withdraw a bid that was overbid.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// It is important to set this to zero because the recipient</span>
            <span class="c1">// can call this function again as part of the receiving call</span>
            <span class="c1">// before `send` returns.</span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">amount</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// No need to call throw here, just reset the amount owing</span>
                <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">amount</span><span class="p">;</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// End the auction and send the highest bid</span>
    <span class="cs">/// to the beneficiary.</span>
    <span class="kd">function</span> <span class="nx">auctionEnd</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// It is a good guideline to structure functions that interact</span>
        <span class="c1">// with other contracts (i.e. they call functions or send Ether)</span>
        <span class="c1">// into three phases:</span>
        <span class="c1">// 1. checking conditions</span>
        <span class="c1">// 2. performing actions (potentially changing conditions)</span>
        <span class="c1">// 3. interacting with other contracts</span>
        <span class="c1">// If these phases are mixed up, the other contract could call</span>
        <span class="c1">// back into the current contract and modify the state or cause</span>
        <span class="c1">// effects (ether payout) to be performed multiple times.</span>
        <span class="c1">// If functions called internally include interaction with external</span>
        <span class="c1">// contracts, they also have to be considered interaction with</span>
        <span class="c1">// external contracts.</span>

        <span class="c1">// 1. Conditions</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">auctionEnd</span><span class="p">,</span> <span class="s2">&quot;Auction not yet ended.&quot;</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">ended</span><span class="p">,</span> <span class="s2">&quot;auctionEnd has already been called.&quot;</span><span class="p">);</span>

        <span class="c1">// 2. Effects</span>
        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">emit</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="nx">highestBidder</span><span class="p">,</span> <span class="nx">highestBid</span><span class="p">);</span>

        <span class="c1">// 3. Interaction</span>
        <span class="nx">beneficiary</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">highestBid</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Blind Auction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The previous open auction is extended to a blind auction
in the following. The advantage of a blind auction is
that there is no time pressure towards the end of
the bidding period. Creating a blind auction on a
transparent computing platform might sound like a
contradiction, but cryptography comes to the rescue.</p>
<p>During the <strong>bidding period</strong>, a bidder does not
actually send her bid, but only a hashed version of it.
Since it is currently considered practically impossible
to find two (sufficiently long) values whose hash
values are equal, the bidder commits to the bid by that.
After the end of the bidding period, the bidders have
to reveal their bids: They send their values
unencrypted and the contract checks that the hash value
is the same as the one provided during the bidding period.</p>
<p>Another challenge is how to make the auction
<strong>binding and blind</strong> at the same time: The only way to
prevent the bidder from just not sending the money
after he won the auction is to make her send it
together with the bid. Since value transfers cannot
be blinded in Ethereum, anyone can see the value.</p>
<p>The following contract solves this problem by
accepting any value that is larger than the highest
bid. Since this can of course only be checked during
the reveal phase, some bids might be <strong>invalid</strong>, and
this is on purpose (it even provides an explicit
flag to place invalid bids with high value transfers):
Bidders can confuse competition by placing several
high or low invalid bids.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">BlindAuction</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Bid</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="nx">blindedBid</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">deposit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">biddingEnd</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">revealEnd</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="k">public</span> <span class="nx">ended</span><span class="p">;</span>

    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="nx">Bid</span><span class="p">[])</span> <span class="k">public</span> <span class="nx">bids</span><span class="p">;</span>

    <span class="kt">address</span> <span class="k">public</span> <span class="nx">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">highestBid</span><span class="p">;</span>

    <span class="c1">// Allowed withdrawals of previous bids</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">pendingReturns</span><span class="p">;</span>

    <span class="kd">event</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="nx">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">highestBid</span><span class="p">);</span>

    <span class="cs">/// Modifiers are a convenient way to validate inputs to</span>
    <span class="cs">/// functions. `onlyBefore` is applied to `bid` below:</span>
    <span class="cs">/// The new function body is the modifier&#39;s body where</span>
    <span class="cs">/// `_` is replaced by the old function body.</span>
    <span class="kd">modifier</span> <span class="nx">onlyBefore</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span> <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&lt;</span> <span class="nx">_time</span><span class="p">);</span> <span class="nx">_</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">modifier</span> <span class="nx">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span> <span class="nb">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;</span> <span class="nx">_time</span><span class="p">);</span> <span class="nx">_</span><span class="p">;</span> <span class="p">}</span>

    <span class="nx">constructor</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="nx">_biddingTime</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="nx">_revealTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="nx">_beneficiary</span>
    <span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">beneficiary</span> <span class="o">=</span> <span class="nx">_beneficiary</span><span class="p">;</span>
        <span class="nx">biddingEnd</span> <span class="o">=</span> <span class="nb">now</span> <span class="o">+</span> <span class="nx">_biddingTime</span><span class="p">;</span>
        <span class="nx">revealEnd</span> <span class="o">=</span> <span class="nx">biddingEnd</span> <span class="o">+</span> <span class="nx">_revealTime</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Place a blinded bid with `_blindedBid` = keccak256(value,</span>
    <span class="cs">/// fake, secret).</span>
    <span class="cs">/// The sent ether is only refunded if the bid is correctly</span>
    <span class="cs">/// revealed in the revealing phase. The bid is valid if the</span>
    <span class="cs">/// ether sent together with the bid is at least &quot;value&quot; and</span>
    <span class="cs">/// &quot;fake&quot; is not true. Setting &quot;fake&quot; to true and sending</span>
    <span class="cs">/// not the exact amount are ways to hide the real bid but</span>
    <span class="cs">/// still make the required deposit. The same address can</span>
    <span class="cs">/// place multiple bids.</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">_blindedBid</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="k">payable</span>
        <span class="nx">onlyBefore</span><span class="p">(</span><span class="nx">biddingEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">bids</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">Bid</span><span class="p">({</span>
            <span class="nx">blindedBid</span><span class="o">:</span> <span class="nx">_blindedBid</span><span class="p">,</span>
            <span class="nx">deposit</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span>
        <span class="p">}));</span>
    <span class="p">}</span>

    <span class="cs">/// Reveal your blinded bids. You will get a refund for all</span>
    <span class="cs">/// correctly blinded invalid bids and for all bids except for</span>
    <span class="cs">/// the totally highest.</span>
    <span class="kd">function</span> <span class="nx">reveal</span><span class="p">(</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">_values</span><span class="p">,</span>
        <span class="kt">bool</span><span class="p">[]</span> <span class="nx">_fake</span><span class="p">,</span>
        <span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">_secret</span>
    <span class="p">)</span>
        <span class="k">public</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">biddingEnd</span><span class="p">)</span>
        <span class="nx">onlyBefore</span><span class="p">(</span><span class="nx">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">bids</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_values</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">length</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_fake</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">length</span><span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_secret</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="nx">length</span><span class="p">);</span>

        <span class="kt">uint</span> <span class="nx">refund</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">bid</span> <span class="o">=</span> <span class="nx">bids</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span>
            <span class="kd">var</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">fake</span><span class="p">,</span> <span class="nx">secret</span><span class="p">)</span> <span class="o">=</span>
                    <span class="p">(</span><span class="nx">_values</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">_fake</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">_secret</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">bid</span><span class="p">.</span><span class="nx">blindedBid</span> <span class="o">!=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">fake</span><span class="p">,</span> <span class="nx">secret</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// Bid was not actually revealed.</span>
                <span class="c1">// Do not refund deposit.</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">refund</span> <span class="o">+=</span> <span class="nx">bid</span><span class="p">.</span><span class="nx">deposit</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fake</span> <span class="o">&amp;&amp;</span> <span class="nx">bid</span><span class="p">.</span><span class="nx">deposit</span> <span class="o">&gt;=</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">placeBid</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">value</span><span class="p">))</span>
                    <span class="nx">refund</span> <span class="o">-=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// Make it impossible for the sender to re-claim</span>
            <span class="c1">// the same deposit.</span>
            <span class="nx">bid</span><span class="p">.</span><span class="nx">blindedBid</span> <span class="o">=</span> <span class="kt">bytes32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">refund</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// This is an &quot;internal&quot; function which means that it</span>
    <span class="c1">// can only be called from the contract itself (or from</span>
    <span class="c1">// derived contracts).</span>
    <span class="kd">function</span> <span class="nx">placeBid</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">internal</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">success</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">&lt;=</span> <span class="nx">highestBid</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">highestBidder</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Refund the previously highest bidder.</span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nx">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">highestBid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">highestBid</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="nx">highestBidder</span> <span class="o">=</span> <span class="nx">bidder</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Withdraw a bid that was overbid.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// It is important to set this to zero because the recipient</span>
            <span class="c1">// can call this function again as part of the receiving call</span>
            <span class="c1">// before `transfer` returns (see the remark above about</span>
            <span class="c1">// conditions -&gt; effects -&gt; interaction).</span>
            <span class="nx">pendingReturns</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cs">/// End the auction and send the highest bid</span>
    <span class="cs">/// to the beneficiary.</span>
    <span class="kd">function</span> <span class="nx">auctionEnd</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="o">!</span><span class="nx">ended</span><span class="p">);</span>
        <span class="nx">emit</span> <span class="nx">AuctionEnded</span><span class="p">(</span><span class="nx">highestBidder</span><span class="p">,</span> <span class="nx">highestBid</span><span class="p">);</span>
        <span class="nx">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">beneficiary</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">highestBid</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="safe-remote-purchase">
<span id="index-2"></span><h3>Safe Remote Purchase<a class="headerlink" href="#safe-remote-purchase" title="Permalink to this headline">¶</a></h3>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Purchase</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">value</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">seller</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">buyer</span><span class="p">;</span>
    <span class="kd">enum</span> <span class="nx">State</span> <span class="p">{</span> <span class="nx">Created</span><span class="p">,</span> <span class="nx">Locked</span><span class="p">,</span> <span class="nx">Inactive</span> <span class="p">}</span>
    <span class="nx">State</span> <span class="k">public</span> <span class="nx">state</span><span class="p">;</span>

    <span class="c1">// Ensure that `msg.value` is an even number.</span>
    <span class="c1">// Division will truncate if it is an odd number.</span>
    <span class="c1">// Check via multiplication that it wasn&#39;t an odd number.</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">seller</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nb">require</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="s2">&quot;Value has to be even.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">condition</span><span class="p">(</span><span class="kt">bool</span> <span class="nx">_condition</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">_condition</span><span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlyBuyer</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">buyer</span><span class="p">,</span>
            <span class="s2">&quot;Only buyer can call this.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlySeller</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">seller</span><span class="p">,</span>
            <span class="s2">&quot;Only seller can call this.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span> <span class="nx">_state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nx">state</span> <span class="o">==</span> <span class="nx">_state</span><span class="p">,</span>
            <span class="s2">&quot;Invalid state.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">event</span> <span class="nx">Aborted</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">PurchaseConfirmed</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">ItemReceived</span><span class="p">();</span>

    <span class="cs">/// Abort the purchase and reclaim the ether.</span>
    <span class="cs">/// Can only be called by the seller before</span>
    <span class="cs">/// the contract is locked.</span>
    <span class="kd">function</span> <span class="nx">abort</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">onlySeller</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">emit</span> <span class="nx">Aborted</span><span class="p">();</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>
        <span class="nx">seller</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cs">/// Confirm the purchase as buyer.</span>
    <span class="cs">/// Transaction has to include `2 * value` ether.</span>
    <span class="cs">/// The ether will be locked until confirmReceived</span>
    <span class="cs">/// is called.</span>
    <span class="kd">function</span> <span class="nx">confirmPurchase</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
        <span class="nx">condition</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span><span class="p">))</span>
        <span class="k">payable</span>
    <span class="p">{</span>
        <span class="nx">emit</span> <span class="nx">PurchaseConfirmed</span><span class="p">();</span>
        <span class="nx">buyer</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Confirm that you (the buyer) received the item.</span>
    <span class="cs">/// This will release the locked ether.</span>
    <span class="kd">function</span> <span class="nx">confirmReceived</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">onlyBuyer</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">emit</span> <span class="nx">ItemReceived</span><span class="p">();</span>
        <span class="c1">// It is important to change the state first because</span>
        <span class="c1">// otherwise, the contracts called using `send` below</span>
        <span class="c1">// can call in again here.</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>

        <span class="c1">// NOTE: This actually allows both the buyer and the seller to</span>
        <span class="c1">// block the refund - the withdraw pattern should be used.</span>

        <span class="nx">buyer</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="nx">seller</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="micropayment-channel">
<h3>Micropayment Channel<a class="headerlink" href="#micropayment-channel" title="Permalink to this headline">¶</a></h3>
<p>To be written.</p>
</div>
</div>
<span id="document-solidity-in-depth"></span><div class="section" id="solidity-in-depth">
<h2>Solidity in Depth<a class="headerlink" href="#solidity-in-depth" title="Permalink to this headline">¶</a></h2>
<p>This section should provide you with all you need to know about Solidity.
If something is missing here, please contact us on
<a class="reference external" href="https://gitter.im/ethereum/solidity">Gitter</a> or make a pull request on
<a class="reference external" href="https://github.com/ethereum/solidity/pulls">Github</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-layout-of-source-files"></span><div class="section" id="layout-of-a-solidity-source-file">
<h3>Layout of a Solidity Source File<a class="headerlink" href="#layout-of-a-solidity-source-file" title="Permalink to this headline">¶</a></h3>
<p>Source files can contain an arbitrary number of contract definitions, include directives
and pragma directives.</p>
<div class="section" id="version-pragma">
<span id="index-0"></span><span id="id1"></span><h4>Version Pragma<a class="headerlink" href="#version-pragma" title="Permalink to this headline">¶</a></h4>
<p>Source files can (and should) be annotated with a so-called version pragma to reject
being compiled with future compiler versions that might introduce incompatible
changes. We try to keep such changes to an absolute minimum and especially
introduce changes in a way that changes in semantics will also require changes
in the syntax, but this is of course not always possible. Because of that, it is always
a good idea to read through the changelog at least for releases that contain
breaking changes, those releases will always have versions of the form
<code class="docutils literal"><span class="pre">0.x.0</span></code> or <code class="docutils literal"><span class="pre">x.0.0</span></code>.</p>
<p>The version pragma is used as follows:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>Such a source file will not compile with a compiler earlier than version 0.4.0
and it will also not work on a compiler starting from version 0.5.0 (this
second condition is added by using <code class="docutils literal"><span class="pre">^</span></code>). The idea behind this is that
there will be no breaking changes until version <code class="docutils literal"><span class="pre">0.5.0</span></code>, so we can always
be sure that our code will compile the way we intended it to. We do not fix
the exact version of the compiler, so that bugfix releases are still possible.</p>
<p>It is possible to specify much more complex rules for the compiler version,
the expression follows those used by <a class="reference external" href="https://docs.npmjs.com/misc/semver">npm</a>.</p>
</div>
<div class="section" id="importing-other-source-files">
<span id="import"></span><span id="index-1"></span><h4>Importing other Source Files<a class="headerlink" href="#importing-other-source-files" title="Permalink to this headline">¶</a></h4>
<div class="section" id="syntax-and-semantics">
<h5>Syntax and Semantics<a class="headerlink" href="#syntax-and-semantics" title="Permalink to this headline">¶</a></h5>
<p>Solidity supports import statements that are very similar to those available in JavaScript
(from ES6 on), although Solidity does not know the concept of a “default export”.</p>
<p>At a global level, you can use import statements of the following form:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This statement imports all global symbols from “filename” (and symbols imported there) into the
current global scope (different than in ES6 but backwards-compatible for Solidity).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">symbolName</span> <span class="nx">from</span> <span class="s2">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>…creates a new global symbol <code class="docutils literal"><span class="pre">symbolName</span></code> whose members are all the global symbols from <code class="docutils literal"><span class="pre">&quot;filename&quot;</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="p">{</span><span class="nx">symbol1</span> <span class="k">as</span> <span class="nx">alias</span><span class="p">,</span> <span class="nx">symbol2</span><span class="p">}</span> <span class="nx">from</span> <span class="s2">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>…creates new global symbols <code class="docutils literal"><span class="pre">alias</span></code> and <code class="docutils literal"><span class="pre">symbol2</span></code> which reference <code class="docutils literal"><span class="pre">symbol1</span></code> and <code class="docutils literal"><span class="pre">symbol2</span></code> from <code class="docutils literal"><span class="pre">&quot;filename&quot;</span></code>, respectively.</p>
<p>Another syntax is not part of ES6, but probably convenient:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;filename&quot;</span> <span class="k">as</span> <span class="nx">symbolName</span><span class="p">;</span>
</pre></div>
</div>
<p>which is equivalent to <code class="docutils literal"><span class="pre">import</span> <span class="pre">*</span> <span class="pre">as</span> <span class="pre">symbolName</span> <span class="pre">from</span> <span class="pre">&quot;filename&quot;;</span></code>.</p>
</div>
<div class="section" id="paths">
<h5>Paths<a class="headerlink" href="#paths" title="Permalink to this headline">¶</a></h5>
<p>In the above, <code class="docutils literal"><span class="pre">filename</span></code> is always treated as a path with <code class="docutils literal"><span class="pre">/</span></code> as directory separator,
<code class="docutils literal"><span class="pre">.</span></code> as the current and <code class="docutils literal"><span class="pre">..</span></code> as the parent directory.  When <code class="docutils literal"><span class="pre">.</span></code> or <code class="docutils literal"><span class="pre">..</span></code> is followed by a character except <code class="docutils literal"><span class="pre">/</span></code>,
it is not considered as the current or the parent directory.
All path names are treated as absolute paths unless they start with the current <code class="docutils literal"><span class="pre">.</span></code> or the parent directory <code class="docutils literal"><span class="pre">..</span></code>.</p>
<p>To import a file <code class="docutils literal"><span class="pre">x</span></code> from the same directory as the current file, use <code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;./x&quot;</span> <span class="pre">as</span> <span class="pre">x;</span></code>.
If you use <code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;x&quot;</span> <span class="pre">as</span> <span class="pre">x;</span></code> instead, a different file could be referenced
(in a global “include directory”).</p>
<p>It depends on the compiler (see below) how to actually resolve the paths.
In general, the directory hierarchy does not need to strictly map onto your local
filesystem, it can also map to resources discovered via e.g. ipfs, http or git.</p>
</div>
<div class="section" id="use-in-actual-compilers">
<h5>Use in Actual Compilers<a class="headerlink" href="#use-in-actual-compilers" title="Permalink to this headline">¶</a></h5>
<p>When the compiler is invoked, it is not only possible to specify how to
discover the first element of a path, but it is possible to specify path prefix
remappings so that e.g. <code class="docutils literal"><span class="pre">github.com/ethereum/dapp-bin/library</span></code> is remapped to
<code class="docutils literal"><span class="pre">/usr/local/dapp-bin/library</span></code> and the compiler will read the files from there.
If multiple remappings can be applied, the one with the longest key is tried first. This
allows for a “fallback-remapping” with e.g. <code class="docutils literal"><span class="pre">&quot;&quot;</span></code> maps to
<code class="docutils literal"><span class="pre">&quot;/usr/local/include/solidity&quot;</span></code>. Furthermore, these remappings can
depend on the context, which allows you to configure packages to
import e.g. different versions of a library of the same name.</p>
<p><strong>solc</strong>:</p>
<p>For solc (the commandline compiler), these remappings are provided as
<code class="docutils literal"><span class="pre">context:prefix=target</span></code> arguments, where both the <code class="docutils literal"><span class="pre">context:</span></code> and the
<code class="docutils literal"><span class="pre">=target</span></code> parts are optional (where target defaults to prefix in that
case). All remapping values that are regular files are compiled (including
their dependencies). This mechanism is completely backwards-compatible (as long
as no filename contains = or :) and thus not a breaking change. All imports
in files in or below the directory <code class="docutils literal"><span class="pre">context</span></code> that import a file that
starts with <code class="docutils literal"><span class="pre">prefix</span></code> are redirected by replacing <code class="docutils literal"><span class="pre">prefix</span></code> by <code class="docutils literal"><span class="pre">target</span></code>.</p>
<p>So as an example, if you clone
<code class="docutils literal"><span class="pre">github.com/ethereum/dapp-bin/</span></code> locally to <code class="docutils literal"><span class="pre">/usr/local/dapp-bin</span></code>, you can use
the following in your source file:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol&quot;</span> <span class="k">as</span> <span class="nx">it_mapping</span><span class="p">;</span>
</pre></div>
</div>
<p>and then run the compiler as</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>solc github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin/ source.sol
</pre></div>
</div>
<p>As a more complex example, suppose you rely on some module that uses a
very old version of dapp-bin. That old version of dapp-bin is checked
out at <code class="docutils literal"><span class="pre">/usr/local/dapp-bin_old</span></code>, then you can use</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>solc module1:github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin/ <span class="se">\</span>
     module2:github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin_old/ <span class="se">\</span>
     source.sol
</pre></div>
</div>
<p>so that all imports in <code class="docutils literal"><span class="pre">module2</span></code> point to the old version but imports
in <code class="docutils literal"><span class="pre">module1</span></code> get the new version.</p>
<p>Note that solc only allows you to include files from certain directories:
They have to be in the directory (or subdirectory) of one of the explicitly
specified source files or in the directory (or subdirectory) of a remapping
target. If you want to allow direct absolute includes, just add the
remapping <code class="docutils literal"><span class="pre">=/</span></code>.</p>
<p>If there are multiple remappings that lead to a valid file, the remapping
with the longest common prefix is chosen.</p>
<p><strong>Remix</strong>:</p>
<p><a class="reference external" href="https://remix.ethereum.org/">Remix</a>
provides an automatic remapping for github and will also automatically retrieve
the file over the network:
You can import the iterable mapping by e.g.
<code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol&quot;</span> <span class="pre">as</span> <span class="pre">it_mapping;</span></code>.</p>
<p>Other source code providers may be added in the future.</p>
</div>
</div>
<div class="section" id="comments">
<span id="index-2"></span><h4>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h4>
<p>Single-line comments (<code class="docutils literal"><span class="pre">//</span></code>) and multi-line comments (<code class="docutils literal"><span class="pre">/*...*/</span></code>) are possible.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// This is a single-line comment.</span>

<span class="cm">/*</span>
<span class="cm">This is a</span>
<span class="cm">multi-line comment.</span>
<span class="cm">*/</span>
</pre></div>
</div>
<p>Additionally, there is another type of comment called a natspec comment,
for which the documentation is not yet written. They are written with a
triple slash (<code class="docutils literal"><span class="pre">///</span></code>) or a double asterisk block(<code class="docutils literal"><span class="pre">/**</span> <span class="pre">...</span> <span class="pre">*/</span></code>) and
they should be used directly above function declarations or statements.
You can use <a class="reference external" href="https://en.wikipedia.org/wiki/Doxygen">Doxygen</a>-style tags inside these comments to document
functions, annotate conditions for formal verification, and provide a
<strong>confirmation text</strong> which is shown to users when they attempt to invoke a
function.</p>
<p>In the following example we document the title of the contract, the explanation
for the two input parameters and two returned values.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="cs">/** </span><span class="k">@title</span><span class="cs"> Shape calculator. */</span>
<span class="kd">contract</span> <span class="nx">shapeCalculator</span> <span class="p">{</span>
    <span class="cs">/** </span><span class="k">@dev</span><span class="cs"> Calculates a rectangle&#39;s surface and perimeter.</span>
<span class="cs">      * </span><span class="k">@param</span><span class="cs"> w Width of the rectangle.</span>
<span class="cs">      * </span><span class="k">@param</span><span class="cs"> h Height of the rectangle.</span>
<span class="cs">      * </span><span class="k">@return</span><span class="cs"> s The calculated surface.</span>
<span class="cs">      * </span><span class="k">@return</span><span class="cs"> p The calculated perimeter.</span>
<span class="cs">      */</span>
    <span class="kd">function</span> <span class="nx">rectangle</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">w</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">h</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">s</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="nx">w</span> <span class="o">*</span> <span class="nx">h</span><span class="p">;</span>
        <span class="nx">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="nx">w</span> <span class="o">+</span> <span class="nx">h</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-structure-of-a-contract"></span><div class="section" id="structure-of-a-contract">
<span id="contract-structure"></span><span id="index-0"></span><h3>Structure of a Contract<a class="headerlink" href="#structure-of-a-contract" title="Permalink to this headline">¶</a></h3>
<p>Contracts in Solidity are similar to classes in object-oriented languages.
Each contract can contain declarations of <a class="reference internal" href="#structure-state-variables"><span class="std std-ref">State Variables</span></a>, <a class="reference internal" href="#structure-functions"><span class="std std-ref">Functions</span></a>,
<a class="reference internal" href="#structure-function-modifiers"><span class="std std-ref">Function Modifiers</span></a>, <a class="reference internal" href="#structure-events"><span class="std std-ref">Events</span></a>, <a class="reference internal" href="#structure-struct-types"><span class="std std-ref">Struct Types</span></a> and <a class="reference internal" href="#structure-enum-types"><span class="std std-ref">Enum Types</span></a>.
Furthermore, contracts can inherit from other contracts.</p>
<div class="section" id="state-variables">
<span id="structure-state-variables"></span><h4>State Variables<a class="headerlink" href="#state-variables" title="Permalink to this headline">¶</a></h4>
<p>State variables are values which are permanently stored in contract storage.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleStorage</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">storedData</span><span class="p">;</span> <span class="c1">// State variable</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="index.html#types"><span class="std std-ref">Types</span></a> section for valid state variable types and
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">Visibility and Getters</span></a> for possible choices for
visibility.</p>
</div>
<div class="section" id="functions">
<span id="structure-functions"></span><h4>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h4>
<p>Functions are the executable units of code within a contract.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleAuction</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span> <span class="c1">// Function</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#function-calls"><span class="std std-ref">Function Calls</span></a> can happen internally or externally
and have different levels of visibility (<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">Visibility and Getters</span></a>)
towards other contracts.</p>
</div>
<div class="section" id="function-modifiers">
<span id="structure-function-modifiers"></span><h4>Function Modifiers<a class="headerlink" href="#function-modifiers" title="Permalink to this headline">¶</a></h4>
<p>Function modifiers can be used to amend the semantics of functions in a declarative way
(see <a class="reference internal" href="index.html#modifiers"><span class="std std-ref">Function Modifiers</span></a> in contracts section).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Purchase</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">seller</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="nx">onlySeller</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Modifier</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">seller</span><span class="p">,</span>
            <span class="s2">&quot;Only seller can call this.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">abort</span><span class="p">()</span> <span class="k">public</span> <span class="nx">onlySeller</span> <span class="p">{</span> <span class="c1">// Modifier usage</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="events">
<span id="structure-events"></span><h4>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>Events are convenience interfaces with the EVM logging facilities.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">21</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SimpleAuction</span> <span class="p">{</span>
    <span class="kd">event</span> <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span> <span class="nx">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">);</span> <span class="c1">// Event</span>

    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nx">emit</span> <span class="nx">HighestBidIncreased</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// Triggering event</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#events"><span class="std std-ref">Events</span></a> in contracts section for information on how events are declared
and can be used from within a dapp.</p>
</div>
<div class="section" id="struct-types">
<span id="structure-struct-types"></span><h4>Struct Types<a class="headerlink" href="#struct-types" title="Permalink to this headline">¶</a></h4>
<p>Structs are custom defined types that can group several variables (see
<a class="reference internal" href="index.html#structs"><span class="std std-ref">Structs</span></a> in types section).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Ballot</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Voter</span> <span class="p">{</span> <span class="c1">// Struct</span>
        <span class="kt">uint</span> <span class="nx">weight</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="nx">voted</span><span class="p">;</span>
        <span class="kt">address</span> <span class="nx">delegate</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">vote</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="enum-types">
<span id="structure-enum-types"></span><h4>Enum Types<a class="headerlink" href="#enum-types" title="Permalink to this headline">¶</a></h4>
<p>Enums can be used to create custom types with a finite set of ‘constant values’ (see
<a class="reference internal" href="index.html#enums"><span class="std std-ref">Enums</span></a> in types section).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Purchase</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nx">State</span> <span class="p">{</span> <span class="nx">Created</span><span class="p">,</span> <span class="nx">Locked</span><span class="p">,</span> <span class="nx">Inactive</span> <span class="p">}</span> <span class="c1">// Enum</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-types"></span><div class="section" id="types">
<span id="index-0"></span><span id="id1"></span><h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p>Solidity is a statically typed language, which means that the type of each
variable (state and local) needs to be specified (or at least known -
see <a class="reference internal" href="#type-deduction"><span class="std std-ref">Type Deduction</span></a> below) at
compile-time. Solidity provides several elementary types which can be combined
to form complex types.</p>
<p>In addition, types can interact with each other in expressions containing
operators. For a quick reference of the various operators, see <a class="reference internal" href="index.html#order"><span class="std std-ref">Order of Precedence of Operators</span></a>.</p>
<div class="section" id="value-types">
<span id="index-1"></span><h4>Value Types<a class="headerlink" href="#value-types" title="Permalink to this headline">¶</a></h4>
<p>The following types are also called value types because variables of these
types will always be passed by value, i.e. they are always copied when they
are used as function arguments or in assignments.</p>
<div class="section" id="booleans">
<span id="index-2"></span><h5>Booleans<a class="headerlink" href="#booleans" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">bool</span></code>: The possible values are constants <code class="docutils literal"><span class="pre">true</span></code> and <code class="docutils literal"><span class="pre">false</span></code>.</p>
<p>Operators:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">!</span></code> (logical negation)</li>
<li><code class="docutils literal"><span class="pre">&amp;&amp;</span></code> (logical conjunction, “and”)</li>
<li><code class="docutils literal"><span class="pre">||</span></code> (logical disjunction, “or”)</li>
<li><code class="docutils literal"><span class="pre">==</span></code> (equality)</li>
<li><code class="docutils literal"><span class="pre">!=</span></code> (inequality)</li>
</ul>
<p>The operators <code class="docutils literal"><span class="pre">||</span></code> and <code class="docutils literal"><span class="pre">&amp;&amp;</span></code> apply the common short-circuiting rules. This means that in the expression <code class="docutils literal"><span class="pre">f(x)</span> <span class="pre">||</span> <span class="pre">g(y)</span></code>, if <code class="docutils literal"><span class="pre">f(x)</span></code> evaluates to <code class="docutils literal"><span class="pre">true</span></code>, <code class="docutils literal"><span class="pre">g(y)</span></code> will not be evaluated even if it may have side-effects.</p>
</div>
<div class="section" id="integers">
<span id="index-3"></span><h5>Integers<a class="headerlink" href="#integers" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">int</span></code> / <code class="docutils literal"><span class="pre">uint</span></code>: Signed and unsigned integers of various sizes. Keywords <code class="docutils literal"><span class="pre">uint8</span></code> to <code class="docutils literal"><span class="pre">uint256</span></code> in steps of <code class="docutils literal"><span class="pre">8</span></code> (unsigned of 8 up to 256 bits) and <code class="docutils literal"><span class="pre">int8</span></code> to <code class="docutils literal"><span class="pre">int256</span></code>. <code class="docutils literal"><span class="pre">uint</span></code> and <code class="docutils literal"><span class="pre">int</span></code> are aliases for <code class="docutils literal"><span class="pre">uint256</span></code> and <code class="docutils literal"><span class="pre">int256</span></code>, respectively.</p>
<p>Operators:</p>
<ul class="simple">
<li>Comparisons: <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal"><span class="pre">bool</span></code>)</li>
<li>Bit operators: <code class="docutils literal"><span class="pre">&amp;</span></code>, <code class="docutils literal"><span class="pre">|</span></code>, <code class="docutils literal"><span class="pre">^</span></code> (bitwise exclusive or), <code class="docutils literal"><span class="pre">~</span></code> (bitwise negation)</li>
<li>Arithmetic operators: <code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code>, unary <code class="docutils literal"><span class="pre">-</span></code>, unary <code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">*</span></code>, <code class="docutils literal"><span class="pre">/</span></code>, <code class="docutils literal"><span class="pre">%</span></code> (remainder), <code class="docutils literal"><span class="pre">**</span></code> (exponentiation), <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> (left shift), <code class="docutils literal"><span class="pre">&gt;&gt;</span></code> (right shift)</li>
</ul>
<p>Division always truncates (it is just compiled to the <code class="docutils literal"><span class="pre">DIV</span></code> opcode of the EVM), but it does not truncate if both
operators are <a class="reference internal" href="#rational-literals"><span class="std std-ref">literals</span></a> (or literal expressions).</p>
<p>Division by zero and modulus with zero throws a runtime exception.</p>
<p>The result of a shift operation is the type of the left operand. The
expression <code class="docutils literal"><span class="pre">x</span> <span class="pre">&lt;&lt;</span> <span class="pre">y</span></code> is equivalent to <code class="docutils literal"><span class="pre">x</span> <span class="pre">*</span> <span class="pre">2**y</span></code>, and <code class="docutils literal"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">y</span></code> is
equivalent to <code class="docutils literal"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">2**y</span></code>. This means that shifting negative numbers
sign extends. Shifting by a negative amount throws a runtime exception.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The results produced by shift right of negative values of signed integer types is different from those produced
by other programming languages. In Solidity, shift right maps to division so the shifted negative values
are going to be rounded towards zero (truncated). In other programming languages the shift right of negative values
works like division with rounding down (towards negative infinity).</p>
</div>
</div>
<div class="section" id="fixed-point-numbers">
<span id="index-4"></span><h5>Fixed Point Numbers<a class="headerlink" href="#fixed-point-numbers" title="Permalink to this headline">¶</a></h5>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Fixed point numbers are not fully supported by Solidity yet. They can be declared, but
cannot be assigned to or from.</p>
</div>
<p><code class="docutils literal"><span class="pre">fixed</span></code> / <code class="docutils literal"><span class="pre">ufixed</span></code>: Signed and unsigned fixed point number of various sizes. Keywords <code class="docutils literal"><span class="pre">ufixedMxN</span></code> and <code class="docutils literal"><span class="pre">fixedMxN</span></code>, where <code class="docutils literal"><span class="pre">M</span></code> represents the number of bits taken by
the type and <code class="docutils literal"><span class="pre">N</span></code> represents how many decimal points are available. <code class="docutils literal"><span class="pre">M</span></code> must be divisible by 8 and goes from 8 to 256 bits. <code class="docutils literal"><span class="pre">N</span></code> must be between 0 and 80, inclusive.
<code class="docutils literal"><span class="pre">ufixed</span></code> and <code class="docutils literal"><span class="pre">fixed</span></code> are aliases for <code class="docutils literal"><span class="pre">ufixed128x18</span></code> and <code class="docutils literal"><span class="pre">fixed128x18</span></code>, respectively.</p>
<p>Operators:</p>
<ul class="simple">
<li>Comparisons: <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal"><span class="pre">bool</span></code>)</li>
<li>Arithmetic operators: <code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code>, unary <code class="docutils literal"><span class="pre">-</span></code>, unary <code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">*</span></code>, <code class="docutils literal"><span class="pre">/</span></code>, <code class="docutils literal"><span class="pre">%</span></code> (remainder)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The main difference between floating point (<code class="docutils literal"><span class="pre">float</span></code> and <code class="docutils literal"><span class="pre">double</span></code> in many languages, more precisely IEEE 754 numbers) and fixed point numbers is
that the number of bits used for the integer and the fractional part (the part after the decimal dot) is flexible in the former, while it is strictly
defined in the latter. Generally, in floating point almost the entire space is used to represent the number, while only a small number of bits define
where the decimal point is.</p>
</div>
</div>
<div class="section" id="address">
<span id="index-5"></span><span id="id2"></span><h5>Address<a class="headerlink" href="#address" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">address</span></code>: Holds a 20 byte value (size of an Ethereum address). Address types also have members and serve as a base for all contracts.</p>
<p>Operators:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code> and <code class="docutils literal"><span class="pre">&gt;</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Starting with version 0.5.0 contracts do not derive from the address type, but can still be explicitly converted to address.</p>
</div>
<div class="section" id="members-of-addresses">
<span id="id3"></span><h6>Members of Addresses<a class="headerlink" href="#members-of-addresses" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">balance</span></code> and <code class="docutils literal"><span class="pre">transfer</span></code></li>
</ul>
<p>For a quick reference, see <a class="reference internal" href="index.html#address-related"><span class="std std-ref">Address Related</span></a>.</p>
<p>It is possible to query the balance of an address using the property <code class="docutils literal"><span class="pre">balance</span></code>
and to send Ether (in units of wei) to an address using the <code class="docutils literal"><span class="pre">transfer</span></code> function:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">address</span> <span class="nx">x</span> <span class="o">=</span> <span class="mh">0x123</span><span class="p">;</span>
<span class="kt">address</span> <span class="nx">myAddress</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">balance</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="nx">myAddress</span><span class="p">.</span><span class="nx">balance</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="nx">x</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <code class="docutils literal"><span class="pre">x</span></code> is a contract address, its code (more specifically: its fallback function, if present) will be executed together with the <code class="docutils literal"><span class="pre">transfer</span></code> call (this is a feature of the EVM and cannot be prevented). If that execution runs out of gas or fails in any way, the Ether transfer will be reverted and the current contract will stop with an exception.</p>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">send</span></code></li>
</ul>
<p>Send is the low-level counterpart of <code class="docutils literal"><span class="pre">transfer</span></code>. If the execution fails, the current contract will not stop with an exception, but <code class="docutils literal"><span class="pre">send</span></code> will return <code class="docutils literal"><span class="pre">false</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There are some dangers in using <code class="docutils literal"><span class="pre">send</span></code>: The transfer fails if the call stack depth is at 1024
(this can always be forced by the caller) and it also fails if the recipient runs out of gas. So in order
to make safe Ether transfers, always check the return value of <code class="docutils literal"><span class="pre">send</span></code>, use <code class="docutils literal"><span class="pre">transfer</span></code> or even better:
use a pattern where the recipient withdraws the money.</p>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">callcode</span></code> and <code class="docutils literal"><span class="pre">delegatecall</span></code></li>
</ul>
<p>Furthermore, to interface with contracts that do not adhere to the ABI,
the function <code class="docutils literal"><span class="pre">call</span></code> is provided which takes an arbitrary number of arguments of any type. These arguments are padded to 32 bytes and concatenated. One exception is the case where the first argument is encoded to exactly four bytes. In this case, it is not padded to allow the use of function signatures here.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">address</span> <span class="nx">nameReg</span> <span class="o">=</span> <span class="mh">0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2</span><span class="p">;</span>
<span class="nx">nameReg</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;MyName&quot;</span><span class="p">);</span>
<span class="nx">nameReg</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;fun(uint256)&quot;</span><span class="p">)),</span> <span class="nx">a</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">call</span></code> returns a boolean indicating whether the invoked function terminated (<code class="docutils literal"><span class="pre">true</span></code>) or caused an EVM exception (<code class="docutils literal"><span class="pre">false</span></code>). It is not possible to access the actual data returned (for this we would need to know the encoding and size in advance).</p>
<p>It is possible to adjust the supplied gas with the <code class="docutils literal"><span class="pre">.gas()</span></code> modifier:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">namReg</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">gas</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;MyName&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Similarly, the supplied Ether value can be controlled too:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">nameReg</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="mi">1</span> <span class="kt">ether</span><span class="p">)(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;MyName&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Lastly, these modifiers can be combined. Their order does not matter:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">nameReg</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">gas</span><span class="p">(</span><span class="mi">1000000</span><span class="p">).</span><span class="nx">value</span><span class="p">(</span><span class="mi">1</span> <span class="kt">ether</span><span class="p">)(</span><span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="s2">&quot;MyName&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It is not yet possible to use the gas or value modifiers on overloaded functions.</p>
<p class="last">A workaround is to introduce a special case for gas and value and just re-check
whether they are present at the point of overload resolution.</p>
</div>
<p>In a similar way, the function <code class="docutils literal"><span class="pre">delegatecall</span></code> can be used: the difference is that only the code of the given address is used, all other aspects (storage, balance, …) are taken from the current contract. The purpose of <code class="docutils literal"><span class="pre">delegatecall</span></code> is to use library code which is stored in another contract. The user has to ensure that the layout of storage in both contracts is suitable for delegatecall to be used. Prior to homestead, only a limited variant called <code class="docutils literal"><span class="pre">callcode</span></code> was available that did not provide access to the original <code class="docutils literal"><span class="pre">msg.sender</span></code> and <code class="docutils literal"><span class="pre">msg.value</span></code> values.</p>
<p>All three functions <code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">delegatecall</span></code> and <code class="docutils literal"><span class="pre">callcode</span></code> are very low-level functions and should only be used as a <em>last resort</em> as they break the type-safety of Solidity.</p>
<p>The <code class="docutils literal"><span class="pre">.gas()</span></code> option is available on all three methods, while the <code class="docutils literal"><span class="pre">.value()</span></code> option is not supported for <code class="docutils literal"><span class="pre">delegatecall</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All contracts can be converted to <code class="docutils literal"><span class="pre">address</span></code> type, so it is possible to query the balance of the
current contract using <code class="docutils literal"><span class="pre">address(this).balance</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The use of <code class="docutils literal"><span class="pre">callcode</span></code> is discouraged and will be removed in the future.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All these functions are low-level functions and should be used with care.
Specifically, any unknown contract might be malicious and if you call it, you
hand over control to that contract which could in turn call back into
your contract, so be prepared for changes to your state variables
when the call returns.</p>
</div>
</div>
</div>
<div class="section" id="fixed-size-byte-arrays">
<span id="index-6"></span><h5>Fixed-size byte arrays<a class="headerlink" href="#fixed-size-byte-arrays" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">bytes1</span></code>, <code class="docutils literal"><span class="pre">bytes2</span></code>, <code class="docutils literal"><span class="pre">bytes3</span></code>, …, <code class="docutils literal"><span class="pre">bytes32</span></code>. <code class="docutils literal"><span class="pre">byte</span></code> is an alias for <code class="docutils literal"><span class="pre">bytes1</span></code>.</p>
<p>Operators:</p>
<ul class="simple">
<li>Comparisons: <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal"><span class="pre">bool</span></code>)</li>
<li>Bit operators: <code class="docutils literal"><span class="pre">&amp;</span></code>, <code class="docutils literal"><span class="pre">|</span></code>, <code class="docutils literal"><span class="pre">^</span></code> (bitwise exclusive or), <code class="docutils literal"><span class="pre">~</span></code> (bitwise negation), <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> (left shift), <code class="docutils literal"><span class="pre">&gt;&gt;</span></code> (right shift)</li>
<li>Index access: If <code class="docutils literal"><span class="pre">x</span></code> is of type <code class="docutils literal"><span class="pre">bytesI</span></code>, then <code class="docutils literal"><span class="pre">x[k]</span></code> for <code class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">I</span></code> returns the <code class="docutils literal"><span class="pre">k</span></code> th byte (read-only).</li>
</ul>
<p>The shifting operator works with any integer type as right operand (but will
return the type of the left operand), which denotes the number of bits to shift by.
Shifting by a negative amount will cause a runtime exception.</p>
<p>Members:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">.length</span></code> yields the fixed length of the byte array (read-only).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to use an array of bytes as <code class="docutils literal"><span class="pre">byte[]</span></code>, but it is wasting a lot of space, 31 bytes every element,
to be exact, when passing in calls. It is better to use <code class="docutils literal"><span class="pre">bytes</span></code>.</p>
</div>
</div>
<div class="section" id="dynamically-sized-byte-array">
<h5>Dynamically-sized byte array<a class="headerlink" href="#dynamically-sized-byte-array" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">bytes</span></code>:</dt>
<dd>Dynamically-sized byte array, see <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. Not a value-type!</dd>
<dt><code class="docutils literal"><span class="pre">string</span></code>:</dt>
<dd>Dynamically-sized UTF-8-encoded string, see <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. Not a value-type!</dd>
</dl>
<p>As a rule of thumb, use <code class="docutils literal"><span class="pre">bytes</span></code> for arbitrary-length raw byte data and <code class="docutils literal"><span class="pre">string</span></code>
for arbitrary-length string (UTF-8) data. If you can limit the length to a certain
number of bytes, always use one of <code class="docutils literal"><span class="pre">bytes1</span></code> to <code class="docutils literal"><span class="pre">bytes32</span></code> because they are much cheaper.</p>
</div>
<div class="section" id="address-literals">
<span id="index-7"></span><span id="id4"></span><h5>Address Literals<a class="headerlink" href="#address-literals" title="Permalink to this headline">¶</a></h5>
<p>Hexadecimal literals that pass the address checksum test, for example
<code class="docutils literal"><span class="pre">0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</span></code> are of <code class="docutils literal"><span class="pre">address</span></code> type.
Hexadecimal literals that are between 39 and 41 digits
long and do not pass the checksum test produce
a warning and are treated as regular rational number literals.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The mixed-case address checksum format is defined in <a class="reference external" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-55.md">EIP-55</a>.</p>
</div>
</div>
<div class="section" id="rational-and-integer-literals">
<span id="rational-literals"></span><span id="index-8"></span><h5>Rational and Integer Literals<a class="headerlink" href="#rational-and-integer-literals" title="Permalink to this headline">¶</a></h5>
<p>Integer literals are formed from a sequence of numbers in the range 0-9.
They are interpreted as decimals. For example, <code class="docutils literal"><span class="pre">69</span></code> means sixty nine.
Octal literals do not exist in Solidity and leading zeros are invalid.</p>
<p>Decimal fraction literals are formed by a <code class="docutils literal"><span class="pre">.</span></code> with at least one number on
one side.  Examples include <code class="docutils literal"><span class="pre">1.</span></code>, <code class="docutils literal"><span class="pre">.1</span></code> and <code class="docutils literal"><span class="pre">1.3</span></code>.</p>
<p>Scientific notation is also supported, where the base can have fractions, while the exponent cannot.
Examples include <code class="docutils literal"><span class="pre">2e10</span></code>, <code class="docutils literal"><span class="pre">-2e10</span></code>, <code class="docutils literal"><span class="pre">2e-10</span></code>, <code class="docutils literal"><span class="pre">2.5e1</span></code>.</p>
<p>Number literal expressions retain arbitrary precision until they are converted to a non-literal type (i.e. by
using them together with a non-literal expression).
This means that computations do not overflow and divisions do not truncate
in number literal expressions.</p>
<p>For example, <code class="docutils literal"><span class="pre">(2**800</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">-</span> <span class="pre">2**800</span></code> results in the constant <code class="docutils literal"><span class="pre">1</span></code> (of type <code class="docutils literal"><span class="pre">uint8</span></code>)
although intermediate results would not even fit the machine word size. Furthermore, <code class="docutils literal"><span class="pre">.5</span> <span class="pre">*</span> <span class="pre">8</span></code> results
in the integer <code class="docutils literal"><span class="pre">4</span></code> (although non-integers were used in between).</p>
<p>Any operator that can be applied to integers can also be applied to number literal expressions as
long as the operands are integers. If any of the two is fractional, bit operations are disallowed
and exponentiation is disallowed if the exponent is fractional (because that might result in
a non-rational number).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Solidity has a number literal type for each rational number.
Integer literals and rational number literals belong to number literal types.
Moreover, all number literal expressions (i.e. the expressions that
contain only number literals and operators) belong to number literal
types.  So the number literal expressions <code class="docutils literal"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code> and <code class="docutils literal"><span class="pre">2</span> <span class="pre">+</span> <span class="pre">1</span></code> both
belong to the same number literal type for the rational number three.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Division on integer literals used to truncate in earlier versions, but it will now convert into a rational number, i.e. <code class="docutils literal"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">2</span></code> is not equal to <code class="docutils literal"><span class="pre">2</span></code>, but to <code class="docutils literal"><span class="pre">2.5</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Number literal expressions are converted into a non-literal type as soon as they are used with non-literal
expressions. Even though we know that the value of the
expression assigned to <code class="docutils literal"><span class="pre">b</span></code> in the following example evaluates to
an integer, but the partial expression <code class="docutils literal"><span class="pre">2.5</span> <span class="pre">+</span> <span class="pre">a</span></code> does not type check so the code
does not compile</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint128</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">uint128</span> <span class="nx">b</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="string-literals">
<span id="index-9"></span><h5>String Literals<a class="headerlink" href="#string-literals" title="Permalink to this headline">¶</a></h5>
<p>String literals are written with either double or single-quotes (<code class="docutils literal"><span class="pre">&quot;foo&quot;</span></code> or <code class="docutils literal"><span class="pre">'bar'</span></code>).  They do not imply trailing zeroes as in C; <code class="docutils literal"><span class="pre">&quot;foo&quot;</span></code> represents three bytes not four.  As with integer literals, their type can vary, but they are implicitly convertible to <code class="docutils literal"><span class="pre">bytes1</span></code>, …, <code class="docutils literal"><span class="pre">bytes32</span></code>, if they fit, to <code class="docutils literal"><span class="pre">bytes</span></code> and to <code class="docutils literal"><span class="pre">string</span></code>.</p>
<p>String literals support escape characters, such as <code class="docutils literal"><span class="pre">\n</span></code>, <code class="docutils literal"><span class="pre">\xNN</span></code> and <code class="docutils literal"><span class="pre">\uNNNN</span></code>. <code class="docutils literal"><span class="pre">\xNN</span></code> takes a hex value and inserts the appropriate byte, while <code class="docutils literal"><span class="pre">\uNNNN</span></code> takes a Unicode codepoint and inserts an UTF-8 sequence.</p>
</div>
<div class="section" id="hexadecimal-literals">
<span id="index-10"></span><h5>Hexadecimal Literals<a class="headerlink" href="#hexadecimal-literals" title="Permalink to this headline">¶</a></h5>
<p>Hexademical Literals are prefixed with the keyword <code class="docutils literal"><span class="pre">hex</span></code> and are enclosed in double or single-quotes (<code class="docutils literal"><span class="pre">hex&quot;001122FF&quot;</span></code>). Their content must be a hexadecimal string and their value will be the binary representation of those values.</p>
<p>Hexademical Literals behave like String Literals and have the same convertibility restrictions.</p>
</div>
<div class="section" id="enums">
<span id="index-11"></span><span id="id5"></span><h5>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">¶</a></h5>
<p>Enums are one way to create a user-defined type in Solidity. They are explicitly convertible
to and from all integer types but implicit conversion is not allowed.  The explicit conversions
check the value ranges at runtime and a failure causes an exception.  Enums needs at least one member.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">test</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nx">ActionChoices</span> <span class="p">{</span> <span class="nx">GoLeft</span><span class="p">,</span> <span class="nx">GoRight</span><span class="p">,</span> <span class="nx">GoStraight</span><span class="p">,</span> <span class="nx">SitStill</span> <span class="p">}</span>
    <span class="nx">ActionChoices</span> <span class="nx">choice</span><span class="p">;</span>
    <span class="nx">ActionChoices</span> <span class="k">constant</span> <span class="nx">defaultChoice</span> <span class="o">=</span> <span class="nx">ActionChoices</span><span class="p">.</span><span class="nx">GoStraight</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">setGoStraight</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">choice</span> <span class="o">=</span> <span class="nx">ActionChoices</span><span class="p">.</span><span class="nx">GoStraight</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Since enum types are not part of the ABI, the signature of &quot;getChoice&quot;</span>
    <span class="c1">// will automatically be changed to &quot;getChoice() returns (uint8)&quot;</span>
    <span class="c1">// for all matters external to Solidity. The integer type used is just</span>
    <span class="c1">// large enough to hold all enum values, i.e. if you have more values,</span>
    <span class="c1">// `uint16` will be used and so on.</span>
    <span class="kd">function</span> <span class="nx">getChoice</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">ActionChoices</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">choice</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">getDefaultChoice</span><span class="p">()</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">uint</span><span class="p">(</span><span class="nx">defaultChoice</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-types">
<span id="index-12"></span><span id="id6"></span><h5>Function Types<a class="headerlink" href="#function-types" title="Permalink to this headline">¶</a></h5>
<p>Function types are the types of functions. Variables of function type
can be assigned from functions and function parameters of function type
can be used to pass functions to and return functions from function calls.
Function types come in two flavours - <em>internal</em> and <em>external</em> functions:</p>
<p>Internal functions can only be called inside the current contract (more specifically,
inside the current code unit, which also includes internal library functions
and inherited functions) because they cannot be executed outside of the
context of the current contract. Calling an internal function is realized
by jumping to its entry label, just like when calling a function of the current
contract internally.</p>
<p>External functions consist of an address and a function signature and they can
be passed via and returned from external function calls.</p>
<p>Function types are notated as follows:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">parameter</span> <span class="nx">types</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span><span class="k">internal</span><span class="o">|</span><span class="k">external</span><span class="p">}</span> <span class="p">[</span><span class="k">pure</span><span class="o">|</span><span class="k">constant</span><span class="o">|</span><span class="k">view</span><span class="o">|</span><span class="k">payable</span><span class="p">]</span> <span class="p">[</span><span class="k">returns</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">return</span> <span class="nx">types</span><span class="o">&gt;</span><span class="p">)]</span>
</pre></div>
</div>
<p>In contrast to the parameter types, the return types cannot be empty - if the
function type should not return anything, the whole <code class="docutils literal"><span class="pre">returns</span> <span class="pre">(&lt;return</span> <span class="pre">types&gt;)</span></code>
part has to be omitted.</p>
<p>By default, function types are internal, so the <code class="docutils literal"><span class="pre">internal</span></code> keyword can be
omitted. In contrast, contract functions themselves are public by default,
only when used as the name of a type, the default is internal.</p>
<p>There are two ways to access a function in the current contract: Either directly
by its name, <code class="docutils literal"><span class="pre">f</span></code>, or using <code class="docutils literal"><span class="pre">this.f</span></code>. The former will result in an internal
function, the latter in an external function.</p>
<p>If a function type variable is not initialized, calling it will result
in an exception. The same happens if you call a function after using <code class="docutils literal"><span class="pre">delete</span></code>
on it.</p>
<p>If external function types are used outside of the context of Solidity,
they are treated as the <code class="docutils literal"><span class="pre">function</span></code> type, which encodes the address
followed by the function identifier together in a single <code class="docutils literal"><span class="pre">bytes24</span></code> type.</p>
<p>Note that public functions of the current contract can be used both as an
internal and as an external function. To use <code class="docutils literal"><span class="pre">f</span></code> as an internal function,
just use <code class="docutils literal"><span class="pre">f</span></code>, if you want to use its external form, use <code class="docutils literal"><span class="pre">this.f</span></code>.</p>
<p>Additionally, public (or external) functions also have a special member called <code class="docutils literal"><span class="pre">selector</span></code>,
which returns the <a class="reference internal" href="index.html#abi-function-selector"><span class="std std-ref">ABI function selector</span></a>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Selector</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes4</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">selector</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example that shows how to use internal function types:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">ArrayUtils</span> <span class="p">{</span>
  <span class="c1">// internal functions can be used in internal library functions because</span>
  <span class="c1">// they will be part of the same code context</span>
  <span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">self</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="nx">f</span><span class="p">)</span>
    <span class="k">internal</span>
    <span class="k">pure</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">r</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">reduce</span><span class="p">(</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">self</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="nx">f</span>
  <span class="p">)</span>
    <span class="k">internal</span>
    <span class="k">pure</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">r</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="nx">self</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">range</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">length</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Pyramid</span> <span class="p">{</span>
  <span class="k">using</span> <span class="nx">ArrayUtils</span> <span class="k">for</span> <span class="o">*</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">pyramid</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">l</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ArrayUtils</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">l</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">square</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">sum</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">square</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">*</span> <span class="nx">x</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">sum</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">y</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Another example that uses external function types:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Oracle</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="nx">Request</span> <span class="p">{</span>
    <span class="kt">bytes</span> <span class="nx">data</span><span class="p">;</span>
    <span class="kd">function</span><span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span><span class="p">)</span> <span class="k">external</span> <span class="nx">callback</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">Request</span><span class="p">[]</span> <span class="nx">requests</span><span class="p">;</span>
  <span class="kd">event</span> <span class="nx">NewRequest</span><span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
  <span class="kd">function</span> <span class="nx">query</span><span class="p">(</span><span class="kt">bytes</span> <span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span><span class="p">)</span> <span class="k">external</span> <span class="nx">callback</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nx">requests</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Request</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">));</span>
    <span class="nx">emit</span> <span class="nx">NewRequest</span><span class="p">(</span><span class="nx">requests</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">reply</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">requestID</span><span class="p">,</span> <span class="kt">bytes</span> <span class="nx">response</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="c1">// Here goes the check that the reply comes from a trusted source</span>
    <span class="nx">requests</span><span class="p">[</span><span class="nx">requestID</span><span class="p">].</span><span class="nx">callback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">OracleUser</span> <span class="p">{</span>
  <span class="nx">Oracle</span> <span class="k">constant</span> <span class="nx">oracle</span> <span class="o">=</span> <span class="nx">Oracle</span><span class="p">(</span><span class="mh">0x1234567</span><span class="p">);</span> <span class="c1">// known contract</span>
  <span class="kd">function</span> <span class="nx">buySomething</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">oracle</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">&quot;USD&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">oracleResponse</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">oracleResponse</span><span class="p">(</span><span class="kt">bytes</span> <span class="nx">response</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span>
        <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nx">oracle</span><span class="p">),</span>
        <span class="s2">&quot;Only oracle can call this.&quot;</span>
    <span class="p">);</span>
    <span class="c1">// Use the data</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lambda or inline functions are planned but not yet supported.</p>
</div>
</div>
</div>
<div class="section" id="reference-types">
<span id="index-13"></span><h4>Reference Types<a class="headerlink" href="#reference-types" title="Permalink to this headline">¶</a></h4>
<p>Complex types, i.e. types which do not always fit into 256 bits have to be handled
more carefully than the value-types we have already seen. Since copying
them can be quite expensive, we have to think about whether we want them to be
stored in <strong>memory</strong> (which is not persisting) or <strong>storage</strong> (where the state
variables are held).</p>
<div class="section" id="data-location">
<h5>Data location<a class="headerlink" href="#data-location" title="Permalink to this headline">¶</a></h5>
<p>Every complex type, i.e. <em>arrays</em> and <em>structs</em>, has an additional
annotation, the “data location”, about whether it is stored in memory or in storage. Depending on the
context, there is always a default, but it can be overridden by appending
either <code class="docutils literal"><span class="pre">storage</span></code> or <code class="docutils literal"><span class="pre">memory</span></code> to the type. The default for function parameters (including return parameters) is <code class="docutils literal"><span class="pre">memory</span></code>, the default for local variables is <code class="docutils literal"><span class="pre">storage</span></code> and the location is forced
to <code class="docutils literal"><span class="pre">storage</span></code> for state variables (obviously).</p>
<p>There is also a third data location, <code class="docutils literal"><span class="pre">calldata</span></code>, which is a non-modifiable,
non-persistent area where function arguments are stored. Function parameters
(not return parameters) of external functions are forced to <code class="docutils literal"><span class="pre">calldata</span></code> and
behave mostly like <code class="docutils literal"><span class="pre">memory</span></code>.</p>
<p>Data locations are important because they change how assignments behave:
assignments between storage and memory and also to a state variable (even from other state variables)
always create an independent copy.
Assignments to local storage variables only assign a reference though, and
this reference always points to the state variable even if the latter is changed
in the meantime.
On the other hand, assignments from a memory stored reference type to another
memory-stored reference type do not create a copy.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// the data location of x is storage</span>

    <span class="c1">// the data location of memoryArray is memory</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">memoryArray</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">memoryArray</span><span class="p">;</span> <span class="c1">// works, copies the whole array to storage</span>
        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// works, assigns a pointer, data location of y is storage</span>
        <span class="nx">y</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span> <span class="c1">// fine, returns the 8th element</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// fine, modifies x through y</span>
        <span class="k">delete</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// fine, clears the array, also modifies y</span>
        <span class="c1">// The following does not work; it would need to create a new temporary /</span>
        <span class="c1">// unnamed array in storage, but storage is &quot;statically&quot; allocated:</span>
        <span class="c1">// y = memoryArray;</span>
        <span class="c1">// This does not work either, since it would &quot;reset&quot; the pointer, but there</span>
        <span class="c1">// is no sensible location it could point to.</span>
        <span class="c1">// delete y;</span>
        <span class="nx">g</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// calls g, handing over a reference to x</span>
        <span class="nx">h</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// calls h and creates an independent, temporary copy in memory</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">storageArray</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{}</span>
    <span class="kd">function</span> <span class="nx">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">memoryArray</span><span class="p">)</span> <span class="k">public</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="summary">
<h6>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt>Forced data location:</dt>
<dd><ul class="first last simple">
<li>parameters (not return) of external functions: calldata</li>
<li>state variables: storage</li>
</ul>
</dd>
<dt>Default data location:</dt>
<dd><ul class="first last simple">
<li>parameters (also return) of functions: memory</li>
<li>all other local variables: storage</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="arrays">
<span id="index-14"></span><span id="id7"></span><h5>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h5>
<p>Arrays can have a compile-time fixed size or they can be dynamic.
For storage arrays, the element type can be arbitrary (i.e. also other
arrays, mappings or structs). For memory arrays, it cannot be a mapping and
has to be an ABI type if it is an argument of a publicly-visible function.</p>
<p>An array of fixed size <code class="docutils literal"><span class="pre">k</span></code> and element type <code class="docutils literal"><span class="pre">T</span></code> is written as <code class="docutils literal"><span class="pre">T[k]</span></code>,
an array of dynamic size as <code class="docutils literal"><span class="pre">T[]</span></code>. As an example, an array of 5 dynamic
arrays of <code class="docutils literal"><span class="pre">uint</span></code> is <code class="docutils literal"><span class="pre">uint[][5]</span></code> (note that the notation is reversed when
compared to some other languages). To access the second uint in the
third dynamic array, you use <code class="docutils literal"><span class="pre">x[2][1]</span></code> (indices are zero-based and
access works in the opposite way of the declaration, i.e. <code class="docutils literal"><span class="pre">x[2]</span></code>
shaves off one level in the type from the right).</p>
<p>Variables of type <code class="docutils literal"><span class="pre">bytes</span></code> and <code class="docutils literal"><span class="pre">string</span></code> are special arrays. A <code class="docutils literal"><span class="pre">bytes</span></code> is similar to <code class="docutils literal"><span class="pre">byte[]</span></code>,
but it is packed tightly in calldata. <code class="docutils literal"><span class="pre">string</span></code> is equal to <code class="docutils literal"><span class="pre">bytes</span></code> but does not allow
length or index access (for now).</p>
<p>So <code class="docutils literal"><span class="pre">bytes</span></code> should always be preferred over <code class="docutils literal"><span class="pre">byte[]</span></code> because it is cheaper.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to access the byte-representation of a string <code class="docutils literal"><span class="pre">s</span></code>, use
<code class="docutils literal"><span class="pre">bytes(s).length</span></code> / <code class="docutils literal"><span class="pre">bytes(s)[7]</span> <span class="pre">=</span> <span class="pre">'x';</span></code>. Keep in mind
that you are accessing the low-level bytes of the UTF-8 representation,
and not the individual characters!</p>
</div>
<p>It is possible to mark arrays <code class="docutils literal"><span class="pre">public</span></code> and have Solidity create a <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a>.
The numeric index will become a required parameter for the getter.</p>
<div class="section" id="allocating-memory-arrays">
<span id="index-15"></span><h6>Allocating Memory Arrays<a class="headerlink" href="#allocating-memory-arrays" title="Permalink to this headline">¶</a></h6>
<p>Creating arrays with variable length in memory can be done using the <code class="docutils literal"><span class="pre">new</span></code> keyword.
As opposed to storage arrays, it is <strong>not</strong> possible to resize memory arrays by assigning to
the <code class="docutils literal"><span class="pre">.length</span></code> member.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">len</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="mi">7</span><span class="p">);</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="nx">len</span><span class="p">);</span>
        <span class="c1">// Here we have a.length == 7 and b.length == len</span>
        <span class="nx">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="array-literals-inline-arrays">
<span id="index-16"></span><h6>Array Literals / Inline Arrays<a class="headerlink" href="#array-literals-inline-arrays" title="Permalink to this headline">¶</a></h6>
<p>Array literals are arrays that are written as an expression and are not
assigned to a variable right away.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{</span>
        <span class="nx">g</span><span class="p">([</span><span class="kt">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nx">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The type of an array literal is a memory array of fixed size whose base
type is the common type of the given elements. The type of <code class="docutils literal"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> is
<code class="docutils literal"><span class="pre">uint8[3]</span> <span class="pre">memory</span></code>, because the type of each of these constants is <code class="docutils literal"><span class="pre">uint8</span></code>.
Because of that, it was necessary to convert the first element in the example
above to <code class="docutils literal"><span class="pre">uint</span></code>. Note that currently, fixed size memory arrays cannot
be assigned to dynamically-sized memory arrays, i.e. the following is not
possible:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// This will not compile.</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// The next line creates a type error because uint[3] memory</span>
        <span class="c1">// cannot be converted to uint[] memory.</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span> <span class="o">=</span> <span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is planned to remove this restriction in the future but currently creates
some complications because of how arrays are passed in the ABI.</p>
</div>
<div class="section" id="members">
<span id="index-17"></span><h6>Members<a class="headerlink" href="#members" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><strong>length</strong>:</dt>
<dd>Arrays have a <code class="docutils literal"><span class="pre">length</span></code> member to hold their number of elements.
Dynamic arrays can be resized in storage (not in memory) by changing the
<code class="docutils literal"><span class="pre">.length</span></code> member. This does not happen automatically when attempting to access elements outside the current length. The size of memory arrays is fixed (but dynamic, i.e. it can depend on runtime parameters) once they are created.</dd>
<dt><strong>push</strong>:</dt>
<dd>Dynamic storage arrays and <code class="docutils literal"><span class="pre">bytes</span></code> (not <code class="docutils literal"><span class="pre">string</span></code>) have a member function called <code class="docutils literal"><span class="pre">push</span></code> that can be used to append an element at the end of the array. The function returns the new length.</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is not yet possible to use arrays of arrays in external functions.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Due to limitations of the EVM, it is not possible to return
dynamic content from external function calls. The function <code class="docutils literal"><span class="pre">f</span></code> in
<code class="docutils literal"><span class="pre">contract</span> <span class="pre">C</span> <span class="pre">{</span> <span class="pre">function</span> <span class="pre">f()</span> <span class="pre">returns</span> <span class="pre">(uint[])</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span> <span class="pre">}</span></code> will return
something if called from web3.js, but not if called from Solidity.</p>
<p class="last">The only workaround for now is to use large statically-sized arrays.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">ArrayContract</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="mi">20</span><span class="p">]</span> <span class="nx">m_aLotOfIntegers</span><span class="p">;</span>
    <span class="c1">// Note that the following is not a pair of dynamic arrays but a</span>
    <span class="c1">// dynamic array of pairs (i.e. of fixed size arrays of length two).</span>
    <span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="nx">m_pairsOfFlags</span><span class="p">;</span>
    <span class="c1">// newPairs is stored in memory - the default for function arguments</span>

    <span class="kd">function</span> <span class="nx">setAllFlagPairs</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="nx">newPairs</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// assignment to a storage array replaces the complete array</span>
        <span class="nx">m_pairsOfFlags</span> <span class="o">=</span> <span class="nx">newPairs</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">setFlagPair</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">flagA</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">flagB</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// access to a non-existing index will throw an exception</span>
        <span class="nx">m_pairsOfFlags</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">flagA</span><span class="p">;</span>
        <span class="nx">m_pairsOfFlags</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">flagB</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changeFlagArraySize</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">newSize</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// if the new size is smaller, removed array elements will be cleared</span>
        <span class="nx">m_pairsOfFlags</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">newSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">clear</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// these clear the arrays completely</span>
        <span class="k">delete</span> <span class="nx">m_pairsOfFlags</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">m_aLotOfIntegers</span><span class="p">;</span>
        <span class="c1">// identical effect here</span>
        <span class="nx">m_pairsOfFlags</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bytes</span> <span class="nx">m_byteData</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">byteArrays</span><span class="p">(</span><span class="kt">bytes</span> <span class="nx">data</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// byte arrays (&quot;bytes&quot;) are different as they are stored without padding,</span>
        <span class="c1">// but can be treated identical to &quot;uint8[]&quot;</span>
        <span class="nx">m_byteData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="nx">m_byteData</span><span class="p">.</span><span class="nx">length</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
        <span class="nx">m_byteData</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="kt">byte</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
        <span class="k">delete</span> <span class="nx">m_byteData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">addFlag</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="nx">flag</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m_pairsOfFlags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">flag</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createMemoryArray</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">size</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Dynamic memory arrays are created using `new`:</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="k">memory</span> <span class="nx">arrayOfPairs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="p">][](</span><span class="nx">size</span><span class="p">);</span>
        <span class="c1">// Create a dynamic byte array:</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="nx">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="kt">byte</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="structs">
<span id="index-18"></span><span id="id8"></span><h5>Structs<a class="headerlink" href="#structs" title="Permalink to this headline">¶</a></h5>
<p>Solidity provides a way to define new types in the form of structs, which is
shown in the following example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">CrowdFunding</span> <span class="p">{</span>
    <span class="c1">// Defines a new type with two fields.</span>
    <span class="kd">struct</span> <span class="nx">Funder</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">addr</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="nx">Campaign</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">beneficiary</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">fundingGoal</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">numFunders</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">amount</span><span class="p">;</span>
        <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="nx">Funder</span><span class="p">)</span> <span class="nx">funders</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">uint</span> <span class="nx">numCampaigns</span><span class="p">;</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="nx">Campaign</span><span class="p">)</span> <span class="nx">campaigns</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">newCampaign</span><span class="p">(</span><span class="kt">address</span> <span class="nx">beneficiary</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">goal</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">campaignID</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">campaignID</span> <span class="o">=</span> <span class="nx">numCampaigns</span><span class="o">++</span><span class="p">;</span> <span class="c1">// campaignID is return variable</span>
        <span class="c1">// Creates new struct and saves in storage. We leave out the mapping type.</span>
        <span class="nx">campaigns</span><span class="p">[</span><span class="nx">campaignID</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Campaign</span><span class="p">(</span><span class="nx">beneficiary</span><span class="p">,</span> <span class="nx">goal</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">contribute</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">campaignID</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">Campaign</span> <span class="k">storage</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">campaigns</span><span class="p">[</span><span class="nx">campaignID</span><span class="p">];</span>
        <span class="c1">// Creates a new temporary memory struct, initialised with the given values</span>
        <span class="c1">// and copies it over to storage.</span>
        <span class="c1">// Note that you can also use Funder(msg.sender, msg.value) to initialise.</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">funders</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">numFunders</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Funder</span><span class="p">({</span><span class="nx">addr</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">amount</span><span class="o">:</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">amount</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">checkGoalReached</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">campaignID</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">reached</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Campaign</span> <span class="k">storage</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">campaigns</span><span class="p">[</span><span class="nx">campaignID</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">amount</span> <span class="o">&lt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">fundingGoal</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">amount</span><span class="p">;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">beneficiary</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The contract does not provide the full functionality of a crowdfunding
contract, but it contains the basic concepts necessary to understand structs.
Struct types can be used inside mappings and arrays and they can itself
contain mappings and arrays.</p>
<p>It is not possible for a struct to contain a member of its own type,
although the struct itself can be the value type of a mapping member.
This restriction is necessary, as the size of the struct has to be finite.</p>
<p>Note how in all the functions, a struct type is assigned to a local variable
(of the default storage data location).
This does not copy the struct but only stores a reference so that assignments to
members of the local variable actually write to the state.</p>
<p>Of course, you can also directly access the members of the struct without
assigning it to a local variable, as in
<code class="docutils literal"><span class="pre">campaigns[campaignID].amount</span> <span class="pre">=</span> <span class="pre">0</span></code>.</p>
</div>
</div>
<div class="section" id="mappings">
<span id="index-19"></span><h4>Mappings<a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h4>
<p>Mapping types are declared as <code class="docutils literal"><span class="pre">mapping(_KeyType</span> <span class="pre">=&gt;</span> <span class="pre">_ValueType)</span></code>.
Here <code class="docutils literal"><span class="pre">_KeyType</span></code> can be almost any type except for a mapping, a dynamically sized array, a contract, an enum and a struct.
<code class="docutils literal"><span class="pre">_ValueType</span></code> can actually be any type, including mappings.</p>
<p>Mappings can be seen as <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a> which are virtually initialized such that
every possible key exists and is mapped to a value whose byte-representation is
all zeros: a type’s <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a>. The similarity ends here, though: The key data is not actually stored
in a mapping, only its <code class="docutils literal"><span class="pre">keccak256</span></code> hash used to look up the value.</p>
<p>Because of this, mappings do not have a length or a concept of a key or value being “set”.</p>
<p>Mappings are only allowed for state variables (or as storage reference types
in internal functions).</p>
<p>It is possible to mark mappings <code class="docutils literal"><span class="pre">public</span></code> and have Solidity create a <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a>.
The <code class="docutils literal"><span class="pre">_KeyType</span></code> will become a required parameter for the getter and it will
return <code class="docutils literal"><span class="pre">_ValueType</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">_ValueType</span></code> can be a mapping too. The getter will have one parameter
for each <code class="docutils literal"><span class="pre">_KeyType</span></code>, recursively.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">MappingExample</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="nx">balances</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">newBalance</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newBalance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">MappingUser</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">MappingExample</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MappingExample</span><span class="p">();</span>
        <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">balances</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mappings are not iterable, but it is possible to implement a data structure on top of them.
For an example, see <a class="reference external" href="https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol">iterable mapping</a>.</p>
</div>
</div>
<div class="section" id="operators-involving-lvalues">
<span id="index-20"></span><h4>Operators Involving LValues<a class="headerlink" href="#operators-involving-lvalues" title="Permalink to this headline">¶</a></h4>
<p>If <code class="docutils literal"><span class="pre">a</span></code> is an LValue (i.e. a variable or something that can be assigned to), the following operators are available as shorthands:</p>
<p><code class="docutils literal"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">e</span></code> is equivalent to <code class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">e</span></code>. The operators <code class="docutils literal"><span class="pre">-=</span></code>, <code class="docutils literal"><span class="pre">*=</span></code>, <code class="docutils literal"><span class="pre">/=</span></code>, <code class="docutils literal"><span class="pre">%=</span></code>, <code class="docutils literal"><span class="pre">|=</span></code>, <code class="docutils literal"><span class="pre">&amp;=</span></code> and <code class="docutils literal"><span class="pre">^=</span></code> are defined accordingly. <code class="docutils literal"><span class="pre">a++</span></code> and <code class="docutils literal"><span class="pre">a--</span></code> are equivalent to <code class="docutils literal"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">1</span></code> / <code class="docutils literal"><span class="pre">a</span> <span class="pre">-=</span> <span class="pre">1</span></code> but the expression itself still has the previous value of <code class="docutils literal"><span class="pre">a</span></code>. In contrast, <code class="docutils literal"><span class="pre">--a</span></code> and <code class="docutils literal"><span class="pre">++a</span></code> have the same effect on <code class="docutils literal"><span class="pre">a</span></code> but return the value after the change.</p>
<div class="section" id="delete">
<h5>delete<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal"><span class="pre">delete</span> <span class="pre">a</span></code> assigns the initial value for the type to <code class="docutils literal"><span class="pre">a</span></code>. I.e. for integers it is equivalent to <code class="docutils literal"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0</span></code>, but it can also be used on arrays, where it assigns a dynamic array of length zero or a static array of the same length with all elements reset. For structs, it assigns a struct with all members reset.</p>
<p><code class="docutils literal"><span class="pre">delete</span></code> has no effect on whole mappings (as the keys of mappings may be arbitrary and are generally unknown). So if you delete a struct, it will reset all members that are not mappings and also recurse into the members unless they are mappings. However, individual keys and what they map to can be deleted.</p>
<p>It is important to note that <code class="docutils literal"><span class="pre">delete</span> <span class="pre">a</span></code> really behaves like an assignment to <code class="docutils literal"><span class="pre">a</span></code>, i.e. it stores a new object in <code class="docutils literal"><span class="pre">a</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">DeleteExample</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">data</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">dataArray</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// sets x to 0, does not affect data</span>
        <span class="k">delete</span> <span class="nx">data</span><span class="p">;</span> <span class="c1">// sets data to 0, does not affect x which still holds a copy</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">dataArray</span><span class="p">;</span>
        <span class="k">delete</span> <span class="nx">dataArray</span><span class="p">;</span> <span class="c1">// this sets dataArray.length to zero, but as uint[] is a complex object, also</span>
        <span class="c1">// y is affected which is an alias to the storage object</span>
        <span class="c1">// On the other hand: &quot;delete y&quot; is not valid, as assignments to local variables</span>
        <span class="c1">// referencing storage objects can only be made from existing storage objects.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="conversions-between-elementary-types">
<span id="index-21"></span><h4>Conversions between Elementary Types<a class="headerlink" href="#conversions-between-elementary-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="implicit-conversions">
<h5>Implicit Conversions<a class="headerlink" href="#implicit-conversions" title="Permalink to this headline">¶</a></h5>
<p>If an operator is applied to different types, the compiler tries to
implicitly convert one of the operands to the type of the other (the same is
true for assignments). In general, an implicit conversion between value-types
is possible if it
makes sense semantically and no information is lost: <code class="docutils literal"><span class="pre">uint8</span></code> is convertible to
<code class="docutils literal"><span class="pre">uint16</span></code> and <code class="docutils literal"><span class="pre">int128</span></code> to <code class="docutils literal"><span class="pre">int256</span></code>, but <code class="docutils literal"><span class="pre">int8</span></code> is not convertible to <code class="docutils literal"><span class="pre">uint256</span></code>
(because <code class="docutils literal"><span class="pre">uint256</span></code> cannot hold e.g. <code class="docutils literal"><span class="pre">-1</span></code>).
Furthermore, unsigned integers can be converted to bytes of the same or larger
size, but not vice-versa. Any type that can be converted to <code class="docutils literal"><span class="pre">uint160</span></code> can also
be converted to <code class="docutils literal"><span class="pre">address</span></code>.</p>
</div>
<div class="section" id="explicit-conversions">
<h5>Explicit Conversions<a class="headerlink" href="#explicit-conversions" title="Permalink to this headline">¶</a></h5>
<p>If the compiler does not allow implicit conversion but you know what you are
doing, an explicit type conversion is sometimes possible. Note that this may
give you some unexpected behaviour so be sure to test to ensure that the
result is what you want! Take the following example where you are converting
a negative <code class="docutils literal"><span class="pre">int8</span></code> to a <code class="docutils literal"><span class="pre">uint</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">int8</span> <span class="nx">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
<span class="kt">uint</span> <span class="nx">x</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</pre></div>
</div>
<p>At the end of this code snippet, <code class="docutils literal"><span class="pre">x</span></code> will have the value <code class="docutils literal"><span class="pre">0xfffff..fd</span></code> (64 hex
characters), which is -3 in the two’s complement representation of 256 bits.</p>
<p>If a type is explicitly converted to a smaller type, higher-order bits are
cut off:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint32</span> <span class="nx">a</span> <span class="o">=</span> <span class="mh">0x12345678</span><span class="p">;</span>
<span class="kt">uint16</span> <span class="nx">b</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span> <span class="c1">// b will be 0x5678 now</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="type-deduction">
<span id="index-22"></span><span id="id9"></span><h4>Type Deduction<a class="headerlink" href="#type-deduction" title="Permalink to this headline">¶</a></h4>
<p>For convenience, it is not always necessary to explicitly specify the type of a
variable, the compiler automatically infers it from the type of the first
expression that is assigned to the variable:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint24</span> <span class="nx">x</span> <span class="o">=</span> <span class="mh">0x123</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
</pre></div>
</div>
<p>Here, the type of <code class="docutils literal"><span class="pre">y</span></code> will be <code class="docutils literal"><span class="pre">uint24</span></code>. Using <code class="docutils literal"><span class="pre">var</span></code> is not possible for function
parameters or return parameters.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The type is only deduced from the first assignment, so
the loop in the following snippet is infinite, as <code class="docutils literal"><span class="pre">i</span></code> will have the type
<code class="docutils literal"><span class="pre">uint8</span></code> and the highest value of this type is smaller than <code class="docutils literal"><span class="pre">2000</span></code>.
<code class="docutils literal"><span class="pre">for</span> <span class="pre">(var</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">2000;</span> <span class="pre">i++)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code></p>
</div>
</div>
</div>
<span id="document-units-and-global-variables"></span><div class="section" id="units-and-globally-available-variables">
<h3>Units and Globally Available Variables<a class="headerlink" href="#units-and-globally-available-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ether-units">
<span id="index-0"></span><h4>Ether Units<a class="headerlink" href="#ether-units" title="Permalink to this headline">¶</a></h4>
<p>A literal number can take a suffix of <code class="docutils literal"><span class="pre">wei</span></code>, <code class="docutils literal"><span class="pre">finney</span></code>, <code class="docutils literal"><span class="pre">szabo</span></code> or <code class="docutils literal"><span class="pre">ether</span></code> to convert between the subdenominations of Ether, where Ether currency numbers without a postfix are assumed to be Wei, e.g. <code class="docutils literal"><span class="pre">2</span> <span class="pre">ether</span> <span class="pre">==</span> <span class="pre">2000</span> <span class="pre">finney</span></code> evaluates to <code class="docutils literal"><span class="pre">true</span></code>.</p>
</div>
<div class="section" id="time-units">
<span id="index-1"></span><h4>Time Units<a class="headerlink" href="#time-units" title="Permalink to this headline">¶</a></h4>
<p>Suffixes like <code class="docutils literal"><span class="pre">seconds</span></code>, <code class="docutils literal"><span class="pre">minutes</span></code>, <code class="docutils literal"><span class="pre">hours</span></code>, <code class="docutils literal"><span class="pre">days</span></code>, <code class="docutils literal"><span class="pre">weeks</span></code> and
<code class="docutils literal"><span class="pre">years</span></code> after literal numbers can be used to convert between units of time where seconds are the base
unit and units are considered naively in the following way:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">seconds</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">minutes</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">seconds</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">hours</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">minutes</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">days</span> <span class="pre">==</span> <span class="pre">24</span> <span class="pre">hours</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">weeks</span> <span class="pre">==</span> <span class="pre">7</span> <span class="pre">days</span></code></li>
<li><code class="docutils literal"><span class="pre">1</span> <span class="pre">years</span> <span class="pre">==</span> <span class="pre">365</span> <span class="pre">days</span></code></li>
</ul>
</div></blockquote>
<p>Take care if you perform calendar calculations using these units, because
not every year equals 365 days and not even every day has 24 hours
because of <a class="reference external" href="https://en.wikipedia.org/wiki/Leap_second">leap seconds</a>.
Due to the fact that leap seconds cannot be predicted, an exact calendar
library has to be updated by an external oracle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The suffix <code class="docutils literal"><span class="pre">years</span></code> has been deprecated due to the reasons above.</p>
</div>
<p>These suffixes cannot be applied to variables. If you want to
interpret some input variable in e.g. days, you can do it in the following way:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">start</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">daysAfter</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">start</span> <span class="o">+</span> <span class="nx">daysAfter</span> <span class="o">*</span> <span class="mi">1</span> <span class="kt">days</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="special-variables-and-functions">
<h4>Special Variables and Functions<a class="headerlink" href="#special-variables-and-functions" title="Permalink to this headline">¶</a></h4>
<p>There are special variables and functions which always exist in the global
namespace and are mainly used to provide information about the blockchain
or are general-use utility functions.</p>
<div class="section" id="block-and-transaction-properties">
<span id="index-2"></span><h5>Block and Transaction Properties<a class="headerlink" href="#block-and-transaction-properties" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">block.blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block - only works for 256 most recent, excluding current, blocks - deprecated in version 0.4.22 and replaced by <code class="docutils literal"><span class="pre">blockhash(uint</span> <span class="pre">blockNumber)</span></code>.</li>
<li><code class="docutils literal"><span class="pre">block.coinbase</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): current block miner’s address</li>
<li><code class="docutils literal"><span class="pre">block.difficulty</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block difficulty</li>
<li><code class="docutils literal"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block gaslimit</li>
<li><code class="docutils literal"><span class="pre">block.number</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block number</li>
<li><code class="docutils literal"><span class="pre">block.timestamp</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block timestamp as seconds since unix epoch</li>
<li><code class="docutils literal"><span class="pre">gasleft()</span> <span class="pre">returns</span> <span class="pre">(uint256)</span></code>: remaining gas</li>
<li><code class="docutils literal"><span class="pre">msg.data</span></code> (<code class="docutils literal"><span class="pre">bytes</span></code>): complete calldata</li>
<li><code class="docutils literal"><span class="pre">msg.gas</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): remaining gas - deprecated in version 0.4.21 and to be replaced by <code class="docutils literal"><span class="pre">gasleft()</span></code></li>
<li><code class="docutils literal"><span class="pre">msg.sender</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): sender of the message (current call)</li>
<li><code class="docutils literal"><span class="pre">msg.sig</span></code> (<code class="docutils literal"><span class="pre">bytes4</span></code>): first four bytes of the calldata (i.e. function identifier)</li>
<li><code class="docutils literal"><span class="pre">msg.value</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): number of wei sent with the message</li>
<li><code class="docutils literal"><span class="pre">now</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block timestamp (alias for <code class="docutils literal"><span class="pre">block.timestamp</span></code>)</li>
<li><code class="docutils literal"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): gas price of the transaction</li>
<li><code class="docutils literal"><span class="pre">tx.origin</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): sender of the transaction (full call chain)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The values of all members of <code class="docutils literal"><span class="pre">msg</span></code>, including <code class="docutils literal"><span class="pre">msg.sender</span></code> and
<code class="docutils literal"><span class="pre">msg.value</span></code> can change for every <strong>external</strong> function call.
This includes calls to library functions.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Do not rely on <code class="docutils literal"><span class="pre">block.timestamp</span></code>, <code class="docutils literal"><span class="pre">now</span></code> and <code class="docutils literal"><span class="pre">blockhash</span></code> as a source of randomness,
unless you know what you are doing.</p>
<p>Both the timestamp and the block hash can be influenced by miners to some degree.
Bad actors in the mining community can for example run a casino payout function on a chosen hash
and just retry a different hash if they did not receive any money.</p>
<p class="last">The current block timestamp must be strictly larger than the timestamp of the last block,
but the only guarantee is that it will be somewhere between the timestamps of two
consecutive blocks in the canonical chain.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The block hashes are not available for all blocks for scalability reasons.
You can only access the hashes of the most recent 256 blocks, all other
values will be zero.</p>
</div>
</div>
<div class="section" id="abi-encoding-functions">
<span id="index-3"></span><h5>ABI Encoding Functions<a class="headerlink" href="#abi-encoding-functions" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">abi.encode(...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: ABI-encodes the given arguments</li>
<li><code class="docutils literal"><span class="pre">abi.encodePacked(...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: Performes packed encoding of the given arguments</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">abi.encodeWithSelector(bytes4</span> <span class="pre">selector,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: ABI-encodes the given arguments</dt>
<dd>starting from the second and prepends the given four-byte selector</dd>
</dl>
</li>
<li><code class="docutils literal"><span class="pre">abi.encodeWithSignature(string</span> <span class="pre">signature,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: Equivalent to <code class="docutils literal"><span class="pre">abi.encodeWithSelector(bytes4(keccak256(signature),</span> <span class="pre">...)`</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These encoding functions can be used to craft data for function calls without actually
calling a function. Furthermore, <code class="docutils literal"><span class="pre">keccak256(abi.encodePacked(a,</span> <span class="pre">b))</span></code> is a more
explicit way to compute <code class="docutils literal"><span class="pre">keccak256(a,</span> <span class="pre">b)</span></code>, which will be deprecated in future
versions.</p>
</div>
<p>See the documentation about the <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a> and the
<a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">tightly packed encoding</span></a> for details about the encoding.</p>
</div>
<div class="section" id="error-handling">
<span id="index-4"></span><h5>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code>:</dt>
<dd>invalidates the transaction if the condition is not met - to be used for internal errors.</dd>
<dt><code class="docutils literal"><span class="pre">require(bool</span> <span class="pre">condition)</span></code>:</dt>
<dd>reverts if the condition is not met - to be used for errors in inputs or external components.</dd>
<dt><code class="docutils literal"><span class="pre">require(bool</span> <span class="pre">condition,</span> <span class="pre">string</span> <span class="pre">message)</span></code>:</dt>
<dd>reverts if the condition is not met - to be used for errors in inputs or external components. Also provides an error message.</dd>
<dt><code class="docutils literal"><span class="pre">revert()</span></code>:</dt>
<dd>abort execution and revert state changes</dd>
<dt><code class="docutils literal"><span class="pre">revert(string</span> <span class="pre">reason)</span></code>:</dt>
<dd>abort execution and revert state changes, providing an explanatory string</dd>
</dl>
</div>
<div class="section" id="mathematical-and-cryptographic-functions">
<span id="index-5"></span><h5>Mathematical and Cryptographic Functions<a class="headerlink" href="#mathematical-and-cryptographic-functions" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>:</dt>
<dd>compute <code class="docutils literal"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the addition is performed with arbitrary precision and does not wrap around at <code class="docutils literal"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</dd>
<dt><code class="docutils literal"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>:</dt>
<dd>compute <code class="docutils literal"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the multiplication is performed with arbitrary precision and does not wrap around at <code class="docutils literal"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</dd>
<dt><code class="docutils literal"><span class="pre">keccak256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>compute the Ethereum-SHA-3 (Keccak-256) hash of the <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">(tightly packed) arguments</span></a></dd>
<dt><code class="docutils literal"><span class="pre">sha256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>compute the SHA-256 hash of the <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">(tightly packed) arguments</span></a></dd>
<dt><code class="docutils literal"><span class="pre">sha3(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>alias to <code class="docutils literal"><span class="pre">keccak256</span></code></dd>
<dt><code class="docutils literal"><span class="pre">ripemd160(...)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code>:</dt>
<dd>compute RIPEMD-160 hash of the <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">(tightly packed) arguments</span></a></dd>
<dt><code class="docutils literal"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns</span> <span class="pre">(address)</span></code>:</dt>
<dd>recover the address associated with the public key from elliptic curve signature or return zero on error
(<a class="reference external" href="https://ethereum.stackexchange.com/q/1777/222">example usage</a>)</dd>
</dl>
<p>In the above, “tightly packed” means that the arguments are concatenated without padding.
This means that the following are all identical:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;ab&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="mh">0x616263</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="mi">6382179</span><span class="p">)</span>
<span class="nb">keccak256</span><span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span>
</pre></div>
</div>
<p>If padding is needed, explicit type conversions can be used: <code class="docutils literal"><span class="pre">keccak256(&quot;\x00\x12&quot;)</span></code> is the
same as <code class="docutils literal"><span class="pre">keccak256(uint16(0x12))</span></code>.</p>
<p>Note that constants will be packed using the minimum number of bytes required to store them.
This means that, for example, <code class="docutils literal"><span class="pre">keccak256(0)</span> <span class="pre">==</span> <span class="pre">keccak256(uint8(0))</span></code> and
<code class="docutils literal"><span class="pre">keccak256(0x12345678)</span> <span class="pre">==</span> <span class="pre">keccak256(uint32(0x12345678))</span></code>.</p>
<p>It might be that you run into Out-of-Gas for <code class="docutils literal"><span class="pre">sha256</span></code>, <code class="docutils literal"><span class="pre">ripemd160</span></code> or <code class="docutils literal"><span class="pre">ecrecover</span></code> on a <em>private blockchain</em>. The reason for this is that those are implemented as so-called precompiled contracts and these contracts only really exist after they received the first message (although their contract code is hardcoded). Messages to non-existing contracts are more expensive and thus the execution runs into an Out-of-Gas error. A workaround for this problem is to first send e.g. 1 Wei to each of the contracts before you use them in your actual contracts. This is not an issue on the official or test net.</p>
</div>
<div class="section" id="address-related">
<span id="index-6"></span><span id="id1"></span><h5>Address Related<a class="headerlink" href="#address-related" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal"><span class="pre">uint256</span></code>):</dt>
<dd>balance of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.transfer(uint256</span> <span class="pre">amount)</span></code>:</dt>
<dd>send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, throws on failure, forwards 2300 gas stipend, not adjustable</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, returns <code class="docutils literal"><span class="pre">false</span></code> on failure, forwards 2300 gas stipend, not adjustable</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.call(...)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>issue low-level <code class="docutils literal"><span class="pre">CALL</span></code>, returns <code class="docutils literal"><span class="pre">false</span></code> on failure, forwards all available gas, adjustable</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.callcode(...)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>issue low-level <code class="docutils literal"><span class="pre">CALLCODE</span></code>, returns <code class="docutils literal"><span class="pre">false</span></code> on failure, forwards all available gas, adjustable</dd>
<dt><code class="docutils literal"><span class="pre">&lt;address&gt;.delegatecall(...)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>issue low-level <code class="docutils literal"><span class="pre">DELEGATECALL</span></code>, returns <code class="docutils literal"><span class="pre">false</span></code> on failure, forwards all available gas, adjustable</dd>
</dl>
<p>For more information, see the section on <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There are some dangers in using <code class="docutils literal"><span class="pre">send</span></code>: The transfer fails if the call stack depth is at 1024
(this can always be forced by the caller) and it also fails if the recipient runs out of gas. So in order
to make safe Ether transfers, always check the return value of <code class="docutils literal"><span class="pre">send</span></code>, use <code class="docutils literal"><span class="pre">transfer</span></code> or even better:
Use a pattern where the recipient withdraws the money.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If storage variables are accessed via a low-level delegatecall, the storage layout of the two contracts
must align in order for the called contract to correctly access the storage variables of the calling contract by name.
This is of course not the case if storage pointers are passed as function arguments as in the case for
the high-level libraries.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The use of <code class="docutils literal"><span class="pre">callcode</span></code> is discouraged and will be removed in the future.</p>
</div>
</div>
<div class="section" id="contract-related">
<span id="index-7"></span><h5>Contract Related<a class="headerlink" href="#contract-related" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">this</span></code> (current contract’s type):</dt>
<dd>the current contract, explicitly convertible to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></dd>
<dt><code class="docutils literal"><span class="pre">selfdestruct(address</span> <span class="pre">recipient)</span></code>:</dt>
<dd>destroy the current contract, sending its funds to the given <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></dd>
<dt><code class="docutils literal"><span class="pre">suicide(address</span> <span class="pre">recipient)</span></code>:</dt>
<dd>deprecated alias to <code class="docutils literal"><span class="pre">selfdestruct</span></code></dd>
</dl>
<p>Furthermore, all functions of the current contract are callable directly including the current function.</p>
</div>
</div>
</div>
<span id="document-control-structures"></span><div class="section" id="expressions-and-control-structures">
<h3>Expressions and Control Structures<a class="headerlink" href="#expressions-and-control-structures" title="Permalink to this headline">¶</a></h3>
<div class="section" id="input-parameters-and-output-parameters">
<span id="index-0"></span><h4>Input Parameters and Output Parameters<a class="headerlink" href="#input-parameters-and-output-parameters" title="Permalink to this headline">¶</a></h4>
<p>As in Javascript, functions may take parameters as input;
unlike in Javascript and C, they may also return arbitrary number of
parameters as output.</p>
<div class="section" id="input-parameters">
<h5>Input Parameters<a class="headerlink" href="#input-parameters" title="Permalink to this headline">¶</a></h5>
<p>The input parameters are declared the same way as variables are. As an
exception, unused parameters can omit the variable name.
For example, suppose we want our contract to
accept one kind of external calls with two integers, we would write
something like:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Simple</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">taker</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_b</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{</span>
        <span class="c1">// do something with _a and _b.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="output-parameters">
<h5>Output Parameters<a class="headerlink" href="#output-parameters" title="Permalink to this headline">¶</a></h5>
<p>The output parameters can be declared with the same syntax after the
<code class="docutils literal"><span class="pre">returns</span></code> keyword. For example, suppose we wished to return two results:
the sum and the product of the two given integers, then we would
write:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Simple</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">arithmetics</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_b</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="k">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">o_product</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">o_sum</span> <span class="o">=</span> <span class="nx">_a</span> <span class="o">+</span> <span class="nx">_b</span><span class="p">;</span>
        <span class="nx">o_product</span> <span class="o">=</span> <span class="nx">_a</span> <span class="o">*</span> <span class="nx">_b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The names of output parameters can be omitted.
The output values can also be specified using <code class="docutils literal"><span class="pre">return</span></code> statements.
The <code class="docutils literal"><span class="pre">return</span></code> statements are also capable of returning multiple
values, see <a class="reference internal" href="#multi-return"><span class="std std-ref">Returning Multiple Values</span></a>.
Return parameters are initialized to zero; if they are not explicitly
set, they stay to be zero.</p>
<p>Input parameters and output parameters can be used as expressions in
the function body.  There, they are also usable in the left-hand side
of assignment.</p>
</div>
</div>
<div class="section" id="control-structures">
<span id="index-1"></span><h4>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this headline">¶</a></h4>
<p>Most of the control structures from JavaScript are available in Solidity
except for <code class="docutils literal"><span class="pre">switch</span></code> and <code class="docutils literal"><span class="pre">goto</span></code>. So
there is: <code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">else</span></code>, <code class="docutils literal"><span class="pre">while</span></code>, <code class="docutils literal"><span class="pre">do</span></code>, <code class="docutils literal"><span class="pre">for</span></code>, <code class="docutils literal"><span class="pre">break</span></code>, <code class="docutils literal"><span class="pre">continue</span></code>, <code class="docutils literal"><span class="pre">return</span></code>, <code class="docutils literal"><span class="pre">?</span> <span class="pre">:</span></code>, with
the usual semantics known from C or JavaScript.</p>
<p>Parentheses can <em>not</em> be omitted for conditionals, but curly brances can be omitted
around single-statement bodies.</p>
<p>Note that there is no type conversion from non-boolean to boolean types as
there is in C and JavaScript, so <code class="docutils literal"><span class="pre">if</span> <span class="pre">(1)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> is <em>not</em> valid
Solidity.</p>
<div class="section" id="returning-multiple-values">
<span id="multi-return"></span><h5>Returning Multiple Values<a class="headerlink" href="#returning-multiple-values" title="Permalink to this headline">¶</a></h5>
<p>When a function has multiple output parameters, <code class="docutils literal"><span class="pre">return</span> <span class="pre">(v0,</span> <span class="pre">v1,</span> <span class="pre">...,</span>
<span class="pre">vn)</span></code> can return multiple values.  The number of components must be
the same as the number of output parameters.</p>
</div>
</div>
<div class="section" id="function-calls">
<span id="index-2"></span><span id="id1"></span><h4>Function Calls<a class="headerlink" href="#function-calls" title="Permalink to this headline">¶</a></h4>
<div class="section" id="internal-function-calls">
<h5>Internal Function Calls<a class="headerlink" href="#internal-function-calls" title="Permalink to this headline">¶</a></h5>
<p>Functions of the current contract can be called directly (“internally”), also recursively, as seen in
this nonsensical example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">f</span><span class="p">();</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">g</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="nx">f</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These function calls are translated into simple jumps inside the EVM. This has
the effect that the current memory is not cleared, i.e. passing memory references
to internally-called functions is very efficient. Only functions of the same
contract can be called internally.</p>
</div>
<div class="section" id="external-function-calls">
<h5>External Function Calls<a class="headerlink" href="#external-function-calls" title="Permalink to this headline">¶</a></h5>
<p>The expressions <code class="docutils literal"><span class="pre">this.g(8);</span></code> and <code class="docutils literal"><span class="pre">c.g(2);</span></code> (where <code class="docutils literal"><span class="pre">c</span></code> is a contract
instance) are also valid function calls, but this time, the function
will be called “externally”, via a message call and not directly via jumps.
Please note that function calls on <code class="docutils literal"><span class="pre">this</span></code> cannot be used in the constructor, as the
actual contract has not been created yet.</p>
<p>Functions of other contracts have to be called externally. For an external call,
all function arguments have to be copied to memory.</p>
<p>When calling functions of other contracts, the amount of Wei sent with the call and
the gas can be specified with special options <code class="docutils literal"><span class="pre">.value()</span></code> and <code class="docutils literal"><span class="pre">.gas()</span></code>, respectively:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">InfoFeed</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">info</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Consumer</span> <span class="p">{</span>
    <span class="nx">InfoFeed</span> <span class="nx">feed</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">setFeed</span><span class="p">(</span><span class="kt">address</span> <span class="nx">addr</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">feed</span> <span class="o">=</span> <span class="nx">InfoFeed</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">callFeed</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">feed</span><span class="p">.</span><span class="nx">info</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">gas</span><span class="p">(</span><span class="mi">800</span><span class="p">)();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The modifier <code class="docutils literal"><span class="pre">payable</span></code> has to be used for <code class="docutils literal"><span class="pre">info</span></code>, because otherwise, the <cite>.value()</cite>
option would not be available.</p>
<p>Note that the expression <code class="docutils literal"><span class="pre">InfoFeed(addr)</span></code> performs an explicit type conversion stating
that “we know that the type of the contract at the given address is <code class="docutils literal"><span class="pre">InfoFeed</span></code>” and
this does not execute a constructor. Explicit type conversions have to be
handled with extreme caution. Never call a function on a contract where you
are not sure about its type.</p>
<p>We could also have used <code class="docutils literal"><span class="pre">function</span> <span class="pre">setFeed(InfoFeed</span> <span class="pre">_feed)</span> <span class="pre">{</span> <span class="pre">feed</span> <span class="pre">=</span> <span class="pre">_feed;</span> <span class="pre">}</span></code> directly.
Be careful about the fact that <code class="docutils literal"><span class="pre">feed.info.value(10).gas(800)</span></code>
only (locally) sets the value and amount of gas sent with the function call and only the
parentheses at the end perform the actual call.</p>
<p>Function calls cause exceptions if the called contract does not exist (in the
sense that the account does not contain code) or if the called contract itself
throws an exception or goes out of gas.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Any interaction with another contract imposes a potential danger, especially
if the source code of the contract is not known in advance. The current
contract hands over control to the called contract and that may potentially
do just about anything. Even if the called contract inherits from a known parent contract,
the inheriting contract is only required to have a correct interface. The
implementation of the contract, however, can be completely arbitrary and thus,
pose a danger. In addition, be prepared in case it calls into other contracts of
your system or even back into the calling contract before the first
call returns. This means
that the called contract can change state variables of the calling contract
via its functions. Write your functions in a way that, for example, calls to
external functions happen after any changes to state variables in your contract
so your contract is not vulnerable to a reentrancy exploit.</p>
</div>
</div>
<div class="section" id="named-calls-and-anonymous-function-parameters">
<h5>Named Calls and Anonymous Function Parameters<a class="headerlink" href="#named-calls-and-anonymous-function-parameters" title="Permalink to this headline">¶</a></h5>
<p>Function call arguments can also be given by name, in any order,
if they are enclosed in <code class="docutils literal"><span class="pre">{</span> <span class="pre">}</span></code> as can be seen in the following
example. The argument list has to coincide by name with the list of
parameters from the function declaration, but can be in arbitrary order.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">key</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// named arguments</span>
        <span class="nx">f</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">key</span><span class="o">:</span> <span class="mi">3</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="omitted-function-parameter-names">
<h5>Omitted Function Parameter Names<a class="headerlink" href="#omitted-function-parameter-names" title="Permalink to this headline">¶</a></h5>
<p>The names of unused parameters (especially return parameters) can be omitted.
Those parameters will still be present on the stack, but they are inaccessible.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="c1">// omitted name for parameter</span>
    <span class="kd">function</span> <span class="nx">func</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">k</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">k</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-contracts-via-new">
<span id="creating-contracts"></span><span id="index-3"></span><h4>Creating Contracts via <code class="docutils literal"><span class="pre">new</span></code><a class="headerlink" href="#creating-contracts-via-new" title="Permalink to this headline">¶</a></h4>
<p>A contract can create a new contract using the <code class="docutils literal"><span class="pre">new</span></code> keyword. The full
code of the contract being created has to be known in advance, so recursive
creation-dependencies are not possible.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">D</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="nx">D</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">D</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// will be executed as part of C&#39;s constructor</span>

    <span class="kd">function</span> <span class="nx">createD</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">arg</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">D</span> <span class="nx">newD</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">D</span><span class="p">(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">createAndEndowD</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">arg</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// Send ether along with the creation</span>
        <span class="nx">D</span> <span class="nx">newD</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">D</span><span class="p">).</span><span class="nx">value</span><span class="p">(</span><span class="nx">amount</span><span class="p">)(</span><span class="nx">arg</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As seen in the example, it is possible to forward Ether while creating
an instance of <code class="docutils literal"><span class="pre">D</span></code> using the <code class="docutils literal"><span class="pre">.value()</span></code> option, but it is not possible
to limit the amount of gas.
If the creation fails (due to out-of-stack, not enough balance or other problems),
an exception is thrown.</p>
</div>
<div class="section" id="order-of-evaluation-of-expressions">
<h4>Order of Evaluation of Expressions<a class="headerlink" href="#order-of-evaluation-of-expressions" title="Permalink to this headline">¶</a></h4>
<p>The evaluation order of expressions is not specified (more formally, the order
in which the children of one node in the expression tree are evaluated is not
specified, but they are of course evaluated before the node itself). It is only
guaranteed that statements are executed in order and short-circuiting for
boolean expressions is done. See <a class="reference internal" href="index.html#order"><span class="std std-ref">Order of Precedence of Operators</span></a> for more information.</p>
</div>
<div class="section" id="assignment">
<span id="index-4"></span><h4>Assignment<a class="headerlink" href="#assignment" title="Permalink to this headline">¶</a></h4>
<div class="section" id="destructuring-assignments-and-returning-multiple-values">
<span id="index-5"></span><h5>Destructuring Assignments and Returning Multiple Values<a class="headerlink" href="#destructuring-assignments-and-returning-multiple-values" title="Permalink to this headline">¶</a></h5>
<p>Solidity internally allows tuple types, i.e. a list of objects of potentially different types whose size is a constant at compile-time. Those tuples can be used to return multiple values at the same time and also assign them to multiple variables (or LValues in general) at the same time:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">bool</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// Variables declared with type</span>
        <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="nx">b</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">y</span><span class="p">;</span>
        <span class="c1">// Tuple values can be assigned to these pre-existing variables</span>
        <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">=</span> <span class="nx">f</span><span class="p">();</span>
        <span class="c1">// Common trick to swap values -- does not work for non-value storage types.</span>
        <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">x</span><span class="p">);</span>
        <span class="c1">// Components can be left out (also for variable declarations).</span>
        <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">,,)</span> <span class="o">=</span> <span class="nx">f</span><span class="p">();</span> <span class="c1">// Sets the length to 7</span>
        <span class="c1">// Components can only be left out at the left-hand-side of assignments, with</span>
        <span class="c1">// one exception:</span>
        <span class="p">(</span><span class="nx">x</span><span class="p">,)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,);</span>
        <span class="c1">// (1,) is the only way to specify a 1-component tuple, because (1) is</span>
        <span class="c1">// equivalent to 1.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.4.24 it was possible to assign to tuples of smaller size, either
filling up on the left or on the right side (which ever was empty). This is
now deprecated, both sides have to have the same number of components.</p>
</div>
</div>
<div class="section" id="complications-for-arrays-and-structs">
<h5>Complications for Arrays and Structs<a class="headerlink" href="#complications-for-arrays-and-structs" title="Permalink to this headline">¶</a></h5>
<p>The semantics of assignment are a bit more complicated for non-value types like arrays and structs.
Assigning <em>to</em> a state variable always creates an independent copy. On the other hand, assigning to a local variable creates an independent copy only for elementary types, i.e. static types that fit into 32 bytes. If structs or arrays (including <code class="docutils literal"><span class="pre">bytes</span></code> and <code class="docutils literal"><span class="pre">string</span></code>) are assigned from a state variable to a local variable, the local variable holds a reference to the original state variable. A second assignment to the local variable does not modify the state but only changes the reference. Assignments to members (or elements) of the local variable <em>do</em> change the state.</p>
</div>
</div>
<div class="section" id="scoping-and-declarations">
<span id="default-value"></span><span id="index-6"></span><h4>Scoping and Declarations<a class="headerlink" href="#scoping-and-declarations" title="Permalink to this headline">¶</a></h4>
<p>A variable which is declared will have an initial default value whose byte-representation is all zeros.
The “default values” of variables are the typical “zero-state” of whatever the type is. For example, the default value for a <code class="docutils literal"><span class="pre">bool</span></code>
is <code class="docutils literal"><span class="pre">false</span></code>. The default value for the <code class="docutils literal"><span class="pre">uint</span></code> or <code class="docutils literal"><span class="pre">int</span></code> types is <code class="docutils literal"><span class="pre">0</span></code>. For statically-sized arrays and <code class="docutils literal"><span class="pre">bytes1</span></code> to <code class="docutils literal"><span class="pre">bytes32</span></code>, each individual
element will be initialized to the default value corresponding to its type. Finally, for dynamically-sized arrays, <code class="docutils literal"><span class="pre">bytes</span></code>
and <code class="docutils literal"><span class="pre">string</span></code>, the default value is an empty array or string.</p>
<p>A variable declared anywhere within a function will be in scope for the <em>entire function</em>, regardless of where it is declared
(this will change soon, see below).
This happens because Solidity inherits its scoping rules from JavaScript.
This is in contrast to many languages where variables are only scoped where they are declared until the end of the semantic block.
As a result, the following code is illegal and cause the compiler to throw an error, <code class="docutils literal"><span class="pre">Identifier</span> <span class="pre">already</span> <span class="pre">declared</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// This will not compile</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">ScopingErrors</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">scoping</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">// Illegal, second declaration of same1</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">minimalScoping</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">// Illegal, second declaration of same2</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">forLoopScoping</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">same3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">same3</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">same3</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">same3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">same3</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">same3</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span><span class="c1">// Illegal, second declaration of same3</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In addition to this, if a variable is declared, it will be initialized at the beginning of the function to its default value.
As a result, the following code is legal, despite being poorly written:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">foo</span><span class="p">()</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// baz is implicitly initialized as 0</span>
        <span class="kt">uint</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">bar</span> <span class="o">+=</span> <span class="nx">baz</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">baz</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span><span class="c1">// never executes</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">bar</span><span class="p">;</span><span class="c1">// returns 5</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="scoping-starting-from-version-0-5-0">
<h5>Scoping starting from Version 0.5.0<a class="headerlink" href="#scoping-starting-from-version-0-5-0" title="Permalink to this headline">¶</a></h5>
<p>Starting from version 0.5.0, Solidity will change to the more widespread scoping rules of C99
(and many other languages): Variables are visible from the point right after their declaration
until the end of a <code class="docutils literal"><span class="pre">{</span> <span class="pre">}</span></code>-block. As an exception to this rule, variables declared in the
initialization part of a for-loop are only visible until the end of the for-loop.</p>
<p>Variables and other items declared outside of a code block, for example functions, contracts,
user-defined types, etc., do not change their scoping behaviour. This means you can
use state variables before they are declared and call functions recursively.</p>
<p>These rules are already introduced now as an experimental feature.</p>
<p>As a consequence, the following examples will compile without warnings, since
the two variables have the same name but disjoint scopes. In non-0.5.0-mode,
they have the same scope (the function <code class="docutils literal"><span class="pre">minimalScoping</span></code>) and thus it does
not compile there.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">pragma</span> <span class="nx">experimental</span> <span class="s2">&quot;v0.5.0&quot;</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">minimalScoping</span><span class="p">()</span> <span class="k">pure</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">same2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As a special example of the C99 scoping rules, note that in the following,
the first assignment to <code class="docutils literal"><span class="pre">x</span></code> will actually assign the outer and not the inner variable.
In any case, you will get a warning about the outer variable being shadowed.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">pragma</span> <span class="nx">experimental</span> <span class="s2">&quot;v0.5.0&quot;</span><span class="p">;</span>
<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">pure</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">{</span>
            <span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// this will assign to the outer variable</span>
            <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">x</span><span class="p">;</span> <span class="c1">// x has value 2</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="error-handling-assert-require-revert-and-exceptions">
<span id="index-7"></span><h4>Error handling: Assert, Require, Revert and Exceptions<a class="headerlink" href="#error-handling-assert-require-revert-and-exceptions" title="Permalink to this headline">¶</a></h4>
<p>Solidity uses state-reverting exceptions to handle errors. Such an exception will undo all changes made to the
state in the current call (and all its sub-calls) and also flag an error to the caller.
The convenience functions <code class="docutils literal"><span class="pre">assert</span></code> and <code class="docutils literal"><span class="pre">require</span></code> can be used to check for conditions and throw an exception
if the condition is not met. The <code class="docutils literal"><span class="pre">assert</span></code> function should only be used to test for internal errors, and to check invariants.
The <code class="docutils literal"><span class="pre">require</span></code> function should be used to ensure valid conditions, such as inputs, or contract state variables are met, or to validate return values from calls to external contracts.
If used properly, analysis tools can evaluate your contract to identify the conditions and function calls which will reach a failing <code class="docutils literal"><span class="pre">assert</span></code>. Properly functioning code should never reach a failing assert statement; if this happens there is a bug in your contract which you should fix.</p>
<p>There are two other ways to trigger exceptions: The <code class="docutils literal"><span class="pre">revert</span></code> function can be used to flag an error and
revert the current call. It is possible to provide a string message containing details about the error
that will be passed back to the caller.
The deprecated keyword <code class="docutils literal"><span class="pre">throw</span></code> can also be used as an alternative to <code class="docutils literal"><span class="pre">revert()</span></code> (but only without error message).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">From version 0.4.13 the <code class="docutils literal"><span class="pre">throw</span></code> keyword is deprecated and will be phased out in the future.</p>
</div>
<p>When exceptions happen in a sub-call, they “bubble up” (i.e. exceptions are rethrown) automatically. Exceptions to this rule are <code class="docutils literal"><span class="pre">send</span></code>
and the low-level functions <code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">delegatecall</span></code> and <code class="docutils literal"><span class="pre">callcode</span></code> – those return <code class="docutils literal"><span class="pre">false</span></code> in case
of an exception instead of “bubbling up”.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The low-level <code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">delegatecall</span></code> and <code class="docutils literal"><span class="pre">callcode</span></code> will return success if the called account is non-existent, as part of the design of EVM. Existence must be checked prior to calling if desired.</p>
</div>
<p>Catching exceptions is not yet possible.</p>
<p>In the following example, you can see how <code class="docutils literal"><span class="pre">require</span></code> can be used to easily check conditions on inputs
and how <code class="docutils literal"><span class="pre">assert</span></code> can be used for internal error checking. Note that you can optionally provide
a message string for <code class="docutils literal"><span class="pre">require</span></code>, but not for <code class="docutils literal"><span class="pre">assert</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Sharer</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">sendHalf</span><span class="p">(</span><span class="kt">address</span> <span class="nx">addr</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">balance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Even value required.&quot;</span><span class="p">);</span>
        <span class="kt">uint</span> <span class="nx">balanceBeforeTransfer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">;</span>
        <span class="nx">addr</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="c1">// Since transfer throws an exception on failure and</span>
        <span class="c1">// cannot call back here, there should be no way for us to</span>
        <span class="c1">// still have half of the money.</span>
        <span class="nb">assert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span> <span class="o">==</span> <span class="nx">balanceBeforeTransfer</span> <span class="o">-</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An <code class="docutils literal"><span class="pre">assert</span></code>-style exception is generated in the following situations:</p>
<ol class="arabic simple">
<li>If you access an array at a too large or negative index (i.e. <code class="docutils literal"><span class="pre">x[i]</span></code> where <code class="docutils literal"><span class="pre">i</span> <span class="pre">&gt;=</span> <span class="pre">x.length</span></code> or <code class="docutils literal"><span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>).</li>
<li>If you access a fixed-length <code class="docutils literal"><span class="pre">bytesN</span></code> at a too large or negative index.</li>
<li>If you divide or modulo by zero (e.g. <code class="docutils literal"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">0</span></code> or <code class="docutils literal"><span class="pre">23</span> <span class="pre">%</span> <span class="pre">0</span></code>).</li>
<li>If you shift by a negative amount.</li>
<li>If you convert a value too big or negative into an enum type.</li>
<li>If you call a zero-initialized variable of internal function type.</li>
<li>If you call <code class="docutils literal"><span class="pre">assert</span></code> with an argument that evaluates to false.</li>
</ol>
<p>A <code class="docutils literal"><span class="pre">require</span></code>-style exception is generated in the following situations:</p>
<ol class="arabic simple">
<li>Calling <code class="docutils literal"><span class="pre">throw</span></code>.</li>
<li>Calling <code class="docutils literal"><span class="pre">require</span></code> with an argument that evaluates to <code class="docutils literal"><span class="pre">false</span></code>.</li>
<li>If you call a function via a message call but it does not finish properly (i.e. it runs out of gas, has no matching function, or throws an exception itself), except when a low level operation <code class="docutils literal"><span class="pre">call</span></code>, <code class="docutils literal"><span class="pre">send</span></code>, <code class="docutils literal"><span class="pre">delegatecall</span></code> or <code class="docutils literal"><span class="pre">callcode</span></code> is used.  The low level operations never throw exceptions but indicate failures by returning <code class="docutils literal"><span class="pre">false</span></code>.</li>
<li>If you create a contract using the <code class="docutils literal"><span class="pre">new</span></code> keyword but the contract creation does not finish properly (see above for the definition of “not finish properly”).</li>
<li>If you perform an external function call targeting a contract that contains no code.</li>
<li>If your contract receives Ether via a public function without <code class="docutils literal"><span class="pre">payable</span></code> modifier (including the constructor and the fallback function).</li>
<li>If your contract receives Ether via a public getter function.</li>
<li>If a <code class="docutils literal"><span class="pre">.transfer()</span></code> fails.</li>
</ol>
<p>Internally, Solidity performs a revert operation (instruction <code class="docutils literal"><span class="pre">0xfd</span></code>) for a <code class="docutils literal"><span class="pre">require</span></code>-style exception and executes an invalid operation
(instruction <code class="docutils literal"><span class="pre">0xfe</span></code>) to throw an <code class="docutils literal"><span class="pre">assert</span></code>-style exception. In both cases, this causes
the EVM to revert all changes made to the state. The reason for reverting is that there is no safe way to continue execution, because an expected effect
did not occur. Because we want to retain the atomicity of transactions, the safest thing to do is to revert all changes and make the whole transaction
(or at least call) without effect. Note that <code class="docutils literal"><span class="pre">assert</span></code>-style exceptions consume all gas available to the call, while
<code class="docutils literal"><span class="pre">require</span></code>-style exceptions will not consume any gas starting from the Metropolis release.</p>
<p>The following example shows how an error string can be used together with revert and require:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">VendingMachine</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">buy</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">amount</span> <span class="o">&gt;</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span> <span class="kt">ether</span><span class="p">)</span>
            <span class="nb">revert</span><span class="p">(</span><span class="s2">&quot;Not enough Ether provided.&quot;</span><span class="p">);</span>
        <span class="c1">// Alternative way to do it:</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nx">amount</span> <span class="o">&lt;=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span> <span class="kt">ether</span><span class="p">,</span>
            <span class="s2">&quot;Not enough Ether provided.&quot;</span>
        <span class="p">);</span>
        <span class="c1">// Perform the purchase.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The provided string will be <a class="reference internal" href="index.html#abi"><span class="std std-ref">abi-encoded</span></a> as if it were a call to a function <code class="docutils literal"><span class="pre">Error(string)</span></code>.
In the above example, <code class="docutils literal"><span class="pre">revert(&quot;Not</span> <span class="pre">enough</span> <span class="pre">Ether</span> <span class="pre">provided.&quot;);</span></code> will cause the following hexadecimal data be
set as error return data:</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0x08c379a0</span>                                                         <span class="c1">// Function selector for Error(string)</span>
<span class="mh">0x0000000000000000000000000000000000000000000000000000000000000020</span> <span class="c1">// Data offset</span>
<span class="mh">0x000000000000000000000000000000000000000000000000000000000000001a</span> <span class="c1">// String length</span>
<span class="mh">0x4e6f7420656e6f7567682045746865722070726f76696465642e000000000000</span> <span class="c1">// String data</span>
</pre></div>
</div>
</div>
</div>
<span id="document-contracts"></span><div class="section" id="contracts">
<span id="index-0"></span><h3>Contracts<a class="headerlink" href="#contracts" title="Permalink to this headline">¶</a></h3>
<p>Contracts in Solidity are similar to classes in object-oriented languages. They
contain persistent data in state variables and functions that can modify these
variables. Calling a function on a different contract (instance) will perform
an EVM function call and thus switch the context such that state variables are
inaccessible.</p>
<div class="section" id="creating-contracts">
<span id="index-1"></span><h4>Creating Contracts<a class="headerlink" href="#creating-contracts" title="Permalink to this headline">¶</a></h4>
<p>Contracts can be created “from outside” via Ethereum transactions or from within Solidity contracts.</p>
<p>IDEs, such as <a class="reference external" href="https://remix.ethereum.org/">Remix</a>, make the creation process seamless using UI elements.</p>
<p>Creating contracts programatically on Ethereum is best done via using the JavaScript API <a class="reference external" href="https://github.com/ethereum/web3.js">web3.js</a>.
As of today it has a method called <a class="reference external" href="https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#new-contract">web3.eth.Contract</a>
to facilitate contract creation.</p>
<p>When a contract is created, its constructor (a function declared with the
<code class="docutils literal"><span class="pre">constructor</span></code> keyword) is executed once.
A constructor is optional. Only one constructor is allowed, and this means
overloading is not supported.</p>
<p id="index-2">Internally, constructor arguments are passed <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI encoded</span></a> after the code of
the contract itself, but you do not have to care about this if you use <code class="docutils literal"><span class="pre">web3.js</span></code>.</p>
<p>If a contract wants to create another contract, the source code
(and the binary) of the created contract has to be known to the creator.
This means that cyclic creation dependencies are impossible.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">OwnedToken</span> <span class="p">{</span>
    <span class="c1">// TokenCreator is a contract type that is defined below.</span>
    <span class="c1">// It is fine to reference it as long as it is not used</span>
    <span class="c1">// to create a new contract.</span>
    <span class="nx">TokenCreator</span> <span class="nx">creator</span><span class="p">;</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
    <span class="kt">bytes32</span> <span class="nx">name</span><span class="p">;</span>

    <span class="c1">// This is the constructor which registers the</span>
    <span class="c1">// creator and the assigned name.</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">_name</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// State variables are accessed via their name</span>
        <span class="c1">// and not via e.g. this.owner. This also applies</span>
        <span class="c1">// to functions and especially in the constructors,</span>
        <span class="c1">// you can only call them like that (&quot;internally&quot;),</span>
        <span class="c1">// because the contract itself does not exist yet.</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="c1">// We do an explicit type conversion from `address`</span>
        <span class="c1">// to `TokenCreator` and assume that the type of</span>
        <span class="c1">// the calling contract is TokenCreator, there is</span>
        <span class="c1">// no real way to check that.</span>
        <span class="nx">creator</span> <span class="o">=</span> <span class="nx">TokenCreator</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changeName</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">newName</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// Only the creator can alter the name --</span>
        <span class="c1">// the comparison is possible since contracts</span>
        <span class="c1">// are implicitly convertible to addresses.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nx">creator</span><span class="p">))</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">newName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="nx">newOwner</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// Only the current owner can transfer the token.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">owner</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="c1">// We also want to ask the creator if the transfer</span>
        <span class="c1">// is fine. Note that this calls a function of the</span>
        <span class="c1">// contract defined below. If the call fails (e.g.</span>
        <span class="c1">// due to out-of-gas), the execution here stops</span>
        <span class="c1">// immediately.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">creator</span><span class="p">.</span><span class="nx">isTokenTransferOK</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span> <span class="nx">newOwner</span><span class="p">))</span>
            <span class="nx">owner</span> <span class="o">=</span> <span class="nx">newOwner</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">TokenCreator</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">createToken</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">name</span><span class="p">)</span>
       <span class="k">public</span>
       <span class="k">returns</span> <span class="p">(</span><span class="nx">OwnedToken</span> <span class="nx">tokenAddress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create a new Token contract and return its address.</span>
        <span class="c1">// From the JavaScript side, the return type is simply</span>
        <span class="c1">// `address`, as this is the closest type available in</span>
        <span class="c1">// the ABI.</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">OwnedToken</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changeName</span><span class="p">(</span><span class="nx">OwnedToken</span> <span class="nx">tokenAddress</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="nx">name</span><span class="p">)</span>  <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// Again, the external type of `tokenAddress` is</span>
        <span class="c1">// simply `address`.</span>
        <span class="nx">tokenAddress</span><span class="p">.</span><span class="nx">changeName</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">isTokenTransferOK</span><span class="p">(</span><span class="kt">address</span> <span class="nx">currentOwner</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">newOwner</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">ok</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Check some arbitrary condition.</span>
        <span class="kt">address</span> <span class="nx">tokenAddress</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="nx">newOwner</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="kt">bytes20</span><span class="p">(</span><span class="nx">tokenAddress</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="visibility-and-getters">
<span id="index-3"></span><span id="id1"></span><h4>Visibility and Getters<a class="headerlink" href="#visibility-and-getters" title="Permalink to this headline">¶</a></h4>
<p>Since Solidity knows two kinds of function calls (internal
ones that do not create an actual EVM call (also called
a “message call”) and external
ones that do), there are four types of visibilities for
functions and state variables.</p>
<p>Functions can be specified as being <code class="docutils literal"><span class="pre">external</span></code>,
<code class="docutils literal"><span class="pre">public</span></code>, <code class="docutils literal"><span class="pre">internal</span></code> or <code class="docutils literal"><span class="pre">private</span></code>, where the default is
<code class="docutils literal"><span class="pre">public</span></code>. For state variables, <code class="docutils literal"><span class="pre">external</span></code> is not possible
and the default is <code class="docutils literal"><span class="pre">internal</span></code>.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">external</span></code>:</dt>
<dd>External functions are part of the contract
interface, which means they can be called from other contracts and
via transactions. An external function <code class="docutils literal"><span class="pre">f</span></code> cannot be called
internally (i.e. <code class="docutils literal"><span class="pre">f()</span></code> does not work, but <code class="docutils literal"><span class="pre">this.f()</span></code> works).
External functions are sometimes more efficient when
they receive large arrays of data.</dd>
<dt><code class="docutils literal"><span class="pre">public</span></code>:</dt>
<dd>Public functions are part of the contract
interface and can be either called internally or via
messages. For public state variables, an automatic getter
function (see below) is generated.</dd>
<dt><code class="docutils literal"><span class="pre">internal</span></code>:</dt>
<dd>Those functions and state variables can only be
accessed internally (i.e. from within the current contract
or contracts deriving from it), without using <code class="docutils literal"><span class="pre">this</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">private</span></code>:</dt>
<dd>Private functions and state variables are only
visible for the contract they are defined in and not in
derived contracts.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Everything that is inside a contract is visible to
all external observers. Making something <code class="docutils literal"><span class="pre">private</span></code>
only prevents other contracts from accessing and modifying
the information, but it will still be visible to the
whole world outside of the blockchain.</p>
</div>
<p>The visibility specifier is given after the type for
state variables and between parameter list and
return parameter list for functions.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">private</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">setData</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the following example, <code class="docutils literal"><span class="pre">D</span></code>, can call <code class="docutils literal"><span class="pre">c.getData()</span></code> to retrieve the value of
<code class="docutils literal"><span class="pre">data</span></code> in state storage, but is not able to call <code class="docutils literal"><span class="pre">f</span></code>. Contract <code class="docutils literal"><span class="pre">E</span></code> is derived from
<code class="docutils literal"><span class="pre">C</span></code> and, thus, can call <code class="docutils literal"><span class="pre">compute</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// This will not compile</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">private</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">private</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">setData</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">getData</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">data</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">compute</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">readData</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">f</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span> <span class="c1">// error: member `f` is not visible</span>
        <span class="nx">c</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">getData</span><span class="p">();</span>
        <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">compute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// error: member `compute` is not visible</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">E</span> <span class="k">is</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">compute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// access to internal member (from derived to parent contract)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="getter-functions">
<span id="index-4"></span><span id="id2"></span><h5>Getter Functions<a class="headerlink" href="#getter-functions" title="Permalink to this headline">¶</a></h5>
<p>The compiler automatically creates getter functions for
all <strong>public</strong> state variables. For the contract given below, the compiler will
generate a function called <code class="docutils literal"><span class="pre">data</span></code> that does not take any
arguments and returns a <code class="docutils literal"><span class="pre">uint</span></code>, the value of the state
variable <code class="docutils literal"><span class="pre">data</span></code>. The initialization of state variables can
be done at declaration.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">data</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Caller</span> <span class="p">{</span>
    <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">local</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The getter functions have external visibility. If the
symbol is accessed internally (i.e. without <code class="docutils literal"><span class="pre">this.</span></code>),
it is evaluated as a state variable.  If it is accessed externally
(i.e. with <code class="docutils literal"><span class="pre">this.</span></code>), it is evaluated as a function.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">data</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">x</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// internal access</span>
        <span class="kt">uint</span> <span class="nx">val</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">();</span> <span class="c1">// external access</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The next example is a bit more complex:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Complex</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Data</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">a</span><span class="p">;</span>
        <span class="kt">bytes3</span> <span class="nx">b</span><span class="p">;</span>
        <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">map</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">bool</span> <span class="o">=&gt;</span> <span class="nx">Data</span><span class="p">[]))</span> <span class="k">public</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It will generate a function of the following form:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">data</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">arg1</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">arg2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">arg3</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">bytes3</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">a</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">arg1</span><span class="p">][</span><span class="nx">arg2</span><span class="p">][</span><span class="nx">arg3</span><span class="p">].</span><span class="nx">a</span><span class="p">;</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">arg1</span><span class="p">][</span><span class="nx">arg2</span><span class="p">][</span><span class="nx">arg3</span><span class="p">].</span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the mapping in the struct is omitted because there
is no good way to provide the key for the mapping.</p>
</div>
</div>
<div class="section" id="function-modifiers">
<span id="modifiers"></span><span id="index-5"></span><h4>Function Modifiers<a class="headerlink" href="#function-modifiers" title="Permalink to this headline">¶</a></h4>
<p>Modifiers can be used to easily change the behaviour of functions.  For example,
they can automatically check a condition prior to executing the function. Modifiers are
inheritable properties of contracts and may be overridden by derived contracts.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">owned</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>

    <span class="c1">// This contract only defines a modifier but does not use</span>
    <span class="c1">// it: it will be used in derived contracts.</span>
    <span class="c1">// The function body is inserted where the special symbol</span>
    <span class="c1">// `_;` in the definition of a modifier appears.</span>
    <span class="c1">// This means that if the owner calls this function, the</span>
    <span class="c1">// function is executed and otherwise, an exception is</span>
    <span class="c1">// thrown.</span>
    <span class="kd">modifier</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">,</span>
            <span class="s2">&quot;Only owner can call this function.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="c1">// This contract inherits the `onlyOwner` modifier from</span>
    <span class="c1">// `owned` and applies it to the `close` function, which</span>
    <span class="c1">// causes that calls to `close` only have an effect if</span>
    <span class="c1">// they are made by the stored owner.</span>
    <span class="kd">function</span> <span class="nx">close</span><span class="p">()</span> <span class="k">public</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">priced</span> <span class="p">{</span>
    <span class="c1">// Modifiers can receive arguments:</span>
    <span class="kd">modifier</span> <span class="nx">costs</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">price</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="nx">price</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Register</span> <span class="k">is</span> <span class="nx">priced</span><span class="p">,</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">registeredAddresses</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="nx">price</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">Register</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">initialPrice</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">initialPrice</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">// It is important to also provide the</span>
    <span class="c1">// `payable` keyword here, otherwise the function will</span>
    <span class="c1">// automatically reject all Ether sent to it.</span>
    <span class="kd">function</span> <span class="nx">register</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="nx">costs</span><span class="p">(</span><span class="nx">price</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">registeredAddresses</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">changePrice</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_price</span><span class="p">)</span> <span class="k">public</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
        <span class="nx">price</span> <span class="o">=</span> <span class="nx">_price</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Mutex</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="nx">locked</span><span class="p">;</span>
    <span class="kd">modifier</span> <span class="nx">noReentrancy</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="o">!</span><span class="nx">locked</span><span class="p">,</span>
            <span class="s2">&quot;Reentrant call.&quot;</span>
        <span class="p">);</span>
        <span class="nx">locked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">_</span><span class="p">;</span>
        <span class="nx">locked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// This function is protected by a mutex, which means that</span>
    <span class="cs">/// reentrant calls from within `msg.sender.call` cannot call `f` again.</span>
    <span class="cs">/// The `return 7` statement assigns 7 to the return value but still</span>
    <span class="cs">/// executes the statement `locked = false` in the modifier.</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="nx">noReentrancy</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">());</span>
        <span class="k">return</span> <span class="mi">7</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Multiple modifiers are applied to a function by specifying them in a
whitespace-separated list and are evaluated in the order presented.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In an earlier version of Solidity, <code class="docutils literal"><span class="pre">return</span></code> statements in functions
having modifiers behaved differently.</p>
</div>
<p>Explicit returns from a modifier or function body only leave the current
modifier or function body. Return variables are assigned and
control flow continues after the “_” in the preceding modifier.</p>
<p>Arbitrary expressions are allowed for modifier arguments and in this context,
all symbols visible from the function are visible in the modifier. Symbols
introduced in the modifier are not visible in the function (as they might
change by overriding).</p>
</div>
<div class="section" id="constant-state-variables">
<span id="index-6"></span><h4>Constant State Variables<a class="headerlink" href="#constant-state-variables" title="Permalink to this headline">¶</a></h4>
<p>State variables can be declared as <code class="docutils literal"><span class="pre">constant</span></code>. In this case, they have to be
assigned from an expression which is a constant at compile time. Any expression
that accesses storage, blockchain data (e.g. <code class="docutils literal"><span class="pre">now</span></code>, <code class="docutils literal"><span class="pre">this.balance</span></code> or
<code class="docutils literal"><span class="pre">block.number</span></code>) or
execution data (<code class="docutils literal"><span class="pre">msg.value</span></code> or <code class="docutils literal"><span class="pre">gasleft()</span></code>) or make calls to external contracts are disallowed. Expressions
that might have a side-effect on memory allocation are allowed, but those that
might have a side-effect on other memory objects are not. The built-in functions
<code class="docutils literal"><span class="pre">keccak256</span></code>, <code class="docutils literal"><span class="pre">sha256</span></code>, <code class="docutils literal"><span class="pre">ripemd160</span></code>, <code class="docutils literal"><span class="pre">ecrecover</span></code>, <code class="docutils literal"><span class="pre">addmod</span></code> and <code class="docutils literal"><span class="pre">mulmod</span></code>
are allowed (even though they do call external contracts).</p>
<p>The reason behind allowing side-effects on the memory allocator is that it
should be possible to construct complex objects like e.g. lookup-tables.
This feature is not yet fully usable.</p>
<p>The compiler does not reserve a storage slot for these variables, and every occurrence is
replaced by the respective constant expression (which might be computed to a single value by the optimizer).</p>
<p>Not all types for constants are implemented at this time. The only supported types are
value types and strings.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">constant</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">32</span><span class="o">**</span><span class="mi">22</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
    <span class="kt">string</span> <span class="k">constant</span> <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;abc&quot;</span><span class="p">;</span>
    <span class="kt">bytes32</span> <span class="k">constant</span> <span class="nx">myHash</span> <span class="o">=</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;abc&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<span id="index-7"></span><span id="id3"></span><h4>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h4>
<div class="section" id="view-functions">
<span id="index-8"></span><span id="id4"></span><h5>View Functions<a class="headerlink" href="#view-functions" title="Permalink to this headline">¶</a></h5>
<p>Functions can be declared <code class="docutils literal"><span class="pre">view</span></code> in which case they promise not to modify the state.</p>
<p>The following statements are considered modifying the state:</p>
<ol class="arabic simple">
<li>Writing to state variables.</li>
<li><a class="reference internal" href="#events"><span class="std std-ref">Emitting events</span></a>.</li>
<li><a class="reference internal" href="index.html#creating-contracts"><span class="std std-ref">Creating other contracts</span></a>.</li>
<li>Using <code class="docutils literal"><span class="pre">selfdestruct</span></code>.</li>
<li>Sending Ether via calls.</li>
<li>Calling any function not marked <code class="docutils literal"><span class="pre">view</span></code> or <code class="docutils literal"><span class="pre">pure</span></code>.</li>
<li>Using low-level calls.</li>
<li>Using inline assembly that contains certain opcodes.</li>
</ol>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">42</span><span class="p">)</span> <span class="o">+</span> <span class="nb">now</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">constant</span></code> on functions is an alias to <code class="docutils literal"><span class="pre">view</span></code>, but this is deprecated and will be dropped in version 0.5.0.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Getter methods are marked <code class="docutils literal"><span class="pre">view</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If invalid explicit type conversions are used, state modifications are possible
even though a <code class="docutils literal"><span class="pre">view</span></code> function was called.
You can switch the compiler to use <code class="docutils literal"><span class="pre">STATICCALL</span></code> when calling such functions and thus
prevent modifications to the state on the level of the EVM by adding
<code class="docutils literal"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">&quot;v0.5.0&quot;;</span></code></p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The compiler does not enforce yet that a <code class="docutils literal"><span class="pre">view</span></code> method is not modifying state. It raises a warning though.</p>
</div>
</div>
<div class="section" id="pure-functions">
<span id="index-9"></span><span id="id5"></span><h5>Pure Functions<a class="headerlink" href="#pure-functions" title="Permalink to this headline">¶</a></h5>
<p>Functions can be declared <code class="docutils literal"><span class="pre">pure</span></code> in which case they promise not to read from or modify the state.</p>
<p>In addition to the list of state modifying statements explained above, the following are considered reading from the state:</p>
<ol class="arabic simple">
<li>Reading from state variables.</li>
<li>Accessing <code class="docutils literal"><span class="pre">this.balance</span></code> or <code class="docutils literal"><span class="pre">&lt;address&gt;.balance</span></code>.</li>
<li>Accessing any of the members of <code class="docutils literal"><span class="pre">block</span></code>, <code class="docutils literal"><span class="pre">tx</span></code>, <code class="docutils literal"><span class="pre">msg</span></code> (with the exception of <code class="docutils literal"><span class="pre">msg.sig</span></code> and <code class="docutils literal"><span class="pre">msg.data</span></code>).</li>
<li>Calling any function not marked <code class="docutils literal"><span class="pre">pure</span></code>.</li>
<li>Using inline assembly that contains certain opcodes.</li>
</ol>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span> <span class="o">*</span> <span class="p">(</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">42</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If invalid explicit type conversions are used, state modifications are possible
even though a <code class="docutils literal"><span class="pre">pure</span></code> function was called.
You can switch the compiler to use <code class="docutils literal"><span class="pre">STATICCALL</span></code> when calling such functions and thus
prevent modifications to the state on the level of the EVM by adding
<code class="docutils literal"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">&quot;v0.5.0&quot;;</span></code></p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is not possible to prevent functions from reading the state at the level
of the EVM, it is only possible to prevent them from writing to the state
(i.e. only <code class="docutils literal"><span class="pre">view</span></code> can be enforced at the EVM level, <code class="docutils literal"><span class="pre">pure</span></code> can not).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before version 0.4.17 the compiler didn’t enforce that <code class="docutils literal"><span class="pre">pure</span></code> is not reading the state.</p>
</div>
</div>
<div class="section" id="fallback-function">
<span id="index-10"></span><span id="id6"></span><h5>Fallback Function<a class="headerlink" href="#fallback-function" title="Permalink to this headline">¶</a></h5>
<p>A contract can have exactly one unnamed function. This function cannot have
arguments and cannot return anything.
It is executed on a call to the contract if none of the other
functions match the given function identifier (or if no data was supplied at
all).</p>
<p>Furthermore, this function is executed whenever the contract receives plain
Ether (without data). Additionally, in order to receive Ether, the fallback function
must be marked <code class="docutils literal"><span class="pre">payable</span></code>. If no such function exists, the contract cannot receive
Ether through regular transactions.</p>
<p>In the worst case, the fallback function can only rely on 2300 gas being available (for example when send or transfer is used), leaving not much room to perform other operations except basic logging. The following operations will consume more gas than the 2300 gas stipend:</p>
<ul class="simple">
<li>Writing to storage</li>
<li>Creating a contract</li>
<li>Calling an external function which consumes a large amount of gas</li>
<li>Sending Ether</li>
</ul>
<p>Like any function, the fallback function can execute complex operations as long as there is enough gas passed on to it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though the fallback function cannot have arguments, one can still use <code class="docutils literal"><span class="pre">msg.data</span></code> to retrieve
any payload supplied with the call.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Contracts that receive Ether directly (without a function call, i.e. using <code class="docutils literal"><span class="pre">send</span></code> or <code class="docutils literal"><span class="pre">transfer</span></code>)
but do not define a fallback function
throw an exception, sending back the Ether (this was different
before Solidity v0.4.0). So if you want your contract to receive Ether,
you have to implement a fallback function.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>A contract without a payable fallback function can receive Ether as a recipient of a <cite>coinbase transaction</cite> (aka <cite>miner block reward</cite>)
or as a destination of a <code class="docutils literal"><span class="pre">selfdestruct</span></code>.</p>
<p>A contract cannot react to such Ether transfers and thus also cannot reject them. This is a design choice of the EVM and Solidity cannot work around it.</p>
<p class="last">It also means that <code class="docutils literal"><span class="pre">this.balance</span></code> can be higher than the sum of some manual accounting implemented in a contract (i.e. having a counter updated in the fallback function).</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Test</span> <span class="p">{</span>
    <span class="c1">// This function is called for all messages sent to</span>
    <span class="c1">// this contract (there is no other function).</span>
    <span class="c1">// Sending Ether to this contract will cause an exception,</span>
    <span class="c1">// because the fallback function does not have the `payable`</span>
    <span class="c1">// modifier.</span>
    <span class="kd">function</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// This contract keeps all Ether sent to it with no way</span>
<span class="c1">// to get it back.</span>
<span class="kd">contract</span> <span class="nx">Sink</span> <span class="p">{</span>
    <span class="kd">function</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Caller</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">callTest</span><span class="p">(</span><span class="nx">Test</span> <span class="nx">test</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">test</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mh">0xabcdef01</span><span class="p">);</span> <span class="c1">// hash does not exist</span>
        <span class="c1">// results in test.x becoming == 1.</span>

        <span class="c1">// The following will not compile, but even</span>
        <span class="c1">// if someone sends ether to that contract,</span>
        <span class="c1">// the transaction will fail and reject the</span>
        <span class="c1">// Ether.</span>
        <span class="c1">//test.send(2 ether);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-overloading">
<span id="overload-function"></span><span id="index-11"></span><h5>Function Overloading<a class="headerlink" href="#function-overloading" title="Permalink to this headline">¶</a></h5>
<p>A Contract can have multiple functions of the same name but with different arguments.
This also applies to inherited functions. The following example shows overloading of the
<code class="docutils literal"><span class="pre">f</span></code> function in the scope of contract <code class="docutils literal"><span class="pre">A</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_in</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_in</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="nx">_key</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Overloaded functions are also present in the external interface. It is an error if two
externally visible functions differ by their Solidity types but not by their external types.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// This will not compile</span>
<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">B</span> <span class="nx">_in</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">B</span> <span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="nx">_in</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_in</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="nx">_in</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">B</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Both <code class="docutils literal"><span class="pre">f</span></code> function overloads above end up accepting the address type for the ABI although
they are considered different inside Solidity.</p>
<div class="section" id="overload-resolution-and-argument-matching">
<h6>Overload resolution and Argument matching<a class="headerlink" href="#overload-resolution-and-argument-matching" title="Permalink to this headline">¶</a></h6>
<p>Overloaded functions are selected by matching the function declarations in the current scope
to the arguments supplied in the function call. Functions are selected as overload candidates
if all arguments can be implicitly converted to the expected types. If there is not exactly one
candidate, resolution fails.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Return parameters are not taken into account for overload resolution.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint8</span> <span class="nx">_in</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span> <span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="nx">_in</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint256</span> <span class="nx">_in</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="nx">_in</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal"><span class="pre">f(50)</span></code> would create a type error since <code class="docutils literal"><span class="pre">50</span></code> can be implicitly converted both to <code class="docutils literal"><span class="pre">uint8</span></code>
and <code class="docutils literal"><span class="pre">uint256</span></code> types. On another hand <code class="docutils literal"><span class="pre">f(256)</span></code> would resolve to <code class="docutils literal"><span class="pre">f(uint256)</span></code> overload as <code class="docutils literal"><span class="pre">256</span></code> cannot be implicitly
converted to <code class="docutils literal"><span class="pre">uint8</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="events">
<span id="index-12"></span><span id="id7"></span><h4>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>Events allow the convenient usage of the EVM logging facilities,
which in turn can be used to “call” JavaScript callbacks in the user interface
of a dapp, which listen for these events.</p>
<p>Events are
inheritable members of contracts. When they are called, they cause the
arguments to be stored in the transaction’s log - a special data structure
in the blockchain. These logs are associated with the address of
the contract and will be incorporated into the blockchain
and stay there as long as a block is accessible (forever as of
Frontier and Homestead, but this might change with Serenity). Log and
event data is not accessible from within contracts (not even from
the contract that created them).</p>
<p>SPV proofs for logs are possible, so if an external entity supplies
a contract with such a proof, it can check that the log actually
exists inside the blockchain.  But be aware that block headers have to be supplied because
the contract can only see the last 256 block hashes.</p>
<p>Up to three parameters can
receive the attribute <code class="docutils literal"><span class="pre">indexed</span></code> which will cause the respective arguments
to be searched for: It is possible to filter for specific values of
indexed arguments in the user interface.</p>
<p>If arrays (including <code class="docutils literal"><span class="pre">string</span></code> and <code class="docutils literal"><span class="pre">bytes</span></code>) are used as indexed arguments, the
Keccak-256 hash of it is stored as topic instead.</p>
<p>The hash of the signature of the event is one of the topics except if you
declared the event with <code class="docutils literal"><span class="pre">anonymous</span></code> specifier. This means that it is
not possible to filter for specific anonymous events by name.</p>
<p>All non-indexed arguments will be stored in the data part of the log.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Indexed arguments will not be stored themselves.  You can only
search for the values, but it is impossible to retrieve the
values themselves.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">ClientReceipt</span> <span class="p">{</span>
    <span class="kd">event</span> <span class="nx">Deposit</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="nx">_from</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="k">indexed</span> <span class="nx">_id</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="nx">_value</span>
    <span class="p">);</span>

    <span class="kd">function</span> <span class="nx">deposit</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">_id</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="c1">// Events are emitted using `emit`, followed by</span>
        <span class="c1">// the name of the event and the arguments</span>
        <span class="c1">// (if any) in parentheses. Any such invocation</span>
        <span class="c1">// (even deeply nested) can be detected from</span>
        <span class="c1">// the JavaScript API by filtering for `Deposit`.</span>
        <span class="nx">emit</span> <span class="nx">Deposit</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">_id</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The use in the JavaScript API would be as follows:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">abi</span> <span class="o">=</span> <span class="cm">/* abi as generated by the compiler */</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ClientReceipt</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="kd">contract</span><span class="p">(</span><span class="nx">abi</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">clientReceipt</span> <span class="o">=</span> <span class="nx">ClientReceipt</span><span class="p">.</span><span class="nx">at</span><span class="p">(</span><span class="s2">&quot;0x1234...ab67&quot;</span> <span class="cm">/* address */</span><span class="p">);</span>

<span class="kd">var</span> <span class="kd">event</span> <span class="o">=</span> <span class="nx">clientReceipt</span><span class="p">.</span><span class="nx">Deposit</span><span class="p">();</span>

<span class="c1">// watch for changes</span>
<span class="kd">event</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">){</span>
    <span class="c1">// result will contain various information</span>
    <span class="c1">// including the argumets given to the `Deposit`</span>
    <span class="c1">// call.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Or pass a callback to start watching immediately</span>
<span class="kd">var</span> <span class="kd">event</span> <span class="o">=</span> <span class="nx">clientReceipt</span><span class="p">.</span><span class="nx">Deposit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="section" id="low-level-interface-to-logs">
<span id="index-13"></span><h5>Low-Level Interface to Logs<a class="headerlink" href="#low-level-interface-to-logs" title="Permalink to this headline">¶</a></h5>
<p>It is also possible to access the low-level interface to the logging
mechanism via the functions <code class="docutils literal"><span class="pre">log0</span></code>, <code class="docutils literal"><span class="pre">log1</span></code>, <code class="docutils literal"><span class="pre">log2</span></code>, <code class="docutils literal"><span class="pre">log3</span></code> and <code class="docutils literal"><span class="pre">log4</span></code>.
<code class="docutils literal"><span class="pre">logi</span></code> takes <code class="docutils literal"><span class="pre">i</span> <span class="pre">+</span> <span class="pre">1</span></code> parameter of type <code class="docutils literal"><span class="pre">bytes32</span></code>, where the first
argument will be used for the data part of the log and the others
as topics. The event call above can be performed in the same way as</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">10</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="nx">_id</span> <span class="o">=</span> <span class="mh">0x420042</span><span class="p">;</span>
        <span class="nb">log3</span><span class="p">(</span>
            <span class="kt">bytes32</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">),</span>
            <span class="kt">bytes32</span><span class="p">(</span><span class="mh">0x50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20</span><span class="p">),</span>
            <span class="kt">bytes32</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">),</span>
            <span class="nx">_id</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where the long hexadecimal number is equal to
<code class="docutils literal"><span class="pre">keccak256(&quot;Deposit(address,bytes32,uint256)&quot;)</span></code>, the signature of the event.</p>
</div>
<div class="section" id="additional-resources-for-understanding-events">
<h5>Additional Resources for Understanding Events<a class="headerlink" href="#additional-resources-for-understanding-events" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ethereum/wiki/wiki/JavaScript-API#contract-events">Javascript documentation</a></li>
<li><a class="reference external" href="https://github.com/debris/smart-exchange/blob/master/lib/contracts/SmartExchange.sol">Example usage of events</a></li>
<li><a class="reference external" href="https://github.com/debris/smart-exchange/blob/master/lib/exchange_transactions.js">How to access them in js</a></li>
</ul>
</div>
</div>
<div class="section" id="inheritance">
<span id="index-14"></span><h4>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h4>
<p>Solidity supports multiple inheritance by copying code including polymorphism.</p>
<p>All function calls are virtual, which means that the most derived function
is called, except when the contract name is explicitly given.</p>
<p>When a contract inherits from multiple contracts, only a single
contract is created on the blockchain, and the code from all the base contracts
is copied into the created contract.</p>
<p>The general inheritance system is very similar to
<a class="reference external" href="https://docs.python.org/3/tutorial/classes.html#inheritance">Python’s</a>,
especially concerning multiple inheritance.</p>
<p>Details are given in the following example.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Use `is` to derive from another contract. Derived</span>
<span class="c1">// contracts can access all non-private members including</span>
<span class="c1">// internal functions and state variables. These cannot be</span>
<span class="c1">// accessed externally via `this`, though.</span>
<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// These abstract contracts are only provided to make the</span>
<span class="c1">// interface known to the compiler. Note the function</span>
<span class="c1">// without body. If a contract does not implement all</span>
<span class="c1">// functions it can only be used as an interface.</span>
<span class="kd">contract</span> <span class="nx">Config</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">lookup</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">id</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="nx">adr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">NameReg</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">name</span><span class="p">)</span> <span class="k">public</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">unregister</span><span class="p">()</span> <span class="k">public</span><span class="p">;</span>
 <span class="p">}</span>

<span class="c1">// Multiple inheritance is possible. Note that `owned` is</span>
<span class="c1">// also a base class of `mortal`, yet there is only a single</span>
<span class="c1">// instance of `owned` (as for virtual inheritance in C++).</span>
<span class="kd">contract</span> <span class="nx">named</span> <span class="k">is</span> <span class="nx">owned</span><span class="p">,</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="kt">bytes32</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Config</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">Config</span><span class="p">(</span><span class="mh">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span><span class="p">);</span>
        <span class="nx">NameReg</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nx">register</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Functions can be overridden by another function with the same name and</span>
    <span class="c1">// the same number/types of inputs.  If the overriding function has different</span>
    <span class="c1">// types of output parameters, that causes an error.</span>
    <span class="c1">// Both local and message-based function calls take these overrides</span>
    <span class="c1">// into account.</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Config</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">Config</span><span class="p">(</span><span class="mh">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span><span class="p">);</span>
            <span class="nx">NameReg</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nx">unregister</span><span class="p">();</span>
            <span class="c1">// It is still possible to call a specific</span>
            <span class="c1">// overridden function.</span>
            <span class="nx">mortal</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// If a constructor takes an argument, it needs to be</span>
<span class="c1">// provided in the header (or modifier-invocation-style at</span>
<span class="c1">// the constructor of the derived contract (see below)).</span>
<span class="kd">contract</span> <span class="nx">PriceFeed</span> <span class="k">is</span> <span class="nx">owned</span><span class="p">,</span> <span class="nx">mortal</span><span class="p">,</span> <span class="nx">named</span><span class="p">(</span><span class="s2">&quot;GoldFeed&quot;</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="nx">updateInfo</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">newInfo</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">newInfo</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">function</span> <span class="nx">get</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">info</span><span class="p">;</span> <span class="p">}</span>

   <span class="kt">uint</span> <span class="nx">info</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that above, we call <code class="docutils literal"><span class="pre">mortal.kill()</span></code> to “forward” the
destruction request. The way this is done is problematic, as
seen in the following example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Base1</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 1 */</span> <span class="nx">mortal</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Base2</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 2 */</span> <span class="nx">mortal</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Final</span> <span class="k">is</span> <span class="nx">Base1</span><span class="p">,</span> <span class="nx">Base2</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A call to <code class="docutils literal"><span class="pre">Final.kill()</span></code> will call <code class="docutils literal"><span class="pre">Base2.kill</span></code> as the most
derived override, but this function will bypass
<code class="docutils literal"><span class="pre">Base1.kill</span></code>, basically because it does not even know about
<code class="docutils literal"><span class="pre">Base1</span></code>.  The way around this is to use <code class="docutils literal"><span class="pre">super</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">mortal</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Base1</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 1 */</span> <span class="k">super</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">Base2</span> <span class="k">is</span> <span class="nx">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 2 */</span> <span class="k">super</span><span class="p">.</span><span class="nx">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Final</span> <span class="k">is</span> <span class="nx">Base1</span><span class="p">,</span> <span class="nx">Base2</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">Base2</span></code> calls a function of <code class="docutils literal"><span class="pre">super</span></code>, it does not simply
call this function on one of its base contracts.  Rather, it
calls this function on the next base contract in the final
inheritance graph, so it will call <code class="docutils literal"><span class="pre">Base1.kill()</span></code> (note that
the final inheritance sequence is – starting with the most
derived contract: Final, Base2, Base1, mortal, owned).
The actual function that is called when using super is
not known in the context of the class where it is used,
although its type is known. This is similar for ordinary
virtual method lookup.</p>
<div class="section" id="constructors">
<span id="index-15"></span><h5>Constructors<a class="headerlink" href="#constructors" title="Permalink to this headline">¶</a></h5>
<p>A constructor is an optional function declared with the <code class="docutils literal"><span class="pre">constructor</span></code> keyword which is executed upon contract creation.
Constructor functions can be either <code class="docutils literal"><span class="pre">public</span></code> or <code class="docutils literal"><span class="pre">internal</span></code>. If there is no constructor, the contract will assume the
default constructor: <code class="docutils literal"><span class="pre">contructor()</span> <span class="pre">public</span> <span class="pre">{}</span></code>.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">a</span><span class="p">;</span>

    <span class="nx">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_a</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A constructor set as <code class="docutils literal"><span class="pre">internal</span></code> causes the contract to be marked as <a class="reference internal" href="#abstract-contract"><span class="std std-ref">abstract</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.4.22, constructors were defined as functions with the same name as the contract. This syntax is now deprecated.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">a</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_a</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="nx">_a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">B</span><span class="p">()</span> <span class="k">public</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="arguments-for-base-constructors">
<span id="index-16"></span><h5>Arguments for Base Constructors<a class="headerlink" href="#arguments-for-base-constructors" title="Permalink to this headline">¶</a></h5>
<p>The constructors of all the base contracts will be called following the
linearization rules explained below. If the base constructors have arguments,
derived contracts need to specify all of them. This can be done in two ways:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Base</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_x</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">_x</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Derived1</span> <span class="k">is</span> <span class="nx">Base</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_y</span><span class="p">)</span> <span class="k">public</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Derived2</span> <span class="k">is</span> <span class="nx">Base</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_y</span><span class="p">)</span> <span class="nx">Base</span><span class="p">(</span><span class="nx">_y</span> <span class="o">*</span> <span class="nx">_y</span><span class="p">)</span> <span class="k">public</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>One way is directly in the inheritance list (<code class="docutils literal"><span class="pre">is</span> <span class="pre">Base(7)</span></code>).  The other is in
the way a modifier would be invoked as part of the header of
the derived constructor (<code class="docutils literal"><span class="pre">Base(_y</span> <span class="pre">*</span> <span class="pre">_y)</span></code>). The first way to
do it is more convenient if the constructor argument is a
constant and defines the behaviour of the contract or
describes it. The second way has to be used if the
constructor arguments of the base depend on those of the
derived contract. Arguments have to be given either in the
inheritance list or in modifier-style in the derived constuctor.
Specifying arguments in both places is an error.</p>
<p>If a derived contract doesn’t specify the arguments to all of its base
contracts’ constructors, it will be abstract.</p>
</div>
<div class="section" id="multiple-inheritance-and-linearization">
<span id="index-17"></span><h5>Multiple Inheritance and Linearization<a class="headerlink" href="#multiple-inheritance-and-linearization" title="Permalink to this headline">¶</a></h5>
<p>Languages that allow multiple inheritance have to deal with
several problems.  One is the <a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">Diamond Problem</a>.
Solidity is similar to Python in that it uses “<a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 Linearization</a>”
to force a specific order in the DAG of base classes. This
results in the desirable property of monotonicity but
disallows some inheritance graphs. Especially, the order in
which the base classes are given in the <code class="docutils literal"><span class="pre">is</span></code> directive is
important: You have to list the direct base contracts
in the order from “most base-like” to “most derived”.
Note that this order is different from the one used in Python.
In the following code, Solidity will give the
error “Linearization of inheritance graph impossible”.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// This will not compile</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">X</span> <span class="p">{}</span>
<span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">X</span> <span class="p">{}</span>
<span class="kd">contract</span> <span class="nx">C</span> <span class="k">is</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">X</span> <span class="p">{}</span>
</pre></div>
</div>
<p>The reason for this is that <code class="docutils literal"><span class="pre">C</span></code> requests <code class="docutils literal"><span class="pre">X</span></code> to override <code class="docutils literal"><span class="pre">A</span></code>
(by specifying <code class="docutils literal"><span class="pre">A,</span> <span class="pre">X</span></code> in this order), but <code class="docutils literal"><span class="pre">A</span></code> itself
requests to override <code class="docutils literal"><span class="pre">X</span></code>, which is a contradiction that
cannot be resolved.</p>
</div>
<div class="section" id="inheriting-different-kinds-of-members-of-the-same-name">
<h5>Inheriting Different Kinds of Members of the Same Name<a class="headerlink" href="#inheriting-different-kinds-of-members-of-the-same-name" title="Permalink to this headline">¶</a></h5>
<p>When the inheritance results in a contract with a function and a modifier of the same name, it is considered as an error.
This error is produced also by an event and a modifier of the same name, and a function and an event of the same name.
As an exception, a state variable getter can override a public function.</p>
</div>
</div>
<div class="section" id="abstract-contracts">
<span id="abstract-contract"></span><span id="index-18"></span><h4>Abstract Contracts<a class="headerlink" href="#abstract-contracts" title="Permalink to this headline">¶</a></h4>
<p>Contracts are marked as abstract when at least one of their functions lacks an implementation as in the following example (note that the function declaration header is terminated by <code class="docutils literal"><span class="pre">;</span></code>):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">utterance</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Such contracts cannot be compiled (even if they contain implemented functions alongside non-implemented functions), but they can be used as base contracts:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">utterance</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">Cat</span> <span class="k">is</span> <span class="nx">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">utterance</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="s2">&quot;miaow&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If a contract inherits from an abstract contract and does not implement all non-implemented functions by overriding, it will itself be abstract.</p>
<p>Note that a function without implementation is different from a <a class="reference internal" href="index.html#function-types"><span class="std std-ref">Function Type</span></a> even though their syntax looks very similar.</p>
<p>Example of function without implementation (a function declaration):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</pre></div>
</div>
<p>Example of a Function Type (a variable declaration, where the variable is of type <code class="docutils literal"><span class="pre">function</span></code>):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="nx">foo</span><span class="p">;</span>
</pre></div>
</div>
<p>Abstract contracts decouple the definition of a contract from its implementation providing better extensibility and self-documentation and
facilitating patterns like the <a class="reference external" href="https://en.wikipedia.org/wiki/Template_method_pattern">Template method</a> and removing code duplication.</p>
</div>
<div class="section" id="interfaces">
<span id="index-19"></span><h4>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h4>
<p>Interfaces are similar to abstract contracts, but they cannot have any functions implemented. There are further restrictions:</p>
<ol class="arabic simple">
<li>Cannot inherit other contracts or interfaces.</li>
<li>Cannot define constructor.</li>
<li>Cannot define variables.</li>
<li>Cannot define structs.</li>
<li>Cannot define enums.</li>
</ol>
<p>Some of these restrictions might be lifted in the future.</p>
<p>Interfaces are basically limited to what the Contract ABI can represent, and the conversion between the ABI and
an Interface should be possible without any information loss.</p>
<p>Interfaces are denoted by their own keyword:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">interface</span> <span class="nx">Token</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="nx">recipient</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">public</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Contracts can inherit interfaces as they would inherit other contracts.</p>
</div>
<div class="section" id="libraries">
<span id="index-20"></span><span id="id8"></span><h4>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h4>
<p>Libraries are similar to contracts, but their purpose is that they are deployed
only once at a specific address and their code is reused using the <code class="docutils literal"><span class="pre">DELEGATECALL</span></code>
(<code class="docutils literal"><span class="pre">CALLCODE</span></code> until Homestead)
feature of the EVM. This means that if library functions are called, their code
is executed in the context of the calling contract, i.e. <code class="docutils literal"><span class="pre">this</span></code> points to the
calling contract, and especially the storage from the calling contract can be
accessed. As a library is an isolated piece of source code, it can only access
state variables of the calling contract if they are explicitly supplied (it
would have no way to name them, otherwise). Library functions can only be
called directly (i.e. without the use of <code class="docutils literal"><span class="pre">DELEGATECALL</span></code>) if they do not modify
the state (i.e. if they are <code class="docutils literal"><span class="pre">view</span></code> or <code class="docutils literal"><span class="pre">pure</span></code> functions),
because libraries are assumed to be stateless. In particular, it is
not possible to destroy a library unless Solidity’s type system is circumvented.</p>
<p>Libraries can be seen as implicit base contracts of the contracts that use them.
They will not be explicitly visible in the inheritance hierarchy, but calls
to library functions look just like calls to functions of explicit base
contracts (<code class="docutils literal"><span class="pre">L.f()</span></code> if <code class="docutils literal"><span class="pre">L</span></code> is the name of the library). Furthermore,
<code class="docutils literal"><span class="pre">internal</span></code> functions of libraries are visible in all contracts, just as
if the library were a base contract. Of course, calls to internal functions
use the internal calling convention, which means that all internal types
can be passed and memory types will be passed by reference and not copied.
To realize this in the EVM, code of internal library functions
and all functions called from therein will at compile time be pulled into the calling
contract, and a regular <code class="docutils literal"><span class="pre">JUMP</span></code> call will be used instead of a <code class="docutils literal"><span class="pre">DELEGATECALL</span></code>.</p>
<p id="index-21">The following example illustrates how to use libraries (but
be sure to check out <a class="reference internal" href="#using-for"><span class="std std-ref">using for</span></a> for a
more advanced example to implement a set).</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">Set</span> <span class="p">{</span>
  <span class="c1">// We define a new struct datatype that will be used to</span>
  <span class="c1">// hold its data in the calling contract.</span>
  <span class="kd">struct</span> <span class="nx">Data</span> <span class="p">{</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">flags</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Note that the first parameter is of type &quot;storage</span>
  <span class="c1">// reference&quot; and thus only its storage address and not</span>
  <span class="c1">// its contents is passed as part of the call.  This is a</span>
  <span class="c1">// special feature of library functions.  It is idiomatic</span>
  <span class="c1">// to call the first parameter `self`, if the function can</span>
  <span class="c1">// be seen as a method of that object.</span>
  <span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// already there</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// not there</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">public</span>
      <span class="k">view</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">Data</span> <span class="nx">knownValues</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// The library functions can be called without a</span>
        <span class="c1">// specific instance of the library, since the</span>
        <span class="c1">// &quot;instance&quot; will be the current contract.</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">Set</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">knownValues</span><span class="p">,</span> <span class="nx">value</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="c1">// In this contract, we can also directly access knownValues.flags, if we want.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Of course, you do not have to follow this way to use
libraries: they can also be used without defining struct
data types. Functions also work without any storage
reference parameters, and they can have multiple storage reference
parameters and in any position.</p>
<p>The calls to <code class="docutils literal"><span class="pre">Set.contains</span></code>, <code class="docutils literal"><span class="pre">Set.insert</span></code> and <code class="docutils literal"><span class="pre">Set.remove</span></code>
are all compiled as calls (<code class="docutils literal"><span class="pre">DELEGATECALL</span></code>) to an external
contract/library. If you use libraries, take care that an
actual external function call is performed.
<code class="docutils literal"><span class="pre">msg.sender</span></code>, <code class="docutils literal"><span class="pre">msg.value</span></code> and <code class="docutils literal"><span class="pre">this</span></code> will retain their values
in this call, though (prior to Homestead, because of the use of <code class="docutils literal"><span class="pre">CALLCODE</span></code>, <code class="docutils literal"><span class="pre">msg.sender</span></code> and
<code class="docutils literal"><span class="pre">msg.value</span></code> changed, though).</p>
<p>The following example shows how to use memory types and
internal functions in libraries in order to implement
custom types without the overhead of external function calls:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">BigInt</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">bigint</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">limbs</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">fromUint</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">bigint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="mi">1</span><span class="p">);</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">bigint</span> <span class="nx">_a</span><span class="p">,</span> <span class="nx">bigint</span> <span class="nx">_b</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">bigint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">max</span><span class="p">(</span><span class="nx">_a</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">_b</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
        <span class="kt">uint</span> <span class="nx">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">limb</span><span class="p">(</span><span class="nx">_a</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
            <span class="kt">uint</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">limb</span><span class="p">(</span><span class="nx">_b</span><span class="p">,</span> <span class="nx">i</span><span class="p">);</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">+</span> <span class="nx">carry</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">a</span> <span class="o">||</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">==</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">carry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
                <span class="nx">carry</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="nx">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">carry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// too bad, we have to add a limb</span>
            <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">newLimbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span>
                <span class="nx">newLimbs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="nx">newLimbs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">carry</span><span class="p">;</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">limbs</span> <span class="o">=</span> <span class="nx">newLimbs</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">limb</span><span class="p">(</span><span class="nx">bigint</span> <span class="nx">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_limb</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_limb</span> <span class="o">&lt;</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">limbs</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">limbs</span><span class="p">[</span><span class="nx">_limb</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">max</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="k">private</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="nx">a</span> <span class="o">:</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="k">using</span> <span class="nx">BigInt</span> <span class="k">for</span> <span class="nx">BigInt</span><span class="p">.</span><span class="nx">bigint</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">BigInt</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">BigInt</span><span class="p">.</span><span class="nx">fromUint</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As the compiler cannot know where the library will be
deployed at, these addresses have to be filled into the
final bytecode by a linker
(see <a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> for how to use the
commandline compiler for linking). If the addresses are not
given as arguments to the compiler, the compiled hex code
will contain placeholders of the form <code class="docutils literal"><span class="pre">__Set______</span></code> (where
<code class="docutils literal"><span class="pre">Set</span></code> is the name of the library). The address can be filled
manually by replacing all those 40 symbols by the hex
encoding of the address of the library contract.</p>
<p>Restrictions for libraries in comparison to contracts:</p>
<ul class="simple">
<li>No state variables</li>
<li>Cannot inherit nor be inherited</li>
<li>Cannot receive Ether</li>
</ul>
<p>(These might be lifted at a later point.)</p>
<div class="section" id="call-protection-for-libraries">
<h5>Call Protection For Libraries<a class="headerlink" href="#call-protection-for-libraries" title="Permalink to this headline">¶</a></h5>
<p>As mentioned in the introduction, if a library’s code is executed
using a <code class="docutils literal"><span class="pre">CALL</span></code> instead of a <code class="docutils literal"><span class="pre">DELEGATECALL</span></code> or <code class="docutils literal"><span class="pre">CALLCODE</span></code>,
it will revert unless a <code class="docutils literal"><span class="pre">view</span></code> or <code class="docutils literal"><span class="pre">pure</span></code> function is called.</p>
<p>The EVM does not provide a direct way for a contract to detect
whether it was called using <code class="docutils literal"><span class="pre">CALL</span></code> or not, but a contract
can use the <code class="docutils literal"><span class="pre">ADDRESS</span></code> opcode to find out “where” it is
currently running. The generated code compares this address
to the address used at construction time to determine the mode
of calling.</p>
<p>More specifically, the runtime code of a library always starts
with a push instruction, which is a zero of 20 bytes at
compilation time. When the deploy code runs, this constant
is replaced in memory by the current address and this
modified code is stored in the contract. At runtime,
this causes the deploy time address to be the first
constant to be pushed onto the stack and the dispatcher
code compares the current address against this constant
for any non-view and non-pure function.</p>
</div>
</div>
<div class="section" id="using-for">
<span id="index-22"></span><span id="id9"></span><h4>Using For<a class="headerlink" href="#using-for" title="Permalink to this headline">¶</a></h4>
<p>The directive <code class="docutils literal"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B;</span></code> can be used to attach library
functions (from the library <code class="docutils literal"><span class="pre">A</span></code>) to any type (<code class="docutils literal"><span class="pre">B</span></code>).
These functions will receive the object they are called on
as their first parameter (like the <code class="docutils literal"><span class="pre">self</span></code> variable in
Python).</p>
<p>The effect of <code class="docutils literal"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">*;</span></code> is that the functions from
the library <code class="docutils literal"><span class="pre">A</span></code> are attached to any type.</p>
<p>In both situations, all functions, even those where the
type of the first parameter does not match the type of
the object, are attached. The type is checked at the
point the function is called and function overload
resolution is performed.</p>
<p>The <code class="docutils literal"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B;</span></code> directive is active for the current
scope, which is limited to a contract for now but will
be lifted to the global scope later, so that by including
a module, its data types including library functions are
available without having to add further code.</p>
<p>Let us rewrite the set example from the
<a class="reference internal" href="#libraries"><span class="std std-ref">Libraries</span></a> in this way:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="c1">// This is the same code as before, just without comments</span>
<span class="kd">library</span> <span class="nx">Set</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="nx">Data</span> <span class="p">{</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">flags</span><span class="p">;</span> <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">insert</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// already there</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">remove</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// not there</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">Data</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
      <span class="k">public</span>
      <span class="k">view</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">flags</span><span class="p">[</span><span class="nx">value</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="k">using</span> <span class="nx">Set</span> <span class="k">for</span> <span class="nx">Set</span><span class="p">.</span><span class="nx">Data</span><span class="p">;</span> <span class="c1">// this is the crucial change</span>
    <span class="nx">Set</span><span class="p">.</span><span class="nx">Data</span> <span class="nx">knownValues</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">register</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// Here, all variables of type Set.Data have</span>
        <span class="c1">// corresponding member functions.</span>
        <span class="c1">// The following function call is identical to</span>
        <span class="c1">// `Set.insert(knownValues, value)`</span>
        <span class="nb">require</span><span class="p">(</span><span class="nx">knownValues</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also possible to extend elementary types in that way:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">Search</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">indexOf</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="nx">value</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">return</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="k">using</span> <span class="nx">Search</span> <span class="k">for</span> <span class="kt">uint</span><span class="p">[];</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">append</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">value</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">replace</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_old</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">_new</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// This performs the library function call</span>
        <span class="kt">uint</span> <span class="nx">index</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">_old</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">==</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_new</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="nx">data</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_new</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that all library calls are actual EVM function calls. This means that
if you pass memory or value types, a copy will be performed, even of the
<code class="docutils literal"><span class="pre">self</span></code> variable. The only situation where no copy will be performed
is when storage reference variables are used.</p>
</div>
</div>
<span id="document-assembly"></span><div class="section" id="solidity-assembly">
<h3>Solidity Assembly<a class="headerlink" href="#solidity-assembly" title="Permalink to this headline">¶</a></h3>
<p id="index-0">Solidity defines an assembly language that can also be used without Solidity.
This assembly language can also be used as “inline assembly” inside Solidity
source code. We start with describing how to use inline assembly and how it
differs from standalone assembly and then specify assembly itself.</p>
<div class="section" id="inline-assembly">
<span id="id1"></span><h4>Inline Assembly<a class="headerlink" href="#inline-assembly" title="Permalink to this headline">¶</a></h4>
<p>For more fine-grained control especially in order to enhance the language by writing libraries,
it is possible to interleave Solidity statements with inline assembly in a language close
to the one of the virtual machine. Due to the fact that the EVM is a stack machine, it is
often hard to address the correct stack slot and provide arguments to opcodes at the correct
point on the stack. Solidity’s inline assembly tries to facilitate that and other issues
arising when writing manual assembly by the following features:</p>
<ul class="simple">
<li>functional-style opcodes: <code class="docutils literal"><span class="pre">mul(1,</span> <span class="pre">add(2,</span> <span class="pre">3))</span></code> instead of <code class="docutils literal"><span class="pre">push1</span> <span class="pre">3</span> <span class="pre">push1</span> <span class="pre">2</span> <span class="pre">add</span> <span class="pre">push1</span> <span class="pre">1</span> <span class="pre">mul</span></code></li>
<li>assembly-local variables: <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(2,</span> <span class="pre">3)</span>&#160; <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mload(0x40)</span>&#160; <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(x,</span> <span class="pre">y)</span></code></li>
<li>access to external variables: <code class="docutils literal"><span class="pre">function</span> <span class="pre">f(uint</span> <span class="pre">x)</span> <span class="pre">public</span> <span class="pre">{</span> <span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">sub(x,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
<li>labels: <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">10</span>&#160; <span class="pre">repeat:</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">sub(x,</span> <span class="pre">1)</span> <span class="pre">jumpi(repeat,</span> <span class="pre">eq(x,</span> <span class="pre">0))</span></code></li>
<li>loops: <code class="docutils literal"><span class="pre">for</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">0</span> <span class="pre">}</span> <span class="pre">lt(i,</span> <span class="pre">x)</span> <span class="pre">{</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">add(i,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(2,</span> <span class="pre">y)</span> <span class="pre">}</span></code></li>
<li>if statements: <code class="docutils literal"><span class="pre">if</span> <span class="pre">slt(x,</span> <span class="pre">0)</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">sub(0,</span> <span class="pre">x)</span> <span class="pre">}</span></code></li>
<li>switch statements: <code class="docutils literal"><span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">2)</span> <span class="pre">}</span> <span class="pre">default</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">0</span> <span class="pre">}</span></code></li>
<li>function calls: <code class="docutils literal"><span class="pre">function</span> <span class="pre">f(x)</span> <span class="pre">-&gt;</span> <span class="pre">y</span> <span class="pre">{</span> <span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">1</span> <span class="pre">}</span> <span class="pre">default</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">f(sub(x,</span> <span class="pre">1)))</span> <span class="pre">}</span>&#160;&#160; <span class="pre">}</span></code></li>
</ul>
<p>We now want to describe the inline assembly language in detail.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Inline assembly is a way to access the Ethereum Virtual Machine
at a low level. This discards several important safety
features of Solidity.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">TODO: Write about how scoping rules of inline assembly are a bit different
and the complications that arise when for example using internal functions
of libraries. Furthermore, write about the symbols defined by the compiler.</p>
</div>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<p>The following example provides library code to access the code of another contract and
load it into a <code class="docutils literal"><span class="pre">bytes</span></code> variable. This is not possible at all with “plain Solidity” and the
idea is that assembly libraries will be used to enhance the language in such ways.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">GetCode</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">at</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_addr</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="nx">o_code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="c1">// retrieve the size of the code, this needs assembly</span>
            <span class="kr">let</span> <span class="nx">size</span> <span class="o">:=</span> <span class="nx">extcodesize</span><span class="p">(</span><span class="nx">_addr</span><span class="p">)</span>
            <span class="c1">// allocate output byte array - this could also be done without assembly</span>
            <span class="c1">// by using o_code = new bytes(size)</span>
            <span class="nx">o_code</span> <span class="o">:=</span> <span class="nx">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
            <span class="c1">// new &quot;memory end&quot; including padding</span>
            <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_code</span><span class="p">,</span> <span class="nx">and</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="mh">0x1f</span><span class="p">),</span> <span class="nx">not</span><span class="p">(</span><span class="mh">0x1f</span><span class="p">))))</span>
            <span class="c1">// store length in memory</span>
            <span class="nx">mstore</span><span class="p">(</span><span class="nx">o_code</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
            <span class="c1">// actually retrieve the code, this needs assembly</span>
            <span class="nx">extcodecopy</span><span class="p">(</span><span class="nx">_addr</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_code</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Inline assembly could also be beneficial in cases where the optimizer fails to produce
efficient code. Please be aware that assembly is much more difficult to write because
the compiler does not perform checks, so you should use it for complex things only if
you really know what you are doing.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">library</span> <span class="nx">VectorSum</span> <span class="p">{</span>
    <span class="c1">// This function is less efficient because the optimizer currently fails to</span>
    <span class="c1">// remove the bounds checks in array access.</span>
    <span class="kd">function</span> <span class="nx">sumSolidity</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span>
            <span class="nx">o_sum</span> <span class="o">+=</span> <span class="nx">_data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// We know that we only access the array in bounds, so we can avoid the check.</span>
    <span class="c1">// 0x20 needs to be added to an array because the first slot contains the</span>
    <span class="c1">// array length.</span>
    <span class="kd">function</span> <span class="nx">sumAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">assembly</span> <span class="p">{</span>
                <span class="nx">o_sum</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_sum</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">_data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">))))</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Same as above, but accomplish the entire code within inline assembly.</span>
    <span class="kd">function</span> <span class="nx">sumPureAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
           <span class="c1">// Load the length (first 32 bytes)</span>
           <span class="kr">let</span> <span class="nx">len</span> <span class="o">:=</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">_data</span><span class="p">)</span>

           <span class="c1">// Skip over the length field.</span>
           <span class="c1">//</span>
           <span class="c1">// Keep temporary variable so it can be incremented in place.</span>
           <span class="c1">//</span>
           <span class="c1">// NOTE: incrementing _data would result in an unusable</span>
           <span class="c1">//       _data variable after this assembly block</span>
           <span class="kr">let</span> <span class="nx">data</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">_data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>

           <span class="c1">// Iterate until the bound is not met.</span>
           <span class="k">for</span>
               <span class="p">{</span> <span class="kr">let</span> <span class="nx">end</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">len</span><span class="p">)</span> <span class="p">}</span>
               <span class="nx">lt</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span>
               <span class="p">{</span> <span class="nx">data</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">}</span>
           <span class="p">{</span>
               <span class="nx">o_sum</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">o_sum</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
           <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="syntax">
<h5>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h5>
<p>Assembly parses comments, literals and identifiers exactly as Solidity, so you can use the
usual <code class="docutils literal"><span class="pre">//</span></code> and <code class="docutils literal"><span class="pre">/*</span> <span class="pre">*/</span></code> comments. Inline assembly is marked by <code class="docutils literal"><span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> and inside
these curly braces, the following can be used (see the later sections for more details)</p>
<blockquote>
<div><ul class="simple">
<li>literals, i.e. <code class="docutils literal"><span class="pre">0x123</span></code>, <code class="docutils literal"><span class="pre">42</span></code> or <code class="docutils literal"><span class="pre">&quot;abc&quot;</span></code> (strings up to 32 characters)</li>
<li>opcodes (in “instruction style”), e.g. <code class="docutils literal"><span class="pre">mload</span> <span class="pre">sload</span> <span class="pre">dup1</span> <span class="pre">sstore</span></code>, for a list see below</li>
<li>opcodes in functional style, e.g. <code class="docutils literal"><span class="pre">add(1,</span> <span class="pre">mlod(0))</span></code></li>
<li>labels, e.g. <code class="docutils literal"><span class="pre">name:</span></code></li>
<li>variable declarations, e.g. <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">7</span></code>, <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code> or <code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span></code> (initial value of empty (0) is assigned)</li>
<li>identifiers (labels or assembly-local variables and externals if used as inline assembly), e.g. <code class="docutils literal"><span class="pre">jump(name)</span></code>, <code class="docutils literal"><span class="pre">3</span> <span class="pre">x</span> <span class="pre">add</span></code></li>
<li>assignments (in “instruction style”), e.g. <code class="docutils literal"><span class="pre">3</span> <span class="pre">=:</span> <span class="pre">x</span></code></li>
<li>assignments in functional style, e.g. <code class="docutils literal"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code></li>
<li>blocks where local variables are scoped inside, e.g. <code class="docutils literal"><span class="pre">{</span> <span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">3</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">add(x,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="opcodes">
<h5>Opcodes<a class="headerlink" href="#opcodes" title="Permalink to this headline">¶</a></h5>
<p>This document does not want to be a full description of the Ethereum virtual machine, but the
following list can be used as a reference of its opcodes.</p>
<p>If an opcode takes arguments (always from the top of the stack), they are given in parentheses.
Note that the order of arguments can be seen to be reversed in non-functional style (explained below).
Opcodes marked with <code class="docutils literal"><span class="pre">-</span></code> do not push an item onto the stack, those marked with <code class="docutils literal"><span class="pre">*</span></code> are
special and all others push exactly one item onto the stack.
Opcodes marked with <code class="docutils literal"><span class="pre">F</span></code>, <code class="docutils literal"><span class="pre">H</span></code>, <code class="docutils literal"><span class="pre">B</span></code> or <code class="docutils literal"><span class="pre">C</span></code> are present since Frontier, Homestead, Byzantium or Constantinople, respectively.
Constantinople is still in planning and all instructions marked as such will result in an invalid instruction exception.</p>
<p>In the following, <code class="docutils literal"><span class="pre">mem[a...b)</span></code> signifies the bytes of memory starting at position <code class="docutils literal"><span class="pre">a</span></code> up to
(excluding) position <code class="docutils literal"><span class="pre">b</span></code> and <code class="docutils literal"><span class="pre">storage[p]</span></code> signifies the storage contents at position <code class="docutils literal"><span class="pre">p</span></code>.</p>
<p>The opcodes <code class="docutils literal"><span class="pre">pushi</span></code> and <code class="docutils literal"><span class="pre">jumpdest</span></code> cannot be used directly.</p>
<p>In the grammar, opcodes are represented as pre-defined identifiers.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="5%" />
<col width="3%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Instruction</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
<th class="head">Explanation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2">stop</td>
<td rowspan="2"><cite>-</cite></td>
<td rowspan="2">F</td>
<td rowspan="2">stop execution, identical to return(0,0)</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td>add(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x + y</td>
</tr>
<tr class="row-odd"><td>sub(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x - y</td>
</tr>
<tr class="row-even"><td>mul(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x * y</td>
</tr>
<tr class="row-odd"><td>div(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x / y</td>
</tr>
<tr class="row-even"><td>sdiv(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x / y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-odd"><td>mod(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x % y</td>
</tr>
<tr class="row-even"><td>smod(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x % y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-odd"><td>exp(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x to the power of y</td>
</tr>
<tr class="row-even"><td>not(x)</td>
<td>&#160;</td>
<td>F</td>
<td>~x, every bit of x is negated</td>
</tr>
<tr class="row-odd"><td>lt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &lt; y, 0 otherwise</td>
</tr>
<tr class="row-even"><td>gt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &gt; y, 0 otherwise</td>
</tr>
<tr class="row-odd"><td>slt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &lt; y, 0 otherwise, for signed numbers in two’s complement</td>
</tr>
<tr class="row-even"><td>sgt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &gt; y, 0 otherwise, for signed numbers in two’s complement</td>
</tr>
<tr class="row-odd"><td>eq(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x == y, 0 otherwise</td>
</tr>
<tr class="row-even"><td>iszero(x)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x == 0, 0 otherwise</td>
</tr>
<tr class="row-odd"><td>and(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>bitwise and of x and y</td>
</tr>
<tr class="row-even"><td>or(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>bitwise or of x and y</td>
</tr>
<tr class="row-odd"><td>xor(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>bitwise xor of x and y</td>
</tr>
<tr class="row-even"><td>byte(n, x)</td>
<td>&#160;</td>
<td>F</td>
<td>nth byte of x, where the most significant byte is the 0th byte</td>
</tr>
<tr class="row-odd"><td>shl(x, y)</td>
<td>&#160;</td>
<td>C</td>
<td>logical shift left y by x bits</td>
</tr>
<tr class="row-even"><td>shr(x, y)</td>
<td>&#160;</td>
<td>C</td>
<td>logical shift right y by x bits</td>
</tr>
<tr class="row-odd"><td>sar(x, y)</td>
<td>&#160;</td>
<td>C</td>
<td>arithmetic shift right y by x bits</td>
</tr>
<tr class="row-even"><td>addmod(x, y, m)</td>
<td>&#160;</td>
<td>F</td>
<td>(x + y) % m with arbitrary precision arithmetics</td>
</tr>
<tr class="row-odd"><td>mulmod(x, y, m)</td>
<td>&#160;</td>
<td>F</td>
<td>(x * y) % m with arbitrary precision arithmetics</td>
</tr>
<tr class="row-even"><td>signextend(i, x)</td>
<td>&#160;</td>
<td>F</td>
<td>sign extend from (i*8+7)th bit counting from least significant</td>
</tr>
<tr class="row-odd"><td>keccak256(p, n)</td>
<td>&#160;</td>
<td>F</td>
<td>keccak(mem[p…(p+n)))</td>
</tr>
<tr class="row-even"><td>sha3(p, n)</td>
<td>&#160;</td>
<td>F</td>
<td>keccak(mem[p…(p+n)))</td>
</tr>
<tr class="row-odd"><td>jump(label)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>jump to label / code position</td>
</tr>
<tr class="row-even"><td>jumpi(label, cond)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>jump to label if cond is nonzero</td>
</tr>
<tr class="row-odd"><td>pc</td>
<td>&#160;</td>
<td>F</td>
<td>current position in code</td>
</tr>
<tr class="row-even"><td>pop(x)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>remove the element pushed by x</td>
</tr>
<tr class="row-odd"><td>dup1 … dup16</td>
<td>&#160;</td>
<td>F</td>
<td>copy ith stack slot to the top (counting from top)</td>
</tr>
<tr class="row-even"><td>swap1 … swap16</td>
<td><cite>*</cite></td>
<td>F</td>
<td>swap topmost and ith stack slot below it</td>
</tr>
<tr class="row-odd"><td>mload(p)</td>
<td>&#160;</td>
<td>F</td>
<td>mem[p..(p+32))</td>
</tr>
<tr class="row-even"><td>mstore(p, v)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>mem[p..(p+32)) := v</td>
</tr>
<tr class="row-odd"><td>mstore8(p, v)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>mem[p] := v &amp; 0xff (only modifies a single byte)</td>
</tr>
<tr class="row-even"><td>sload(p)</td>
<td>&#160;</td>
<td>F</td>
<td>storage[p]</td>
</tr>
<tr class="row-odd"><td>sstore(p, v)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>storage[p] := v</td>
</tr>
<tr class="row-even"><td>msize</td>
<td>&#160;</td>
<td>F</td>
<td>size of memory, i.e. largest accessed memory index</td>
</tr>
<tr class="row-odd"><td>gas</td>
<td>&#160;</td>
<td>F</td>
<td>gas still available to execution</td>
</tr>
<tr class="row-even"><td>address</td>
<td>&#160;</td>
<td>F</td>
<td>address of the current contract / execution context</td>
</tr>
<tr class="row-odd"><td>balance(a)</td>
<td>&#160;</td>
<td>F</td>
<td>wei balance at address a</td>
</tr>
<tr class="row-even"><td>caller</td>
<td>&#160;</td>
<td>F</td>
<td>call sender (excluding <code class="docutils literal"><span class="pre">delegatecall</span></code>)</td>
</tr>
<tr class="row-odd"><td>callvalue</td>
<td>&#160;</td>
<td>F</td>
<td>wei sent together with the current call</td>
</tr>
<tr class="row-even"><td>calldataload(p)</td>
<td>&#160;</td>
<td>F</td>
<td>call data starting from position p (32 bytes)</td>
</tr>
<tr class="row-odd"><td>calldatasize</td>
<td>&#160;</td>
<td>F</td>
<td>size of call data in bytes</td>
</tr>
<tr class="row-even"><td>calldatacopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>copy s bytes from calldata at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>codesize</td>
<td>&#160;</td>
<td>F</td>
<td>size of the code of the current contract / execution context</td>
</tr>
<tr class="row-even"><td>codecopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>copy s bytes from code at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>extcodesize(a)</td>
<td>&#160;</td>
<td>F</td>
<td>size of the code at address a</td>
</tr>
<tr class="row-even"><td>extcodecopy(a, t, f, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>like codecopy(t, f, s) but take code at address a</td>
</tr>
<tr class="row-odd"><td>returndatasize</td>
<td>&#160;</td>
<td>B</td>
<td>size of the last returndata</td>
</tr>
<tr class="row-even"><td>returndatacopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>B</td>
<td>copy s bytes from returndata at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>create(v, p, s)</td>
<td>&#160;</td>
<td>F</td>
<td>create new contract with code mem[p..(p+s)) and send v wei
and return the new address</td>
</tr>
<tr class="row-even"><td>create2(v, n, p, s)</td>
<td>&#160;</td>
<td>C</td>
<td>create new contract with code mem[p..(p+s)) at address
keccak256(&lt;address&gt; . n . keccak256(mem[p..(p+s))) and send v
wei and return the new address</td>
</tr>
<tr class="row-odd"><td>call(g, a, v, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>F</td>
<td>call contract at address a with input mem[in..(in+insize))
providing g gas and v wei and output area
mem[out..(out+outsize)) returning 0 on error (eg. out of gas)
and 1 on success</td>
</tr>
<tr class="row-even"><td>callcode(g, a, v, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>F</td>
<td>identical to <code class="docutils literal"><span class="pre">call</span></code> but only use the code from a and stay
in the context of the current contract otherwise</td>
</tr>
<tr class="row-odd"><td>delegatecall(g, a, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>H</td>
<td>identical to <code class="docutils literal"><span class="pre">callcode</span></code> but also keep <code class="docutils literal"><span class="pre">caller</span></code>
and <code class="docutils literal"><span class="pre">callvalue</span></code></td>
</tr>
<tr class="row-even"><td>staticcall(g, a, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>B</td>
<td>identical to <code class="docutils literal"><span class="pre">call(g,</span> <span class="pre">a,</span> <span class="pre">0,</span> <span class="pre">in,</span> <span class="pre">insize,</span> <span class="pre">out,</span> <span class="pre">outsize)</span></code> but do
not allow state modifications</td>
</tr>
<tr class="row-odd"><td>return(p, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>end execution, return data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>revert(p, s)</td>
<td><cite>-</cite></td>
<td>B</td>
<td>end execution, revert state changes, return data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>selfdestruct(a)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>end execution, destroy current contract and send funds to a</td>
</tr>
<tr class="row-even"><td>invalid</td>
<td><cite>-</cite></td>
<td>F</td>
<td>end execution with invalid instruction</td>
</tr>
<tr class="row-odd"><td>log0(p, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log without topics and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log1(p, s, t1)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topic t1 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log2(p, s, t1, t2)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topics t1, t2 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log3(p, s, t1, t2, t3)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topics t1, t2, t3 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log4(p, s, t1, t2, t3,
t4)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topics t1, t2, t3, t4 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>origin</td>
<td>&#160;</td>
<td>F</td>
<td>transaction sender</td>
</tr>
<tr class="row-odd"><td>gasprice</td>
<td>&#160;</td>
<td>F</td>
<td>gas price of the transaction</td>
</tr>
<tr class="row-even"><td>blockhash(b)</td>
<td>&#160;</td>
<td>F</td>
<td>hash of block nr b - only for last 256 blocks excluding current</td>
</tr>
<tr class="row-odd"><td>coinbase</td>
<td>&#160;</td>
<td>F</td>
<td>current mining beneficiary</td>
</tr>
<tr class="row-even"><td>timestamp</td>
<td>&#160;</td>
<td>F</td>
<td>timestamp of the current block in seconds since the epoch</td>
</tr>
<tr class="row-odd"><td>number</td>
<td>&#160;</td>
<td>F</td>
<td>current block number</td>
</tr>
<tr class="row-even"><td>difficulty</td>
<td>&#160;</td>
<td>F</td>
<td>difficulty of the current block</td>
</tr>
<tr class="row-odd"><td>gaslimit</td>
<td>&#160;</td>
<td>F</td>
<td>block gas limit of the current block</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="literals">
<h5>Literals<a class="headerlink" href="#literals" title="Permalink to this headline">¶</a></h5>
<p>You can use integer constants by typing them in decimal or hexadecimal notation and an
appropriate <code class="docutils literal"><span class="pre">PUSHi</span></code> instruction will automatically be generated. The following creates code
to add 2 and 3 resulting in 5 and then computes the bitwise and with the string “abc”.
Strings are stored left-aligned and cannot be longer than 32 bytes.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">assembly</span> <span class="p">{</span> <span class="mi">2</span> <span class="mi">3</span> <span class="nx">add</span> <span class="s2">&quot;abc&quot;</span> <span class="nx">and</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functional-style">
<h5>Functional Style<a class="headerlink" href="#functional-style" title="Permalink to this headline">¶</a></h5>
<p>You can type opcode after opcode in the same way they will end up in bytecode. For example
adding <code class="docutils literal"><span class="pre">3</span></code> to the contents in memory at position <code class="docutils literal"><span class="pre">0x80</span></code> would be</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="mh">0x80</span> <span class="nx">mload</span> <span class="nx">add</span> <span class="mh">0x80</span> <span class="nx">mstore</span>
</pre></div>
</div>
<p>As it is often hard to see what the actual arguments for certain opcodes are,
Solidity inline assembly also provides a “functional style” notation where the same code
would be written as follows</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">mstore</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">mload</span><span class="p">(</span><span class="mh">0x80</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>Functional style expressions cannot use instructional style internally, i.e.
<code class="docutils literal"><span class="pre">1</span> <span class="pre">2</span> <span class="pre">mstore(0x80,</span> <span class="pre">add)</span></code> is not valid assembly, it has to be written as
<code class="docutils literal"><span class="pre">mstore(0x80,</span> <span class="pre">add(2,</span> <span class="pre">1))</span></code>. For opcodes that do not take arguments, the
parentheses can be omitted.</p>
<p>Note that the order of arguments is reversed in functional-style as opposed to the instruction-style
way. If you use functional-style, the first argument will end up on the stack top.</p>
</div>
<div class="section" id="access-to-external-variables-and-functions">
<h5>Access to External Variables and Functions<a class="headerlink" href="#access-to-external-variables-and-functions" title="Permalink to this headline">¶</a></h5>
<p>Solidity variables and other identifiers can be accessed by simply using their name.
For memory variables, this will push the address and not the value onto the
stack. Storage variables are different: Values in storage might not occupy a
full storage slot, so their “address” is composed of a slot and a byte-offset
inside that slot. To retrieve the slot pointed to by the variable <code class="docutils literal"><span class="pre">x</span></code>, you
used <code class="docutils literal"><span class="pre">x_slot</span></code> and to retrieve the byte-offset you used <code class="docutils literal"><span class="pre">x_offset</span></code>.</p>
<p>In assignments (see below), we can even use local Solidity variables to assign to.</p>
<p>Functions external to inline assembly can also be accessed: The assembly will
push their entry label (with virtual function resolution applied). The calling semantics
in solidity are:</p>
<blockquote>
<div><ul class="simple">
<li>the caller pushes <code class="docutils literal"><span class="pre">return</span> <span class="pre">label</span></code>, <code class="docutils literal"><span class="pre">arg1</span></code>, <code class="docutils literal"><span class="pre">arg2</span></code>, …, <code class="docutils literal"><span class="pre">argn</span></code></li>
<li>the call returns with <code class="docutils literal"><span class="pre">ret1</span></code>, <code class="docutils literal"><span class="pre">ret2</span></code>, …, <code class="docutils literal"><span class="pre">retm</span></code></li>
</ul>
</div></blockquote>
<p>This feature is still a bit cumbersome to use, because the stack offset essentially
changes during the call, and thus references to local variables will be wrong.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">b</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="nx">r</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">sload</span><span class="p">(</span><span class="nx">b_slot</span><span class="p">))</span> <span class="c1">// ignore the offset, we know it is zero</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you access variables of a type that spans less than 256 bits
(for example <code class="docutils literal"><span class="pre">uint64</span></code>, <code class="docutils literal"><span class="pre">address</span></code>, <code class="docutils literal"><span class="pre">bytes16</span></code> or <code class="docutils literal"><span class="pre">byte</span></code>),
you cannot make any assumptions about bits not part of the
encoding of the type. Especially, do not assume them to be zero.
To be safe, always clear the data properly before you use it
in a context where this is important:
<code class="docutils literal"><span class="pre">uint32</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">f();</span> <span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">and(x,</span> <span class="pre">0xffffffff)</span> <span class="pre">/*</span> <span class="pre">now</span> <span class="pre">use</span> <span class="pre">x</span> <span class="pre">*/</span> <span class="pre">}</span></code>
To clean signed types, you can use the <code class="docutils literal"><span class="pre">signextend</span></code> opcode.</p>
</div>
</div>
<div class="section" id="labels">
<h5>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Labels are deprecated. Please use functions, loops, if or switch statements instead.</p>
</div>
<p>Another problem in EVM assembly is that <code class="docutils literal"><span class="pre">jump</span></code> and <code class="docutils literal"><span class="pre">jumpi</span></code> use absolute addresses
which can change easily. Solidity inline assembly provides labels to make the use of
jumps easier. Note that labels are a low-level feature and it is possible to write
efficient assembly without labels, just using assembly functions, loops, if and switch instructions
(see below). The following code computes an element in the Fibonacci series.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">n</span> <span class="o">:=</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="kr">let</span> <span class="nx">a</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="kr">let</span> <span class="nx">b</span> <span class="o">:=</span> <span class="nx">a</span>
<span class="nx">loop</span><span class="o">:</span>
    <span class="nx">jumpi</span><span class="p">(</span><span class="nx">loopend</span><span class="p">,</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="nx">a</span> <span class="nx">add</span> <span class="nx">swap1</span>
    <span class="nx">n</span> <span class="o">:=</span> <span class="nx">sub</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">loop</span><span class="p">)</span>
<span class="nx">loopend</span><span class="o">:</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Please note that automatically accessing stack variables can only work if the
assembler knows the current stack height. This fails to work if the jump source
and target have different stack heights. It is still fine to use such jumps, but
you should just not access any stack variables (even assembly variables) in that case.</p>
<p>Furthermore, the stack height analyser goes through the code opcode by opcode
(and not according to control flow), so in the following case, the assembler
will have a wrong impression about the stack height at label <code class="docutils literal"><span class="pre">two</span></code>:</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">8</span>
    <span class="nx">jump</span><span class="p">(</span><span class="nx">two</span><span class="p">)</span>
    <span class="nx">one</span><span class="o">:</span>
        <span class="c1">// Here the stack height is 2 (because we pushed x and 7),</span>
        <span class="c1">// but the assembler thinks it is 1 because it reads</span>
        <span class="c1">// from top to bottom.</span>
        <span class="c1">// Accessing the stack variable x here will lead to errors.</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="mi">9</span>
        <span class="nx">jump</span><span class="p">(</span><span class="nx">three</span><span class="p">)</span>
    <span class="nx">two</span><span class="o">:</span>
        <span class="mi">7</span> <span class="c1">// push something onto the stack</span>
        <span class="nx">jump</span><span class="p">(</span><span class="nx">one</span><span class="p">)</span>
    <span class="nx">three</span><span class="o">:</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="declaring-assembly-local-variables">
<h5>Declaring Assembly-Local Variables<a class="headerlink" href="#declaring-assembly-local-variables" title="Permalink to this headline">¶</a></h5>
<p>You can use the <code class="docutils literal"><span class="pre">let</span></code> keyword to declare variables that are only visible in
inline assembly and actually only in the current <code class="docutils literal"><span class="pre">{...}</span></code>-block. What happens
is that the <code class="docutils literal"><span class="pre">let</span></code> instruction will create a new stack slot that is reserved
for the variable and automatically removed again when the end of the block
is reached. You need to provide an initial value for the variable which can
be just <code class="docutils literal"><span class="pre">0</span></code>, but it can also be a complex functional-style expression.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="kr">let</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kr">let</span> <span class="nx">y</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">sload</span><span class="p">(</span><span class="nx">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="nx">b</span> <span class="o">:=</span> <span class="nx">y</span>
            <span class="p">}</span> <span class="c1">// y is &quot;deallocated&quot; here</span>
            <span class="nx">b</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
        <span class="p">}</span> <span class="c1">// v is &quot;deallocated&quot; here</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="assignments">
<h5>Assignments<a class="headerlink" href="#assignments" title="Permalink to this headline">¶</a></h5>
<p>Assignments are possible to assembly-local variables and to function-local
variables. Take care that when you assign to variables that point to
memory or storage, you will only change the pointer and not the data.</p>
<p>There are two kinds of assignments: functional-style and instruction-style.
For functional-style assignments (<code class="docutils literal"><span class="pre">variable</span> <span class="pre">:=</span> <span class="pre">value</span></code>), you need to provide a value in a
functional-style expression that results in exactly one stack value
and for instruction-style (<code class="docutils literal"><span class="pre">=:</span> <span class="pre">variable</span></code>), the value is just taken from the stack top.
For both ways, the colon points to the name of the variable. The assignment
is performed by replacing the variable’s value on the stack by the new value.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">v</span> <span class="o">:=</span> <span class="mi">0</span> <span class="c1">// functional-style assignment as part of variable declaration</span>
    <span class="kr">let</span> <span class="nx">g</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nx">sload</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="o">=:</span> <span class="nx">v</span> <span class="c1">// instruction style assignment, puts the result of sload(10) into v</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Instruction-style assignment is deprecated.</p>
</div>
</div>
<div class="section" id="if">
<h5>If<a class="headerlink" href="#if" title="Permalink to this headline">¶</a></h5>
<p>The if statement can be used for conditionally executing code.
There is no “else” part, consider using “switch” (see below) if
you need multiple alternatives.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="k">if</span> <span class="nx">eq</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The curly braces for the body are required.</p>
</div>
<div class="section" id="switch">
<h5>Switch<a class="headerlink" href="#switch" title="Permalink to this headline">¶</a></h5>
<p>You can use a switch statement as a very basic version of “if/else”.
It takes the value of an expression and compares it to several constants.
The branch corresponding to the matching constant is taken. Contrary to the
error-prone behaviour of some programming languages, control flow does
not continue from one case to the next. There can be a fallback or default
case called <code class="docutils literal"><span class="pre">default</span></code>.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="kr">switch</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="kr">case</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mh">0x24</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kr">default</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">calldataload</span><span class="p">(</span><span class="mh">0x44</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">sstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">div</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The list of cases does not require curly braces, but the body of a
case does require them.</p>
</div>
<div class="section" id="loops">
<h5>Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h5>
<p>Assembly supports a simple for-style loop. For-style loops have
a header containing an initializing part, a condition and a post-iteration
part. The condition has to be a functional-style expression, while
the other two are blocks. If the initializing part
declares any variables, the scope of these variables is extended into the
body (including the condition and the post-iteration part).</p>
<p>The following example computes the sum of an area in memory.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">}</span> <span class="p">{</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For loops can also be written so that they behave like while loops:
Simply leave the initialization and post-iteration parts empty.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kr">let</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="p">}</span> <span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="p">{</span>     <span class="c1">// while(i &lt; 0x100)</span>
        <span class="nx">x</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">mload</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
        <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<h5>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h5>
<p>Assembly allows the definition of low-level functions. These take their
arguments (and a return PC) from the stack and also put the results onto the
stack. Calling a function looks the same way as executing a functional-style
opcode.</p>
<p>Functions can be defined anywhere and are visible in the block they are
declared in. Inside a function, you cannot access local variables
defined outside of that function. There is no explicit <code class="docutils literal"><span class="pre">return</span></code>
statement.</p>
<p>If you call a function that returns multiple values, you have to assign
them to a tuple using <code class="docutils literal"><span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code> or <code class="docutils literal"><span class="pre">let</span> <span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code>.</p>
<p>The following example implements the power function by square-and-multiply.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kd">function</span> <span class="nx">power</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">exponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">result</span> <span class="p">{</span>
        <span class="kr">switch</span> <span class="nx">exponent</span>
        <span class="kr">case</span> <span class="mi">0</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="mi">1</span> <span class="p">}</span>
        <span class="kr">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="nx">base</span> <span class="p">}</span>
        <span class="kr">default</span> <span class="p">{</span>
            <span class="nx">result</span> <span class="o">:=</span> <span class="nx">power</span><span class="p">(</span><span class="nx">mul</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">base</span><span class="p">),</span> <span class="nx">div</span><span class="p">(</span><span class="nx">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="kr">switch</span> <span class="nx">mod</span><span class="p">(</span><span class="nx">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="kr">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="things-to-avoid">
<h5>Things to Avoid<a class="headerlink" href="#things-to-avoid" title="Permalink to this headline">¶</a></h5>
<p>Inline assembly might have a quite high-level look, but it actually is extremely
low-level. Function calls, loops, ifs and switches are converted by simple
rewriting rules and after that, the only thing the assembler does for you is re-arranging
functional-style opcodes, managing jump labels, counting stack height for
variable access and removing stack slots for assembly-local variables when the end
of their block is reached. Especially for those two last cases, it is important
to know that the assembler only counts stack height from top to bottom, not
necessarily following control flow. Furthermore, operations like swap will only
swap the contents of the stack but not the location of variables.</p>
</div>
<div class="section" id="conventions-in-solidity">
<h5>Conventions in Solidity<a class="headerlink" href="#conventions-in-solidity" title="Permalink to this headline">¶</a></h5>
<p>In contrast to EVM assembly, Solidity knows types which are narrower than 256 bits,
e.g. <code class="docutils literal"><span class="pre">uint24</span></code>. In order to make them more efficient, most arithmetic operations just
treat them as 256-bit numbers and the higher-order bits are only cleaned at the
point where it is necessary, i.e. just shortly before they are written to memory
or before comparisons are performed. This means that if you access such a variable
from within inline assembly, you might have to manually clean the higher order bits
first.</p>
<p>Solidity manages memory in a very simple way: There is a “free memory pointer”
at position <code class="docutils literal"><span class="pre">0x40</span></code> in memory. If you want to allocate memory, just use the memory
from that point on and update the pointer accordingly.</p>
<p>The first 64 bytes of memory can be used as “scratch space” for short-term
allocation. The 32 bytes after the free memory pointer (i.e. starting at <code class="docutils literal"><span class="pre">0x60</span></code>)
is meant to be zero permanently and is used as the initial value for
empty dynamic memory arrays.</p>
<p>Elements in memory arrays in Solidity always occupy multiples of 32 bytes (yes, this is
even true for <code class="docutils literal"><span class="pre">byte[]</span></code>, but not for <code class="docutils literal"><span class="pre">bytes</span></code> and <code class="docutils literal"><span class="pre">string</span></code>). Multi-dimensional memory
arrays are pointers to memory arrays. The length of a dynamic array is stored at the
first slot of the array and then only the array elements follow.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Statically-sized memory arrays do not have a length field, but it will be added soon
to allow better convertibility between statically- and dynamically-sized arrays, so
please do not rely on that.</p>
</div>
</div>
</div>
<div class="section" id="standalone-assembly">
<h4>Standalone Assembly<a class="headerlink" href="#standalone-assembly" title="Permalink to this headline">¶</a></h4>
<p>The assembly language described as inline assembly above can also be used
standalone and in fact, the plan is to use it as an intermediate language
for the Solidity compiler. In this form, it tries to achieve several goals:</p>
<ol class="arabic simple">
<li>Programs written in it should be readable, even if the code is generated by a compiler from Solidity.</li>
<li>The translation from assembly to bytecode should contain as few “surprises” as possible.</li>
<li>Control flow should be easy to detect to help in formal verification and optimization.</li>
</ol>
<p>In order to achieve the first and last goal, assembly provides high-level constructs
like <code class="docutils literal"><span class="pre">for</span></code> loops, <code class="docutils literal"><span class="pre">if</span></code> and <code class="docutils literal"><span class="pre">switch</span></code> statements and function calls. It should be possible
to write assembly programs that do not make use of explicit <code class="docutils literal"><span class="pre">SWAP</span></code>, <code class="docutils literal"><span class="pre">DUP</span></code>,
<code class="docutils literal"><span class="pre">JUMP</span></code> and <code class="docutils literal"><span class="pre">JUMPI</span></code> statements, because the first two obfuscate the data flow
and the last two obfuscate control flow. Furthermore, functional statements of
the form <code class="docutils literal"><span class="pre">mul(add(x,</span> <span class="pre">y),</span> <span class="pre">7)</span></code> are preferred over pure opcode statements like
<code class="docutils literal"><span class="pre">7</span> <span class="pre">y</span> <span class="pre">x</span> <span class="pre">add</span> <span class="pre">mul</span></code> because in the first form, it is much easier to see which
operand is used for which opcode.</p>
<p>The second goal is achieved by compiling the
higher level constructs to bytecode in a very regular way.
The only non-local operation performed
by the assembler is name lookup of user-defined identifiers (functions, variables, …),
which follow very simple and regular scoping rules and cleanup of local variables from the stack.</p>
<p>Scoping: An identifier that is declared (label, variable, function, assembly)
is only visible in the block where it was declared (including nested blocks
inside the current block). It is not legal to access local variables across
function borders, even if they would be in scope. Shadowing is not allowed.
Local variables cannot be accessed before they were declared, but labels,
functions and assemblies can. Assemblies are special blocks that are used
for e.g. returning runtime code or creating contracts. No identifier from an
outer assembly is visible in a sub-assembly.</p>
<p>If control flow passes over the end of a block, pop instructions are inserted
that match the number of local variables declared in that block.
Whenever a local variable is referenced, the code generator needs
to know its current relative position in the stack and thus it needs to
keep track of the current so-called stack height. Since all local variables
are removed at the end of a block, the stack height before and after the block
should be the same. If this is not the case, a warning is issued.</p>
<p>Using <code class="docutils literal"><span class="pre">switch</span></code>, <code class="docutils literal"><span class="pre">for</span></code> and functions, it should be possible to write
complex code without using <code class="docutils literal"><span class="pre">jump</span></code> or <code class="docutils literal"><span class="pre">jumpi</span></code> manually. This makes it much
easier to analyze the control flow, which allows for improved formal
verification and optimization.</p>
<p>Furthermore, if manual jumps are allowed, computing the stack height is rather complicated.
The position of all local variables on the stack needs to be known, otherwise
neither references to local variables nor removing local variables automatically
from the stack at the end of a block will work properly.</p>
<p>Example:</p>
<p>We will follow an example compilation from Solidity to assembly.
We consider the runtime bytecode of the following Solidity program:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following assembly will be generated:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">)</span> <span class="c1">// store the &quot;free memory pointer&quot;</span>
  <span class="c1">// function dispatcher</span>
  <span class="kr">switch</span> <span class="nx">div</span><span class="p">(</span><span class="nx">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">exp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">226</span><span class="p">))</span>
  <span class="kr">case</span> <span class="mh">0xb3de648b</span> <span class="p">{</span>
    <span class="kr">let</span> <span class="nx">r</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">(</span><span class="nx">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="kr">let</span> <span class="nx">ret</span> <span class="o">:=</span> <span class="nx">$allocate</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="nx">ret</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="kr">default</span> <span class="p">{</span> <span class="nb">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
  <span class="c1">// memory allocator</span>
  <span class="kd">function</span> <span class="nx">$allocate</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">pos</span> <span class="p">{</span>
    <span class="nx">pos</span> <span class="o">:=</span> <span class="nx">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
    <span class="nx">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">size</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="c1">// the contract function</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">y</span> <span class="p">{</span>
    <span class="nx">y</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="p">{</span> <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span> <span class="p">{</span>
      <span class="nx">y</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="assembly-grammar">
<h5>Assembly Grammar<a class="headerlink" href="#assembly-grammar" title="Permalink to this headline">¶</a></h5>
<p>The tasks of the parser are the following:</p>
<ul class="simple">
<li>Turn the byte stream into a token stream, discarding C++-style comments
(a special comment exists for source references, but we will not explain it here).</li>
<li>Turn the token stream into an AST according to the grammar below</li>
<li>Register identifiers with the block they are defined in (annotation to the
AST node) and note from which point on, variables can be accessed.</li>
</ul>
<p>The assembly lexer follows the one defined by Solidity itself.</p>
<p>Whitespace is used to delimit tokens and it consists of the characters
Space, Tab and Linefeed. Comments are regular JavaScript/C++ comments and
are interpreted in the same way as Whitespace.</p>
<p>Grammar:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">AssemblyBlock</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="nx">AssemblyItem</span><span class="o">*</span> <span class="s1">&#39;}&#39;</span>
<span class="nx">AssemblyItem</span> <span class="o">=</span>
    <span class="nx">Identifier</span> <span class="o">|</span>
    <span class="nx">AssemblyBlock</span> <span class="o">|</span>
    <span class="nx">AssemblyExpression</span> <span class="o">|</span>
    <span class="nx">AssemblyLocalDefinition</span> <span class="o">|</span>
    <span class="nx">AssemblyAssignment</span> <span class="o">|</span>
    <span class="nx">AssemblyStackAssignment</span> <span class="o">|</span>
    <span class="nx">LabelDefinition</span> <span class="o">|</span>
    <span class="nx">AssemblyIf</span> <span class="o">|</span>
    <span class="nx">AssemblySwitch</span> <span class="o">|</span>
    <span class="nx">AssemblyFunctionDefinition</span> <span class="o">|</span>
    <span class="nx">AssemblyFor</span> <span class="o">|</span>
    <span class="s1">&#39;break&#39;</span> <span class="o">|</span>
    <span class="s1">&#39;continue&#39;</span> <span class="o">|</span>
    <span class="nx">SubAssembly</span>
<span class="nx">AssemblyExpression</span> <span class="o">=</span> <span class="nx">AssemblyCall</span> <span class="o">|</span> <span class="nx">Identifier</span> <span class="o">|</span> <span class="nx">AssemblyLiteral</span>
<span class="nx">AssemblyLiteral</span> <span class="o">=</span> <span class="nx">NumberLiteral</span> <span class="o">|</span> <span class="nx">StringLiteral</span> <span class="o">|</span> <span class="nx">HexLiteral</span>
<span class="nx">Identifier</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_$</span><span class="p">]</span> <span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span>
<span class="nx">AssemblyCall</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="s1">&#39;(&#39;</span> <span class="p">(</span> <span class="nx">AssemblyExpression</span> <span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="nx">AssemblyExpression</span> <span class="p">)</span><span class="o">*</span> <span class="p">)</span><span class="o">?</span> <span class="s1">&#39;)&#39;</span>
<span class="nx">AssemblyLocalDefinition</span> <span class="o">=</span> <span class="s1">&#39;let&#39;</span> <span class="nx">IdentifierOrList</span> <span class="p">(</span> <span class="s1">&#39;:=&#39;</span> <span class="nx">AssemblyExpression</span> <span class="p">)</span><span class="o">?</span>
<span class="nx">AssemblyAssignment</span> <span class="o">=</span> <span class="nx">IdentifierOrList</span> <span class="s1">&#39;:=&#39;</span> <span class="nx">AssemblyExpression</span>
<span class="nx">IdentifierOrList</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="o">|</span> <span class="s1">&#39;(&#39;</span> <span class="nx">IdentifierList</span> <span class="s1">&#39;)&#39;</span>
<span class="nx">IdentifierList</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="nx">Identifier</span><span class="p">)</span><span class="o">*</span>
<span class="nx">AssemblyStackAssignment</span> <span class="o">=</span> <span class="s1">&#39;=:&#39;</span> <span class="nx">Identifier</span>
<span class="nx">LabelDefinition</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="s1">&#39;:&#39;</span>
<span class="nx">AssemblyIf</span> <span class="o">=</span> <span class="s1">&#39;if&#39;</span> <span class="nx">AssemblyExpression</span> <span class="nx">AssemblyBlock</span>
<span class="nx">AssemblySwitch</span> <span class="o">=</span> <span class="s1">&#39;switch&#39;</span> <span class="nx">AssemblyExpression</span> <span class="nx">AssemblyCase</span><span class="o">*</span>
    <span class="p">(</span> <span class="s1">&#39;default&#39;</span> <span class="nx">AssemblyBlock</span> <span class="p">)</span><span class="o">?</span>
<span class="nx">AssemblyCase</span> <span class="o">=</span> <span class="s1">&#39;case&#39;</span> <span class="nx">AssemblyExpression</span> <span class="nx">AssemblyBlock</span>
<span class="nx">AssemblyFunctionDefinition</span> <span class="o">=</span> <span class="s1">&#39;function&#39;</span> <span class="nx">Identifier</span> <span class="s1">&#39;(&#39;</span> <span class="nx">IdentifierList</span><span class="o">?</span> <span class="s1">&#39;)&#39;</span>
    <span class="p">(</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="s1">&#39;(&#39;</span> <span class="nx">IdentifierList</span> <span class="s1">&#39;)&#39;</span> <span class="p">)</span><span class="o">?</span> <span class="nx">AssemblyBlock</span>
<span class="nx">AssemblyFor</span> <span class="o">=</span> <span class="s1">&#39;for&#39;</span> <span class="p">(</span> <span class="nx">AssemblyBlock</span> <span class="o">|</span> <span class="nx">AssemblyExpression</span> <span class="p">)</span>
    <span class="nx">AssemblyExpression</span> <span class="p">(</span> <span class="nx">AssemblyBlock</span> <span class="o">|</span> <span class="nx">AssemblyExpression</span> <span class="p">)</span> <span class="nx">AssemblyBlock</span>
<span class="nx">SubAssembly</span> <span class="o">=</span> <span class="s1">&#39;assembly&#39;</span> <span class="nx">Identifier</span> <span class="nx">AssemblyBlock</span>
<span class="nx">NumberLiteral</span> <span class="o">=</span> <span class="nx">HexNumber</span> <span class="o">|</span> <span class="nx">DecimalNumber</span>
<span class="nx">HexLiteral</span> <span class="o">=</span> <span class="s1">&#39;hex&#39;</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">|</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">)</span>
<span class="nx">StringLiteral</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="o">^</span><span class="s2">&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;</span><span class="s1">&#39;</span>
<span class="s1">HexNumber = &#39;</span><span class="mi">0</span><span class="nx">x</span><span class="err">&#39;</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]</span><span class="o">+</span>
<span class="nx">DecimalNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-miscellaneous"></span><div class="section" id="miscellaneous">
<h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h3>
<div class="section" id="layout-of-state-variables-in-storage">
<span id="index-0"></span><h4>Layout of State Variables in Storage<a class="headerlink" href="#layout-of-state-variables-in-storage" title="Permalink to this headline">¶</a></h4>
<p>Statically-sized variables (everything except mapping and dynamically-sized array types) are laid out contiguously in storage starting from position <code class="docutils literal"><span class="pre">0</span></code>. Multiple items that need less than 32 bytes are packed into a single storage slot if possible, according to the following rules:</p>
<ul class="simple">
<li>The first item in a storage slot is stored lower-order aligned.</li>
<li>Elementary types use only that many bytes that are necessary to store them.</li>
<li>If an elementary type does not fit the remaining part of a storage slot, it is moved to the next storage slot.</li>
<li>Structs and array data always start a new slot and occupy whole slots (but items inside a struct or array are packed tightly according to these rules).</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When using elements that are smaller than 32 bytes, your contract’s gas usage may be higher.
This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller
than that, the EVM must use more operations in order to reduce the size of the element from 32
bytes to the desired size.</p>
<p>It is only beneficial to use reduced-size arguments if you are dealing with storage values
because the compiler will pack multiple elements into one storage slot, and thus, combine
multiple reads or writes into a single operation. When dealing with function arguments or memory
values, there is no inherent benefit because the compiler does not pack these values.</p>
<p class="last">Finally, in order to allow the EVM to optimize for this, ensure that you try to order your
storage variables and <code class="docutils literal"><span class="pre">struct</span></code> members such that they can be packed tightly. For example,
declaring your storage variables in the order of <code class="docutils literal"><span class="pre">uint128,</span> <span class="pre">uint128,</span> <span class="pre">uint256</span></code> instead of
<code class="docutils literal"><span class="pre">uint128,</span> <span class="pre">uint256,</span> <span class="pre">uint128</span></code>, as the former will only take up two slots of storage whereas the
latter will take up three.</p>
</div>
<p>The elements of structs and arrays are stored after each other, just as if they were given explicitly.</p>
<p>Due to their unpredictable size, mapping and dynamically-sized array types use a Keccak-256 hash
computation to find the starting position of the value or the array data. These starting positions are always full stack slots.</p>
<p>The mapping or the dynamic array itself
occupies an (unfilled) slot in storage at some position <code class="docutils literal"><span class="pre">p</span></code> according to the above rule (or by
recursively applying this rule for mappings to mappings or arrays of arrays). For a dynamic array, this slot stores the number of elements in the array (byte arrays and strings are an exception here, see below). For a mapping, the slot is unused (but it is needed so that two equal mappings after each other will use a different hash distribution).
Array data is located at <code class="docutils literal"><span class="pre">keccak256(p)</span></code> and the value corresponding to a mapping key
<code class="docutils literal"><span class="pre">k</span></code> is located at <code class="docutils literal"><span class="pre">keccak256(k</span> <span class="pre">.</span> <span class="pre">p)</span></code> where <code class="docutils literal"><span class="pre">.</span></code> is concatenation. If the value is again a
non-elementary type, the positions are found by adding an offset of <code class="docutils literal"><span class="pre">keccak256(k</span> <span class="pre">.</span> <span class="pre">p)</span></code>.</p>
<p><code class="docutils literal"><span class="pre">bytes</span></code> and <code class="docutils literal"><span class="pre">string</span></code> store their data in the same slot where also the length is stored if they are short. In particular: If the data is at most <code class="docutils literal"><span class="pre">31</span></code> bytes long, it is stored in the higher-order bytes (left aligned) and the lowest-order byte stores <code class="docutils literal"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span></code>. If it is longer, the main slot stores <code class="docutils literal"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">1</span></code> and the data is stored as usual in <code class="docutils literal"><span class="pre">keccak256(slot)</span></code>.</p>
<p>So for the following contract snippet:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="nx">s</span> <span class="p">{</span> <span class="kt">uint</span> <span class="nx">a</span><span class="p">;</span> <span class="kt">uint</span> <span class="nx">b</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span>
  <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">))</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The position of <code class="docutils literal"><span class="pre">data[4][9].b</span></code> is at <code class="docutils literal"><span class="pre">keccak256(uint256(9)</span> <span class="pre">.</span> <span class="pre">keccak256(uint256(4)</span> <span class="pre">.</span> <span class="pre">uint256(1)))</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
</div>
<div class="section" id="layout-in-memory">
<h4>Layout in Memory<a class="headerlink" href="#layout-in-memory" title="Permalink to this headline">¶</a></h4>
<p>Solidity reserves four 32 byte slots:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">0x00</span></code> - <code class="docutils literal"><span class="pre">0x3f</span></code>: scratch space for hashing methods</li>
<li><code class="docutils literal"><span class="pre">0x40</span></code> - <code class="docutils literal"><span class="pre">0x5f</span></code>: currently allocated memory size (aka. free memory pointer)</li>
<li><code class="docutils literal"><span class="pre">0x60</span></code> - <code class="docutils literal"><span class="pre">0x7f</span></code>: zero slot</li>
</ul>
<p>Scratch space can be used between statements (ie. within inline assembly). The zero slot
is used as initial value for dynamic memory arrays and should never be written to
(the free memory pointer points to <code class="docutils literal"><span class="pre">0x80</span></code> initially).</p>
<p>Solidity always places new objects at the free memory pointer and memory is never freed (this might change in the future).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There are some operations in Solidity that need a temporary memory area larger than 64 bytes and therefore will not fit into the scratch space. They will be placed where the free memory points to, but given their short lifecycle, the pointer is not updated. The memory may or may not be zeroed out. Because of this, one shouldn’t expect the free memory to be zeroed out.</p>
</div>
</div>
<div class="section" id="layout-of-call-data">
<h4>Layout of Call Data<a class="headerlink" href="#layout-of-call-data" title="Permalink to this headline">¶</a></h4>
<p>When a Solidity contract is deployed and when it is called from an
account, the input data is assumed to be in the format in <a class="reference internal" href="index.html#abi"><span class="std std-ref">the ABI
specification</span></a>. The ABI specification requires arguments to be padded to multiples of 32
bytes.  The internal function calls use a different convention.</p>
</div>
<div class="section" id="internals-cleaning-up-variables">
<h4>Internals - Cleaning Up Variables<a class="headerlink" href="#internals-cleaning-up-variables" title="Permalink to this headline">¶</a></h4>
<p>When a value is shorter than 256-bit, in some cases the remaining bits
must be cleaned.
The Solidity compiler is designed to clean such remaining bits before any operations
that might be adversely affected by the potential garbage in the remaining bits.
For example, before writing a value to the memory, the remaining bits need
to be cleared because the memory contents can be used for computing
hashes or sent as the data of a message call.  Similarly, before
storing a value in the storage, the remaining bits need to be cleaned
because otherwise the garbled value can be observed.</p>
<p>On the other hand, we do not clean the bits if the immediately
following operation is not affected.  For instance, since any non-zero
value is considered <code class="docutils literal"><span class="pre">true</span></code> by <code class="docutils literal"><span class="pre">JUMPI</span></code> instruction, we do not clean
the boolean values before they are used as the condition for
<code class="docutils literal"><span class="pre">JUMPI</span></code>.</p>
<p>In addition to the design principle above, the Solidity compiler
cleans input data when it is loaded onto the stack.</p>
<p>Different types have different rules for cleaning up invalid values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="31%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Valid Values</th>
<th class="head">Invalid Values Mean</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>enum of n
members</td>
<td>0 until n - 1</td>
<td>exception</td>
</tr>
<tr class="row-odd"><td>bool</td>
<td>0 or 1</td>
<td>1</td>
</tr>
<tr class="row-even"><td>signed integers</td>
<td>sign-extended
word</td>
<td>currently silently
wraps; in the
future exceptions
will be thrown</td>
</tr>
<tr class="row-odd"><td>unsigned
integers</td>
<td>higher bits
zeroed</td>
<td>currently silently
wraps; in the
future exceptions
will be thrown</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="internals-the-optimizer">
<span id="index-1"></span><h4>Internals - The Optimizer<a class="headerlink" href="#internals-the-optimizer" title="Permalink to this headline">¶</a></h4>
<p>The Solidity optimizer operates on assembly, so it can be and also is used by other languages. It splits the sequence of instructions into basic blocks at <code class="docutils literal"><span class="pre">JUMPs</span></code> and <code class="docutils literal"><span class="pre">JUMPDESTs</span></code>. Inside these blocks, the instructions are analysed and every modification to the stack, to memory or storage is recorded as an expression which consists of an instruction and a list of arguments which are essentially pointers to other expressions. The main idea is now to find expressions that are always equal (on every input) and combine them into an expression class. The optimizer first tries to find each new expression in a list of already known expressions. If this does not work, the expression is simplified according to rules like <code class="docutils literal"><span class="pre">constant</span> <span class="pre">+</span> <span class="pre">constant</span> <span class="pre">=</span> <span class="pre">sum_of_constants</span></code> or <code class="docutils literal"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">1</span> <span class="pre">=</span> <span class="pre">X</span></code>. Since this is done recursively, we can also apply the latter rule if the second factor is a more complex expression where we know that it will always evaluate to one. Modifications to storage and memory locations have to erase knowledge about storage and memory locations which are not known to be different: If we first write to location x and then to location y and both are input variables, the second could overwrite the first, so we actually do not know what is stored at x after we wrote to y. On the other hand, if a simplification of the expression x - y evaluates to a non-zero constant, we know that we can keep our knowledge about what is stored at x.</p>
<p>At the end of this process, we know which expressions have to be on the stack in the end and have a list of modifications to memory and storage. This information is stored together with the basic blocks and is used to link them. Furthermore, knowledge about the stack, storage and memory configuration is forwarded to the next block(s). If we know the targets of all <code class="docutils literal"><span class="pre">JUMP</span></code> and <code class="docutils literal"><span class="pre">JUMPI</span></code> instructions, we can build a complete control flow graph of the program. If there is only one target we do not know (this can happen as in principle, jump targets can be computed from inputs), we have to erase all knowledge about the input state of a block as it can be the target of the unknown <code class="docutils literal"><span class="pre">JUMP</span></code>. If a <code class="docutils literal"><span class="pre">JUMPI</span></code> is found whose condition evaluates to a constant, it is transformed to an unconditional jump.</p>
<p>As the last step, the code in each block is completely re-generated. A dependency graph is created from the expressions on the stack at the end of the block and every operation that is not part of this graph is essentially dropped. Now code is generated that applies the modifications to memory and storage in the order they were made in the original code (dropping modifications which were found not to be needed) and finally, generates all values that are required to be on the stack in the correct place.</p>
<p>These steps are applied to each basic block and the newly generated code is used as replacement if it is smaller. If a basic block is split at a <code class="docutils literal"><span class="pre">JUMPI</span></code> and during the analysis, the condition evaluates to a constant, the <code class="docutils literal"><span class="pre">JUMPI</span></code> is replaced depending on the value of the constant, and thus code like</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nx">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">x</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">else</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>is simplified to code which can also be compiled from</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>even though the instructions contained a jump in the beginning.</p>
</div>
<div class="section" id="source-mappings">
<span id="index-2"></span><h4>Source Mappings<a class="headerlink" href="#source-mappings" title="Permalink to this headline">¶</a></h4>
<p>As part of the AST output, the compiler provides the range of the source
code that is represented by the respective node in the AST. This can be
used for various purposes ranging from static analysis tools that report
errors based on the AST and debugging tools that highlight local variables
and their uses.</p>
<p>Furthermore, the compiler can also generate a mapping from the bytecode
to the range in the source code that generated the instruction. This is again
important for static analysis tools that operate on bytecode level and
for displaying the current position in the source code inside a debugger
or for breakpoint handling.</p>
<p>Both kinds of source mappings use integer indentifiers to refer to source files.
These are regular array indices into a list of source files usually called
<code class="docutils literal"><span class="pre">&quot;sourceList&quot;</span></code>, which is part of the combined-json and the output of
the json / npm compiler.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the case of instructions that are not associated with any particular source file,
the source mapping assigns an integer identifier of <code class="docutils literal"><span class="pre">-1</span></code>. This may happen for
bytecode sections stemming from compiler-generated inline assembly statements.</p>
</div>
<p>The source mappings inside the AST use the following
notation:</p>
<p><code class="docutils literal"><span class="pre">s:l:f</span></code></p>
<p>Where <code class="docutils literal"><span class="pre">s</span></code> is the byte-offset to the start of the range in the source file,
<code class="docutils literal"><span class="pre">l</span></code> is the length of the source range in bytes and <code class="docutils literal"><span class="pre">f</span></code> is the source
index mentioned above.</p>
<p>The encoding in the source mapping for the bytecode is more complicated:
It is a list of <code class="docutils literal"><span class="pre">s:l:f:j</span></code> separated by <code class="docutils literal"><span class="pre">;</span></code>. Each of these
elements corresponds to an instruction, i.e. you cannot use the byte offset
but have to use the instruction offset (push instructions are longer than a single byte).
The fields <code class="docutils literal"><span class="pre">s</span></code>, <code class="docutils literal"><span class="pre">l</span></code> and <code class="docutils literal"><span class="pre">f</span></code> are as above and <code class="docutils literal"><span class="pre">j</span></code> can be either
<code class="docutils literal"><span class="pre">i</span></code>, <code class="docutils literal"><span class="pre">o</span></code> or <code class="docutils literal"><span class="pre">-</span></code> signifying whether a jump instruction goes into a
function, returns from a function or is a regular jump as part of e.g. a loop.</p>
<p>In order to compress these source mappings especially for bytecode, the
following rules are used:</p>
<blockquote>
<div><ul class="simple">
<li>If a field is empty, the value of the preceding element is used.</li>
<li>If a <code class="docutils literal"><span class="pre">:</span></code> is missing, all following fields are considered empty.</li>
</ul>
</div></blockquote>
<p>This means the following source mappings represent the same information:</p>
<p><code class="docutils literal"><span class="pre">1:2:1;1:9:1;2:1:2;2:1:2;2:1:2</span></code></p>
<p><code class="docutils literal"><span class="pre">1:2:1;:9;2:1:2;;</span></code></p>
</div>
<div class="section" id="tips-and-tricks">
<h4>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Use <code class="docutils literal"><span class="pre">delete</span></code> on arrays to delete all its elements.</li>
<li>Use shorter types for struct elements and sort them such that short types are grouped together. This can lower the gas costs as multiple <code class="docutils literal"><span class="pre">SSTORE</span></code> operations might be combined into a single (<code class="docutils literal"><span class="pre">SSTORE</span></code> costs 5000 or 20000 gas, so this is what you want to optimise). Use the gas price estimator (with optimiser enabled) to check!</li>
<li>Make your state variables public - the compiler will create <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getters</span></a> for you automatically.</li>
<li>If you end up checking conditions on input or state a lot at the beginning of your functions, try using <a class="reference internal" href="index.html#modifiers"><span class="std std-ref">Function Modifiers</span></a>.</li>
<li>If your contract has a function called <code class="docutils literal"><span class="pre">send</span></code> but you want to use the built-in send-function, use <code class="docutils literal"><span class="pre">address(contractVariable).send(amount)</span></code>.</li>
<li>Initialize storage structs with a single assignment: <code class="docutils literal"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">MyStruct({a:</span> <span class="pre">1,</span> <span class="pre">b:</span> <span class="pre">2});</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the storage struct has tightly packed properties, initialize it with separate assignments: <code class="docutils literal"><span class="pre">x.a</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">x.b</span> <span class="pre">=</span> <span class="pre">2;</span></code>. In this way it will be easier for the optimizer to update storage in one go, thus making assignment cheaper.</p>
</div>
</div>
<div class="section" id="cheatsheet">
<h4>Cheatsheet<a class="headerlink" href="#cheatsheet" title="Permalink to this headline">¶</a></h4>
<div class="section" id="order-of-precedence-of-operators">
<span id="order"></span><span id="index-3"></span><h5>Order of Precedence of Operators<a class="headerlink" href="#order-of-precedence-of-operators" title="Permalink to this headline">¶</a></h5>
<p>The following is the order of precedence for operators, listed in order of evaluation.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="40%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Precedence</th>
<th class="head">Description</th>
<th class="head">Operator</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="6"><em>1</em></td>
<td>Postfix increment and decrement</td>
<td><code class="docutils literal"><span class="pre">++</span></code>, <code class="docutils literal"><span class="pre">--</span></code></td>
</tr>
<tr class="row-odd"><td>New expression</td>
<td><code class="docutils literal"><span class="pre">new</span> <span class="pre">&lt;typename&gt;</span></code></td>
</tr>
<tr class="row-even"><td>Array subscripting</td>
<td><code class="docutils literal"><span class="pre">&lt;array&gt;[&lt;index&gt;]</span></code></td>
</tr>
<tr class="row-odd"><td>Member access</td>
<td><code class="docutils literal"><span class="pre">&lt;object&gt;.&lt;member&gt;</span></code></td>
</tr>
<tr class="row-even"><td>Function-like call</td>
<td><code class="docutils literal"><span class="pre">&lt;func&gt;(&lt;args...&gt;)</span></code></td>
</tr>
<tr class="row-odd"><td>Parentheses</td>
<td><code class="docutils literal"><span class="pre">(&lt;statement&gt;)</span></code></td>
</tr>
<tr class="row-even"><td rowspan="5"><em>2</em></td>
<td>Prefix increment and decrement</td>
<td><code class="docutils literal"><span class="pre">++</span></code>, <code class="docutils literal"><span class="pre">--</span></code></td>
</tr>
<tr class="row-odd"><td>Unary plus and minus</td>
<td><code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code></td>
</tr>
<tr class="row-even"><td>Unary operations</td>
<td><code class="docutils literal"><span class="pre">delete</span></code></td>
</tr>
<tr class="row-odd"><td>Logical NOT</td>
<td><code class="docutils literal"><span class="pre">!</span></code></td>
</tr>
<tr class="row-even"><td>Bitwise NOT</td>
<td><code class="docutils literal"><span class="pre">~</span></code></td>
</tr>
<tr class="row-odd"><td><em>3</em></td>
<td>Exponentiation</td>
<td><code class="docutils literal"><span class="pre">**</span></code></td>
</tr>
<tr class="row-even"><td><em>4</em></td>
<td>Multiplication, division and modulo</td>
<td><code class="docutils literal"><span class="pre">*</span></code>, <code class="docutils literal"><span class="pre">/</span></code>, <code class="docutils literal"><span class="pre">%</span></code></td>
</tr>
<tr class="row-odd"><td><em>5</em></td>
<td>Addition and subtraction</td>
<td><code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code></td>
</tr>
<tr class="row-even"><td><em>6</em></td>
<td>Bitwise shift operators</td>
<td><code class="docutils literal"><span class="pre">&lt;&lt;</span></code>, <code class="docutils literal"><span class="pre">&gt;&gt;</span></code></td>
</tr>
<tr class="row-odd"><td><em>7</em></td>
<td>Bitwise AND</td>
<td><code class="docutils literal"><span class="pre">&amp;</span></code></td>
</tr>
<tr class="row-even"><td><em>8</em></td>
<td>Bitwise XOR</td>
<td><code class="docutils literal"><span class="pre">^</span></code></td>
</tr>
<tr class="row-odd"><td><em>9</em></td>
<td>Bitwise OR</td>
<td><code class="docutils literal"><span class="pre">|</span></code></td>
</tr>
<tr class="row-even"><td><em>10</em></td>
<td>Inequality operators</td>
<td><code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code></td>
</tr>
<tr class="row-odd"><td><em>11</em></td>
<td>Equality operators</td>
<td><code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code></td>
</tr>
<tr class="row-even"><td><em>12</em></td>
<td>Logical AND</td>
<td><code class="docutils literal"><span class="pre">&amp;&amp;</span></code></td>
</tr>
<tr class="row-odd"><td><em>13</em></td>
<td>Logical OR</td>
<td><code class="docutils literal"><span class="pre">||</span></code></td>
</tr>
<tr class="row-even"><td><em>14</em></td>
<td>Ternary operator</td>
<td><code class="docutils literal"><span class="pre">&lt;conditional&gt;</span> <span class="pre">?</span> <span class="pre">&lt;if-true&gt;</span> <span class="pre">:</span> <span class="pre">&lt;if-false&gt;</span></code></td>
</tr>
<tr class="row-odd"><td><em>15</em></td>
<td>Assignment operators</td>
<td><code class="docutils literal"><span class="pre">=</span></code>, <code class="docutils literal"><span class="pre">|=</span></code>, <code class="docutils literal"><span class="pre">^=</span></code>, <code class="docutils literal"><span class="pre">&amp;=</span></code>, <code class="docutils literal"><span class="pre">&lt;&lt;=</span></code>,
<code class="docutils literal"><span class="pre">&gt;&gt;=</span></code>, <code class="docutils literal"><span class="pre">+=</span></code>, <code class="docutils literal"><span class="pre">-=</span></code>, <code class="docutils literal"><span class="pre">*=</span></code>, <code class="docutils literal"><span class="pre">/=</span></code>,
<code class="docutils literal"><span class="pre">%=</span></code></td>
</tr>
<tr class="row-even"><td><em>16</em></td>
<td>Comma operator</td>
<td><code class="docutils literal"><span class="pre">,</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="global-variables">
<span id="index-4"></span><h5>Global Variables<a class="headerlink" href="#global-variables" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">abi.encode(...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-encodes the given arguments</li>
<li><code class="docutils literal"><span class="pre">abi.encodePacked(...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: Performes <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">packed encoding</span></a> of the given arguments</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">abi.encodeWithSelector(bytes4</span> <span class="pre">selector,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-encodes the given arguments</dt>
<dd>starting from the second and prepends the given four-byte selector</dd>
</dl>
</li>
<li><code class="docutils literal"><span class="pre">abi.encodeWithSignature(string</span> <span class="pre">signature,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes)</span></code>: Equivalent to <code class="docutils literal"><span class="pre">abi.encodeWithSelector(bytes4(keccak256(signature),</span> <span class="pre">...)`</span></code></li>
<li><code class="docutils literal"><span class="pre">block.blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block - only works for 256 most recent, excluding current, blocks - deprecated in version 0.4.22 and replaced by <code class="docutils literal"><span class="pre">blockhash(uint</span> <span class="pre">blockNumber)</span></code>.</li>
<li><code class="docutils literal"><span class="pre">block.coinbase</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): current block miner’s address</li>
<li><code class="docutils literal"><span class="pre">block.difficulty</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block difficulty</li>
<li><code class="docutils literal"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block gaslimit</li>
<li><code class="docutils literal"><span class="pre">block.number</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block number</li>
<li><code class="docutils literal"><span class="pre">block.timestamp</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block timestamp</li>
<li><code class="docutils literal"><span class="pre">gasleft()</span> <span class="pre">returns</span> <span class="pre">(uint256)</span></code>: remaining gas</li>
<li><code class="docutils literal"><span class="pre">msg.data</span></code> (<code class="docutils literal"><span class="pre">bytes</span></code>): complete calldata</li>
<li><code class="docutils literal"><span class="pre">msg.gas</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): remaining gas - deprecated in version 0.4.21 and to be replaced by <code class="docutils literal"><span class="pre">gasleft()</span></code></li>
<li><code class="docutils literal"><span class="pre">msg.sender</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): sender of the message (current call)</li>
<li><code class="docutils literal"><span class="pre">msg.value</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): number of wei sent with the message</li>
<li><code class="docutils literal"><span class="pre">now</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): current block timestamp (alias for <code class="docutils literal"><span class="pre">block.timestamp</span></code>)</li>
<li><code class="docutils literal"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal"><span class="pre">uint</span></code>): gas price of the transaction</li>
<li><code class="docutils literal"><span class="pre">tx.origin</span></code> (<code class="docutils literal"><span class="pre">address</span></code>): sender of the transaction (full call chain)</li>
<li><code class="docutils literal"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal"><span class="pre">false</span></code> (use for internal error)</li>
<li><code class="docutils literal"><span class="pre">require(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal"><span class="pre">false</span></code> (use for malformed input or error in external component)</li>
<li><code class="docutils literal"><span class="pre">require(bool</span> <span class="pre">condition,</span> <span class="pre">string</span> <span class="pre">message)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal"><span class="pre">false</span></code> (use for malformed input or error in external component). Also provide error message.</li>
<li><code class="docutils literal"><span class="pre">revert()</span></code>: abort execution and revert state changes</li>
<li><code class="docutils literal"><span class="pre">revert(string</span> <span class="pre">message)</span></code>: abort execution and revert state changes providing an explanatory string</li>
<li><code class="docutils literal"><span class="pre">blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block - only works for 256 most recent blocks</li>
<li><code class="docutils literal"><span class="pre">keccak256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the Ethereum-SHA-3 (Keccak-256) hash of the <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">(tightly packed) arguments</span></a></li>
<li><code class="docutils literal"><span class="pre">sha3(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: an alias to <code class="docutils literal"><span class="pre">keccak256</span></code></li>
<li><code class="docutils literal"><span class="pre">sha256(...)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the SHA-256 hash of the <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">(tightly packed) arguments</span></a></li>
<li><code class="docutils literal"><span class="pre">ripemd160(...)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code>: compute the RIPEMD-160 hash of the <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">(tightly packed) arguments</span></a></li>
<li><code class="docutils literal"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns</span> <span class="pre">(address)</span></code>: recover address associated with the public key from elliptic curve signature, return zero on error</li>
<li><code class="docutils literal"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the addition is performed with arbitrary precision and does not wrap around at <code class="docutils literal"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</li>
<li><code class="docutils literal"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the multiplication is performed with arbitrary precision and does not wrap around at <code class="docutils literal"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</li>
<li><code class="docutils literal"><span class="pre">this</span></code> (current contract’s type): the current contract, explicitly convertible to <code class="docutils literal"><span class="pre">address</span></code></li>
<li><code class="docutils literal"><span class="pre">super</span></code>: the contract one level higher in the inheritance hierarchy</li>
<li><code class="docutils literal"><span class="pre">selfdestruct(address</span> <span class="pre">recipient)</span></code>: destroy the current contract, sending its funds to the given address</li>
<li><code class="docutils literal"><span class="pre">suicide(address</span> <span class="pre">recipient)</span></code>: a deprecated alias to <code class="docutils literal"><span class="pre">selfdestruct</span></code></li>
<li><code class="docutils literal"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal"><span class="pre">uint256</span></code>): balance of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</li>
<li><code class="docutils literal"><span class="pre">&lt;address&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, returns <code class="docutils literal"><span class="pre">false</span></code> on failure</li>
<li><code class="docutils literal"><span class="pre">&lt;address&gt;.transfer(uint256</span> <span class="pre">amount)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, throws on failure</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Do not rely on <code class="docutils literal"><span class="pre">block.timestamp</span></code>, <code class="docutils literal"><span class="pre">now</span></code> and <code class="docutils literal"><span class="pre">blockhash</span></code> as a source of randomness,
unless you know what you are doing.</p>
<p>Both the timestamp and the block hash can be influenced by miners to some degree.
Bad actors in the mining community can for example run a casino payout function on a chosen hash
and just retry a different hash if they did not receive any money.</p>
<p class="last">The current block timestamp must be strictly larger than the timestamp of the last block,
but the only guarantee is that it will be somewhere between the timestamps of two
consecutive blocks in the canonical chain.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The block hashes are not available for all blocks for scalability reasons.
You can only access the hashes of the most recent 256 blocks, all other
values will be zero.</p>
</div>
</div>
<div class="section" id="function-visibility-specifiers">
<span id="index-5"></span><h5>Function Visibility Specifiers<a class="headerlink" href="#function-visibility-specifiers" title="Permalink to this headline">¶</a></h5>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">myFunction</span><span class="p">()</span> <span class="o">&lt;</span><span class="nx">visibility</span> <span class="nx">specifier</span><span class="o">&gt;</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">public</span></code>: visible externally and internally (creates a <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a> for storage/state variables)</li>
<li><code class="docutils literal"><span class="pre">private</span></code>: only visible in the current contract</li>
<li><code class="docutils literal"><span class="pre">external</span></code>: only visible externally (only for functions) - i.e. can only be message-called (via <code class="docutils literal"><span class="pre">this.func</span></code>)</li>
<li><code class="docutils literal"><span class="pre">internal</span></code>: only visible internally</li>
</ul>
</div>
<div class="section" id="modifiers">
<span id="index-6"></span><h5>Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pure</span></code> for functions: Disallows modification or access of state - this is not enforced yet.</li>
<li><code class="docutils literal"><span class="pre">view</span></code> for functions: Disallows modification of state - this is not enforced yet.</li>
<li><code class="docutils literal"><span class="pre">payable</span></code> for functions: Allows them to receive Ether together with a call.</li>
<li><code class="docutils literal"><span class="pre">constant</span></code> for state variables: Disallows assignment (except initialisation), does not occupy storage slot.</li>
<li><code class="docutils literal"><span class="pre">constant</span></code> for functions: Same as <code class="docutils literal"><span class="pre">view</span></code>.</li>
<li><code class="docutils literal"><span class="pre">anonymous</span></code> for events: Does not store event signature as topic.</li>
<li><code class="docutils literal"><span class="pre">indexed</span></code> for event parameters: Stores the parameter as topic.</li>
</ul>
</div>
<div class="section" id="reserved-keywords">
<h5>Reserved Keywords<a class="headerlink" href="#reserved-keywords" title="Permalink to this headline">¶</a></h5>
<p>These keywords are reserved in Solidity. They might become part of the syntax in the future:</p>
<p><code class="docutils literal"><span class="pre">abstract</span></code>, <code class="docutils literal"><span class="pre">after</span></code>, <code class="docutils literal"><span class="pre">case</span></code>, <code class="docutils literal"><span class="pre">catch</span></code>, <code class="docutils literal"><span class="pre">default</span></code>, <code class="docutils literal"><span class="pre">final</span></code>, <code class="docutils literal"><span class="pre">in</span></code>, <code class="docutils literal"><span class="pre">inline</span></code>, <code class="docutils literal"><span class="pre">let</span></code>, <code class="docutils literal"><span class="pre">match</span></code>, <code class="docutils literal"><span class="pre">null</span></code>,
<code class="docutils literal"><span class="pre">of</span></code>, <code class="docutils literal"><span class="pre">relocatable</span></code>, <code class="docutils literal"><span class="pre">static</span></code>, <code class="docutils literal"><span class="pre">switch</span></code>, <code class="docutils literal"><span class="pre">try</span></code>, <code class="docutils literal"><span class="pre">type</span></code>, <code class="docutils literal"><span class="pre">typeof</span></code>.</p>
</div>
<div class="section" id="language-grammar">
<h5>Language Grammar<a class="headerlink" href="#language-grammar" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none"><div class="highlight"><pre><span></span>SourceUnit = (PragmaDirective | ImportDirective | ContractDefinition)*

// Pragma actually parses anything up to the trailing &#39;;&#39; to be fully forward-compatible.
PragmaDirective = &#39;pragma&#39; Identifier ([^;]+) &#39;;&#39;

ImportDirective = &#39;import&#39; StringLiteral (&#39;as&#39; Identifier)? &#39;;&#39;
        | &#39;import&#39; (&#39;*&#39; | Identifier) (&#39;as&#39; Identifier)? &#39;from&#39; StringLiteral &#39;;&#39;
        | &#39;import&#39; &#39;{&#39; Identifier (&#39;as&#39; Identifier)? ( &#39;,&#39; Identifier (&#39;as&#39; Identifier)? )* &#39;}&#39; &#39;from&#39; StringLiteral &#39;;&#39;

ContractDefinition = ( &#39;contract&#39; | &#39;library&#39; | &#39;interface&#39; ) Identifier
                     ( &#39;is&#39; InheritanceSpecifier (&#39;,&#39; InheritanceSpecifier )* )?
                     &#39;{&#39; ContractPart* &#39;}&#39;

ContractPart = StateVariableDeclaration | UsingForDeclaration
             | StructDefinition | ModifierDefinition | FunctionDefinition | EventDefinition | EnumDefinition

InheritanceSpecifier = UserDefinedTypeName ( &#39;(&#39; Expression ( &#39;,&#39; Expression )* &#39;)&#39; )?

StateVariableDeclaration = TypeName ( &#39;public&#39; | &#39;internal&#39; | &#39;private&#39; | &#39;constant&#39; )* Identifier (&#39;=&#39; Expression)? &#39;;&#39;
UsingForDeclaration = &#39;using&#39; Identifier &#39;for&#39; (&#39;*&#39; | TypeName) &#39;;&#39;
StructDefinition = &#39;struct&#39; Identifier &#39;{&#39;
                     ( VariableDeclaration &#39;;&#39; (VariableDeclaration &#39;;&#39;)* ) &#39;}&#39;

ModifierDefinition = &#39;modifier&#39; Identifier ParameterList? Block
ModifierInvocation = Identifier ( &#39;(&#39; ExpressionList? &#39;)&#39; )?

FunctionDefinition = &#39;function&#39; Identifier? ParameterList
                     ( ModifierInvocation | StateMutability | &#39;external&#39; | &#39;public&#39; | &#39;internal&#39; | &#39;private&#39; )*
                     ( &#39;returns&#39; ParameterList )? ( &#39;;&#39; | Block )
EventDefinition = &#39;event&#39; Identifier EventParameterList &#39;anonymous&#39;? &#39;;&#39;

EnumValue = Identifier
EnumDefinition = &#39;enum&#39; Identifier &#39;{&#39; EnumValue? (&#39;,&#39; EnumValue)* &#39;}&#39;

ParameterList = &#39;(&#39; ( Parameter (&#39;,&#39; Parameter)* )? &#39;)&#39;
Parameter = TypeName StorageLocation? Identifier?

EventParameterList = &#39;(&#39; ( EventParameter (&#39;,&#39; EventParameter )* )? &#39;)&#39;
EventParameter = TypeName &#39;indexed&#39;? Identifier?

FunctionTypeParameterList = &#39;(&#39; ( FunctionTypeParameter (&#39;,&#39; FunctionTypeParameter )* )? &#39;)&#39;
FunctionTypeParameter = TypeName StorageLocation?

// semantic restriction: mappings and structs (recursively) containing mappings
// are not allowed in argument lists
VariableDeclaration = TypeName StorageLocation? Identifier

TypeName = ElementaryTypeName
         | UserDefinedTypeName
         | Mapping
         | ArrayTypeName
         | FunctionTypeName

UserDefinedTypeName = Identifier ( &#39;.&#39; Identifier )*

Mapping = &#39;mapping&#39; &#39;(&#39; ElementaryTypeName &#39;=&gt;&#39; TypeName &#39;)&#39;
ArrayTypeName = TypeName &#39;[&#39; Expression? &#39;]&#39;
FunctionTypeName = &#39;function&#39; FunctionTypeParameterList ( &#39;internal&#39; | &#39;external&#39; | StateMutability )*
                   ( &#39;returns&#39; FunctionTypeParameterList )?
StorageLocation = &#39;memory&#39; | &#39;storage&#39;
StateMutability = &#39;pure&#39; | &#39;constant&#39; | &#39;view&#39; | &#39;payable&#39;

Block = &#39;{&#39; Statement* &#39;}&#39;
Statement = IfStatement | WhileStatement | ForStatement | Block | InlineAssemblyStatement |
            ( DoWhileStatement | PlaceholderStatement | Continue | Break | Return |
              Throw | EmitStatement | SimpleStatement ) &#39;;&#39;

ExpressionStatement = Expression
IfStatement = &#39;if&#39; &#39;(&#39; Expression &#39;)&#39; Statement ( &#39;else&#39; Statement )?
WhileStatement = &#39;while&#39; &#39;(&#39; Expression &#39;)&#39; Statement
PlaceholderStatement = &#39;_&#39;
SimpleStatement = VariableDefinition | ExpressionStatement
ForStatement = &#39;for&#39; &#39;(&#39; (SimpleStatement)? &#39;;&#39; (Expression)? &#39;;&#39; (ExpressionStatement)? &#39;)&#39; Statement
InlineAssemblyStatement = &#39;assembly&#39; StringLiteral? InlineAssemblyBlock
DoWhileStatement = &#39;do&#39; Statement &#39;while&#39; &#39;(&#39; Expression &#39;)&#39;
Continue = &#39;continue&#39;
Break = &#39;break&#39;
Return = &#39;return&#39; Expression?
Throw = &#39;throw&#39;
EmitStatement = &#39;emit&#39; FunctionCall
VariableDefinition = (&#39;var&#39; IdentifierList | VariableDeclaration) ( &#39;=&#39; Expression )?
IdentifierList = &#39;(&#39; ( Identifier? &#39;,&#39; )* Identifier? &#39;)&#39;

// Precedence by order (see github.com/ethereum/solidity/pull/732)
Expression
  = Expression (&#39;++&#39; | &#39;--&#39;)
  | NewExpression
  | IndexAccess
  | MemberAccess
  | FunctionCall
  | &#39;(&#39; Expression &#39;)&#39;
  | (&#39;!&#39; | &#39;~&#39; | &#39;delete&#39; | &#39;++&#39; | &#39;--&#39; | &#39;+&#39; | &#39;-&#39;) Expression
  | Expression &#39;**&#39; Expression
  | Expression (&#39;*&#39; | &#39;/&#39; | &#39;%&#39;) Expression
  | Expression (&#39;+&#39; | &#39;-&#39;) Expression
  | Expression (&#39;&lt;&lt;&#39; | &#39;&gt;&gt;&#39;) Expression
  | Expression &#39;&amp;&#39; Expression
  | Expression &#39;^&#39; Expression
  | Expression &#39;|&#39; Expression
  | Expression (&#39;&lt;&#39; | &#39;&gt;&#39; | &#39;&lt;=&#39; | &#39;&gt;=&#39;) Expression
  | Expression (&#39;==&#39; | &#39;!=&#39;) Expression
  | Expression &#39;&amp;&amp;&#39; Expression
  | Expression &#39;||&#39; Expression
  | Expression &#39;?&#39; Expression &#39;:&#39; Expression
  | Expression (&#39;=&#39; | &#39;|=&#39; | &#39;^=&#39; | &#39;&amp;=&#39; | &#39;&lt;&lt;=&#39; | &#39;&gt;&gt;=&#39; | &#39;+=&#39; | &#39;-=&#39; | &#39;*=&#39; | &#39;/=&#39; | &#39;%=&#39;) Expression
  | PrimaryExpression

PrimaryExpression = BooleanLiteral
                  | NumberLiteral
                  | HexLiteral
                  | StringLiteral
                  | TupleExpression
                  | Identifier
                  | ElementaryTypeNameExpression

ExpressionList = Expression ( &#39;,&#39; Expression )*
NameValueList = Identifier &#39;:&#39; Expression ( &#39;,&#39; Identifier &#39;:&#39; Expression )*

FunctionCall = Expression &#39;(&#39; FunctionCallArguments &#39;)&#39;
FunctionCallArguments = &#39;{&#39; NameValueList? &#39;}&#39;
                      | ExpressionList?

NewExpression = &#39;new&#39; TypeName
MemberAccess = Expression &#39;.&#39; Identifier
IndexAccess = Expression &#39;[&#39; Expression? &#39;]&#39;

BooleanLiteral = &#39;true&#39; | &#39;false&#39;
NumberLiteral = ( HexNumber | DecimalNumber ) (&#39; &#39; NumberUnit)?
NumberUnit = &#39;wei&#39; | &#39;szabo&#39; | &#39;finney&#39; | &#39;ether&#39;
           | &#39;seconds&#39; | &#39;minutes&#39; | &#39;hours&#39; | &#39;days&#39; | &#39;weeks&#39; | &#39;years&#39;
HexLiteral = &#39;hex&#39; (&#39;&quot;&#39; ([0-9a-fA-F]{2})* &#39;&quot;&#39; | &#39;\&#39;&#39; ([0-9a-fA-F]{2})* &#39;\&#39;&#39;)
StringLiteral = &#39;&quot;&#39; ([^&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;&#39;
Identifier = [a-zA-Z_$] [a-zA-Z_$0-9]*

HexNumber = &#39;0x&#39; [0-9a-fA-F]+
DecimalNumber = [0-9]+ ( &#39;.&#39; [0-9]* )? ( [eE] [0-9]+ )?

TupleExpression = &#39;(&#39; ( Expression? ( &#39;,&#39; Expression? )*  )? &#39;)&#39;
                | &#39;[&#39; ( Expression  ( &#39;,&#39; Expression  )*  )? &#39;]&#39;

ElementaryTypeNameExpression = ElementaryTypeName

ElementaryTypeName = &#39;address&#39; | &#39;bool&#39; | &#39;string&#39; | &#39;var&#39;
                   | Int | Uint | Byte | Fixed | Ufixed

Int = &#39;int&#39; | &#39;int8&#39; | &#39;int16&#39; | &#39;int24&#39; | &#39;int32&#39; | &#39;int40&#39; | &#39;int48&#39; | &#39;int56&#39; | &#39;int64&#39; | &#39;int72&#39; | &#39;int80&#39; | &#39;int88&#39; | &#39;int96&#39; | &#39;int104&#39; | &#39;int112&#39; | &#39;int120&#39; | &#39;int128&#39; | &#39;int136&#39; | &#39;int144&#39; | &#39;int152&#39; | &#39;int160&#39; | &#39;int168&#39; | &#39;int176&#39; | &#39;int184&#39; | &#39;int192&#39; | &#39;int200&#39; | &#39;int208&#39; | &#39;int216&#39; | &#39;int224&#39; | &#39;int232&#39; | &#39;int240&#39; | &#39;int248&#39; | &#39;int256&#39;

Uint = &#39;uint&#39; | &#39;uint8&#39; | &#39;uint16&#39; | &#39;uint24&#39; | &#39;uint32&#39; | &#39;uint40&#39; | &#39;uint48&#39; | &#39;uint56&#39; | &#39;uint64&#39; | &#39;uint72&#39; | &#39;uint80&#39; | &#39;uint88&#39; | &#39;uint96&#39; | &#39;uint104&#39; | &#39;uint112&#39; | &#39;uint120&#39; | &#39;uint128&#39; | &#39;uint136&#39; | &#39;uint144&#39; | &#39;uint152&#39; | &#39;uint160&#39; | &#39;uint168&#39; | &#39;uint176&#39; | &#39;uint184&#39; | &#39;uint192&#39; | &#39;uint200&#39; | &#39;uint208&#39; | &#39;uint216&#39; | &#39;uint224&#39; | &#39;uint232&#39; | &#39;uint240&#39; | &#39;uint248&#39; | &#39;uint256&#39;

Byte = &#39;byte&#39; | &#39;bytes&#39; | &#39;bytes1&#39; | &#39;bytes2&#39; | &#39;bytes3&#39; | &#39;bytes4&#39; | &#39;bytes5&#39; | &#39;bytes6&#39; | &#39;bytes7&#39; | &#39;bytes8&#39; | &#39;bytes9&#39; | &#39;bytes10&#39; | &#39;bytes11&#39; | &#39;bytes12&#39; | &#39;bytes13&#39; | &#39;bytes14&#39; | &#39;bytes15&#39; | &#39;bytes16&#39; | &#39;bytes17&#39; | &#39;bytes18&#39; | &#39;bytes19&#39; | &#39;bytes20&#39; | &#39;bytes21&#39; | &#39;bytes22&#39; | &#39;bytes23&#39; | &#39;bytes24&#39; | &#39;bytes25&#39; | &#39;bytes26&#39; | &#39;bytes27&#39; | &#39;bytes28&#39; | &#39;bytes29&#39; | &#39;bytes30&#39; | &#39;bytes31&#39; | &#39;bytes32&#39;

Fixed = &#39;fixed&#39; | ( &#39;fixed&#39; [0-9]+ &#39;x&#39; [0-9]+ )

Ufixed = &#39;ufixed&#39; | ( &#39;ufixed&#39; [0-9]+ &#39;x&#39; [0-9]+ )

InlineAssemblyBlock = &#39;{&#39; AssemblyItem* &#39;}&#39;

AssemblyItem = Identifier | FunctionalAssemblyExpression | InlineAssemblyBlock | AssemblyLocalBinding | AssemblyAssignment | AssemblyLabel | NumberLiteral | StringLiteral | HexLiteral
AssemblyLocalBinding = &#39;let&#39; Identifier &#39;:=&#39; FunctionalAssemblyExpression
AssemblyAssignment = ( Identifier &#39;:=&#39; FunctionalAssemblyExpression ) | ( &#39;=:&#39; Identifier )
AssemblyLabel = Identifier &#39;:&#39;
FunctionalAssemblyExpression = Identifier &#39;(&#39; AssemblyItem? ( &#39;,&#39; AssemblyItem )* &#39;)&#39;
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-security-considerations"></span><div class="section" id="security-considerations">
<span id="id1"></span><h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>While it is usually quite easy to build software that works as expected,
it is much harder to check that nobody can use it in a way that was <strong>not</strong> anticipated.</p>
<p>In Solidity, this is even more important because you can use smart contracts
to handle tokens or, possibly, even more valuable things. Furthermore, every
execution of a smart contract happens in public and, in addition to that,
the source code is often available.</p>
<p>Of course you always have to consider how much is at stake:
You can compare a smart contract with a web service that is open to the
public (and thus, also to malicious actors) and perhaps even open source.
If you only store your grocery list on that web service, you might not have
to take too much care, but if you manage your bank account using that web service,
you should be more careful.</p>
<p>This section will list some pitfalls and general security recommendations but
can, of course, never be complete. Also, keep in mind that even if your
smart contract code is bug-free, the compiler or the platform itself might
have a bug. A list of some publicly known security-relevant bugs of the compiler
can be found in the
<a class="reference internal" href="index.html#known-bugs"><span class="std std-ref">list of known bugs</span></a>, which is also machine-readable. Note
that there is a bug bounty program that covers the code generator of the
Solidity compiler.</p>
<p>As always, with open source documentation, please help us extend this section
(especially, some examples would not hurt)!</p>
<div class="section" id="pitfalls">
<h3>Pitfalls<a class="headerlink" href="#pitfalls" title="Permalink to this headline">¶</a></h3>
<div class="section" id="private-information-and-randomness">
<h4>Private Information and Randomness<a class="headerlink" href="#private-information-and-randomness" title="Permalink to this headline">¶</a></h4>
<p>Everything you use in a smart contract is publicly visible, even
local variables and state variables marked <code class="docutils literal"><span class="pre">private</span></code>.</p>
<p>Using random numbers in smart contracts is quite tricky if you do not want
miners to be able to cheat.</p>
</div>
<div class="section" id="re-entrancy">
<h4>Re-Entrancy<a class="headerlink" href="#re-entrancy" title="Permalink to this headline">¶</a></h4>
<p>Any interaction from a contract (A) with another contract (B) and any transfer
of Ether hands over control to that contract (B). This makes it possible for B
to call back into A before this interaction is completed. To give an example,
the following code contains a bug (it is just a snippet and not a
complete contract):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="nx">Fund</span> <span class="p">{</span>
    <span class="cs">/// Mapping of ether shares of the contract.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">shares</span><span class="p">;</span>
    <span class="cs">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]))</span>
            <span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The problem is not too serious here because of the limited gas as part
of <code class="docutils literal"><span class="pre">send</span></code>, but it still exposes a weakness: Ether transfer can always
include code execution, so the recipient could be a contract that calls
back into <code class="docutils literal"><span class="pre">withdraw</span></code>. This would let it get multiple refunds and
basically retrieve all the Ether in the contract. In particular, the
following contract will allow an attacker to refund multiple times
as it uses <code class="docutils literal"><span class="pre">call</span></code> which forwards all remaining gas by default:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="nx">Fund</span> <span class="p">{</span>
    <span class="cs">/// Mapping of ether shares of the contract.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">shares</span><span class="p">;</span>
    <span class="cs">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">])())</span>
            <span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To avoid re-entrancy, you can use the Checks-Effects-Interactions pattern as
outlined further below:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Fund</span> <span class="p">{</span>
    <span class="cs">/// Mapping of ether shares of the contract.</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">shares</span><span class="p">;</span>
    <span class="cs">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">share</span> <span class="o">=</span> <span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="nx">shares</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">share</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that re-entrancy is not only an effect of Ether transfer but of any
function call on another contract. Furthermore, you also have to take
multi-contract situations into account. A called contract could modify the
state of another contract you depend on.</p>
</div>
<div class="section" id="gas-limit-and-loops">
<h4>Gas Limit and Loops<a class="headerlink" href="#gas-limit-and-loops" title="Permalink to this headline">¶</a></h4>
<p>Loops that do not have a fixed number of iterations, for example, loops that depend on storage values, have to be used carefully:
Due to the block gas limit, transactions can only consume a certain amount of gas. Either explicitly or just due to
normal operation, the number of iterations in a loop can grow beyond the block gas limit which can cause the complete
contract to be stalled at a certain point. This may not apply to <code class="docutils literal"><span class="pre">view</span></code> functions that are only executed
to read data from the blockchain. Still, such functions may be called by other contracts as part of on-chain operations
and stall those. Please be explicit about such cases in the documentation of your contracts.</p>
</div>
<div class="section" id="sending-and-receiving-ether">
<h4>Sending and Receiving Ether<a class="headerlink" href="#sending-and-receiving-ether" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Neither contracts nor “external accounts” are currently able to prevent that someone sends them Ether.
Contracts can react on and reject a regular transfer, but there are ways
to move Ether without creating a message call. One way is to simply “mine to”
the contract address and the second way is using <code class="docutils literal"><span class="pre">selfdestruct(x)</span></code>.</li>
<li>If a contract receives Ether (without a function being called), the fallback function is executed.
If it does not have a fallback function, the Ether will be rejected (by throwing an exception).
During the execution of the fallback function, the contract can only rely
on the “gas stipend” (2300 gas) being available to it at that time. This stipend is not enough to access storage in any way.
To be sure that your contract can receive Ether in that way, check the gas requirements of the fallback function
(for example in the “details” section in Remix).</li>
<li>There is a way to forward more gas to the receiving contract using
<code class="docutils literal"><span class="pre">addr.call.value(x)()</span></code>. This is essentially the same as <code class="docutils literal"><span class="pre">addr.transfer(x)</span></code>,
only that it forwards all remaining gas and opens up the ability for the
recipient to perform more expensive actions (and it only returns a failure code
and does not automatically propagate the error). This might include calling back
into the sending contract or other state changes you might not have thought of.
So it allows for great flexibility for honest users but also for malicious actors.</li>
<li>If you want to send Ether using <code class="docutils literal"><span class="pre">address.transfer</span></code>, there are certain details to be aware of:<ol class="arabic">
<li>If the recipient is a contract, it causes its fallback function to be executed which can, in turn, call back the sending contract.</li>
<li>Sending Ether can fail due to the call depth going above 1024. Since the caller is in total control of the call
depth, they can force the transfer to fail; take this possibility into account or use <code class="docutils literal"><span class="pre">send</span></code> and make sure to always check its return value. Better yet,
write your contract using a pattern where the recipient can withdraw Ether instead.</li>
<li>Sending Ether can also fail because the execution of the recipient contract
requires more than the allotted amount of gas (explicitly by using <code class="docutils literal"><span class="pre">require</span></code>,
<code class="docutils literal"><span class="pre">assert</span></code>, <code class="docutils literal"><span class="pre">revert</span></code>, <code class="docutils literal"><span class="pre">throw</span></code> or
because the operation is just too expensive) - it “runs out of gas” (OOG).
If you use <code class="docutils literal"><span class="pre">transfer</span></code> or <code class="docutils literal"><span class="pre">send</span></code> with a return value check, this might provide a
means for the recipient to block progress in the sending contract. Again, the best practice here is to use
a <a class="reference internal" href="index.html#withdrawal-pattern"><span class="std std-ref">“withdraw” pattern instead of a “send” pattern</span></a>.</li>
</ol>
</li>
</ul>
</div>
<div class="section" id="callstack-depth">
<h4>Callstack Depth<a class="headerlink" href="#callstack-depth" title="Permalink to this headline">¶</a></h4>
<p>External function calls can fail any time because they exceed the maximum
call stack of 1024. In such situations, Solidity throws an exception.
Malicious actors might be able to force the call stack to a high value
before they interact with your contract.</p>
<p>Note that <code class="docutils literal"><span class="pre">.send()</span></code> does <strong>not</strong> throw an exception if the call stack is
depleted but rather returns <code class="docutils literal"><span class="pre">false</span></code> in that case. The low-level functions
<code class="docutils literal"><span class="pre">.call()</span></code>, <code class="docutils literal"><span class="pre">.callcode()</span></code> and <code class="docutils literal"><span class="pre">.delegatecall()</span></code> behave in the same way.</p>
</div>
<div class="section" id="tx-origin">
<h4>tx.origin<a class="headerlink" href="#tx-origin" title="Permalink to this headline">¶</a></h4>
<p>Never use tx.origin for authorization. Let’s say you have a wallet contract like this:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="nx">TxUserWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">TxUserWallet</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="nx">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="nx">origin</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span>
        <span class="nx">dest</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now someone tricks you into sending ether to the address of this attack wallet:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">interface</span> <span class="nx">TxUserWallet</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="nx">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">amount</span><span class="p">)</span> <span class="k">public</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">TxAttackWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">TxAttackWallet</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">TxUserWallet</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">).</span><span class="nx">transferTo</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If your wallet had checked <code class="docutils literal"><span class="pre">msg.sender</span></code> for authorization, it would get the address of the attack wallet, instead of the owner address. But by checking <code class="docutils literal"><span class="pre">tx.origin</span></code>, it gets the original address that kicked off the transaction, which is still the owner address. The attack wallet instantly drains all your funds.</p>
</div>
<div class="section" id="minor-details">
<h4>Minor Details<a class="headerlink" href="#minor-details" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>In <code class="docutils literal"><span class="pre">for</span> <span class="pre">(var</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">arrayName.length;</span> <span class="pre">i++)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code>, the type of <code class="docutils literal"><span class="pre">i</span></code> will be <code class="docutils literal"><span class="pre">uint8</span></code>, because this is the smallest type that is required to hold the value <code class="docutils literal"><span class="pre">0</span></code>. If the array has more than 255 elements, the loop will not terminate.</li>
<li>Types that do not occupy the full 32 bytes might contain “dirty higher order bits”.
This is especially important if you access <code class="docutils literal"><span class="pre">msg.data</span></code> - it poses a malleability risk:
You can craft transactions that call a function <code class="docutils literal"><span class="pre">f(uint8</span> <span class="pre">x)</span></code> with a raw byte argument
of <code class="docutils literal"><span class="pre">0xff000001</span></code> and with <code class="docutils literal"><span class="pre">0x00000001</span></code>. Both are fed to the contract and both will
look like the number <code class="docutils literal"><span class="pre">1</span></code> as far as <code class="docutils literal"><span class="pre">x</span></code> is concerned, but <code class="docutils literal"><span class="pre">msg.data</span></code> will
be different, so if you use <code class="docutils literal"><span class="pre">keccak256(msg.data)</span></code> for anything, you will get different results.</li>
</ul>
</div>
</div>
<div class="section" id="recommendations">
<h3>Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="take-warnings-seriously">
<h4>Take Warnings Seriously<a class="headerlink" href="#take-warnings-seriously" title="Permalink to this headline">¶</a></h4>
<p>If the compiler warns you about something, you should better change it.
Even if you do not think that this particular warning has security
implications, there might be another issue buried beneath it.
Any compiler warning we issue can be silenced by slight changes to the
code.</p>
<p>Also try to enable the “0.5.0” safety features as early as possible
by adding <code class="docutils literal"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">&quot;v0.5.0&quot;;</span></code>. Note that in this case,
the word <code class="docutils literal"><span class="pre">experimental</span></code> does not mean that the safety features are in any
way risky, it is just a way to enable some features that are
not yet part of the latest version of Solidity due to backwards
compatibility.</p>
</div>
<div class="section" id="restrict-the-amount-of-ether">
<h4>Restrict the Amount of Ether<a class="headerlink" href="#restrict-the-amount-of-ether" title="Permalink to this headline">¶</a></h4>
<p>Restrict the amount of Ether (or other tokens) that can be stored in a smart
contract. If your source code, the compiler or the platform has a bug, these
funds may be lost. If you want to limit your loss, limit the amount of Ether.</p>
</div>
<div class="section" id="keep-it-small-and-modular">
<h4>Keep it Small and Modular<a class="headerlink" href="#keep-it-small-and-modular" title="Permalink to this headline">¶</a></h4>
<p>Keep your contracts small and easily understandable. Single out unrelated
functionality in other contracts or into libraries. General recommendations
about source code quality of course apply: Limit the amount of local variables,
the length of functions and so on. Document your functions so that others
can see what your intention was and whether it is different than what the code does.</p>
</div>
<div class="section" id="use-the-checks-effects-interactions-pattern">
<h4>Use the Checks-Effects-Interactions Pattern<a class="headerlink" href="#use-the-checks-effects-interactions-pattern" title="Permalink to this headline">¶</a></h4>
<p>Most functions will first perform some checks (who called the function,
are the arguments in range, did they send enough Ether, does the person
have tokens, etc.). These checks should be done first.</p>
<p>As the second step, if all checks passed, effects to the state variables
of the current contract should be made. Interaction with other contracts
should be the very last step in any function.</p>
<p>Early contracts delayed some effects and waited for external function
calls to return in a non-error state. This is often a serious mistake
because of the re-entrancy problem explained above.</p>
<p>Note that, also, calls to known contracts might in turn cause calls to
unknown contracts, so it is probably better to just always apply this pattern.</p>
</div>
<div class="section" id="include-a-fail-safe-mode">
<h4>Include a Fail-Safe Mode<a class="headerlink" href="#include-a-fail-safe-mode" title="Permalink to this headline">¶</a></h4>
<p>While making your system fully decentralised will remove any intermediary,
it might be a good idea, especially for new code, to include some kind
of fail-safe mechanism:</p>
<p>You can add a function in your smart contract that performs some
self-checks like “Has any Ether leaked?”,
“Is the sum of the tokens equal to the balance of the contract?” or similar things.
Keep in mind that you cannot use too much gas for that, so help through off-chain
computations might be needed there.</p>
<p>If the self-check fails, the contract automatically switches into some kind
of “failsafe” mode, which, for example, disables most of the features, hands over
control to a fixed and trusted third party or just converts the contract into
a simple “give me back my money” contract.</p>
</div>
</div>
<div class="section" id="formal-verification">
<h3>Formal Verification<a class="headerlink" href="#formal-verification" title="Permalink to this headline">¶</a></h3>
<p>Using formal verification, it is possible to perform an automated mathematical
proof that your source code fulfills a certain formal specification.
The specification is still formal (just as the source code), but usually much
simpler.</p>
<p>Note that formal verification itself can only help you understand the
difference between what you did (the specification) and how you did it
(the actual implementation). You still need to check whether the specification
is what you wanted and that you did not miss any unintended effects of it.</p>
</div>
</div>
<span id="document-using-the-compiler"></span><div class="section" id="using-the-compiler">
<h2>Using the compiler<a class="headerlink" href="#using-the-compiler" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-the-commandline-compiler">
<span id="commandline-compiler"></span><span id="index-0"></span><h3>Using the Commandline Compiler<a class="headerlink" href="#using-the-commandline-compiler" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section doesn’t apply to <a class="reference internal" href="index.html#solcjs"><span class="std std-ref">solcjs</span></a>.</p>
</div>
<p>One of the build targets of the Solidity repository is <code class="docutils literal"><span class="pre">solc</span></code>, the solidity commandline compiler.
Using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--help</span></code> provides you with an explanation of all options. The compiler can produce various outputs, ranging from simple binaries and assembly over an abstract syntax tree (parse tree) to estimations of gas usage.
If you only want to compile a single file, you run it as <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code> and it will print the binary. If you want to get some of the more advanced output variants of <code class="docutils literal"><span class="pre">solc</span></code>, it is probably better to tell it to output everything to separate files using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">-o</span> <span class="pre">outputDirectory</span> <span class="pre">--bin</span> <span class="pre">--ast</span> <span class="pre">--asm</span> <span class="pre">sourceFile.sol</span></code>.</p>
<p>Before you deploy your contract, activate the optimizer while compiling using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--optimize</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code>. By default, the optimizer will optimize the contract for 200 runs. If you want to optimize for initial contract deployment and get the smallest output, set it to <code class="docutils literal"><span class="pre">--runs=1</span></code>. If you expect many transactions and don’t care for higher deployment cost and output size, set <code class="docutils literal"><span class="pre">--runs</span></code> to a high number.</p>
<p>The commandline compiler will automatically read imported files from the filesystem, but
it is also possible to provide path redirects using <code class="docutils literal"><span class="pre">prefix=path</span></code> in the following way:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">solc</span> <span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">ethereum</span><span class="o">/</span><span class="nx">dapp</span><span class="o">-</span><span class="nx">bin</span><span class="o">/=</span><span class="err">/usr/local/lib/dapp-bin/ =/usr/local/lib/fallback file.sol</span>
</pre></div>
</div>
<p>This essentially instructs the compiler to search for anything starting with
<code class="docutils literal"><span class="pre">github.com/ethereum/dapp-bin/</span></code> under <code class="docutils literal"><span class="pre">/usr/local/lib/dapp-bin</span></code> and if it does not
find the file there, it will look at <code class="docutils literal"><span class="pre">/usr/local/lib/fallback</span></code> (the empty prefix
always matches). <code class="docutils literal"><span class="pre">solc</span></code> will not read files from the filesystem that lie outside of
the remapping targets and outside of the directories where explicitly specified source
files reside, so things like <code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;/etc/passwd&quot;;</span></code> only work if you add <code class="docutils literal"><span class="pre">=/</span></code> as a remapping.</p>
<p>If there are multiple matches due to remappings, the one with the longest common prefix is selected.</p>
<p>For security reasons the compiler has restrictions what directories it can access. Paths (and their subdirectories) of source files specified on the commandline and paths defined by remappings are allowed for import statements, but everything else is rejected. Additional paths (and their subdirectories) can be allowed via the <code class="docutils literal"><span class="pre">--allow-paths</span> <span class="pre">/sample/path,/another/sample/path</span></code> switch.</p>
<p>If your contracts use <a class="reference internal" href="index.html#libraries"><span class="std std-ref">libraries</span></a>, you will notice that the bytecode contains substrings of the form <code class="docutils literal"><span class="pre">__LibraryName______</span></code>. You can use <code class="docutils literal"><span class="pre">solc</span></code> as a linker meaning that it will insert the library addresses for you at those points:</p>
<p>Either add <code class="docutils literal"><span class="pre">--libraries</span> <span class="pre">&quot;Math:0x12345678901234567890</span> <span class="pre">Heap:0xabcdef0123456&quot;</span></code> to your command to provide an address for each library or store the string in a file (one library per line) and run <code class="docutils literal"><span class="pre">solc</span></code> using <code class="docutils literal"><span class="pre">--libraries</span> <span class="pre">fileName</span></code>.</p>
<p>If <code class="docutils literal"><span class="pre">solc</span></code> is called with the option <code class="docutils literal"><span class="pre">--link</span></code>, all input files are interpreted to be unlinked binaries (hex-encoded) in the <code class="docutils literal"><span class="pre">__LibraryName____</span></code>-format given above and are linked in-place (if the input is read from stdin, it is written to stdout). All options except <code class="docutils literal"><span class="pre">--libraries</span></code> are ignored (including <code class="docutils literal"><span class="pre">-o</span></code>) in this case.</p>
<p>If <code class="docutils literal"><span class="pre">solc</span></code> is called with the option <code class="docutils literal"><span class="pre">--standard-json</span></code>, it will expect a JSON input (as explained below) on the standard input, and return a JSON output on the standard output.</p>
</div>
<div class="section" id="compiler-input-and-output-json-description">
<span id="compiler-api"></span><h3>Compiler Input and Output JSON Description<a class="headerlink" href="#compiler-input-and-output-json-description" title="Permalink to this headline">¶</a></h3>
<p>These JSON formats are used by the compiler API as well as are available through <code class="docutils literal"><span class="pre">solc</span></code>. These are subject to change,
some fields are optional (as noted), but it is aimed at to only make backwards compatible changes.</p>
<p>The compiler API expects a JSON formatted input and outputs the compilation result in a JSON formatted output.</p>
<p>Comments are of course not permitted and used here only for explanatory purposes.</p>
<div class="section" id="input-description">
<h4>Input Description<a class="headerlink" href="#input-description" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>{
  // Required: Source code language, such as &quot;Solidity&quot;, &quot;serpent&quot;, &quot;lll&quot;, &quot;assembly&quot;, etc.
  language: &quot;Solidity&quot;,
  // Required
  sources:
  {
    // The keys here are the &quot;global&quot; names of the source files,
    // imports can use other files via remappings (see below).
    &quot;myFile.sol&quot;:
    {
      // Optional: keccak256 hash of the source file
      // It is used to verify the retrieved content if imported via URLs.
      &quot;keccak256&quot;: &quot;0x123...&quot;,
      // Required (unless &quot;content&quot; is used, see below): URL(s) to the source file.
      // URL(s) should be imported in this order and the result checked against the
      // keccak256 hash (if available). If the hash doesn&#39;t match or none of the
      // URL(s) result in success, an error should be raised.
      &quot;urls&quot;:
      [
        &quot;bzzr://56ab...&quot;,
        &quot;ipfs://Qma...&quot;,
        &quot;file:///tmp/path/to/file.sol&quot;
      ]
    },
    &quot;mortal&quot;:
    {
      // Optional: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x234...&quot;,
      // Required (unless &quot;urls&quot; is used): literal contents of the source file
      &quot;content&quot;: &quot;contract mortal is owned { function kill() { if (msg.sender == owner) selfdestruct(owner); } }&quot;
    }
  },
  // Optional
  settings:
  {
    // Optional: Sorted list of remappings
    remappings: [ &quot;:g/dir&quot; ],
    // Optional: Optimizer settings
    optimizer: {
      // disabled by default
      enabled: true,
      // Optimize for how many times you intend to run the code.
      // Lower values will optimize more for initial deployment cost, higher values will optimize more for high-frequency usage.
      runs: 200
    },
    evmVersion: &quot;byzantium&quot;, // Version of the EVM to compile for. Affects type checking and code generation. Can be homestead, tangerineWhistle, spuriousDragon, byzantium or constantinople
    // Metadata settings (optional)
    metadata: {
      // Use only literal content and not URLs (false by default)
      useLiteralContent: true
    },
    // Addresses of the libraries. If not all libraries are given here, it can result in unlinked objects whose output data is different.
    libraries: {
      // The top level key is the the name of the source file where the library is used.
      // If remappings are used, this source file should match the global path after remappings were applied.
      // If this key is an empty string, that refers to a global level.
      &quot;myFile.sol&quot;: {
        &quot;MyLib&quot;: &quot;0x123123...&quot;
      }
    }
    // The following can be used to select desired outputs.
    // If this field is omitted, then the compiler loads and does type checking, but will not generate any outputs apart from errors.
    // The first level key is the file name and the second is the contract name, where empty contract name refers to the file itself,
    // while the star refers to all of the contracts.
    //
    // The available output types are as follows:
    //   abi - ABI
    //   ast - AST of all source files
    //   legacyAST - legacy AST of all source files
    //   devdoc - Developer documentation (natspec)
    //   userdoc - User documentation (natspec)
    //   metadata - Metadata
    //   ir - New assembly format before desugaring
    //   evm.assembly - New assembly format after desugaring
    //   evm.legacyAssembly - Old-style assembly format in JSON
    //   evm.bytecode.object - Bytecode object
    //   evm.bytecode.opcodes - Opcodes list
    //   evm.bytecode.sourceMap - Source mapping (useful for debugging)
    //   evm.bytecode.linkReferences - Link references (if unlinked object)
    //   evm.deployedBytecode* - Deployed bytecode (has the same options as evm.bytecode)
    //   evm.methodIdentifiers - The list of function hashes
    //   evm.gasEstimates - Function gas estimates
    //   ewasm.wast - eWASM S-expressions format (not supported atm)
    //   ewasm.wasm - eWASM binary format (not supported atm)
    //
    // Note that using a using `evm`, `evm.bytecode`, `ewasm`, etc. will select every
    // target part of that output. Additionally, `*` can be used as a wildcard to request everything.
    //
    outputSelection: {
      // Enable the metadata and bytecode outputs of every single contract.
      &quot;*&quot;: {
        &quot;*&quot;: [ &quot;metadata&quot;, &quot;evm.bytecode&quot; ]
      },
      // Enable the abi and opcodes output of MyContract defined in file def.
      &quot;def&quot;: {
        &quot;MyContract&quot;: [ &quot;abi&quot;, &quot;evm.bytecode.opcodes&quot; ]
      },
      // Enable the source map output of every single contract.
      &quot;*&quot;: {
        &quot;*&quot;: [ &quot;evm.bytecode.sourceMap&quot; ]
      },
      // Enable the legacy AST output of every single file.
      &quot;*&quot;: {
        &quot;&quot;: [ &quot;legacyAST&quot; ]
      }
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="output-description">
<h4>Output Description<a class="headerlink" href="#output-description" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none"><div class="highlight"><pre><span></span>{
  // Optional: not present if no errors/warnings were encountered
  errors: [
    {
      // Optional: Location within the source file.
      sourceLocation: {
        file: &quot;sourceFile.sol&quot;,
        start: 0,
        end: 100
      ],
      // Mandatory: Error type, such as &quot;TypeError&quot;, &quot;InternalCompilerError&quot;, &quot;Exception&quot;, etc.
      // See below for complete list of types.
      type: &quot;TypeError&quot;,
      // Mandatory: Component where the error originated, such as &quot;general&quot;, &quot;ewasm&quot;, etc.
      component: &quot;general&quot;,
      // Mandatory (&quot;error&quot; or &quot;warning&quot;)
      severity: &quot;error&quot;,
      // Mandatory
      message: &quot;Invalid keyword&quot;
      // Optional: the message formatted with source location
      formattedMessage: &quot;sourceFile.sol:100: Invalid keyword&quot;
    }
  ],
  // This contains the file-level outputs. In can be limited/filtered by the outputSelection settings.
  sources: {
    &quot;sourceFile.sol&quot;: {
      // Identifier (used in source maps)
      id: 1,
      // The AST object
      ast: {},
      // The legacy AST object
      legacyAST: {}
    }
  },
  // This contains the contract-level outputs. It can be limited/filtered by the outputSelection settings.
  contracts: {
    &quot;sourceFile.sol&quot;: {
      // If the language used has no contract names, this field should equal to an empty string.
      &quot;ContractName&quot;: {
        // The Ethereum Contract ABI. If empty, it is represented as an empty array.
        // See https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI
        abi: [],
        // See the Metadata Output documentation (serialised JSON string)
        metadata: &quot;{...}&quot;,
        // User documentation (natspec)
        userdoc: {},
        // Developer documentation (natspec)
        devdoc: {},
        // Intermediate representation (string)
        ir: &quot;&quot;,
        // EVM-related outputs
        evm: {
          // Assembly (string)
          assembly: &quot;&quot;,
          // Old-style assembly (object)
          legacyAssembly: {},
          // Bytecode and related details.
          bytecode: {
            // The bytecode as a hex string.
            object: &quot;00fe&quot;,
            // Opcodes list (string)
            opcodes: &quot;&quot;,
            // The source mapping as a string. See the source mapping definition.
            sourceMap: &quot;&quot;,
            // If given, this is an unlinked object.
            linkReferences: {
              &quot;libraryFile.sol&quot;: {
                // Byte offsets into the bytecode. Linking replaces the 20 bytes located there.
                &quot;Library1&quot;: [
                  { start: 0, length: 20 },
                  { start: 200, length: 20 }
                ]
              }
            }
          },
          // The same layout as above.
          deployedBytecode: { },
          // The list of function hashes
          methodIdentifiers: {
            &quot;delegate(address)&quot;: &quot;5c19a95c&quot;
          },
          // Function gas estimates
          gasEstimates: {
            creation: {
              codeDepositCost: &quot;420000&quot;,
              executionCost: &quot;infinite&quot;,
              totalCost: &quot;infinite&quot;
            },
            external: {
              &quot;delegate(address)&quot;: &quot;25000&quot;
            },
            internal: {
              &quot;heavyLifting()&quot;: &quot;infinite&quot;
            }
          }
        },
        // eWASM related outputs
        ewasm: {
          // S-expressions format
          wast: &quot;&quot;,
          // Binary format (hex string)
          wasm: &quot;&quot;
        }
      }
    }
  }
}
</pre></div>
</div>
<div class="section" id="error-types">
<h5>Error types<a class="headerlink" href="#error-types" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">JSONError</span></code>: JSON input doesn’t conform to the required format, e.g. input is not a JSON object, the language is not supported, etc.</li>
<li><code class="docutils literal"><span class="pre">IOError</span></code>: IO and import processing errors, such as unresolvable URL or hash mismatch in supplied sources.</li>
<li><code class="docutils literal"><span class="pre">ParserError</span></code>: Source code doesn’t conform to the language rules.</li>
<li><code class="docutils literal"><span class="pre">DocstringParsingError</span></code>: The NatSpec tags in the comment block cannot be parsed.</li>
<li><code class="docutils literal"><span class="pre">SyntaxError</span></code>: Syntactical error, such as <code class="docutils literal"><span class="pre">continue</span></code> is used outside of a <code class="docutils literal"><span class="pre">for</span></code> loop.</li>
<li><code class="docutils literal"><span class="pre">DeclarationError</span></code>: Invalid, unresolvable or clashing identifier names. e.g. <code class="docutils literal"><span class="pre">Identifier</span> <span class="pre">not</span> <span class="pre">found</span></code></li>
<li><code class="docutils literal"><span class="pre">TypeError</span></code>: Error within the type system, such as invalid type conversions, invalid assignments, etc.</li>
<li><code class="docutils literal"><span class="pre">UnimplementedFeatureError</span></code>: Feature is not supported by the compiler, but is expected to be supported in future versions.</li>
<li><code class="docutils literal"><span class="pre">InternalCompilerError</span></code>: Internal bug triggered in the compiler - this should be reported as an issue.</li>
<li><code class="docutils literal"><span class="pre">Exception</span></code>: Unknown failure during compilation - this should be reported as an issue.</li>
<li><code class="docutils literal"><span class="pre">CompilerError</span></code>: Invalid use of the compiler stack - this should be reported as an issue.</li>
<li><code class="docutils literal"><span class="pre">FatalError</span></code>: Fatal error not processed correctly - this should be reported as an issue.</li>
<li><code class="docutils literal"><span class="pre">Warning</span></code>: A warning, which didn’t stop the compilation, but should be addressed if possible.</li>
</ol>
</div>
</div>
</div>
</div>
<span id="document-metadata"></span><div class="section" id="contract-metadata">
<h2>Contract Metadata<a class="headerlink" href="#contract-metadata" title="Permalink to this headline">¶</a></h2>
<p id="index-0">The Solidity compiler automatically generates a JSON file, the
contract metadata, that contains information about the current contract.
It can be used to query the compiler version, the sources used, the ABI
and NatSpec documentation in order to more safely interact with the contract
and to verify its source code.</p>
<p>The compiler appends a Swarm hash of the metadata file to the end of the
bytecode (for details, see below) of each contract, so that you can retrieve
the file in an authenticated way without having to resort to a centralized
data provider.</p>
<p>Of course, you have to publish the metadata file to Swarm (or some other service)
so that others can access it. The file can be output by using <code class="docutils literal"><span class="pre">solc</span> <span class="pre">--metadata</span></code>
and the file will be called <code class="docutils literal"><span class="pre">ContractName_meta.json</span></code>.
It will contain Swarm references to the source code, so you have to upload
all source files and the metadata file.</p>
<p>The metadata file has the following format. The example below is presented in a
human-readable way. Properly formatted metadata should use quotes correctly,
reduce whitespace to a minimum and sort the keys of all objects to arrive at a
unique formatting.
Comments are of course also not permitted and used here only for explanatory purposes.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>{
  // Required: The version of the metadata format
  version: &quot;1&quot;,
  // Required: Source code language, basically selects a &quot;sub-version&quot;
  // of the specification
  language: &quot;Solidity&quot;,
  // Required: Details about the compiler, contents are specific
  // to the language.
  compiler: {
    // Required for Solidity: Version of the compiler
    version: &quot;0.4.6+commit.2dabbdf0.Emscripten.clang&quot;,
    // Optional: Hash of the compiler binary which produced this output
    keccak256: &quot;0x123...&quot;
  },
  // Required: Compilation source files/source units, keys are file names
  sources:
  {
    &quot;myFile.sol&quot;: {
      // Required: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x123...&quot;,
      // Required (unless &quot;content&quot; is used, see below): Sorted URL(s)
      // to the source file, protocol is more or less arbitrary, but a
      // Swarm URL is recommended
      &quot;urls&quot;: [ &quot;bzzr://56ab...&quot; ]
    },
    &quot;mortal&quot;: {
      // Required: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x234...&quot;,
      // Required (unless &quot;url&quot; is used): literal contents of the source file
      &quot;content&quot;: &quot;contract mortal is owned { function kill() { if (msg.sender == owner) selfdestruct(owner); } }&quot;
    }
  },
  // Required: Compiler settings
  settings:
  {
    // Required for Solidity: Sorted list of remappings
    remappings: [ &quot;:g/dir&quot; ],
    // Optional: Optimizer settings (enabled defaults to false)
    optimizer: {
      enabled: true,
      runs: 500
    },
    // Required for Solidity: File and name of the contract or library this
    // metadata is created for.
    compilationTarget: {
      &quot;myFile.sol&quot;: &quot;MyContract&quot;
    },
    // Required for Solidity: Addresses for libraries used
    libraries: {
      &quot;MyLib&quot;: &quot;0x123123...&quot;
    }
  },
  // Required: Generated information about the contract.
  output:
  {
    // Required: ABI definition of the contract
    abi: [ ... ],
    // Required: NatSpec user documentation of the contract
    userdoc: [ ... ],
    // Required: NatSpec developer documentation of the contract
    devdoc: [ ... ],
  }
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note the ABI definition above has no fixed order. It can change with compiler versions.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since the bytecode of the resulting contract contains the metadata hash, any change to
the metadata will result in a change of the bytecode. Furthermore, since the metadata
includes a hash of all the sources used, a single whitespace change in any of the source
codes will result in a different metadata, and subsequently a different bytecode.</p>
</div>
<div class="section" id="encoding-of-the-metadata-hash-in-the-bytecode">
<h3>Encoding of the Metadata Hash in the Bytecode<a class="headerlink" href="#encoding-of-the-metadata-hash-in-the-bytecode" title="Permalink to this headline">¶</a></h3>
<p>Because we might support other ways to retrieve the metadata file in the future,
the mapping <code class="docutils literal"><span class="pre">{&quot;bzzr0&quot;:</span> <span class="pre">&lt;Swarm</span> <span class="pre">hash&gt;}</span></code> is stored
<a class="reference external" href="https://tools.ietf.org/html/rfc7049">CBOR</a>-encoded. Since the beginning of that
encoding is not easy to find, its length is added in a two-byte big-endian
encoding. The current version of the Solidity compiler thus adds the following
to the end of the deployed bytecode:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xa1</span> <span class="mh">0x65</span> <span class="s1">&#39;b&#39;</span> <span class="s1">&#39;z&#39;</span> <span class="s1">&#39;z&#39;</span> <span class="s1">&#39;r&#39;</span> <span class="s1">&#39;0&#39;</span> <span class="mh">0x58</span> <span class="mh">0x20</span> <span class="o">&lt;</span><span class="mi">32</span> <span class="kt">bytes</span> <span class="nx">swarm</span> <span class="nx">hash</span><span class="o">&gt;</span> <span class="mh">0x00</span> <span class="mh">0x29</span>
</pre></div>
</div>
<p>So in order to retrieve the data, the end of the deployed bytecode can be checked
to match that pattern and use the Swarm hash to retrieve the file.</p>
</div>
<div class="section" id="usage-for-automatic-interface-generation-and-natspec">
<h3>Usage for Automatic Interface Generation and NatSpec<a class="headerlink" href="#usage-for-automatic-interface-generation-and-natspec" title="Permalink to this headline">¶</a></h3>
<p>The metadata is used in the following way: A component that wants to interact
with a contract (e.g. Mist) retrieves the code of the contract, from that
the Swarm hash of a file which is then retrieved.
That file is JSON-decoded into a structure like above.</p>
<p>The component can then use the ABI to automatically generate a rudimentary
user interface for the contract.</p>
<p>Furthermore, Mist can use the userdoc to display a confirmation message to the user
whenever they interact with the contract.</p>
<p>Additional information about Ethereum Natural Specification (NatSpec) can be found <a class="reference external" href="https://github.com/ethereum/wiki/wiki/Ethereum-Natural-Specification-Format">here</a>.</p>
</div>
<div class="section" id="usage-for-source-code-verification">
<h3>Usage for Source Code Verification<a class="headerlink" href="#usage-for-source-code-verification" title="Permalink to this headline">¶</a></h3>
<p>In order to verify the compilation, sources can be retrieved from Swarm
via the link in the metadata file.
The compiler of the correct version (which is checked to be part of the “official” compilers)
is invoked on that input with the specified settings. The resulting
bytecode is compared to the data of the creation transaction or <code class="docutils literal"><span class="pre">CREATE</span></code> opcode data.
This automatically verifies the metadata since its hash is part of the bytecode.
Excess data corresponds to the constructor input data, which should be decoded
according to the interface and presented to the user.</p>
</div>
</div>
<span id="document-abi-spec"></span><div class="section" id="application-binary-interface-specification">
<span id="abi"></span><span id="index-0"></span><h2>Application Binary Interface Specification<a class="headerlink" href="#application-binary-interface-specification" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-design">
<h3>Basic Design<a class="headerlink" href="#basic-design" title="Permalink to this headline">¶</a></h3>
<p>The Application Binary Interface is the standard way to interact with contracts in the Ethereum ecosystem, both
from outside the blockchain and for contract-to-contract interaction. Data is encoded according to its type,
as described in this specification.  The encoding is not self describing and thus requires a schema in order to decode.</p>
<p>We assume the interface functions of a contract are strongly typed, known at compilation time and static. No introspection mechanism will be provided. We assume that all contracts will have the interface definitions of any contracts they call available at compile-time.</p>
<p>This specification does not address contracts whose interface is dynamic or otherwise known only at run-time. Should these cases become important they can be adequately handled as facilities built within the Ethereum ecosystem.</p>
</div>
<div class="section" id="function-selector">
<span id="abi-function-selector"></span><h3>Function Selector<a class="headerlink" href="#function-selector" title="Permalink to this headline">¶</a></h3>
<p>The first four bytes of the call data for a function call specifies the function to be called. It is the
first (left, high-order in big-endian) four bytes of the Keccak (SHA-3) hash of the signature of the function. The signature is defined as the canonical expression of the basic prototype, i.e.
the function name with the parenthesised list of parameter types. Parameter types are split by a single comma - no spaces are used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The return type of a function is not part of this signature. In <a class="reference internal" href="index.html#overload-function"><span class="std std-ref">Solidity’s function overloading</span></a> return types are not considered. The reason is to keep function call resolution context-independent.
The JSON description of the ABI however contains both inputs and outputs. See (the <a class="reference internal" href="#abi-json"><span class="std std-ref">JSON ABI</span></a>)</p>
</div>
</div>
<div class="section" id="argument-encoding">
<h3>Argument Encoding<a class="headerlink" href="#argument-encoding" title="Permalink to this headline">¶</a></h3>
<p>Starting from the fifth byte, the encoded arguments follow. This encoding is also used in other places, e.g. the return values and also event arguments are encoded in the same way, without the four bytes specifying the function.</p>
</div>
<div class="section" id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p>The following elementary types exist:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">uint&lt;M&gt;</span></code>: unsigned integer type of <code class="docutils literal"><span class="pre">M</span></code> bits, <code class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==</span> <span class="pre">0</span></code>. e.g. <code class="docutils literal"><span class="pre">uint32</span></code>, <code class="docutils literal"><span class="pre">uint8</span></code>, <code class="docutils literal"><span class="pre">uint256</span></code>.</li>
<li><code class="docutils literal"><span class="pre">int&lt;M&gt;</span></code>: two’s complement signed integer type of <code class="docutils literal"><span class="pre">M</span></code> bits, <code class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==</span> <span class="pre">0</span></code>.</li>
<li><code class="docutils literal"><span class="pre">address</span></code>: equivalent to <code class="docutils literal"><span class="pre">uint160</span></code>, except for the assumed interpretation and language typing. For computing the function selector, <code class="docutils literal"><span class="pre">address</span></code> is used.</li>
<li><code class="docutils literal"><span class="pre">uint</span></code>, <code class="docutils literal"><span class="pre">int</span></code>: synonyms for <code class="docutils literal"><span class="pre">uint256</span></code>, <code class="docutils literal"><span class="pre">int256</span></code> respectively. For computing the function selector, <code class="docutils literal"><span class="pre">uint256</span></code> and <code class="docutils literal"><span class="pre">int256</span></code> have to be used.</li>
<li><code class="docutils literal"><span class="pre">bool</span></code>: equivalent to <code class="docutils literal"><span class="pre">uint8</span></code> restricted to the values 0 and 1. For computing the function selector, <code class="docutils literal"><span class="pre">bool</span></code> is used.</li>
<li><code class="docutils literal"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>: signed fixed-point decimal number of <code class="docutils literal"><span class="pre">M</span></code> bits, <code class="docutils literal"><span class="pre">8</span> <span class="pre">&lt;=</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==0</span></code>, and <code class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">N</span> <span class="pre">&lt;=</span> <span class="pre">80</span></code>, which denotes the value <code class="docutils literal"><span class="pre">v</span></code> as <code class="docutils literal"><span class="pre">v</span> <span class="pre">/</span> <span class="pre">(10</span> <span class="pre">**</span> <span class="pre">N)</span></code>.</li>
<li><code class="docutils literal"><span class="pre">ufixed&lt;M&gt;x&lt;N&gt;</span></code>: unsigned variant of <code class="docutils literal"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>.</li>
<li><code class="docutils literal"><span class="pre">fixed</span></code>, <code class="docutils literal"><span class="pre">ufixed</span></code>: synonyms for <code class="docutils literal"><span class="pre">fixed128x18</span></code>, <code class="docutils literal"><span class="pre">ufixed128x18</span></code> respectively. For computing the function selector, <code class="docutils literal"><span class="pre">fixed128x18</span></code> and <code class="docutils literal"><span class="pre">ufixed128x18</span></code> have to be used.</li>
<li><code class="docutils literal"><span class="pre">bytes&lt;M&gt;</span></code>: binary type of <code class="docutils literal"><span class="pre">M</span></code> bytes, <code class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">32</span></code>.</li>
<li><code class="docutils literal"><span class="pre">function</span></code>: an address (20 bytes) followed by a function selector (4 bytes). Encoded identical to <code class="docutils literal"><span class="pre">bytes24</span></code>.</li>
</ul>
<p>The following (fixed-size) array type exists:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&lt;type&gt;[M]</span></code>: a fixed-length array of <code class="docutils literal"><span class="pre">M</span></code> elements, <code class="docutils literal"><span class="pre">M</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>, of the given type.</li>
</ul>
<p>The following non-fixed-size types exist:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">bytes</span></code>: dynamic sized byte sequence.</li>
<li><code class="docutils literal"><span class="pre">string</span></code>: dynamic sized unicode string assumed to be UTF-8 encoded.</li>
<li><code class="docutils literal"><span class="pre">&lt;type&gt;[]</span></code>: a variable-length array of elements of the given type.</li>
</ul>
<p>Types can be combined to a tuple by enclosing a finite non-negative number
of them inside parentheses, separated by commas:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">(T1,T2,...,Tn)</span></code>: tuple consisting of the types <code class="docutils literal"><span class="pre">T1</span></code>, …, <code class="docutils literal"><span class="pre">Tn</span></code>, <code class="docutils literal"><span class="pre">n</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></li>
</ul>
<p>It is possible to form tuples of tuples, arrays of tuples and so on.  It is also possible to form zero-tuples (where <code class="docutils literal"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Solidity supports all the types presented above with the same names with the exception of tuples. The ABI tuple type is utilised for encoding Solidity <code class="docutils literal"><span class="pre">structs</span></code>.</p>
</div>
</div>
<div class="section" id="formal-specification-of-the-encoding">
<h3>Formal Specification of the Encoding<a class="headerlink" href="#formal-specification-of-the-encoding" title="Permalink to this headline">¶</a></h3>
<p>We will now formally specify the encoding, such that it will have the following
properties, which are especially useful if some arguments are nested arrays:</p>
<p>Properties:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The number of reads necessary to access a value is at most the depth of the value inside the argument array structure, i.e. four reads are needed to retrieve <code class="docutils literal"><span class="pre">a_i[k][l][r]</span></code>. In a previous version of the ABI, the number of reads scaled linearly with the total number of dynamic parameters in the worst case.</li>
<li>The data of a variable or array element is not interleaved with other data and it is relocatable, i.e. it only uses relative “addresses”</li>
</ol>
</div></blockquote>
<p>We distinguish static and dynamic types. Static types are encoded in-place and dynamic types are encoded at a separately allocated location after the current block.</p>
<p><strong>Definition:</strong> The following types are called “dynamic”:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">bytes</span></code></li>
<li><code class="docutils literal"><span class="pre">string</span></code></li>
<li><code class="docutils literal"><span class="pre">T[]</span></code> for any <code class="docutils literal"><span class="pre">T</span></code></li>
<li><code class="docutils literal"><span class="pre">T[k]</span></code> for any dynamic <code class="docutils literal"><span class="pre">T</span></code> and any <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></li>
<li><code class="docutils literal"><span class="pre">(T1,...,Tk)</span></code> if <code class="docutils literal"><span class="pre">Ti</span></code> is dynamic for some <code class="docutils literal"><span class="pre">1</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">k</span></code></li>
</ul>
<p>All other types are called “static”.</p>
<p><strong>Definition:</strong> <code class="docutils literal"><span class="pre">len(a)</span></code> is the number of bytes in a binary string <code class="docutils literal"><span class="pre">a</span></code>.
The type of <code class="docutils literal"><span class="pre">len(a)</span></code> is assumed to be <code class="docutils literal"><span class="pre">uint256</span></code>.</p>
<p>We define <code class="docutils literal"><span class="pre">enc</span></code>, the actual encoding, as a mapping of values of the ABI types to binary strings such
that <code class="docutils literal"><span class="pre">len(enc(X))</span></code> depends on the value of <code class="docutils literal"><span class="pre">X</span></code> if and only if the type of <code class="docutils literal"><span class="pre">X</span></code> is dynamic.</p>
<p><strong>Definition:</strong> For any ABI value <code class="docutils literal"><span class="pre">X</span></code>, we recursively define <code class="docutils literal"><span class="pre">enc(X)</span></code>, depending
on the type of <code class="docutils literal"><span class="pre">X</span></code> being</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">(T1,...,Tk)</span></code> for <code class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> and any types <code class="docutils literal"><span class="pre">T1</span></code>, …, <code class="docutils literal"><span class="pre">Tk</span></code></p>
<p><code class="docutils literal"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">head(X(1))</span> <span class="pre">...</span> <span class="pre">head(X(k))</span> <span class="pre">tail(X(1))</span> <span class="pre">...</span> <span class="pre">tail(X(k))</span></code></p>
<p>where <code class="docutils literal"><span class="pre">X</span> <span class="pre">=</span> <span class="pre">(X(1),</span> <span class="pre">...,</span> <span class="pre">X(k))</span></code> and
<code class="docutils literal"><span class="pre">head</span></code> and <code class="docutils literal"><span class="pre">tail</span></code> are defined for <code class="docutils literal"><span class="pre">Ti</span></code> being a static type as</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">head(X(i))</span> <span class="pre">=</span> <span class="pre">enc(X(i))</span></code> and <code class="docutils literal"><span class="pre">tail(X(i))</span> <span class="pre">=</span> <span class="pre">&quot;&quot;</span></code> (the empty string)</p>
</div></blockquote>
<p>and as</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">head(X(i))</span> <span class="pre">=</span> <span class="pre">enc(len(head(X(1))</span> <span class="pre">...</span> <span class="pre">head(X(k))</span> <span class="pre">tail(X(1))</span> <span class="pre">...</span> <span class="pre">tail(X(i-1))</span> <span class="pre">))</span></code>
<code class="docutils literal"><span class="pre">tail(X(i))</span> <span class="pre">=</span> <span class="pre">enc(X(i))</span></code></p>
</div></blockquote>
<p>otherwise, i.e. if <code class="docutils literal"><span class="pre">Ti</span></code> is a dynamic type.</p>
<p>Note that in the dynamic case, <code class="docutils literal"><span class="pre">head(X(i))</span></code> is well-defined since the lengths of
the head parts only depend on the types and not the values. Its value is the offset
of the beginning of <code class="docutils literal"><span class="pre">tail(X(i))</span></code> relative to the start of <code class="docutils literal"><span class="pre">enc(X)</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">T[k]</span></code> for any <code class="docutils literal"><span class="pre">T</span></code> and <code class="docutils literal"><span class="pre">k</span></code>:</p>
<p><code class="docutils literal"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc((X[0],</span> <span class="pre">...,</span> <span class="pre">X[k-1]))</span></code></p>
<p>i.e. it is encoded as if it were a tuple with <code class="docutils literal"><span class="pre">k</span></code> elements
of the same type.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">T[]</span></code> where <code class="docutils literal"><span class="pre">X</span></code> has <code class="docutils literal"><span class="pre">k</span></code> elements (<code class="docutils literal"><span class="pre">k</span></code> is assumed to be of type <code class="docutils literal"><span class="pre">uint256</span></code>):</p>
<p><code class="docutils literal"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(k)</span> <span class="pre">enc([X[0],</span> <span class="pre">...,</span> <span class="pre">X[k-1]])</span></code></p>
<p>i.e. it is encoded as if it were an array of static size <code class="docutils literal"><span class="pre">k</span></code>, prefixed with
the number of elements.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">bytes</span></code>, of length <code class="docutils literal"><span class="pre">k</span></code> (which is assumed to be of type <code class="docutils literal"><span class="pre">uint256</span></code>):</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(k)</span> <span class="pre">pad_right(X)</span></code>, i.e. the number of bytes is encoded as a</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">uint256</span></code> followed by the actual value of <code class="docutils literal"><span class="pre">X</span></code> as a byte sequence, followed by
the minimum number of zero-bytes such that <code class="docutils literal"><span class="pre">len(enc(X))</span></code> is a multiple of 32.</p>
</dd>
</dl>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">string</span></code>:</p>
<p><code class="docutils literal"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(enc_utf8(X))</span></code>, i.e. <code class="docutils literal"><span class="pre">X</span></code> is utf-8 encoded and this value is interpreted as of <code class="docutils literal"><span class="pre">bytes</span></code> type and encoded further. Note that the length used in this subsequent encoding is the number of bytes of the utf-8 encoded string, not its number of characters.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">uint&lt;M&gt;</span></code>: <code class="docutils literal"><span class="pre">enc(X)</span></code> is the big-endian encoding of <code class="docutils literal"><span class="pre">X</span></code>, padded on the higher-order (left) side with zero-bytes such that the length is 32 bytes.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">address</span></code>: as in the <code class="docutils literal"><span class="pre">uint160</span></code> case</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">int&lt;M&gt;</span></code>: <code class="docutils literal"><span class="pre">enc(X)</span></code> is the big-endian two’s complement encoding of <code class="docutils literal"><span class="pre">X</span></code>, padded on the higher-order (left) side with <code class="docutils literal"><span class="pre">0xff</span></code> for negative <code class="docutils literal"><span class="pre">X</span></code> and with zero bytes for positive <code class="docutils literal"><span class="pre">X</span></code> such that the length is 32 bytes.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">bool</span></code>: as in the <code class="docutils literal"><span class="pre">uint8</span></code> case, where <code class="docutils literal"><span class="pre">1</span></code> is used for <code class="docutils literal"><span class="pre">true</span></code> and <code class="docutils literal"><span class="pre">0</span></code> for <code class="docutils literal"><span class="pre">false</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>: <code class="docutils literal"><span class="pre">enc(X)</span></code> is <code class="docutils literal"><span class="pre">enc(X</span> <span class="pre">*</span> <span class="pre">10**N)</span></code> where <code class="docutils literal"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">10**N</span></code> is interpreted as a <code class="docutils literal"><span class="pre">int256</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">fixed</span></code>: as in the <code class="docutils literal"><span class="pre">fixed128x18</span></code> case</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ufixed&lt;M&gt;x&lt;N&gt;</span></code>: <code class="docutils literal"><span class="pre">enc(X)</span></code> is <code class="docutils literal"><span class="pre">enc(X</span> <span class="pre">*</span> <span class="pre">10**N)</span></code> where <code class="docutils literal"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">10**N</span></code> is interpreted as a <code class="docutils literal"><span class="pre">uint256</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ufixed</span></code>: as in the <code class="docutils literal"><span class="pre">ufixed128x18</span></code> case</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">bytes&lt;M&gt;</span></code>: <code class="docutils literal"><span class="pre">enc(X)</span></code> is the sequence of bytes in <code class="docutils literal"><span class="pre">X</span></code> padded with trailing zero-bytes to a length of 32 bytes.</p>
</li>
</ul>
<p>Note that for any <code class="docutils literal"><span class="pre">X</span></code>, <code class="docutils literal"><span class="pre">len(enc(X))</span></code> is a multiple of 32.</p>
</div>
<div class="section" id="function-selector-and-argument-encoding">
<h3>Function Selector and Argument Encoding<a class="headerlink" href="#function-selector-and-argument-encoding" title="Permalink to this headline">¶</a></h3>
<p>All in all, a call to the function <code class="docutils literal"><span class="pre">f</span></code> with parameters <code class="docutils literal"><span class="pre">a_1,</span> <span class="pre">...,</span> <span class="pre">a_n</span></code> is encoded as</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">function_selector(f)</span> <span class="pre">enc((a_1,</span> <span class="pre">...,</span> <span class="pre">a_n))</span></code></div></blockquote>
<p>and the return values <code class="docutils literal"><span class="pre">v_1,</span> <span class="pre">...,</span> <span class="pre">v_k</span></code> of <code class="docutils literal"><span class="pre">f</span></code> are encoded as</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">enc((v_1,</span> <span class="pre">...,</span> <span class="pre">v_k))</span></code></div></blockquote>
<p>i.e. the values are combined into a tuple and encoded.</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Given the contract:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Foo</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">bar</span><span class="p">(</span><span class="kt">bytes3</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{}</span>
  <span class="kd">function</span> <span class="nx">baz</span><span class="p">(</span><span class="kt">uint32</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">y</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">32</span> <span class="o">||</span> <span class="nx">y</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">sam</span><span class="p">(</span><span class="kt">bytes</span><span class="p">,</span> <span class="kt">bool</span><span class="p">,</span> <span class="kt">uint</span><span class="p">[])</span> <span class="k">public</span> <span class="k">pure</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Thus for our <code class="docutils literal"><span class="pre">Foo</span></code> example if we wanted to call <code class="docutils literal"><span class="pre">baz</span></code> with the parameters <code class="docutils literal"><span class="pre">69</span></code> and <code class="docutils literal"><span class="pre">true</span></code>, we would pass 68 bytes total, which can be broken down into:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">0xcdcd77c0</span></code>: the Method ID. This is derived as the first 4 bytes of the Keccak hash of the ASCII form of the signature <code class="docutils literal"><span class="pre">baz(uint32,bool)</span></code>.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000045</span></code>: the first parameter, a uint32 value <code class="docutils literal"><span class="pre">69</span></code> padded to 32 bytes</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the second parameter - boolean <code class="docutils literal"><span class="pre">true</span></code>, padded to 32 bytes</li>
</ul>
<p>In total:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xcdcd77c000000000000000000000000000000000000000000000000000000000000000450000000000000000000000000000000000000000000000000000000000000001</span>
</pre></div>
</div>
<p>It returns a single <code class="docutils literal"><span class="pre">bool</span></code>. If, for example, it were to return <code class="docutils literal"><span class="pre">false</span></code>, its output would be the single byte array <code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000000</span></code>, a single bool.</p>
<p>If we wanted to call <code class="docutils literal"><span class="pre">bar</span></code> with the argument <code class="docutils literal"><span class="pre">[&quot;abc&quot;,</span> <span class="pre">&quot;def&quot;]</span></code>, we would pass 68 bytes total, broken down into:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">0xfce353f6</span></code>: the Method ID. This is derived from the signature <code class="docutils literal"><span class="pre">bar(bytes3[2])</span></code>.</li>
<li><code class="docutils literal"><span class="pre">0x6162630000000000000000000000000000000000000000000000000000000000</span></code>: the first part of the first parameter, a <code class="docutils literal"><span class="pre">bytes3</span></code> value <code class="docutils literal"><span class="pre">&quot;abc&quot;</span></code> (left-aligned).</li>
<li><code class="docutils literal"><span class="pre">0x6465660000000000000000000000000000000000000000000000000000000000</span></code>: the second part of the first parameter, a <code class="docutils literal"><span class="pre">bytes3</span></code> value <code class="docutils literal"><span class="pre">&quot;def&quot;</span></code> (left-aligned).</li>
</ul>
<p>In total:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xfce353f661626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000</span>
</pre></div>
</div>
<p>If we wanted to call <code class="docutils literal"><span class="pre">sam</span></code> with the arguments <code class="docutils literal"><span class="pre">&quot;dave&quot;</span></code>, <code class="docutils literal"><span class="pre">true</span></code> and <code class="docutils literal"><span class="pre">[1,2,3]</span></code>, we would pass 292 bytes total, broken down into:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">0xa5643bf2</span></code>: the Method ID. This is derived from the signature <code class="docutils literal"><span class="pre">sam(bytes,bool,uint256[])</span></code>. Note that <code class="docutils literal"><span class="pre">uint</span></code> is replaced with its canonical representation <code class="docutils literal"><span class="pre">uint256</span></code>.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000060</span></code>: the location of the data part of the first parameter (dynamic type), measured in bytes from the start of the arguments block. In this case, <code class="docutils literal"><span class="pre">0x60</span></code>.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the second parameter: boolean true.</li>
<li><code class="docutils literal"><span class="pre">0x00000000000000000000000000000000000000000000000000000000000000a0</span></code>: the location of the data part of the third parameter (dynamic type), measured in bytes. In this case, <code class="docutils literal"><span class="pre">0xa0</span></code>.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000004</span></code>: the data part of the first argument, it starts with the length of the byte array in elements, in this case, 4.</li>
<li><code class="docutils literal"><span class="pre">0x6461766500000000000000000000000000000000000000000000000000000000</span></code>: the contents of the first argument: the UTF-8 (equal to ASCII in this case) encoding of <code class="docutils literal"><span class="pre">&quot;dave&quot;</span></code>, padded on the right to 32 bytes.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code>: the data part of the third argument, it starts with the length of the array in elements, in this case, 3.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the first entry of the third parameter.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code>: the second entry of the third parameter.</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code>: the third entry of the third parameter.</li>
</ul>
<p>In total:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xa5643bf20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000464617665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003</span>
</pre></div>
</div>
</div>
<div class="section" id="use-of-dynamic-types">
<h3>Use of Dynamic Types<a class="headerlink" href="#use-of-dynamic-types" title="Permalink to this headline">¶</a></h3>
<p>A call to a function with the signature <code class="docutils literal"><span class="pre">f(uint,uint32[],bytes10,bytes)</span></code> with values <code class="docutils literal"><span class="pre">(0x123,</span> <span class="pre">[0x456,</span> <span class="pre">0x789],</span> <span class="pre">&quot;1234567890&quot;,</span> <span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;)</span></code> is encoded in the following way:</p>
<p>We take the first four bytes of <code class="docutils literal"><span class="pre">sha3(&quot;f(uint256,uint32[],bytes10,bytes)&quot;)</span></code>, i.e. <code class="docutils literal"><span class="pre">0x8be65246</span></code>.
Then we encode the head parts of all four arguments. For the static types <code class="docutils literal"><span class="pre">uint256</span></code> and <code class="docutils literal"><span class="pre">bytes10</span></code>, these are directly the values we want to pass, whereas for the dynamic types <code class="docutils literal"><span class="pre">uint32[]</span></code> and <code class="docutils literal"><span class="pre">bytes</span></code>, we use the offset in bytes to the start of their data area, measured from the start of the value encoding (i.e. not counting the first four bytes containing the hash of the function signature). These are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000123</span></code> (<code class="docutils literal"><span class="pre">0x123</span></code> padded to 32 bytes)</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000080</span></code> (offset to start of data part of second parameter, 4*32 bytes, exactly the size of the head part)</li>
<li><code class="docutils literal"><span class="pre">0x3132333435363738393000000000000000000000000000000000000000000000</span></code> (<code class="docutils literal"><span class="pre">&quot;1234567890&quot;</span></code> padded to 32 bytes on the right)</li>
<li><code class="docutils literal"><span class="pre">0x00000000000000000000000000000000000000000000000000000000000000e0</span></code> (offset to start of data part of fourth parameter = offset to start of data part of first dynamic parameter + size of data part of first dynamic parameter = 4*32 + 3*32 (see below))</li>
</ul>
</div></blockquote>
<p>After this, the data part of the first dynamic argument, <code class="docutils literal"><span class="pre">[0x456,</span> <span class="pre">0x789]</span></code> follows:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (number of elements of the array, 2)</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000456</span></code> (first element)</li>
<li><code class="docutils literal"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000789</span></code> (second element)</li>
</ul>
</div></blockquote>
<p>Finally, we encode the data part of the second dynamic argument, <code class="docutils literal"><span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">0x000000000000000000000000000000000000000000000000000000000000000d</span></code> (number of elements (bytes in this case): 13)</li>
<li><code class="docutils literal"><span class="pre">0x48656c6c6f2c20776f726c642100000000000000000000000000000000000000</span></code> (<code class="docutils literal"><span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;</span></code> padded to 32 bytes on the right)</li>
</ul>
</div></blockquote>
<p>All together, the encoding is (newline after function selector and each 32-bytes for clarity):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0x8be65246</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000123</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000080</span>
  <span class="mi">3132333435363738393000000000000000000000000000000000000000000000</span>
  <span class="mi">00000000000000000000000000000000000000000000000000000000000000e0</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000002</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000456</span>
  <span class="mi">0000000000000000000000000000000000000000000000000000000000000789</span>
  <span class="mi">000000000000000000000000000000000000000000000000000000000000000</span><span class="nx">d</span>
  <span class="mi">48656</span><span class="nx">c6c6f2c20776f726c642100000000000000000000000000000000000000</span>
</pre></div>
</div>
</div>
<div class="section" id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p>Events are an abstraction of the Ethereum logging/event-watching protocol. Log entries provide the contract’s address, a series of up to four topics and some arbitrary length binary data. Events leverage the existing function ABI in order to interpret this (together with an interface spec) as a properly typed structure.</p>
<p>Given an event name and series of event parameters, we split them into two sub-series: those which are indexed and those which are not. Those which are indexed, which may number up to 3, are used alongside the Keccak hash of the event signature to form the topics of the log entry. Those which are not indexed form the byte array of the event.</p>
<p>In effect, a log entry using this ABI is described as:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">address</span></code>: the address of the contract (intrinsically provided by Ethereum);</li>
<li><code class="docutils literal"><span class="pre">topics[0]</span></code>: <code class="docutils literal"><span class="pre">keccak(EVENT_NAME+&quot;(&quot;+EVENT_ARGS.map(canonical_type_of).join(&quot;,&quot;)+&quot;)&quot;)</span></code> (<code class="docutils literal"><span class="pre">canonical_type_of</span></code> is a function that simply returns the canonical type of a given argument, e.g. for <code class="docutils literal"><span class="pre">uint</span> <span class="pre">indexed</span> <span class="pre">foo</span></code>, it would return <code class="docutils literal"><span class="pre">uint256</span></code>). If the event is declared as <code class="docutils literal"><span class="pre">anonymous</span></code> the <code class="docutils literal"><span class="pre">topics[0]</span></code> is not generated;</li>
<li><code class="docutils literal"><span class="pre">topics[n]</span></code>: <code class="docutils literal"><span class="pre">EVENT_INDEXED_ARGS[n</span> <span class="pre">-</span> <span class="pre">1]</span></code> (<code class="docutils literal"><span class="pre">EVENT_INDEXED_ARGS</span></code> is the series of <code class="docutils literal"><span class="pre">EVENT_ARGS</span></code> that are indexed);</li>
<li><code class="docutils literal"><span class="pre">data</span></code>: <code class="docutils literal"><span class="pre">abi_serialise(EVENT_NON_INDEXED_ARGS)</span></code> (<code class="docutils literal"><span class="pre">EVENT_NON_INDEXED_ARGS</span></code> is the series of <code class="docutils literal"><span class="pre">EVENT_ARGS</span></code> that are not indexed, <code class="docutils literal"><span class="pre">abi_serialise</span></code> is the ABI serialisation function used for returning a series of typed values from a function, as described above).</li>
</ul>
<p>For all fixed-length Solidity types, the <code class="docutils literal"><span class="pre">EVENT_INDEXED_ARGS</span></code> array contains the 32-byte encoded value directly. However, for <em>types of dynamic length</em>, which include <code class="docutils literal"><span class="pre">string</span></code>, <code class="docutils literal"><span class="pre">bytes</span></code>, and arrays, <code class="docutils literal"><span class="pre">EVENT_INDEXED_ARGS</span></code> will contain the <em>Keccak hash</em> of the encoded value, rather than the encoded value directly. This allows applications to efficiently query for values of dynamic-length types (by setting the hash of the encoded value as the topic), but leaves applications unable to decode indexed values they have not queried for. For dynamic-length types, application developers face a trade-off between fast search for predetermined values (if the argument is indexed) and legibility of arbitrary values (which requires that the arguments not be indexed). Developers may overcome this tradeoff and achieve both efficient search and arbitrary legibility by defining events with two arguments — one indexed, one not — intended to hold the same value.</p>
</div>
<div class="section" id="json">
<span id="abi-json"></span><h3>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>The JSON format for a contract’s interface is given by an array of function and/or event descriptions.
A function description is a JSON object with the fields:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">type</span></code>: <code class="docutils literal"><span class="pre">&quot;function&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;constructor&quot;</span></code>, or <code class="docutils literal"><span class="pre">&quot;fallback&quot;</span></code> (the <a class="reference internal" href="index.html#fallback-function"><span class="std std-ref">unnamed “default” function</span></a>);</li>
<li><code class="docutils literal"><span class="pre">name</span></code>: the name of the function;</li>
<li><code class="docutils literal"><span class="pre">inputs</span></code>: an array of objects, each of which contains:<ul>
<li><code class="docutils literal"><span class="pre">name</span></code>: the name of the parameter;</li>
<li><code class="docutils literal"><span class="pre">type</span></code>: the canonical type of the parameter (more below).</li>
<li><code class="docutils literal"><span class="pre">components</span></code>: used for tuple types (more below).</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">outputs</span></code>: an array of objects similar to <code class="docutils literal"><span class="pre">inputs</span></code>, can be omitted if function doesn’t return anything;</li>
<li><code class="docutils literal"><span class="pre">payable</span></code>: <code class="docutils literal"><span class="pre">true</span></code> if function accepts ether, defaults to <code class="docutils literal"><span class="pre">false</span></code>;</li>
<li><code class="docutils literal"><span class="pre">stateMutability</span></code>: a string with one of the following values: <code class="docutils literal"><span class="pre">pure</span></code> (<a class="reference internal" href="index.html#pure-functions"><span class="std std-ref">specified to not read blockchain state</span></a>), <code class="docutils literal"><span class="pre">view</span></code> (<a class="reference internal" href="index.html#view-functions"><span class="std std-ref">specified to not modify the blockchain state</span></a>), <code class="docutils literal"><span class="pre">nonpayable</span></code> and <code class="docutils literal"><span class="pre">payable</span></code> (same as <code class="docutils literal"><span class="pre">payable</span></code> above).</li>
<li><code class="docutils literal"><span class="pre">constant</span></code>: <code class="docutils literal"><span class="pre">true</span></code> if function is either <code class="docutils literal"><span class="pre">pure</span></code> or <code class="docutils literal"><span class="pre">view</span></code></li>
</ul>
<p><code class="docutils literal"><span class="pre">type</span></code> can be omitted, defaulting to <code class="docutils literal"><span class="pre">&quot;function&quot;</span></code>.</p>
<p>Constructor and fallback function never have <code class="docutils literal"><span class="pre">name</span></code> or <code class="docutils literal"><span class="pre">outputs</span></code>. Fallback function doesn’t have <code class="docutils literal"><span class="pre">inputs</span></code> either.</p>
<p>Sending non-zero ether to non-payable function will throw. Don’t do it.</p>
<p>An event description is a JSON object with fairly similar fields:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">type</span></code>: always <code class="docutils literal"><span class="pre">&quot;event&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">name</span></code>: the name of the event;</li>
<li><code class="docutils literal"><span class="pre">inputs</span></code>: an array of objects, each of which contains:<ul>
<li><code class="docutils literal"><span class="pre">name</span></code>: the name of the parameter;</li>
<li><code class="docutils literal"><span class="pre">type</span></code>: the canonical type of the parameter (more below).</li>
<li><code class="docutils literal"><span class="pre">components</span></code>: used for tuple types (more below).</li>
<li><code class="docutils literal"><span class="pre">indexed</span></code>: <code class="docutils literal"><span class="pre">true</span></code> if the field is part of the log’s topics, <code class="docutils literal"><span class="pre">false</span></code> if it one of the log’s data segment.</li>
</ul>
</li>
<li><code class="docutils literal"><span class="pre">anonymous</span></code>: <code class="docutils literal"><span class="pre">true</span></code> if the event was declared as <code class="docutils literal"><span class="pre">anonymous</span></code>.</li>
</ul>
<p>For example,</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Test</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">Test</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">b</span> <span class="o">=</span> <span class="mh">0x12345678901234567890123456789012</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">event</span> <span class="nx">Event</span><span class="p">(</span><span class="kt">uint</span> <span class="k">indexed</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="nx">b</span><span class="p">);</span>
  <span class="kd">event</span> <span class="nx">Event2</span><span class="p">(</span><span class="kt">uint</span> <span class="k">indexed</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="nx">b</span><span class="p">);</span>
  <span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">Event</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">);</span> <span class="p">}</span>
  <span class="kt">bytes32</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>would result in the JSON:</p>
<div class="code json highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">[{</span>
<span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span>
<span class="s2">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">},{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}],</span>
<span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Event&quot;</span>
<span class="p">},</span> <span class="p">{</span>
<span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span>
<span class="s2">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">true</span><span class="p">},{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="s2">&quot;indexed&quot;</span><span class="o">:</span><span class="kc">false</span><span class="p">}],</span>
<span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Event2&quot;</span>
<span class="p">},</span> <span class="p">{</span>
<span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
<span class="s2">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
<span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="s2">&quot;outputs&quot;</span><span class="o">:</span> <span class="p">[]</span>
<span class="p">}]</span>
</pre></div>
</div>
<div class="section" id="handling-tuple-types">
<h4>Handling tuple types<a class="headerlink" href="#handling-tuple-types" title="Permalink to this headline">¶</a></h4>
<p>Despite that names are intentionally not part of the ABI encoding they do make a lot of sense to be included
in the JSON to enable displaying it to the end user. The structure is nested in the following way:</p>
<p>An object with members <code class="docutils literal"><span class="pre">name</span></code>, <code class="docutils literal"><span class="pre">type</span></code> and potentially <code class="docutils literal"><span class="pre">components</span></code> describes a typed variable.
The canonical type is determined until a tuple type is reached and the string description up
to that point is stored in <code class="docutils literal"><span class="pre">type</span></code> prefix with the word <code class="docutils literal"><span class="pre">tuple</span></code>, i.e. it will be <code class="docutils literal"><span class="pre">tuple</span></code> followed by
a sequence of <code class="docutils literal"><span class="pre">[]</span></code> and <code class="docutils literal"><span class="pre">[k]</span></code> with
integers <code class="docutils literal"><span class="pre">k</span></code>. The components of the tuple are then stored in the member <code class="docutils literal"><span class="pre">components</span></code>,
which is of array type and has the same structure as the top-level object except that
<code class="docutils literal"><span class="pre">indexed</span></code> is not allowed there.</p>
<p>As an example, the code</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">19</span><span class="p">;</span>
<span class="k">pragma</span> <span class="nx">experimental</span> <span class="nx">ABIEncoderV2</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Test</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="nx">S</span> <span class="p">{</span> <span class="kt">uint</span> <span class="nx">a</span><span class="p">;</span> <span class="kt">uint</span><span class="p">[]</span> <span class="nx">b</span><span class="p">;</span> <span class="nx">T</span><span class="p">[]</span> <span class="nx">c</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">struct</span> <span class="nx">T</span> <span class="p">{</span> <span class="kt">uint</span> <span class="nx">x</span><span class="p">;</span> <span class="kt">uint</span> <span class="nx">y</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">S</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">T</span> <span class="nx">t</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="nx">S</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">T</span> <span class="nx">t</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">a</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>would result in the JSON:</p>
<div class="code json highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inputs&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;tuple&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;uint256&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;uint256[]&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;tuple[]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;components&quot;</span><span class="o">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;uint256&quot;</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;uint256&quot;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;tuple&quot;</span><span class="p">,</span>
        <span class="s2">&quot;components&quot;</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;uint256&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;uint256&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;uint256&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;outputs&quot;</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="non-standard-packed-mode">
<span id="abi-packed-mode"></span><h3>Non-standard Packed Mode<a class="headerlink" href="#non-standard-packed-mode" title="Permalink to this headline">¶</a></h3>
<p>Solidity supports a non-standard packed mode where:</p>
<ul class="simple">
<li>no <a class="reference internal" href="#abi-function-selector"><span class="std std-ref">function selector</span></a> is encoded,</li>
<li>types shorter than 32 bytes are neither zero padded nor sign extended and</li>
<li>dynamic types are encoded in-place and without the length.</li>
</ul>
<p>As an example encoding <code class="docutils literal"><span class="pre">int1,</span> <span class="pre">bytes1,</span> <span class="pre">uint16,</span> <span class="pre">string</span></code> with values <code class="docutils literal"><span class="pre">-1,</span> <span class="pre">0x42,</span> <span class="pre">0x2424,</span> <span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;</span></code> results in</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="mh">0xff42242448656c6c6f2c20776f726c6421</span>
  <span class="o">^^</span>                                 <span class="nx">int1</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">^^</span>                               <span class="kt">bytes1</span><span class="p">(</span><span class="mh">0x42</span><span class="p">)</span>
      <span class="o">^^^^</span>                           <span class="kt">uint16</span><span class="p">(</span><span class="mh">0x2424</span><span class="p">)</span>
          <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^</span> <span class="kt">string</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span> <span class="nx">without</span> <span class="nx">a</span> <span class="nx">length</span> <span class="nx">field</span>
</pre></div>
</div>
<p>More specifically, each statically-sized type takes as many bytes as its range has
and dynamically-sized types like <code class="docutils literal"><span class="pre">string</span></code>, <code class="docutils literal"><span class="pre">bytes</span></code> or <code class="docutils literal"><span class="pre">uint[]</span></code> are encoded without
their length field. This means that the encoding is ambiguous as soon as there are two
dynamically-sized elements.</p>
</div>
</div>
<span id="document-julia"></span><div class="section" id="joyfully-universal-language-for-inline-assembly">
<h2>Joyfully Universal Language for (Inline) Assembly<a class="headerlink" href="#joyfully-universal-language-for-inline-assembly" title="Permalink to this headline">¶</a></h2>
<span class="target" id="julia"></span><p id="index-0">JULIA is an intermediate language that can compile to various different backends
(EVM 1.0, EVM 1.5 and eWASM are planned).
Because of that, it is designed to be a usable common denominator of all three
platforms.
It can already be used for “inline assembly” inside Solidity and
future versions of the Solidity compiler will even use JULIA as intermediate
language. It should also be easy to build high-level optimizer stages for JULIA.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the flavour used for “inline assembly” does not have types
(everything is <code class="docutils literal"><span class="pre">u256</span></code>) and the built-in functions are identical
to the EVM opcodes. Please resort to the inline assembly documentation
for details.</p>
</div>
<p>The core components of JULIA are functions, blocks, variables, literals,
for-loops, if-statements, switch-statements, expressions and assignments to variables.</p>
<p>JULIA is typed, both variables and literals must specify the type with postfix
notation. The supported types are <code class="docutils literal"><span class="pre">bool</span></code>, <code class="docutils literal"><span class="pre">u8</span></code>, <code class="docutils literal"><span class="pre">s8</span></code>, <code class="docutils literal"><span class="pre">u32</span></code>, <code class="docutils literal"><span class="pre">s32</span></code>,
<code class="docutils literal"><span class="pre">u64</span></code>, <code class="docutils literal"><span class="pre">s64</span></code>, <code class="docutils literal"><span class="pre">u128</span></code>, <code class="docutils literal"><span class="pre">s128</span></code>, <code class="docutils literal"><span class="pre">u256</span></code> and <code class="docutils literal"><span class="pre">s256</span></code>.</p>
<p>JULIA in itself does not even provide operators. If the EVM is targeted,
opcodes will be available as built-in functions, but they can be reimplemented
if the backend changes. For a list of mandatory built-in functions, see the section below.</p>
<p>The following example program assumes that the EVM opcodes <code class="docutils literal"><span class="pre">mul</span></code>, <code class="docutils literal"><span class="pre">div</span></code>
and <code class="docutils literal"><span class="pre">mod</span></code> are available either natively or as functions and computes exponentiation.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kd">function</span> <span class="nx">power</span><span class="p">(</span><span class="nx">base</span><span class="o">:</span><span class="nx">u256</span><span class="p">,</span> <span class="nx">exponent</span><span class="o">:</span><span class="nx">u256</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">result</span><span class="o">:</span><span class="nx">u256</span>
    <span class="p">{</span>
        <span class="kr">switch</span> <span class="nx">exponent</span>
        <span class="kr">case</span> <span class="mi">0</span><span class="o">:</span><span class="nx">u256</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">:</span><span class="nx">u256</span> <span class="p">}</span>
        <span class="kr">case</span> <span class="mi">1</span><span class="o">:</span><span class="nx">u256</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="nx">base</span> <span class="p">}</span>
        <span class="kr">default</span><span class="o">:</span>
        <span class="p">{</span>
            <span class="nx">result</span> <span class="o">:=</span> <span class="nx">power</span><span class="p">(</span><span class="nx">mul</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">base</span><span class="p">),</span> <span class="nx">div</span><span class="p">(</span><span class="nx">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="nx">u256</span><span class="p">))</span>
            <span class="kr">switch</span> <span class="nx">mod</span><span class="p">(</span><span class="nx">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="nx">u256</span><span class="p">)</span>
                <span class="kr">case</span> <span class="mi">1</span><span class="o">:</span><span class="nx">u256</span> <span class="p">{</span> <span class="nx">result</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also possible to implement the same function using a for-loop
instead of with recursion. Here, we need the EVM opcodes <code class="docutils literal"><span class="pre">lt</span></code> (less-than)
and <code class="docutils literal"><span class="pre">add</span></code> to be available.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kd">function</span> <span class="nx">power</span><span class="p">(</span><span class="nx">base</span><span class="o">:</span><span class="nx">u256</span><span class="p">,</span> <span class="nx">exponent</span><span class="o">:</span><span class="nx">u256</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nx">result</span><span class="o">:</span><span class="nx">u256</span>
    <span class="p">{</span>
        <span class="nx">result</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">:</span><span class="nx">u256</span>
        <span class="k">for</span> <span class="p">{</span> <span class="kr">let</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">:</span><span class="nx">u256</span> <span class="p">}</span> <span class="nx">lt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">exponent</span><span class="p">)</span> <span class="p">{</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">add</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="nx">u256</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">{</span>
            <span class="nx">result</span> <span class="o">:=</span> <span class="nx">mul</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">base</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="specification-of-julia">
<h3>Specification of JULIA<a class="headerlink" href="#specification-of-julia" title="Permalink to this headline">¶</a></h3>
<p>JULIA code is described in this chapter. JULIA code is usually placed into a JULIA object, which is described in the following chapter.</p>
<p>Grammar:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">Block</span> <span class="o">=</span> <span class="s1">&#39;{&#39;</span> <span class="nx">Statement</span><span class="o">*</span> <span class="s1">&#39;}&#39;</span>
<span class="nx">Statement</span> <span class="o">=</span>
    <span class="nx">Block</span> <span class="o">|</span>
    <span class="nx">FunctionDefinition</span> <span class="o">|</span>
    <span class="nx">VariableDeclaration</span> <span class="o">|</span>
    <span class="nx">Assignment</span> <span class="o">|</span>
    <span class="nx">Expression</span> <span class="o">|</span>
    <span class="nx">Switch</span> <span class="o">|</span>
    <span class="nx">ForLoop</span> <span class="o">|</span>
    <span class="nx">BreakContinue</span>
<span class="nx">FunctionDefinition</span> <span class="o">=</span>
    <span class="s1">&#39;function&#39;</span> <span class="nx">Identifier</span> <span class="s1">&#39;(&#39;</span> <span class="nx">TypedIdentifierList</span><span class="o">?</span> <span class="s1">&#39;)&#39;</span>
    <span class="p">(</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="nx">TypedIdentifierList</span> <span class="p">)</span><span class="o">?</span> <span class="nx">Block</span>
<span class="nx">VariableDeclaration</span> <span class="o">=</span>
    <span class="s1">&#39;let&#39;</span> <span class="nx">TypedIdentifierList</span> <span class="p">(</span> <span class="s1">&#39;:=&#39;</span> <span class="nx">Expression</span> <span class="p">)</span><span class="o">?</span>
<span class="nx">Assignment</span> <span class="o">=</span>
    <span class="nx">IdentifierList</span> <span class="s1">&#39;:=&#39;</span> <span class="nx">Expression</span>
<span class="nx">Expression</span> <span class="o">=</span>
    <span class="nx">FunctionCall</span> <span class="o">|</span> <span class="nx">Identifier</span> <span class="o">|</span> <span class="nx">Literal</span>
<span class="nx">If</span> <span class="o">=</span>
    <span class="s1">&#39;if&#39;</span> <span class="nx">Expression</span> <span class="nx">Block</span>
<span class="nx">Switch</span> <span class="o">=</span>
    <span class="s1">&#39;switch&#39;</span> <span class="nx">Expression</span> <span class="nx">Case</span><span class="o">*</span> <span class="p">(</span> <span class="s1">&#39;default&#39;</span> <span class="nx">Block</span> <span class="p">)</span><span class="o">?</span>
<span class="nx">Case</span> <span class="o">=</span>
    <span class="s1">&#39;case&#39;</span> <span class="nx">Literal</span> <span class="nx">Block</span>
<span class="nx">ForLoop</span> <span class="o">=</span>
    <span class="s1">&#39;for&#39;</span> <span class="nx">Block</span> <span class="nx">Expression</span> <span class="nx">Block</span> <span class="nx">Block</span>
<span class="nx">BreakContinue</span> <span class="o">=</span>
    <span class="s1">&#39;break&#39;</span> <span class="o">|</span> <span class="s1">&#39;continue&#39;</span>
<span class="nx">FunctionCall</span> <span class="o">=</span>
    <span class="nx">Identifier</span> <span class="s1">&#39;(&#39;</span> <span class="p">(</span> <span class="nx">Expression</span> <span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="nx">Expression</span> <span class="p">)</span><span class="o">*</span> <span class="p">)</span><span class="o">?</span> <span class="s1">&#39;)&#39;</span>
<span class="nx">Identifier</span> <span class="o">=</span> <span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_$</span><span class="p">]</span> <span class="p">[</span><span class="nx">a</span><span class="o">-</span><span class="nx">zA</span><span class="o">-</span><span class="nx">Z_0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span>
<span class="nx">IdentifierList</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="nx">Identifier</span><span class="p">)</span><span class="o">*</span>
<span class="nx">TypeName</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="o">|</span> <span class="nx">BuiltinTypeName</span>
<span class="nx">BuiltinTypeName</span> <span class="o">=</span> <span class="s1">&#39;bool&#39;</span> <span class="o">|</span> <span class="p">[</span><span class="nx">us</span><span class="p">]</span> <span class="p">(</span> <span class="s1">&#39;8&#39;</span> <span class="o">|</span> <span class="s1">&#39;32&#39;</span> <span class="o">|</span> <span class="s1">&#39;64&#39;</span> <span class="o">|</span> <span class="s1">&#39;128&#39;</span> <span class="o">|</span> <span class="s1">&#39;256&#39;</span> <span class="p">)</span>
<span class="nx">TypedIdentifierList</span> <span class="o">=</span> <span class="nx">Identifier</span> <span class="s1">&#39;:&#39;</span> <span class="nx">TypeName</span> <span class="p">(</span> <span class="s1">&#39;,&#39;</span> <span class="nx">Identifier</span> <span class="s1">&#39;:&#39;</span> <span class="nx">TypeName</span> <span class="p">)</span><span class="o">*</span>
<span class="nx">Literal</span> <span class="o">=</span>
    <span class="p">(</span><span class="nx">NumberLiteral</span> <span class="o">|</span> <span class="nx">StringLiteral</span> <span class="o">|</span> <span class="nx">HexLiteral</span> <span class="o">|</span> <span class="nx">TrueLiteral</span> <span class="o">|</span> <span class="nx">FalseLiteral</span><span class="p">)</span> <span class="s1">&#39;:&#39;</span> <span class="nx">TypeName</span>
<span class="nx">NumberLiteral</span> <span class="o">=</span> <span class="nx">HexNumber</span> <span class="o">|</span> <span class="nx">DecimalNumber</span>
<span class="nx">HexLiteral</span> <span class="o">=</span> <span class="s1">&#39;hex&#39;</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">|</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">)</span>
<span class="nx">StringLiteral</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="o">^</span><span class="s2">&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;</span><span class="s1">&#39;</span>
<span class="s1">TrueLiteral = &#39;</span><span class="kc">true</span><span class="s1">&#39;</span>
<span class="s1">FalseLiteral = &#39;</span><span class="kc">false</span><span class="s1">&#39;</span>
<span class="s1">HexNumber = &#39;</span><span class="mi">0</span><span class="nx">x</span><span class="err">&#39;</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]</span><span class="o">+</span>
<span class="nx">DecimalNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
</pre></div>
</div>
<div class="section" id="restrictions-on-the-grammar">
<h4>Restrictions on the Grammar<a class="headerlink" href="#restrictions-on-the-grammar" title="Permalink to this headline">¶</a></h4>
<p>Switches must have at least one case (including the default case).
If all possible values of the expression is covered, the default case should
not be allowed (i.e. a switch with a <code class="docutils literal"><span class="pre">bool</span></code> expression and having both a
true and false case should not allow a default case).</p>
<p>Every expression evaluates to zero or more values. Identifiers and Literals
evaluate to exactly
one value and function calls evaluate to a number of values equal to the
number of return values of the function called.</p>
<p>In variable declarations and assignments, the right-hand-side expression
(if present) has to evaluate to a number of values equal to the number of
variables on the left-hand-side.
This is the only situation where an expression evaluating
to more than one value is allowed.</p>
<p>Expressions that are also statements (i.e. at the block level) have to
evaluate to zero values.</p>
<p>In all other situations, expressions have to evaluate to exactly one value.</p>
<p>The <code class="docutils literal"><span class="pre">continue</span></code> and <code class="docutils literal"><span class="pre">break</span></code> statements can only be used inside loop bodies
and have to be in the same function as the loop (or both have to be at the
top level).
The condition part of the for-loop has to evaluate to exactly one value.</p>
<p>Literals cannot be larger than the their type. The largest type defined is 256-bit wide.</p>
</div>
<div class="section" id="scoping-rules">
<h4>Scoping Rules<a class="headerlink" href="#scoping-rules" title="Permalink to this headline">¶</a></h4>
<p>Scopes in JULIA are tied to Blocks (exceptions are functions and the for loop
as explained below) and all declarations
(<code class="docutils literal"><span class="pre">FunctionDefinition</span></code>, <code class="docutils literal"><span class="pre">VariableDeclaration</span></code>)
introduce new identifiers into these scopes.</p>
<p>Identifiers are visible in
the block they are defined in (including all sub-nodes and sub-blocks).
As an exception, identifiers defined in the “init” part of the for-loop
(the first block) are visible in all other parts of the for-loop
(but not outside of the loop).
Identifiers declared in the other parts of the for loop respect the regular
syntatical scoping rules.
The parameters and return parameters of functions are visible in the
function body and their names cannot overlap.</p>
<p>Variables can only be referenced after their declaration. In particular,
variables cannot be referenced in the right hand side of their own variable
declaration.
Functions can be referenced already before their declaration (if they are visible).</p>
<p>Shadowing is disallowed, i.e. you cannot declare an identifier at a point
where another identifier with the same name is also visible, even if it is
not accessible.</p>
<p>Inside functions, it is not possible to access a variable that was declared
outside of that function.</p>
</div>
<div class="section" id="formal-specification">
<h4>Formal Specification<a class="headerlink" href="#formal-specification" title="Permalink to this headline">¶</a></h4>
<p>We formally specify JULIA by providing an evaluation function E overloaded
on the various nodes of the AST. Any functions can have side effects, so
E takes two state objects and the AST node and returns two new
state objects and a variable number of other values.
The two state objects are the global state object
(which in the context of the EVM is the memory, storage and state of the
blockchain) and the local state object (the state of local variables, i.e. a
segment of the stack in the EVM).
If the AST node is a statement, E returns the two state objects and a “mode”,
which is used for the <code class="docutils literal"><span class="pre">break</span></code> and <code class="docutils literal"><span class="pre">continue</span></code> statements.
If the AST node is an expression, E returns the two state objects and
as many values as the expression evaluates to.</p>
<p>The exact nature of the global state is unspecified for this high level
description. The local state <code class="docutils literal"><span class="pre">L</span></code> is a mapping of identifiers <code class="docutils literal"><span class="pre">i</span></code> to values <code class="docutils literal"><span class="pre">v</span></code>,
denoted as <code class="docutils literal"><span class="pre">L[i]</span> <span class="pre">=</span> <span class="pre">v</span></code>.</p>
<p>For an identifier <code class="docutils literal"><span class="pre">v</span></code>, let <code class="docutils literal"><span class="pre">$v</span></code> be the name of the identifier.</p>
<p>We will use a destructuring notation for the AST nodes.</p>
<div class="code highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="p">{</span><span class="nx">St1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">Stn</span><span class="p">}</span><span class="o">&gt;:</span> <span class="nx">Block</span><span class="p">)</span> <span class="o">=</span>
    <span class="kr">let</span> <span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">St1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">Stn</span><span class="p">)</span>
    <span class="kr">let</span> <span class="nx">L2</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">restriction</span> <span class="kr">of</span> <span class="nx">L1</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">identifiers</span> <span class="kr">of</span> <span class="nx">L</span>
    <span class="nx">G1</span><span class="p">,</span> <span class="nx">L2</span><span class="p">,</span> <span class="nx">mode</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">St1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">Stn</span><span class="o">:</span> <span class="nx">Statement</span><span class="p">)</span> <span class="o">=</span>
    <span class="k">if</span> <span class="nx">n</span> <span class="k">is</span> <span class="nx">zero</span><span class="o">:</span>
        <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">regular</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="kr">let</span> <span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">St1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">mode</span> <span class="k">is</span> <span class="nx">regular</span> <span class="nx">then</span>
            <span class="nx">E</span><span class="p">(</span><span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">St2</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">Stn</span><span class="p">)</span>
        <span class="nx">otherwise</span>
            <span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">mode</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">FunctionDefinition</span><span class="p">)</span> <span class="o">=</span>
    <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">regular</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="kr">let</span> <span class="nx">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">varn</span> <span class="o">:=</span> <span class="nx">rhs</span><span class="o">&gt;:</span> <span class="nx">VariableDeclaration</span><span class="p">)</span> <span class="o">=</span>
    <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">varn</span> <span class="o">:=</span> <span class="nx">rhs</span><span class="o">&gt;:</span> <span class="nx">Assignment</span><span class="p">)</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="kr">let</span> <span class="nx">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">varn</span><span class="o">&gt;:</span> <span class="nx">VariableDeclaration</span><span class="p">)</span> <span class="o">=</span>
    <span class="kr">let</span> <span class="nx">L1</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="kr">of</span> <span class="nx">L</span> <span class="nx">where</span> <span class="nx">L1</span><span class="p">[</span><span class="nx">$vari</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">n</span>
    <span class="nx">G</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">regular</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="nx">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">varn</span> <span class="o">:=</span> <span class="nx">rhs</span><span class="o">&gt;:</span> <span class="nx">Assignment</span><span class="p">)</span> <span class="o">=</span>
    <span class="kr">let</span> <span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">v1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">vn</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span>
    <span class="kr">let</span> <span class="nx">L2</span> <span class="nx">be</span> <span class="nx">a</span> <span class="nx">copy</span> <span class="kr">of</span> <span class="nx">L1</span> <span class="nx">where</span> <span class="nx">L2</span><span class="p">[</span><span class="nx">$vari</span><span class="p">]</span> <span class="o">=</span> <span class="nx">vi</span> <span class="k">for</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">...,</span> <span class="nx">n</span>
    <span class="nx">G</span><span class="p">,</span> <span class="nx">L2</span><span class="p">,</span> <span class="nx">regular</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">for</span> <span class="p">{</span> <span class="nx">i1</span><span class="p">,</span> <span class="p">...,</span> <span class="kr">in</span> <span class="p">}</span> <span class="nx">condition</span> <span class="nx">post</span> <span class="nx">body</span><span class="o">&gt;:</span> <span class="nx">ForLoop</span><span class="p">)</span> <span class="o">=</span>
    <span class="k">if</span> <span class="nx">n</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">:</span>
        <span class="kr">let</span> <span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">i1</span><span class="p">,</span> <span class="p">...,</span> <span class="kr">in</span><span class="p">)</span>
        <span class="c1">// mode has to be regular due to the syntactic restrictions</span>
        <span class="kr">let</span> <span class="nx">G2</span><span class="p">,</span> <span class="nx">L2</span><span class="p">,</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="k">for</span> <span class="p">{}</span> <span class="nx">condition</span> <span class="nx">post</span> <span class="nx">body</span><span class="p">)</span>
        <span class="c1">// mode has to be regular due to the syntactic restrictions</span>
        <span class="kr">let</span> <span class="nx">L3</span> <span class="nx">be</span> <span class="nx">the</span> <span class="nx">restriction</span> <span class="kr">of</span> <span class="nx">L2</span> <span class="nx">to</span> <span class="nx">only</span> <span class="nx">variables</span> <span class="kr">of</span> <span class="nx">L</span>
        <span class="nx">G2</span><span class="p">,</span> <span class="nx">L3</span><span class="p">,</span> <span class="nx">regular</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="kr">let</span> <span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">v</span> <span class="k">is</span> <span class="kc">false</span><span class="o">:</span>
            <span class="nx">G1</span><span class="p">,</span> <span class="nx">L1</span><span class="p">,</span> <span class="nx">regular</span>
        <span class="k">else</span><span class="o">:</span>
            <span class="kr">let</span> <span class="nx">G2</span><span class="p">,</span> <span class="nx">L2</span><span class="p">,</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G1</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">mode</span> <span class="k">is</span> <span class="k">break</span><span class="o">:</span>
                <span class="nx">G2</span><span class="p">,</span> <span class="nx">L2</span><span class="p">,</span> <span class="nx">regular</span>
            <span class="k">else</span><span class="o">:</span>
                <span class="nx">G3</span><span class="p">,</span> <span class="nx">L3</span><span class="p">,</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G2</span><span class="p">,</span> <span class="nx">L2</span><span class="p">,</span> <span class="nx">post</span><span class="p">)</span>
                <span class="nx">E</span><span class="p">(</span><span class="nx">G3</span><span class="p">,</span> <span class="nx">L3</span><span class="p">,</span> <span class="k">for</span> <span class="p">{}</span> <span class="nx">condition</span> <span class="nx">post</span> <span class="nx">body</span><span class="p">)</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="k">break</span><span class="o">:</span> <span class="nx">BreakContinue</span><span class="p">)</span> <span class="o">=</span>
    <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="k">break</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="k">continue</span><span class="o">:</span> <span class="nx">BreakContinue</span><span class="p">)</span> <span class="o">=</span>
    <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="k">continue</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">if</span> <span class="nx">condition</span> <span class="nx">body</span><span class="o">&gt;:</span> <span class="nx">If</span><span class="p">)</span> <span class="o">=</span>
    <span class="kr">let</span> <span class="nx">G0</span><span class="p">,</span> <span class="nx">L0</span><span class="p">,</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">condition</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">v</span> <span class="k">is</span> <span class="kc">true</span><span class="o">:</span>
        <span class="nx">E</span><span class="p">(</span><span class="nx">G0</span><span class="p">,</span> <span class="nx">L0</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="nx">G0</span><span class="p">,</span> <span class="nx">L0</span><span class="p">,</span> <span class="nx">regular</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="kr">switch</span> <span class="nx">condition</span> <span class="kr">case</span> <span class="nx">l1</span><span class="o">:</span><span class="nx">t1</span> <span class="nx">st1</span> <span class="p">...</span> <span class="kr">case</span> <span class="nx">ln</span><span class="o">:</span><span class="nx">tn</span> <span class="nx">stn</span><span class="o">&gt;:</span> <span class="nx">Switch</span><span class="p">)</span> <span class="o">=</span>
    <span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="kr">switch</span> <span class="nx">condition</span> <span class="kr">case</span> <span class="nx">l1</span><span class="o">:</span><span class="nx">t1</span> <span class="nx">st1</span> <span class="p">...</span> <span class="kr">case</span> <span class="nx">ln</span><span class="o">:</span><span class="nx">tn</span> <span class="nx">stn</span> <span class="kr">default</span> <span class="p">{})</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="kr">switch</span> <span class="nx">condition</span> <span class="kr">case</span> <span class="nx">l1</span><span class="o">:</span><span class="nx">t1</span> <span class="nx">st1</span> <span class="p">...</span> <span class="kr">case</span> <span class="nx">ln</span><span class="o">:</span><span class="nx">tn</span> <span class="nx">stn</span> <span class="kr">default</span> <span class="nx">st</span><span class="s1">&#39;&gt;: Switch) =</span>
<span class="s1">    let G0, L0, v = E(G, L, condition)</span>
<span class="s1">    // i = 1 .. n</span>
<span class="s1">    // Evaluate literals, context doesn&#39;</span><span class="nx">t</span> <span class="nx">matter</span>
    <span class="kr">let</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v1</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G0</span><span class="p">,</span> <span class="nx">L0</span><span class="p">,</span> <span class="nx">l1</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="kr">let</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">vn</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">G0</span><span class="p">,</span> <span class="nx">L0</span><span class="p">,</span> <span class="nx">ln</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">there</span> <span class="nx">exists</span> <span class="nx">smallest</span> <span class="nx">i</span> <span class="nx">such</span> <span class="nx">that</span> <span class="nx">vi</span> <span class="o">=</span> <span class="nx">v</span><span class="o">:</span>
        <span class="nx">E</span><span class="p">(</span><span class="nx">G0</span><span class="p">,</span> <span class="nx">L0</span><span class="p">,</span> <span class="nx">sti</span><span class="p">)</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="nx">E</span><span class="p">(</span><span class="nx">G0</span><span class="p">,</span> <span class="nx">L0</span><span class="p">,</span> <span class="nx">st</span><span class="s1">&#39;)</span>

<span class="s1">E(G, L, &lt;name&gt;: Identifier) =</span>
<span class="s1">    G, L, L[$name]</span>
<span class="s1">E(G, L, &lt;fname(arg1, ..., argn)&gt;: FunctionCall) =</span>
<span class="s1">    G1, L1, vn = E(G, L, argn)</span>
<span class="s1">    ...</span>
<span class="s1">    G(n-1), L(n-1), v2 = E(G(n-2), L(n-2), arg2)</span>
<span class="s1">    Gn, Ln, v1 = E(G(n-1), L(n-1), arg1)</span>
<span class="s1">    Let &lt;function fname (param1, ..., paramn) -&gt; ret1, ..., retm block&gt;</span>
<span class="s1">    be the function of name $fname visible at the point of the call.</span>
<span class="s1">    Let L&#39;</span> <span class="nx">be</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">local</span> <span class="nx">state</span> <span class="nx">such</span> <span class="nx">that</span>
    <span class="nx">L</span><span class="s1">&#39;[$parami] = vi and L&#39;</span><span class="p">[</span><span class="nx">$reti</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="nx">all</span> <span class="nx">i</span><span class="p">.</span>
    <span class="nx">Let</span> <span class="nx">G</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">L</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">E</span><span class="p">(</span><span class="nx">Gn</span><span class="p">,</span> <span class="nx">L</span><span class="s1">&#39;, block)</span>
<span class="s1">    G&#39;&#39;, Ln, L&#39;&#39;[$ret1], ..., L&#39;</span><span class="err">&#39;</span><span class="p">[</span><span class="nx">$retm</span><span class="p">]</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">l</span><span class="o">:</span> <span class="nx">HexLiteral</span><span class="p">)</span> <span class="o">=</span> <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">hexString</span><span class="p">(</span><span class="nx">l</span><span class="p">),</span>
    <span class="nx">where</span> <span class="nx">hexString</span> <span class="nx">decodes</span> <span class="nx">l</span> <span class="nx">from</span> <span class="k">hex</span> <span class="nx">and</span> <span class="nx">left</span><span class="o">-</span><span class="nx">aligns</span> <span class="nx">it</span> <span class="nx">into</span> <span class="mi">32</span> <span class="kt">bytes</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">l</span><span class="o">:</span> <span class="nx">StringLiteral</span><span class="p">)</span> <span class="o">=</span> <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">utf8EncodeLeftAligned</span><span class="p">(</span><span class="nx">l</span><span class="p">),</span>
    <span class="nx">where</span> <span class="nx">utf8EncodeLeftAligned</span> <span class="nx">performs</span> <span class="nx">a</span> <span class="nx">utf8</span> <span class="nx">encoding</span> <span class="kr">of</span> <span class="nx">l</span>
    <span class="nx">and</span> <span class="nx">aligns</span> <span class="nx">it</span> <span class="nx">left</span> <span class="nx">into</span> <span class="mi">32</span> <span class="kt">bytes</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">n</span><span class="o">:</span> <span class="nx">HexNumber</span><span class="p">)</span> <span class="o">=</span> <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="k">hex</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
    <span class="nx">where</span> <span class="k">hex</span> <span class="k">is</span> <span class="nx">the</span> <span class="nx">hexadecimal</span> <span class="nx">decoding</span> <span class="kd">function</span>
<span class="nx">E</span><span class="p">(</span><span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">n</span><span class="o">:</span> <span class="nx">DecimalNumber</span><span class="p">)</span> <span class="o">=</span> <span class="nx">G</span><span class="p">,</span> <span class="nx">L</span><span class="p">,</span> <span class="nx">dec</span><span class="p">(</span><span class="nx">n</span><span class="p">),</span>
    <span class="nx">where</span> <span class="nx">dec</span> <span class="k">is</span> <span class="nx">the</span> <span class="nx">decimal</span> <span class="nx">decoding</span> <span class="kd">function</span>
</pre></div>
</div>
</div>
<div class="section" id="type-conversion-functions">
<h4>Type Conversion Functions<a class="headerlink" href="#type-conversion-functions" title="Permalink to this headline">¶</a></h4>
<p>JULIA has no support for implicit type conversion and therefore functions exists to provide explicit conversion.
When converting a larger type to a shorter type a runtime exception can occur in case of an overflow.</p>
<dl class="docutils">
<dt>Truncating conversions are supported between the following types:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">bool</span></code></li>
<li><code class="docutils literal"><span class="pre">u32</span></code></li>
<li><code class="docutils literal"><span class="pre">u64</span></code></li>
<li><code class="docutils literal"><span class="pre">u256</span></code></li>
<li><code class="docutils literal"><span class="pre">s256</span></code></li>
</ul>
</dd>
</dl>
<p>For each of these a type conversion function exists having the prototype in the form of <code class="docutils literal"><span class="pre">&lt;input_type&gt;to&lt;output_type&gt;(x:&lt;input_type&gt;)</span> <span class="pre">-&gt;</span> <span class="pre">y:&lt;output_type&gt;</span></code>,
such as <code class="docutils literal"><span class="pre">u32tobool(x:u32)</span> <span class="pre">-&gt;</span> <span class="pre">y:bool</span></code>, <code class="docutils literal"><span class="pre">u256tou32(x:u256)</span> <span class="pre">-&gt;</span> <span class="pre">y:u32</span></code> or <code class="docutils literal"><span class="pre">s256tou256(x:s256)</span> <span class="pre">-&gt;</span> <span class="pre">y:u256</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">u32tobool(x:u32)</span> <span class="pre">-&gt;</span> <span class="pre">y:bool</span></code> can be implemented as <code class="docutils literal"><span class="pre">y</span> <span class="pre">:=</span> <span class="pre">not(iszerou256(x))</span></code> and
<code class="docutils literal"><span class="pre">booltou32(x:bool)</span> <span class="pre">-&gt;</span> <span class="pre">y:u32</span></code> can be implemented as <code class="docutils literal"><span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">true:bool</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">1:u32</span> <span class="pre">}</span> <span class="pre">case</span> <span class="pre">false:bool</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">0:u32</span> <span class="pre">}</span></code></p>
</div>
</div>
<div class="section" id="low-level-functions">
<h4>Low-level Functions<a class="headerlink" href="#low-level-functions" title="Permalink to this headline">¶</a></h4>
<p>The following functions must be available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2"><em>Logic</em></td>
</tr>
<tr class="row-even"><td>not(x:bool) -&gt; z:bool</td>
<td>logical not</td>
</tr>
<tr class="row-odd"><td>and(x:bool, y:bool) -&gt; z:bool</td>
<td>logical and</td>
</tr>
<tr class="row-even"><td>or(x:bool, y:bool) -&gt; z:bool</td>
<td>logical or</td>
</tr>
<tr class="row-odd"><td>xor(x:bool, y:bool) -&gt; z:bool</td>
<td>xor</td>
</tr>
<tr class="row-even"><td colspan="2"><em>Arithmetics</em></td>
</tr>
<tr class="row-odd"><td>addu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x + y</td>
</tr>
<tr class="row-even"><td>subu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x - y</td>
</tr>
<tr class="row-odd"><td>mulu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x * y</td>
</tr>
<tr class="row-even"><td>divu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x / y</td>
</tr>
<tr class="row-odd"><td>divs256(x:s256, y:s256) -&gt; z:s256</td>
<td>x / y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-even"><td>modu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x % y</td>
</tr>
<tr class="row-odd"><td>mods256(x:s256, y:s256) -&gt; z:s256</td>
<td>x % y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-even"><td>signextendu256(i:u256, x:u256) -&gt; z:u256</td>
<td>sign extend from (i*8+7)th bit counting from least significant</td>
</tr>
<tr class="row-odd"><td>expu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x to the power of y</td>
</tr>
<tr class="row-even"><td>addmodu256(x:u256, y:u256, m:u256) -&gt; z:u256</td>
<td>(x + y) % m with arbitrary precision arithmetics</td>
</tr>
<tr class="row-odd"><td>mulmodu256(x:u256, y:u256, m:u256) -&gt; z:u256</td>
<td>(x * y) % m with arbitrary precision arithmetics</td>
</tr>
<tr class="row-even"><td>ltu256(x:u256, y:u256) -&gt; z:bool</td>
<td>true if x &lt; y, false otherwise</td>
</tr>
<tr class="row-odd"><td>gtu256(x:u256, y:u256) -&gt; z:bool</td>
<td>true if x &gt; y, false otherwise</td>
</tr>
<tr class="row-even"><td>sltu256(x:s256, y:s256) -&gt; z:bool</td>
<td>true if x &lt; y, false otherwise
(for signed numbers in two’s complement)</td>
</tr>
<tr class="row-odd"><td>sgtu256(x:s256, y:s256) -&gt; z:bool</td>
<td>true if x &gt; y, false otherwise
(for signed numbers in two’s complement)</td>
</tr>
<tr class="row-even"><td>equ256(x:u256, y:u256) -&gt; z:bool</td>
<td>true if x == y, false otherwise</td>
</tr>
<tr class="row-odd"><td>iszerou256(x:u256) -&gt; z:bool</td>
<td>true if x == 0, false otherwise</td>
</tr>
<tr class="row-even"><td>notu256(x:u256) -&gt; z:u256</td>
<td>~x, every bit of x is negated</td>
</tr>
<tr class="row-odd"><td>andu256(x:u256, y:u256) -&gt; z:u256</td>
<td>bitwise and of x and y</td>
</tr>
<tr class="row-even"><td>oru256(x:u256, y:u256) -&gt; z:u256</td>
<td>bitwise or of x and y</td>
</tr>
<tr class="row-odd"><td>xoru256(x:u256, y:u256) -&gt; z:u256</td>
<td>bitwise xor of x and y</td>
</tr>
<tr class="row-even"><td>shlu256(x:u256, y:u256) -&gt; z:u256</td>
<td>logical left shift of x by y</td>
</tr>
<tr class="row-odd"><td>shru256(x:u256, y:u256) -&gt; z:u256</td>
<td>logical right shift of x by y</td>
</tr>
<tr class="row-even"><td>saru256(x:u256, y:u256) -&gt; z:u256</td>
<td>arithmetic right shift of x by y</td>
</tr>
<tr class="row-odd"><td>byte(n:u256, x:u256) -&gt; v:u256</td>
<td>nth byte of x, where the most significant byte is the 0th byte
Cannot this be just replaced by and256(shr256(n, x), 0xff) and
let it be optimised out by the EVM backend?</td>
</tr>
<tr class="row-even"><td colspan="2"><em>Memory and storage</em></td>
</tr>
<tr class="row-odd"><td>mload(p:u256) -&gt; v:u256</td>
<td>mem[p..(p+32))</td>
</tr>
<tr class="row-even"><td>mstore(p:u256, v:u256)</td>
<td>mem[p..(p+32)) := v</td>
</tr>
<tr class="row-odd"><td>mstore8(p:u256, v:u256)</td>
<td>mem[p] := v &amp; 0xff    - only modifies a single byte</td>
</tr>
<tr class="row-even"><td>sload(p:u256) -&gt; v:u256</td>
<td>storage[p]</td>
</tr>
<tr class="row-odd"><td>sstore(p:u256, v:u256)</td>
<td>storage[p] := v</td>
</tr>
<tr class="row-even"><td>msize() -&gt; size:u256</td>
<td>size of memory, i.e. largest accessed memory index, albeit due
due to the memory extension function, which extends by words,
this will always be a multiple of 32 bytes</td>
</tr>
<tr class="row-odd"><td colspan="2"><em>Execution control</em></td>
</tr>
<tr class="row-even"><td>create(v:u256, p:u256, s:u256)</td>
<td>create new contract with code mem[p..(p+s)) and send v wei
and return the new address</td>
</tr>
<tr class="row-odd"><td>call(g:u256, a:u256, v:u256, in:u256,
insize:u256, out:u256,
outsize:u256)
-&gt; r:u256</td>
<td>call contract at address a with input mem[in..(in+insize))
providing g gas and v wei and output area
mem[out..(out+outsize)) returning 0 on error (eg. out of gas)
and 1 on success</td>
</tr>
<tr class="row-even"><td>callcode(g:u256, a:u256, v:u256, in:u256,
insize:u256, out:u256,
outsize:u256) -&gt; r:u256</td>
<td>identical to <code class="docutils literal"><span class="pre">call</span></code> but only use the code from a
and stay in the context of the
current contract otherwise</td>
</tr>
<tr class="row-odd"><td>delegatecall(g:u256, a:u256, in:u256,
insize:u256, out:u256,
outsize:u256) -&gt; r:u256</td>
<td>identical to <code class="docutils literal"><span class="pre">callcode</span></code>,
but also keep <code class="docutils literal"><span class="pre">caller</span></code>
and <code class="docutils literal"><span class="pre">callvalue</span></code></td>
</tr>
<tr class="row-even"><td>abort()</td>
<td>abort (equals to invalid instruction on EVM)</td>
</tr>
<tr class="row-odd"><td>return(p:u256, s:u256)</td>
<td>end execution, return data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>revert(p:u256, s:u256)</td>
<td>end execution, revert state changes, return data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>selfdestruct(a:u256)</td>
<td>end execution, destroy current contract and send funds to a</td>
</tr>
<tr class="row-even"><td>log0(p:u256, s:u256)</td>
<td>log without topics and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log1(p:u256, s:u256, t1:u256)</td>
<td>log with topic t1 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log2(p:u256, s:u256, t1:u256, t2:u256)</td>
<td>log with topics t1, t2 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log3(p:u256, s:u256, t1:u256, t2:u256,
t3:u256)</td>
<td>log with topics t, t2, t3 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log4(p:u256, s:u256, t1:u256, t2:u256,
t3:u256, t4:u256)</td>
<td>log with topics t1, t2, t3, t4 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td colspan="2"><em>State queries</em></td>
</tr>
<tr class="row-even"><td>blockcoinbase() -&gt; address:u256</td>
<td>current mining beneficiary</td>
</tr>
<tr class="row-odd"><td>blockdifficulty() -&gt; difficulty:u256</td>
<td>difficulty of the current block</td>
</tr>
<tr class="row-even"><td>blockgaslimit() -&gt; limit:u256</td>
<td>block gas limit of the current block</td>
</tr>
<tr class="row-odd"><td>blockhash(b:u256) -&gt; hash:u256</td>
<td>hash of block nr b - only for last 256 blocks excluding current</td>
</tr>
<tr class="row-even"><td>blocknumber() -&gt; block:u256</td>
<td>current block number</td>
</tr>
<tr class="row-odd"><td>blocktimestamp() -&gt; timestamp:u256</td>
<td>timestamp of the current block in seconds since the epoch</td>
</tr>
<tr class="row-even"><td>txorigin() -&gt; address:u256</td>
<td>transaction sender</td>
</tr>
<tr class="row-odd"><td>txgasprice() -&gt; price:u256</td>
<td>gas price of the transaction</td>
</tr>
<tr class="row-even"><td>gasleft() -&gt; gas:u256</td>
<td>gas still available to execution</td>
</tr>
<tr class="row-odd"><td>balance(a:u256) -&gt; v:u256</td>
<td>wei balance at address a</td>
</tr>
<tr class="row-even"><td>this() -&gt; address:u256</td>
<td>address of the current contract / execution context</td>
</tr>
<tr class="row-odd"><td>caller() -&gt; address:u256</td>
<td>call sender (excluding delegatecall)</td>
</tr>
<tr class="row-even"><td>callvalue() -&gt; v:u256</td>
<td>wei sent together with the current call</td>
</tr>
<tr class="row-odd"><td>calldataload(p:u256) -&gt; v:u256</td>
<td>call data starting from position p (32 bytes)</td>
</tr>
<tr class="row-even"><td>calldatasize() -&gt; v:u256</td>
<td>size of call data in bytes</td>
</tr>
<tr class="row-odd"><td>calldatacopy(t:u256, f:u256, s:u256)</td>
<td>copy s bytes from calldata at position f to mem at position t</td>
</tr>
<tr class="row-even"><td>codesize() -&gt; size:u256</td>
<td>size of the code of the current contract / execution context</td>
</tr>
<tr class="row-odd"><td>codecopy(t:u256, f:u256, s:u256)</td>
<td>copy s bytes from code at position f to mem at position t</td>
</tr>
<tr class="row-even"><td>extcodesize(a:u256) -&gt; size:u256</td>
<td>size of the code at address a</td>
</tr>
<tr class="row-odd"><td>extcodecopy(a:u256, t:u256, f:u256, s:u256)</td>
<td>like codecopy(t, f, s) but take code at address a</td>
</tr>
<tr class="row-even"><td colspan="2"><em>Others</em></td>
</tr>
<tr class="row-odd"><td>discard(unused:bool)</td>
<td>discard value</td>
</tr>
<tr class="row-even"><td>discardu256(unused:u256)</td>
<td>discard value</td>
</tr>
<tr class="row-odd"><td><dl class="first last docutils">
<dt>splitu256tou64(x:u256) -&gt; (x1:u64, x2:u64,</dt>
<dd>x3:u64, x4:u64)</dd>
</dl>
</td>
<td>split u256 to four u64’s</td>
</tr>
<tr class="row-even"><td><dl class="first last docutils">
<dt>combineu64tou256(x1:u64, x2:u64, x3:u64,</dt>
<dd>x4:u64) -&gt; (x:u256)</dd>
</dl>
</td>
<td>combine four u64’s into a single u256</td>
</tr>
<tr class="row-odd"><td>keccak256(p:u256, s:u256) -&gt; v:u256</td>
<td>keccak(mem[p…(p+s)))</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="backends">
<h4>Backends<a class="headerlink" href="#backends" title="Permalink to this headline">¶</a></h4>
<p>Backends or targets are the translators from JULIA to a specific bytecode. Each of the backends can expose functions
prefixed with the name of the backend. We reserve <code class="docutils literal"><span class="pre">evm_</span></code> and <code class="docutils literal"><span class="pre">ewasm_</span></code> prefixes for the two proposed backends.</p>
</div>
<div class="section" id="backend-evm">
<h4>Backend: EVM<a class="headerlink" href="#backend-evm" title="Permalink to this headline">¶</a></h4>
<p>The EVM target will have all the underlying EVM opcodes exposed with the <cite>evm_</cite> prefix.</p>
</div>
<div class="section" id="backend-evm-1-5">
<h4>Backend: “EVM 1.5”<a class="headerlink" href="#backend-evm-1-5" title="Permalink to this headline">¶</a></h4>
<p>TBD</p>
</div>
<div class="section" id="backend-ewasm">
<h4>Backend: eWASM<a class="headerlink" href="#backend-ewasm" title="Permalink to this headline">¶</a></h4>
<p>TBD</p>
</div>
</div>
<div class="section" id="specification-of-julia-object">
<h3>Specification of JULIA Object<a class="headerlink" href="#specification-of-julia-object" title="Permalink to this headline">¶</a></h3>
<p>Grammar:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">TopLevelObject</span> <span class="o">=</span> <span class="s1">&#39;object&#39;</span> <span class="s1">&#39;{&#39;</span> <span class="nx">Code</span><span class="o">?</span> <span class="p">(</span> <span class="nx">Object</span> <span class="o">|</span> <span class="nx">Data</span> <span class="p">)</span><span class="o">*</span> <span class="s1">&#39;}&#39;</span>
<span class="nx">Object</span> <span class="o">=</span> <span class="s1">&#39;object&#39;</span> <span class="nx">StringLiteral</span> <span class="s1">&#39;{&#39;</span> <span class="nx">Code</span><span class="o">?</span> <span class="p">(</span> <span class="nx">Object</span> <span class="o">|</span> <span class="nx">Data</span> <span class="p">)</span><span class="o">*</span> <span class="s1">&#39;}&#39;</span>
<span class="nx">Code</span> <span class="o">=</span> <span class="s1">&#39;code&#39;</span> <span class="nx">Block</span>
<span class="nx">Data</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span> <span class="nx">StringLiteral</span> <span class="nx">HexLiteral</span>
<span class="nx">HexLiteral</span> <span class="o">=</span> <span class="s1">&#39;hex&#39;</span> <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">|</span> <span class="s1">&#39;\&#39;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="nx">a</span><span class="o">-</span><span class="nx">fA</span><span class="o">-</span><span class="nx">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">)</span>
<span class="nx">StringLiteral</span> <span class="o">=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="p">([</span><span class="o">^</span><span class="s2">&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;</span><span class="err">&#39;</span>
</pre></div>
</div>
<p>Above, <code class="docutils literal"><span class="pre">Block</span></code> refers to <code class="docutils literal"><span class="pre">Block</span></code> in the JULIA code grammar explained in the previous chapter.</p>
<p>An example JULIA Object is shown below:</p>
<p>..code:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// Code consists of a single object. A single &quot;code&quot; node is the code of the object.</span>
<span class="c1">// Every (other) named object or data section is serialized and</span>
<span class="c1">// made accessible to the special built-in functions datacopy / dataoffset / datasize</span>
<span class="nx">object</span> <span class="p">{</span>
    <span class="nx">code</span> <span class="p">{</span>
        <span class="kr">let</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">datasize</span><span class="p">(</span><span class="s2">&quot;runtime&quot;</span><span class="p">)</span>
        <span class="kr">let</span> <span class="nx">offset</span> <span class="o">=</span> <span class="nx">allocate</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
        <span class="c1">// This will turn into a memory-&gt;memory copy for eWASM and</span>
        <span class="c1">// a codecopy for EVM</span>
        <span class="nx">datacopy</span><span class="p">(</span><span class="nx">dataoffset</span><span class="p">(</span><span class="s2">&quot;runtime&quot;</span><span class="p">),</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
        <span class="c1">// this is a constructor and the runtime code is returned</span>
        <span class="k">return</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nx">data</span> <span class="s2">&quot;Table2&quot;</span> <span class="k">hex</span><span class="s2">&quot;4123&quot;</span>

    <span class="nx">object</span> <span class="s2">&quot;runtime&quot;</span> <span class="p">{</span>
        <span class="nx">code</span> <span class="p">{</span>
            <span class="c1">// runtime code</span>

            <span class="kr">let</span> <span class="nx">size</span> <span class="o">=</span> <span class="nx">datasize</span><span class="p">(</span><span class="s2">&quot;Contract2&quot;</span><span class="p">)</span>
            <span class="kr">let</span> <span class="nx">offset</span> <span class="o">=</span> <span class="nx">allocate</span><span class="p">(</span><span class="nx">size</span><span class="p">)</span>
            <span class="c1">// This will turn into a memory-&gt;memory copy for eWASM and</span>
            <span class="c1">// a codecopy for EVM</span>
            <span class="nx">datacopy</span><span class="p">(</span><span class="nx">dataoffset</span><span class="p">(</span><span class="s2">&quot;Contract2&quot;</span><span class="p">),</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
            <span class="c1">// constructor parameter is a single number 0x1234</span>
            <span class="nx">mstore</span><span class="p">(</span><span class="nx">add</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">size</span><span class="p">),</span> <span class="mh">0x1234</span><span class="p">)</span>
            <span class="nx">create</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">add</span><span class="p">(</span><span class="nx">size</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="c1">// Embedded object. Use case is that the outside is a factory contract,</span>
        <span class="c1">// and Contract2 is the code to be created by the factory</span>
        <span class="nx">object</span> <span class="s2">&quot;Contract2&quot;</span> <span class="p">{</span>
            <span class="nx">code</span> <span class="p">{</span>
                <span class="c1">// code here ...</span>
            <span class="p">}</span>

            <span class="nx">object</span> <span class="s2">&quot;runtime&quot;</span> <span class="p">{</span>
                <span class="nx">code</span> <span class="p">{</span>
                    <span class="c1">// code here ...</span>
                <span class="p">}</span>
             <span class="p">}</span>

             <span class="nx">data</span> <span class="s2">&quot;Table1&quot;</span> <span class="k">hex</span><span class="s2">&quot;4123&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-style-guide"></span><div class="section" id="style-guide">
<span id="index-0"></span><h2>Style Guide<a class="headerlink" href="#style-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>This guide is intended to provide coding conventions for writing solidity code.
This guide should be thought of as an evolving document that will change over
time as useful conventions are found and old conventions are rendered obsolete.</p>
<p>Many projects will implement their own style guides.  In the event of
conflicts, project specific style guides take precedence.</p>
<p>The structure and many of the recommendations within this style guide were
taken from python’s
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">pep8 style guide</a>.</p>
<p>The goal of this guide is <em>not</em> to be the right way or the best way to write
solidity code.  The goal of this guide is <em>consistency</em>.  A quote from python’s
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">pep8</a>
captures this concept well.</p>
<blockquote>
<div>A style guide is about consistency. Consistency with this style guide is important. Consistency within a project is more important. Consistency within one module or function is most important.
But most importantly: know when to be inconsistent – sometimes the style guide just doesn’t apply. When in doubt, use your best judgement. Look at other examples and decide what looks best. And don’t hesitate to ask!</div></blockquote>
</div>
<div class="section" id="code-layout">
<h3>Code Layout<a class="headerlink" href="#code-layout" title="Permalink to this headline">¶</a></h3>
<div class="section" id="indentation">
<h4>Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h4>
<p>Use 4 spaces per indentation level.</p>
</div>
<div class="section" id="tabs-or-spaces">
<h4>Tabs or Spaces<a class="headerlink" href="#tabs-or-spaces" title="Permalink to this headline">¶</a></h4>
<p>Spaces are the preferred indentation method.</p>
<p>Mixing tabs and spaces should be avoided.</p>
</div>
<div class="section" id="blank-lines">
<h4>Blank Lines<a class="headerlink" href="#blank-lines" title="Permalink to this headline">¶</a></h4>
<p>Surround top level declarations in solidity source with two blank lines.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Within a contract surround function declarations with a single blank line.</p>
<p>Blank lines may be omitted between groups of related one-liners (such as stub functions for an abstract contract)</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">spam</span><span class="p">()</span> <span class="k">public</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">ham</span><span class="p">()</span> <span class="k">public</span><span class="p">;</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">spam</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">ham</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">spam</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">ham</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="maximum-line-length">
<span id="id1"></span><h4>Maximum Line Length<a class="headerlink" href="#maximum-line-length" title="Permalink to this headline">¶</a></h4>
<p>Keeping lines under the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#maximum-line-length">PEP 8 recommendation</a> to a maximum of 79 (or 99)
characters helps readers easily parse the code.</p>
<p>Wrapped lines should conform to the following guidelines.</p>
<ol class="arabic simple">
<li>The first argument should not be attached to the opening parenthesis.</li>
<li>One, and only one, indent should be used.</li>
<li>Each argument should fall on its own line.</li>
<li>The terminating element, <code class="code docutils literal"><span class="pre">);</span></code>, should be placed on the final line by itself.</li>
</ol>
<p>Function Calls</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">thisFunctionCallIsReallyLong</span><span class="p">(</span>
    <span class="nx">longArgument1</span><span class="p">,</span>
    <span class="nx">longArgument2</span><span class="p">,</span>
    <span class="nx">longArgument3</span>
<span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">thisFunctionCallIsReallyLong</span><span class="p">(</span><span class="nx">longArgument1</span><span class="p">,</span>
                              <span class="nx">longArgument2</span><span class="p">,</span>
                              <span class="nx">longArgument3</span>
<span class="p">);</span>

<span class="nx">thisFunctionCallIsReallyLong</span><span class="p">(</span><span class="nx">longArgument1</span><span class="p">,</span>
    <span class="nx">longArgument2</span><span class="p">,</span>
    <span class="nx">longArgument3</span>
<span class="p">);</span>

<span class="nx">thisFunctionCallIsReallyLong</span><span class="p">(</span>
    <span class="nx">longArgument1</span><span class="p">,</span> <span class="nx">longArgument2</span><span class="p">,</span>
    <span class="nx">longArgument3</span>
<span class="p">);</span>

<span class="nx">thisFunctionCallIsReallyLong</span><span class="p">(</span>
<span class="nx">longArgument1</span><span class="p">,</span>
<span class="nx">longArgument2</span><span class="p">,</span>
<span class="nx">longArgument3</span>
<span class="p">);</span>

<span class="nx">thisFunctionCallIsReallyLong</span><span class="p">(</span>
    <span class="nx">longArgument1</span><span class="p">,</span>
    <span class="nx">longArgument2</span><span class="p">,</span>
    <span class="nx">longArgument3</span><span class="p">);</span>
</pre></div>
</div>
<p>Assignment Statements</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">thisIsALongNestedMapping</span><span class="p">[</span><span class="nx">being</span><span class="p">][</span><span class="nx">set</span><span class="p">][</span><span class="nx">to_some_value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">someFunction</span><span class="p">(</span>
    <span class="nx">argument1</span><span class="p">,</span>
    <span class="nx">argument2</span><span class="p">,</span>
    <span class="nx">argument3</span><span class="p">,</span>
    <span class="nx">argument4</span>
<span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">thisIsALongNestedMapping</span><span class="p">[</span><span class="nx">being</span><span class="p">][</span><span class="nx">set</span><span class="p">][</span><span class="nx">to_some_value</span><span class="p">]</span> <span class="o">=</span> <span class="nx">someFunction</span><span class="p">(</span><span class="nx">argument1</span><span class="p">,</span>
                                                                   <span class="nx">argument2</span><span class="p">,</span>
                                                                   <span class="nx">argument3</span><span class="p">,</span>
                                                                   <span class="nx">argument4</span><span class="p">);</span>
</pre></div>
</div>
<p>Event Definitions and Event Emitters</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">event</span> <span class="nx">LongAndLotsOfArgs</span><span class="p">(</span>
    <span class="nx">adress</span> <span class="nx">sender</span><span class="p">,</span>
    <span class="nx">adress</span> <span class="nx">recipient</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="nx">publicKey</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="nx">amount</span><span class="p">,</span>
    <span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">options</span>
<span class="p">);</span>

<span class="nx">LongAndLotsOfArgs</span><span class="p">(</span>
    <span class="nx">sender</span><span class="p">,</span>
    <span class="nx">recipient</span><span class="p">,</span>
    <span class="nx">publicKey</span><span class="p">,</span>
    <span class="nx">amount</span><span class="p">,</span>
    <span class="nx">options</span>
<span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">event</span> <span class="nx">LongAndLotsOfArgs</span><span class="p">(</span><span class="nx">adress</span> <span class="nx">sender</span><span class="p">,</span>
                        <span class="nx">adress</span> <span class="nx">recipient</span><span class="p">,</span>
                        <span class="kt">uint256</span> <span class="nx">publicKey</span><span class="p">,</span>
                        <span class="kt">uint256</span> <span class="nx">amount</span><span class="p">,</span>
                        <span class="kt">bytes32</span><span class="p">[]</span> <span class="nx">options</span><span class="p">);</span>

<span class="nx">LongAndLotsOfArgs</span><span class="p">(</span><span class="nx">sender</span><span class="p">,</span>
                  <span class="nx">recipient</span><span class="p">,</span>
                  <span class="nx">publicKey</span><span class="p">,</span>
                  <span class="nx">amount</span><span class="p">,</span>
                  <span class="nx">options</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="source-file-encoding">
<h4>Source File Encoding<a class="headerlink" href="#source-file-encoding" title="Permalink to this headline">¶</a></h4>
<p>UTF-8 or ASCII encoding is preferred.</p>
</div>
<div class="section" id="imports">
<h4>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h4>
<p>Import statements should always be placed at the top of the file.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="s2">&quot;owned&quot;</span><span class="p">;</span>


<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>


<span class="k">import</span> <span class="s2">&quot;owned&quot;</span><span class="p">;</span>


<span class="kd">contract</span> <span class="nx">B</span> <span class="k">is</span> <span class="nx">owned</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="order-of-functions">
<h4>Order of Functions<a class="headerlink" href="#order-of-functions" title="Permalink to this headline">¶</a></h4>
<p>Ordering helps readers identify which functions they can call and to find the constructor and fallback definitions easier.</p>
<p>Functions should be grouped according to their visibility and ordered:</p>
<ul class="simple">
<li>constructor</li>
<li>fallback function (if exists)</li>
<li>external</li>
<li>public</li>
<li>internal</li>
<li>private</li>
</ul>
<p>Within a grouping, place the <code class="docutils literal"><span class="pre">view</span></code> and <code class="docutils literal"><span class="pre">pure</span></code> functions last.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="c1">// External functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// External functions that are view</span>
    <span class="c1">// ...</span>

    <span class="c1">// External functions that are pure</span>
    <span class="c1">// ...</span>

    <span class="c1">// Public functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Internal functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Private functions</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>

    <span class="c1">// External functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Private functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Public functions</span>
    <span class="c1">// ...</span>

    <span class="kd">function</span> <span class="nx">A</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="c1">// Internal functions</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="whitespace-in-expressions">
<h4>Whitespace in Expressions<a class="headerlink" href="#whitespace-in-expressions" title="Permalink to this headline">¶</a></h4>
<p>Avoid extraneous whitespace in the following  situations:</p>
<p>Immediately inside parenthesis, brackets or braces, with the exception of single line function declarations.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">spam</span><span class="p">(</span><span class="nx">ham</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">Coin</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;ham&quot;</span><span class="p">}));</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">spam</span><span class="p">(</span> <span class="nx">ham</span><span class="p">[</span> <span class="mi">1</span> <span class="p">],</span> <span class="nx">Coin</span><span class="p">(</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;ham&quot;</span> <span class="p">}</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>Exception:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">singleLine</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">spam</span><span class="p">();</span> <span class="p">}</span>
</pre></div>
</div>
<p>Immediately before a comma, semicolon:</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">spam</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">Coin</span> <span class="nx">coin</span><span class="p">)</span> <span class="k">public</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">spam</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span> <span class="p">,</span> <span class="nx">Coin</span> <span class="nx">coin</span><span class="p">)</span> <span class="k">public</span> <span class="p">;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>More than one space around an assignment or other operator to align with</dt>
<dd>another:</dd>
</dl>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nx">long_variable</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">y</span>             <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nx">long_variable</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<p>Don’t include a whitespace in the fallback function:</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="control-structures">
<h4>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this headline">¶</a></h4>
<p>The braces denoting the body of a contract, library, functions and structs
should:</p>
<ul class="simple">
<li>open on the same line as the declaration</li>
<li>close on their own line at the same indentation level as the beginning of the
declaration.</li>
<li>The opening brace should be proceeded by a single space.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">Coin</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Bank</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">Coin</span>
<span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">Bank</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="nx">owner</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The same recommendations apply to the control structures <code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">else</span></code>, <code class="docutils literal"><span class="pre">while</span></code>,
and <code class="docutils literal"><span class="pre">for</span></code>.</p>
<p>Additionally there should be a single space between the control structures
<code class="docutils literal"><span class="pre">if</span></code>, <code class="docutils literal"><span class="pre">while</span></code>, and <code class="docutils literal"><span class="pre">for</span></code> and the parenthetic block representing the
conditional, as well as a single space between the conditional parenthetic
block and the opening brace.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(...)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">while</span><span class="p">(...){</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...;}</span>
</pre></div>
</div>
<p>For control structures whose body contains a single statement, omitting the
braces is ok <em>if</em> the statement is contained on a single line.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="nx">someArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Coin</span><span class="p">({</span>
        <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;spam&#39;</span><span class="p">,</span>
        <span class="nx">value</span><span class="o">:</span> <span class="mi">42</span>
    <span class="p">}));</span>
</pre></div>
</div>
<p>For <code class="docutils literal"><span class="pre">if</span></code> blocks which have an <code class="docutils literal"><span class="pre">else</span></code> or <code class="docutils literal"><span class="pre">else</span> <span class="pre">if</span></code> clause, the <code class="docutils literal"><span class="pre">else</span></code> should be
placed on the same line as the <code class="docutils literal"><span class="pre">if</span></code>’s closing brace. This is an exception compared
to the rules of other block-like structures.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">else</span>
    <span class="nx">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="nx">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-declaration">
<h4>Function Declaration<a class="headerlink" href="#function-declaration" title="Permalink to this headline">¶</a></h4>
<p>For short function declarations, it is recommended for the opening brace of the
function body to be kept on the same line as the function declaration.</p>
<p>The closing brace should be at the same indentation level as the function
declaration.</p>
<p>The opening brace should be preceded by a single space.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="nx">onlyowner</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">){</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

<span class="kd">function</span> <span class="nx">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">x</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;}</span>
</pre></div>
</div>
<p>You should explicitly label the visibility of all functions, including constructors.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">explicitlyPublic</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">val</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">implicitlyPublic</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The visibility modifier for a function should come before any custom
modifiers.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="k">public</span> <span class="nx">onlyowner</span> <span class="p">{</span>
    <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="nx">onlyowner</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">selfdestruct</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For long function declarations, it is recommended to drop each argument onto
it’s own line at the same indentation level as the function body.  The closing
parenthesis and opening bracket should be placed on their own line as well at
the same indentation level as the function declaration.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">f</span>
<span class="p">)</span>
    <span class="k">public</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span> <span class="nx">a</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">f</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="nx">f</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionHasLotsOfArguments</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">d</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">e</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">f</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If a long function declaration has modifiers, then each modifier should be
dropped to its own line.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
    <span class="k">public</span>
    <span class="nx">onlyowner</span>
    <span class="nx">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">x</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">z</span><span class="p">,</span>
<span class="p">)</span>
    <span class="k">public</span>
    <span class="nx">onlyowner</span>
    <span class="nx">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
                                      <span class="k">public</span>
                                      <span class="nx">onlyowner</span>
                                      <span class="nx">priced</span>
                                      <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
    <span class="k">public</span> <span class="nx">onlyowner</span> <span class="nx">priced</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="nx">x</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">y</span><span class="p">,</span> <span class="kt">address</span> <span class="nx">z</span><span class="p">)</span>
    <span class="k">public</span>
    <span class="nx">onlyowner</span>
    <span class="nx">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Multiline output parameters and return statements should follow the same style recommended for wrapping long lines found in the <a class="reference internal" href="#maximum-line-length"><span class="std std-ref">Maximum Line Length</span></a> section.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">c</span>
<span class="p">)</span>
    <span class="k">public</span>
    <span class="k">returns</span> <span class="p">(</span>
        <span class="kt">address</span> <span class="nx">someAddressName</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="nx">LongArgument</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="nx">Argument</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="nx">veryLongReturnArg1</span><span class="p">,</span>
        <span class="nx">veryLongReturnArg2</span><span class="p">,</span>
        <span class="nx">veryLongReturnArg3</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">thisFunctionNameIsReallyLong</span><span class="p">(</span>
    <span class="kt">address</span> <span class="nx">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="nx">c</span>
<span class="p">)</span>
    <span class="k">public</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="nx">someAddressName</span><span class="p">,</span>
             <span class="kt">uint256</span> <span class="nx">LongArgument</span><span class="p">,</span>
             <span class="kt">uint256</span> <span class="nx">Argument</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="nx">veryLongReturnArg1</span><span class="p">,</span>
            <span class="nx">veryLongReturnArg1</span><span class="p">,</span>
            <span class="nx">veryLongReturnArg1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For constructor functions on inherited contracts whose bases require arguments,
it is recommended to drop the base constructors onto new lines in the same
manner as modifiers if the function declaration is long or hard to read.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param5</span><span class="p">)</span>
        <span class="nx">B</span><span class="p">(</span><span class="nx">param1</span><span class="p">)</span>
        <span class="nx">C</span><span class="p">(</span><span class="nx">param2</span><span class="p">,</span> <span class="nx">param3</span><span class="p">)</span>
        <span class="nx">D</span><span class="p">(</span><span class="nx">param4</span><span class="p">)</span>
        <span class="k">public</span>
    <span class="p">{</span>
        <span class="c1">// do something with param5</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param5</span><span class="p">)</span>
    <span class="nx">B</span><span class="p">(</span><span class="nx">param1</span><span class="p">)</span>
    <span class="nx">C</span><span class="p">(</span><span class="nx">param2</span><span class="p">,</span> <span class="nx">param3</span><span class="p">)</span>
    <span class="nx">D</span><span class="p">(</span><span class="nx">param4</span><span class="p">)</span>
    <span class="k">public</span>
    <span class="p">{</span>
        <span class="c1">// do something with param5</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="k">is</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">,</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">A</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="nx">param5</span><span class="p">)</span>
        <span class="nx">B</span><span class="p">(</span><span class="nx">param1</span><span class="p">)</span>
        <span class="nx">C</span><span class="p">(</span><span class="nx">param2</span><span class="p">,</span> <span class="nx">param3</span><span class="p">)</span>
        <span class="nx">D</span><span class="p">(</span><span class="nx">param4</span><span class="p">)</span>
        <span class="k">public</span> <span class="p">{</span>
        <span class="c1">// do something with param5</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When declaring short functions with a single statement, it is permissible to do it on a single line.</p>
<p>Permissible:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">shortFunction</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
</pre></div>
</div>
<p>These guidelines for function declarations are intended to improve readability.
Authors should use their best judgement as this guide does not try to cover all
possible permutations for function declarations.</p>
</div>
<div class="section" id="mappings">
<h4>Mappings<a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
<div class="section" id="variable-declarations">
<h4>Variable Declarations<a class="headerlink" href="#variable-declarations" title="Permalink to this headline">¶</a></h4>
<p>Declarations of array variables should not have a space between the type and
the brackets.</p>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kt">uint</span> <span class="p">[]</span> <span class="nx">x</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="other-recommendations">
<h4>Other Recommendations<a class="headerlink" href="#other-recommendations" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Strings should be quoted with double-quotes instead of single-quotes.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
<span class="nx">str</span> <span class="o">=</span> <span class="s2">&quot;Hamlet says, &#39;To be or not to be...&#39;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nx">str</span> <span class="o">=</span> <span class="s1">&#39;&quot;Be yourself; everyone else is already taken.&quot; -Oscar Wilde&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Surround operators with a single space on either side.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">|=</span> <span class="nx">y</span> <span class="o">&amp;&amp;</span> <span class="nx">z</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">100</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">+=</span> <span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">|=</span> <span class="nx">y</span><span class="o">&amp;&amp;</span><span class="nx">z</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Operators with a higher priority than others can exclude surrounding
whitespace in order to denote precedence.  This is meant to allow for
improved readability for complex statement. You should always use the same
amount of whitespace on either side of an operator:</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nx">y</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="nx">z</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">a</span><span class="o">-</span><span class="nx">b</span><span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">=</span> <span class="nx">y</span><span class="o">+</span><span class="nx">z</span><span class="p">;</span>
<span class="nx">x</span> <span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="naming-conventions">
<h3>Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h3>
<p>Naming conventions are powerful when adopted and used broadly.  The use of
different conventions can convey significant <em>meta</em> information that would
otherwise not be immediately available.</p>
<p>The naming recommendations given here are intended to improve the readability,
and thus they are not rules, but rather guidelines to try and help convey the
most information through the names of things.</p>
<p>Lastly, consistency within a codebase should always supercede any conventions
outlined in this document.</p>
<div class="section" id="naming-styles">
<h4>Naming Styles<a class="headerlink" href="#naming-styles" title="Permalink to this headline">¶</a></h4>
<p>To avoid confusion, the following names will be used to refer to different
naming styles.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">b</span></code> (single lowercase letter)</li>
<li><code class="docutils literal"><span class="pre">B</span></code> (single uppercase letter)</li>
<li><code class="docutils literal"><span class="pre">lowercase</span></code></li>
<li><code class="docutils literal"><span class="pre">lower_case_with_underscores</span></code></li>
<li><code class="docutils literal"><span class="pre">UPPERCASE</span></code></li>
<li><code class="docutils literal"><span class="pre">UPPER_CASE_WITH_UNDERSCORES</span></code></li>
<li><code class="docutils literal"><span class="pre">CapitalizedWords</span></code> (or CapWords)</li>
<li><code class="docutils literal"><span class="pre">mixedCase</span></code> (differs from CapitalizedWords by initial lowercase character!)</li>
<li><code class="docutils literal"><span class="pre">Capitalized_Words_With_Underscores</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using initialisms in CapWords, capitalize all the letters of the initialisms. Thus HTTPServerError is better than HttpServerError. When using initialisms is mixedCase, capitalize all the letters of the initialisms, except keep the first one lower case if it is the beginning of the name. Thus xmlHTTPRequest is better than XMLHTTPRequest.</p>
</div>
</div>
<div class="section" id="names-to-avoid">
<h4>Names to Avoid<a class="headerlink" href="#names-to-avoid" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">l</span></code> - Lowercase letter el</li>
<li><code class="docutils literal"><span class="pre">O</span></code> - Uppercase letter oh</li>
<li><code class="docutils literal"><span class="pre">I</span></code> - Uppercase letter eye</li>
</ul>
<p>Never use any of these for single letter variable names.  They are often
indistinguishable from the numerals one and zero.</p>
</div>
<div class="section" id="contract-and-library-names">
<h4>Contract and Library Names<a class="headerlink" href="#contract-and-library-names" title="Permalink to this headline">¶</a></h4>
<p>Contracts and libraries should be named using the CapWords style. Examples: <code class="docutils literal"><span class="pre">SimpleToken</span></code>, <code class="docutils literal"><span class="pre">SmartBank</span></code>, <code class="docutils literal"><span class="pre">CertificateHashRepository</span></code>, <code class="docutils literal"><span class="pre">Player</span></code>.</p>
</div>
<div class="section" id="struct-names">
<h4>Struct Names<a class="headerlink" href="#struct-names" title="Permalink to this headline">¶</a></h4>
<p>Structs should be named using the CapWords style. Examples: <code class="docutils literal"><span class="pre">MyCoin</span></code>, <code class="docutils literal"><span class="pre">Position</span></code>, <code class="docutils literal"><span class="pre">PositionXY</span></code>.</p>
</div>
<div class="section" id="event-names">
<h4>Event Names<a class="headerlink" href="#event-names" title="Permalink to this headline">¶</a></h4>
<p>Events should be named using the CapWords style. Examples: <code class="docutils literal"><span class="pre">Deposit</span></code>, <code class="docutils literal"><span class="pre">Transfer</span></code>, <code class="docutils literal"><span class="pre">Approval</span></code>, <code class="docutils literal"><span class="pre">BeforeTransfer</span></code>, <code class="docutils literal"><span class="pre">AfterTransfer</span></code>.</p>
</div>
<div class="section" id="function-names">
<h4>Function Names<a class="headerlink" href="#function-names" title="Permalink to this headline">¶</a></h4>
<p>Functions other than constructors should use mixedCase. Examples: <code class="docutils literal"><span class="pre">getBalance</span></code>, <code class="docutils literal"><span class="pre">transfer</span></code>, <code class="docutils literal"><span class="pre">verifyOwner</span></code>, <code class="docutils literal"><span class="pre">addMember</span></code>, <code class="docutils literal"><span class="pre">changeOwner</span></code>.</p>
</div>
<div class="section" id="function-argument-names">
<h4>Function Argument Names<a class="headerlink" href="#function-argument-names" title="Permalink to this headline">¶</a></h4>
<p>Function arguments should use mixedCase. Examples: <code class="docutils literal"><span class="pre">initialSupply</span></code>, <code class="docutils literal"><span class="pre">account</span></code>, <code class="docutils literal"><span class="pre">recipientAddress</span></code>, <code class="docutils literal"><span class="pre">senderAddress</span></code>, <code class="docutils literal"><span class="pre">newOwner</span></code>.</p>
<p>When writing library functions that operate on a custom struct, the struct
should be the first argument and should always be named <code class="docutils literal"><span class="pre">self</span></code>.</p>
</div>
<div class="section" id="local-and-state-variable-names">
<h4>Local and State Variable Names<a class="headerlink" href="#local-and-state-variable-names" title="Permalink to this headline">¶</a></h4>
<p>Use mixedCase. Examples: <code class="docutils literal"><span class="pre">totalSupply</span></code>, <code class="docutils literal"><span class="pre">remainingSupply</span></code>, <code class="docutils literal"><span class="pre">balancesOf</span></code>, <code class="docutils literal"><span class="pre">creatorAddress</span></code>, <code class="docutils literal"><span class="pre">isPreSale</span></code>, <code class="docutils literal"><span class="pre">tokenExchangeRate</span></code>.</p>
</div>
<div class="section" id="constants">
<h4>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h4>
<p>Constants should be named with all capital letters with underscores separating
words. Examples: <code class="docutils literal"><span class="pre">MAX_BLOCKS</span></code>, <code class="docutils literal"><span class="pre">TOKEN_NAME</span></code>, <code class="docutils literal"><span class="pre">TOKEN_TICKER</span></code>, <code class="docutils literal"><span class="pre">CONTRACT_VERSION</span></code>.</p>
</div>
<div class="section" id="modifier-names">
<h4>Modifier Names<a class="headerlink" href="#modifier-names" title="Permalink to this headline">¶</a></h4>
<p>Use mixedCase. Examples: <code class="docutils literal"><span class="pre">onlyBy</span></code>, <code class="docutils literal"><span class="pre">onlyAfter</span></code>, <code class="docutils literal"><span class="pre">onlyDuringThePreSale</span></code>.</p>
</div>
<div class="section" id="enums">
<h4>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">¶</a></h4>
<p>Enums, in the style of simple type declarations, should be named using the CapWords style. Examples: <code class="docutils literal"><span class="pre">TokenGroup</span></code>, <code class="docutils literal"><span class="pre">Frame</span></code>, <code class="docutils literal"><span class="pre">HashStyle</span></code>, <code class="docutils literal"><span class="pre">CharacterLocation</span></code>.</p>
</div>
<div class="section" id="avoiding-naming-collisions">
<h4>Avoiding Naming Collisions<a class="headerlink" href="#avoiding-naming-collisions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">single_trailing_underscore_</span></code></li>
</ul>
<p>This convention is suggested when the desired name collides with that of a
built-in or otherwise reserved name.</p>
</div>
<div class="section" id="general-recommendations">
<h4>General Recommendations<a class="headerlink" href="#general-recommendations" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
</div>
</div>
<span id="document-common-patterns"></span><div class="section" id="common-patterns">
<h2>Common Patterns<a class="headerlink" href="#common-patterns" title="Permalink to this headline">¶</a></h2>
<div class="section" id="withdrawal-from-contracts">
<span id="withdrawal-pattern"></span><span id="index-0"></span><h3>Withdrawal from Contracts<a class="headerlink" href="#withdrawal-from-contracts" title="Permalink to this headline">¶</a></h3>
<p>The recommended method of sending funds after an effect
is using the withdrawal pattern. Although the most intuitive
method of sending Ether, as a result of an effect, is a
direct <code class="docutils literal"><span class="pre">send</span></code> call, this is not recommended as it
introduces a potential security risk. You may read
more about this on the <a class="reference internal" href="index.html#security-considerations"><span class="std std-ref">Security Considerations</span></a> page.</p>
<p>This is an example of the withdrawal pattern in practice in
a contract where the goal is to send the most money to the
contract in order to become the “richest”, inspired by
<a class="reference external" href="https://www.kingoftheether.com/">King of the Ether</a>.</p>
<p>In the following contract, if you are usurped as the richest,
you will receive the funds of the person who has gone on to
become the new richest.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">WithdrawalContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">mostSent</span><span class="p">;</span>

    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="nx">pendingWithdrawals</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">WithdrawalContract</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">becomeRichest</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pendingWithdrawals</span><span class="p">[</span><span class="nx">richest</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
            <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">amount</span> <span class="o">=</span> <span class="nx">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
        <span class="c1">// Remember to zero the pending refund before</span>
        <span class="c1">// sending to prevent re-entrancy attacks</span>
        <span class="nx">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is as opposed to the more intuitive sending pattern:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">SendContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">mostSent</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">SendContract</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
        <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">becomeRichest</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// This line can cause problems (explained below).</span>
            <span class="nx">richest</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
            <span class="nx">richest</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
            <span class="nx">mostSent</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice that, in this example, an attacker could trap the
contract into an unusable state by causing <code class="docutils literal"><span class="pre">richest</span></code> to be
the address of a contract that has a fallback function
which fails (e.g. by using <code class="docutils literal"><span class="pre">revert()</span></code> or by just
consuming more than the 2300 gas stipend). That way,
whenever <code class="docutils literal"><span class="pre">transfer</span></code> is called to deliver funds to the
“poisoned” contract, it will fail and thus also <code class="docutils literal"><span class="pre">becomeRichest</span></code>
will fail, with the contract being stuck forever.</p>
<p>In contrast, if you use the “withdraw” pattern from the first example,
the attacker can only cause his or her own withdraw to fail and not the
rest of the contract’s workings.</p>
</div>
<div class="section" id="restricting-access">
<span id="index-1"></span><h3>Restricting Access<a class="headerlink" href="#restricting-access" title="Permalink to this headline">¶</a></h3>
<p>Restricting access is a common pattern for contracts.
Note that you can never restrict any human or computer
from reading the content of your transactions or
your contract’s state. You can make it a bit harder
by using encryption, but if your contract is supposed
to read the data, so will everyone else.</p>
<p>You can restrict read access to your contract’s state
by <strong>other contracts</strong>. That is actually the default
unless you declare make your state variables <code class="docutils literal"><span class="pre">public</span></code>.</p>
<p>Furthermore, you can restrict who can make modifications
to your contract’s state or call your contract’s
functions and this is what this section is about.</p>
<p id="index-2">The use of <strong>function modifiers</strong> makes these
restrictions highly readable.</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">AccessRestriction</span> <span class="p">{</span>
    <span class="c1">// These will be assigned at the construction</span>
    <span class="c1">// phase, where `msg.sender` is the account</span>
    <span class="c1">// creating this contract.</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="c1">// Modifiers can be used to change</span>
    <span class="c1">// the body of a function.</span>
    <span class="c1">// If this modifier is used, it will</span>
    <span class="c1">// prepend a check that only passes</span>
    <span class="c1">// if the function is called from</span>
    <span class="c1">// a certain address.</span>
    <span class="kd">modifier</span> <span class="nx">onlyBy</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_account</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">_account</span><span class="p">,</span>
            <span class="s2">&quot;Sender not authorized.&quot;</span>
        <span class="p">);</span>
        <span class="c1">// Do not forget the &quot;_;&quot;! It will</span>
        <span class="c1">// be replaced by the actual function</span>
        <span class="c1">// body when the modifier is used.</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Make `_newOwner` the new owner of this</span>
    <span class="cs">/// contract.</span>
    <span class="kd">function</span> <span class="nx">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_newOwner</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="nx">onlyBy</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_newOwner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">_time</span><span class="p">,</span>
            <span class="s2">&quot;Function called too early.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Erase ownership information.</span>
    <span class="cs">/// May only be called 6 weeks after</span>
    <span class="cs">/// the contract has been created.</span>
    <span class="kd">function</span> <span class="nx">disown</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">onlyBy</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span>
        <span class="nx">onlyAfter</span><span class="p">(</span><span class="nx">creationTime</span> <span class="o">+</span> <span class="mi">6</span> <span class="kt">weeks</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="nx">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This modifier requires a certain</span>
    <span class="c1">// fee being associated with a function call.</span>
    <span class="c1">// If the caller sent too much, he or she is</span>
    <span class="c1">// refunded, but only after the function body.</span>
    <span class="c1">// This was dangerous before Solidity version 0.4.0,</span>
    <span class="c1">// where it was possible to skip the part after `_;`.</span>
    <span class="kd">modifier</span> <span class="nx">costs</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">_amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="nx">_amount</span><span class="p">,</span>
            <span class="s2">&quot;Not enough Ether provided.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="nx">_amount</span><span class="p">)</span>
            <span class="nb">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">-</span> <span class="nx">_amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">forceOwnerChange</span><span class="p">(</span><span class="kt">address</span> <span class="nx">_newOwner</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="k">payable</span>
        <span class="nx">costs</span><span class="p">(</span><span class="mi">200</span> <span class="kt">ether</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_newOwner</span><span class="p">;</span>
        <span class="c1">// just some example condition</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">// This did not refund for Solidity</span>
            <span class="c1">// before version 0.4.0.</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c1">// refund overpaid fees</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A more specialised way in which access to function
calls can be restricted will be discussed
in the next example.</p>
</div>
<div class="section" id="state-machine">
<span id="index-3"></span><h3>State Machine<a class="headerlink" href="#state-machine" title="Permalink to this headline">¶</a></h3>
<p>Contracts often act as a state machine, which means
that they have certain <strong>stages</strong> in which they behave
differently or in which different functions can
be called. A function call often ends a stage
and transitions the contract into the next stage
(especially if the contract models <strong>interaction</strong>).
It is also common that some stages are automatically
reached at a certain point in <strong>time</strong>.</p>
<p>An example for this is a blind auction contract which
starts in the stage “accepting blinded bids”, then
transitions to “revealing bids” which is ended by
“determine auction outcome”.</p>
<p id="index-4">Function modifiers can be used in this situation
to model the states and guard against
incorrect usage of the contract.</p>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>In the following example,
the modifier <code class="docutils literal"><span class="pre">atStage</span></code> ensures that the function can
only be called at a certain stage.</p>
<p>Automatic timed transitions
are handled by the modifier <code class="docutils literal"><span class="pre">timeTransitions</span></code>, which
should be used for all functions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Modifier Order Matters</strong>.
If atStage is combined
with timedTransitions, make sure that you mention
it after the latter, so that the new stage is
taken into account.</p>
</div>
<p>Finally, the modifier <code class="docutils literal"><span class="pre">transitionNext</span></code> can be used
to automatically go to the next stage when the
function finishes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Modifier May be Skipped</strong>.
This only applies to Solidity before version 0.4.0:
Since modifiers are applied by simply replacing
code and not by using a function call,
the code in the transitionNext modifier
can be skipped if the function itself uses
return. If you want to do that, make sure
to call nextStage manually from those functions.
Starting with version 0.4.0, modifier code
will run even if the function explicitly returns.</p>
</div>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">StateMachine</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="nx">Stages</span> <span class="p">{</span>
        <span class="nx">AcceptingBlindedBids</span><span class="p">,</span>
        <span class="nx">RevealBids</span><span class="p">,</span>
        <span class="nx">AnotherStage</span><span class="p">,</span>
        <span class="nx">AreWeDoneYet</span><span class="p">,</span>
        <span class="nx">Finished</span>
    <span class="p">}</span>

    <span class="c1">// This is the current stage.</span>
    <span class="nx">Stages</span> <span class="k">public</span> <span class="nx">stage</span> <span class="o">=</span> <span class="nx">Stages</span><span class="p">.</span><span class="nx">AcceptingBlindedBids</span><span class="p">;</span>

    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span> <span class="nx">_stage</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="nx">stage</span> <span class="o">==</span> <span class="nx">_stage</span><span class="p">,</span>
            <span class="s2">&quot;Function cannot be called at this time.&quot;</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">nextStage</span><span class="p">()</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">stage</span> <span class="o">=</span> <span class="nx">Stages</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="nx">stage</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Perform timed transitions. Be sure to mention</span>
    <span class="c1">// this modifier first, otherwise the guards</span>
    <span class="c1">// will not take the new stage into account.</span>
    <span class="kd">modifier</span> <span class="nx">timedTransitions</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span> <span class="o">==</span> <span class="nx">Stages</span><span class="p">.</span><span class="nx">AcceptingBlindedBids</span> <span class="o">&amp;&amp;</span>
                    <span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">creationTime</span> <span class="o">+</span> <span class="mi">10</span> <span class="kt">days</span><span class="p">)</span>
            <span class="nx">nextStage</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span> <span class="o">==</span> <span class="nx">Stages</span><span class="p">.</span><span class="nx">RevealBids</span> <span class="o">&amp;&amp;</span>
                <span class="nb">now</span> <span class="o">&gt;=</span> <span class="nx">creationTime</span> <span class="o">+</span> <span class="mi">12</span> <span class="kt">days</span><span class="p">)</span>
            <span class="nx">nextStage</span><span class="p">();</span>
        <span class="c1">// The other stages transition by transaction</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Order of the modifiers matters here!</span>
    <span class="kd">function</span> <span class="nx">bid</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="k">payable</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">AcceptingBlindedBids</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We will not implement that here</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">reveal</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">RevealBids</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// This modifier goes to the next stage</span>
    <span class="c1">// after the function is done.</span>
    <span class="kd">modifier</span> <span class="nx">transitionNext</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">_</span><span class="p">;</span>
        <span class="nx">nextStage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">AnotherStage</span><span class="p">)</span>
        <span class="nx">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">h</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">AreWeDoneYet</span><span class="p">)</span>
        <span class="nx">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">i</span><span class="p">()</span>
        <span class="k">public</span>
        <span class="nx">timedTransitions</span>
        <span class="nx">atStage</span><span class="p">(</span><span class="nx">Stages</span><span class="p">.</span><span class="nx">Finished</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-bugs"></span><div class="section" id="list-of-known-bugs">
<span id="known-bugs"></span><span id="index-0"></span><h2>List of Known Bugs<a class="headerlink" href="#list-of-known-bugs" title="Permalink to this headline">¶</a></h2>
<p>Below, you can find a JSON-formatted list of some of the known security-relevant bugs in the
Solidity compiler. The file itself is hosted in the <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs.json">Github repository</a>.
The list stretches back as far as version 0.3.0, bugs known to be present only
in versions preceding that are not listed.</p>
<p>There is another file called <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs_by_version.json">bugs_by_version.json</a>,
which can be used to check which bugs affect a specific version of the compiler.</p>
<p>Contract source verification tools and also other tools interacting with
contracts should consult this list according to the following criteria:</p>
<blockquote>
<div><ul class="simple">
<li>It is mildly suspicious if a contract was compiled with a nightly
compiler version instead of a released version. This list does not keep
track of unreleased or nightly versions.</li>
<li>It is also mildly suspicious if a contract was compiled with a version that was
not the most recent at the time the contract was created. For contracts
created from other contracts, you have to follow the creation chain
back to a transaction and use the date of that transaction as creation date.</li>
<li>It is highly suspicious if a contract was compiled with a compiler that
contains a known bug and the contract was created at a time where a newer
compiler version containing a fix was already released.</li>
</ul>
</div></blockquote>
<p>The JSON file of known bugs below is an array of objects, one for each bug,
with the following keys:</p>
<dl class="docutils">
<dt>name</dt>
<dd>Unique name given to the bug</dd>
<dt>summary</dt>
<dd>Short description of the bug</dd>
<dt>description</dt>
<dd>Detailed description of the bug</dd>
<dt>link</dt>
<dd>URL of a website with more detailed information, optional</dd>
<dt>introduced</dt>
<dd>The first published compiler version that contained the bug, optional</dd>
<dt>fixed</dt>
<dd>The first published compiler version that did not contain the bug anymore</dd>
<dt>publish</dt>
<dd>The date at which the bug became known publicly, optional</dd>
<dt>severity</dt>
<dd>Severity of the bug: very low, low, medium, high. Takes into account
discoverability in contract tests, likelihood of occurrence and
potential damage by exploits.</dd>
<dt>conditions</dt>
<dd>Conditions that have to be met to trigger the bug. Currently, this
is an object that can contain a boolean value <code class="docutils literal"><span class="pre">optimizer</span></code>, which
means that the optimizer has to be switched on to enable the bug.
If no conditions are given, assume that the bug is present.</dd>
</dl>
<div class="highlight-js"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OneOfTwoConstructorsSkipped&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;If a contract has both a new-style constructor (using the constructor keyword) and an old-style constructor (a function with the same name as the contract) at the same time, one of them will be ignored.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If a contract has both a new-style constructor (using the constructor keyword) and an old-style constructor (a function with the same name as the contract) at the same time, one of them will be ignored. There will be a compiler warning about the old-style constructor, so contracts only using new-style constructors are fine.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.22&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.23&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;very low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ZeroFunctionSelector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;It is possible to craft the name of a function such that it is executed instead of the fallback function in very specific circumstances.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If a function has a selector consisting only of zeros, is payable and part of a contract that does not have a fallback function and at most five external functions in total, this function is called instead of the fallback function if Ether is sent to the contract without data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;very low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;DelegateCallReturnValue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The low-level .delegatecall() does not return the execution outcome, but converts the value returned by the functioned called to a boolean instead.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The return value of the low-level .delegatecall() function is taken from a position in memory, where the call data or the return data resides. This value is interpreted as a boolean and put onto the stack. This means if the called function returns at least 32 zero bytes, .delegatecall() returns false even if the call was successuful.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ECRecoverMalformedInput&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The ecrecover() builtin can return garbage for malformed input.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The ecrecover precompile does not properly signal failure for malformed input (especially in the &#39;v&#39; argument) and thus the Solidity function can return data that was previously present in the return area in memory.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SkipEmptyStringLiteral&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;If \&quot;\&quot; is used in a function call, the following function arguments will not be correctly passed to the function.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If the empty string literal \&quot;\&quot; is used as an argument in a function call, it is skipped by the encoder. This has the effect that the encoding of all arguments following this is shifted left by 32 bytes and thus the function call data is corrupted.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ConstantOptimizerSubtraction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;In some situations, the optimizer replaces certain numbers in the code with routines that compute different numbers.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer tries to represent any number in the bytecode by routines that compute them with less gas. For some special numbers, an incorrect routine is generated. This could allow an attacker to e.g. trick victims about a specific amount of ether, or function calls to call different functions (or none at all).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="s2">&quot;https://blog.ethereum.org/2017/05/03/solidity-optimizer-bug/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.11&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;IdentityPrecompileReturnIgnored&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Failure of the identity precompile was ignored.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Calls to the identity contract, which is used for copying memory, ignored its return value. On the public chain, calls to the identity precompile can be made in a way that they never fail, but this might be different on private chains.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.7&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerStateKnowledgeNotResetForJumpdest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was simplified to just use the empty state, but this implementation was not done properly. This bug can cause data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;HighOrderByteCleanStorage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;For short types, the high order bytes were not cleaned properly and could overwrite existing data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Types shorter than 32 bytes are packed together into the same 32 byte storage slot, but storage writes always write 32 bytes. For some types, the higher order bytes were not cleaned properly, which made it sometimes possible to overwrite a variable in storage when writing to another one.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="s2">&quot;https://blog.ethereum.org/2016/11/01/security-alert-solidity-variables-can-overwritten-storage/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.1.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.4&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerStaleKnowledgeAboutSHA3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its knowledge about SHA3 operations resulting in some hashes (also used for storage variable positions) not being calculated correctly.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution in order to save re-evaluating expressions whose value is already known. This knowledge was not properly reset across control flow paths and thus the optimizer sometimes thought that the result of a SHA3 operation is already present on the stack. This could result in data corruption by accessing the wrong storage slot.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;LibrariesNotCallableFromPayableFunctions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Library functions threw an exception when called from a call that received Ether.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Library functions are protected against sending them Ether through a call. Since the DELEGATECALL opcode forwards the information about how much Ether was sent with a call, the library function incorrectly assumed that Ether was sent to the library and threw an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.2&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SendFailsForZeroEther&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The send function did not provide enough gas to the recipient if no Ether was sent with it.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The recipient of an Ether transfer automatically receives a certain amount of gas from the EVM to handle the transfer. In the case of a zero-transfer, this gas is not provided which causes the recipient to throw an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.0&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;DynamicAllocationInfiniteLoop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Dynamic allocation of an empty memory array caused an infinite loop and thus an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Memory arrays can be created provided a length. If this length is zero, code was generated that did not terminate and thus consumed all gas.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.6&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerClearStateOnCodePathJoin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was not done correctly. This bug can cause data corruption, but it is probably quite hard to use for targeted attacks.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;CleanBytesHigherOrderBits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The higher order bits of short bytesNN types were not cleaned before comparison.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Two variables of type bytesNN were considered different if their higher order bits, which are not part of the actual value, were different. An attacker might use this to reach seemingly unreachable code paths by providing incorrectly formatted input data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium/high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.3&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ArrayAccessCleanHigherOrderBits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Access to array elements for arrays of types with less than 32 bytes did not correctly clean the higher order bits, causing corruption in other array elements.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Multiple elements of an array of values that are shorter than 17 bytes are packed into the same storage slot. Writing to a single element of such an array did not properly clean the higher order bytes and thus could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium/high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.1&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;AncientCompiler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;This compiler version is ancient and might contain several undocumented or undiscovered bugs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The list of bugs is only kept for compiler versions starting from 0.3.0, so older versions might contain undocumented bugs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.0&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-contributing"></span><div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Help is always appreciated!</p>
<p>To get started, you can try <a class="reference internal" href="index.html#building-from-source"><span class="std std-ref">Building from Source</span></a> in order to familiarize
yourself with the components of Solidity and the build process. Also, it may be
useful to become well-versed at writing smart-contracts in Solidity.</p>
<p>In particular, we need help in the following areas:</p>
<ul class="simple">
<li>Improving the documentation</li>
<li>Responding to questions from other users on <a class="reference external" href="https://ethereum.stackexchange.com">StackExchange</a> and the <a class="reference external" href="https://gitter.im/ethereum/solidity">Solidity Gitter</a></li>
<li>Fixing and responding to <a class="reference external" href="https://github.com/ethereum/solidity/issues">Solidity’s GitHub issues</a>, especially those tagged as
<a class="reference external" href="https://github.com/ethereum/solidity/issues?q=is%3Aopen+is%3Aissue+label%3Aup-for-grabs">up-for-grabs</a> which are
meant as introductory issues for external contributors.</li>
</ul>
<div class="section" id="how-to-report-issues">
<h3>How to Report Issues<a class="headerlink" href="#how-to-report-issues" title="Permalink to this headline">¶</a></h3>
<p>To report an issue, please use the
<a class="reference external" href="https://github.com/ethereum/solidity/issues">GitHub issues tracker</a>. When
reporting issues, please mention the following details:</p>
<ul class="simple">
<li>Which version of Solidity you are using</li>
<li>What was the source code (if applicable)</li>
<li>Which platform are you running on</li>
<li>How to reproduce the issue</li>
<li>What was the result of the issue</li>
<li>What the expected behaviour is</li>
</ul>
<p>Reducing the source code that caused the issue to a bare minimum is always
very helpful and sometimes even clarifies a misunderstanding.</p>
</div>
<div class="section" id="workflow-for-pull-requests">
<h3>Workflow for Pull Requests<a class="headerlink" href="#workflow-for-pull-requests" title="Permalink to this headline">¶</a></h3>
<p>In order to contribute, please fork off of the <code class="docutils literal"><span class="pre">develop</span></code> branch and make your
changes there. Your commit messages should detail <em>why</em> you made your change
in addition to <em>what</em> you did (unless it is a tiny change).</p>
<p>If you need to pull in any changes from <code class="docutils literal"><span class="pre">develop</span></code> after making your fork (for
example, to resolve potential merge conflicts), please avoid using <code class="docutils literal"><span class="pre">git</span> <span class="pre">merge</span></code>
and instead, <code class="docutils literal"><span class="pre">git</span> <span class="pre">rebase</span></code> your branch.</p>
<p>Additionally, if you are writing a new feature, please ensure you write appropriate
Boost test cases and place them under <code class="docutils literal"><span class="pre">test/</span></code>.</p>
<p>However, if you are making a larger change, please consult with the <a class="reference external" href="https://gitter.im/ethereum/solidity-dev">Solidity Development Gitter channel</a> (different from the one mentioned above, this on is
focused on compiler and language development instead of language use) first.</p>
<p>Finally, please make sure you respect the <a class="reference external" href="https://raw.githubusercontent.com/ethereum/solidity/develop/CODING_STYLE.md">coding style</a>
for this project. Also, even though we do CI testing, please test your code and
ensure that it builds locally before submitting a pull request.</p>
<p>Thank you for your help!</p>
</div>
<div class="section" id="running-the-compiler-tests">
<h3>Running the compiler tests<a class="headerlink" href="#running-the-compiler-tests" title="Permalink to this headline">¶</a></h3>
<p>Solidity includes different types of tests. They are included in the application
called <code class="docutils literal"><span class="pre">soltest</span></code>. Some of them require the <code class="docutils literal"><span class="pre">cpp-ethereum</span></code> client in testing mode,
some others require <code class="docutils literal"><span class="pre">libz3</span></code> to be installed.</p>
<p><code class="docutils literal"><span class="pre">soltest</span></code> reads test contracts that are annotated with expected results
stored in <code class="docutils literal"><span class="pre">./test/libsolidity/syntaxTests</span></code>. In order for soltest to find these
tests the root test directory has to be specified using the <code class="docutils literal"><span class="pre">--testpath</span></code> command
line option, e.g. <code class="docutils literal"><span class="pre">./build/test/soltest</span> <span class="pre">--</span> <span class="pre">--testpath</span> <span class="pre">./test</span></code>.</p>
<p>To disable the z3 tests, use <code class="docutils literal"><span class="pre">./build/test/soltest</span> <span class="pre">--</span> <span class="pre">--no-smt</span> <span class="pre">--testpath</span> <span class="pre">./test</span></code> and
to run a subset of the tests that do not require <code class="docutils literal"><span class="pre">cpp-ethereum</span></code>, use
<code class="docutils literal"><span class="pre">./build/test/soltest</span> <span class="pre">--</span> <span class="pre">--no-ipc</span> <span class="pre">--testpath</span> <span class="pre">./test</span></code>.</p>
<p>For all other tests, you need to install <a class="reference external" href="https://github.com/ethereum/cpp-ethereum/releases/download/solidityTester/eth">cpp-ethereum</a> and run it in testing mode: <code class="docutils literal"><span class="pre">eth</span> <span class="pre">--test</span> <span class="pre">-d</span> <span class="pre">/tmp/testeth</span></code>.</p>
<p>Then you run the actual tests: <code class="docutils literal"><span class="pre">./build/test/soltest</span> <span class="pre">--</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span> <span class="pre">--testpath</span> <span class="pre">./test</span></code>.</p>
<p>To run a subset of tests, filters can be used:
<code class="docutils literal"><span class="pre">soltest</span> <span class="pre">-t</span> <span class="pre">TestSuite/TestName</span> <span class="pre">--</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span> <span class="pre">--testpath</span> <span class="pre">./test</span></code>,
where <code class="docutils literal"><span class="pre">TestName</span></code> can be a wildcard <code class="docutils literal"><span class="pre">*</span></code>.</p>
<p>Alternatively, there is a testing script at <code class="docutils literal"><span class="pre">scripts/test.sh</span></code> which executes all tests and runs
<code class="docutils literal"><span class="pre">cpp-ethereum</span></code> automatically if it is in the path (but does not download it).</p>
<p>Travis CI even runs some additional tests (including <code class="docutils literal"><span class="pre">solc-js</span></code> and testing third party Solidity frameworks) that require compiling the Emscripten target.</p>
<div class="section" id="writing-and-running-syntax-tests">
<h4>Writing and running syntax tests<a class="headerlink" href="#writing-and-running-syntax-tests" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, syntax tests are stored in individual contracts. These files must contain annotations, stating the expected result(s) of the respective test.
The test suite will compile and check them against the given expectations.</p>
<p>Example: <code class="docutils literal"><span class="pre">./test/libsolidity/syntaxTests/double_stateVariable_declaration.sol</span></code></p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="nx">variable</span><span class="p">;</span>
    <span class="kt">uint128</span> <span class="nx">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: Identifier already declared.</span>
</pre></div>
</div>
<p>A syntax test must contain at least the contract under test itself, followed by the seperator <code class="docutils literal"><span class="pre">----</span></code>. The additional comments above are used to describe the
expected compiler errors or warnings. This section can be empty in case that the contract should compile without any errors or warnings.</p>
<p>In the above example, the state variable <code class="docutils literal"><span class="pre">variable</span></code> was declared twice, which is not allowed. This will result in a <code class="docutils literal"><span class="pre">DeclarationError</span></code> stating that the identifer was already declared.</p>
<p>The tool that is being used for those tests is called <code class="docutils literal"><span class="pre">isoltest</span></code> and can be found under <code class="docutils literal"><span class="pre">./test/tools/</span></code>. It is an interactive tool which allows
editing of failing contracts using your prefered text editor. Let’s try to break this test by removing the second declaration of <code class="docutils literal"><span class="pre">variable</span></code>:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="nx">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: Identifier already declared.</span>
</pre></div>
</div>
<p>Running <code class="docutils literal"><span class="pre">./test/isoltest</span></code> again will result in a test failure:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">syntaxTests</span><span class="o">/</span><span class="nx">double_stateVariable_declaration</span><span class="p">.</span><span class="nx">sol</span><span class="o">:</span> <span class="nx">FAIL</span>
    <span class="nx">Contract</span><span class="o">:</span>
        <span class="kd">contract</span> <span class="nx">test</span> <span class="p">{</span>
            <span class="kt">uint256</span> <span class="nx">variable</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="nx">Expected</span> <span class="nx">result</span><span class="o">:</span>
        <span class="nx">DeclarationError</span><span class="o">:</span> <span class="nx">Identifier</span> <span class="nx">already</span> <span class="nx">declared</span><span class="p">.</span>
    <span class="nx">Obtained</span> <span class="nx">result</span><span class="o">:</span>
        <span class="nx">Success</span>
</pre></div>
</div>
<p>which prints the expected result next to the obtained result, but also provides a way to change edit / update / skip the current contract or to even quit.
<code class="docutils literal"><span class="pre">isoltest</span></code> offers several options for failing tests:</p>
<ul class="simple">
<li>edit: <code class="docutils literal"><span class="pre">isoltest</span></code> will try to open the editor that was specified before using <code class="docutils literal"><span class="pre">isoltest</span> <span class="pre">--editor</span> <span class="pre">/path/to/editor</span></code>. If no path was set, this will result in a runtime error. In case an editor was specified, this will open it such that the contract can be adjusted.</li>
<li>update: Updates the contract under test. This will either remove the annotation which contains the exception not met or will add missing expectations. The test will then be run again.</li>
<li>skip: Skips the execution of this particular test.</li>
<li>quit: Quits <code class="docutils literal"><span class="pre">isoltest</span></code>.</li>
</ul>
<p>Automatically updating the test above will change it to</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="nx">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="nx">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
</pre></div>
</div>
<p>and re-run the test. It will now pass again:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">Re</span><span class="o">-</span><span class="nx">running</span> <span class="nx">test</span> <span class="kr">case</span><span class="p">...</span>
<span class="nx">syntaxTests</span><span class="o">/</span><span class="nx">double_stateVariable_declaration</span><span class="p">.</span><span class="nx">sol</span><span class="o">:</span> <span class="nx">OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please choose a name for the contract file, that is self-explainatory in the sense of what is been tested, e.g. <code class="docutils literal"><span class="pre">double_variable_declaration.sol</span></code>.
Do not put more than one contract into a single file. <code class="docutils literal"><span class="pre">isoltest</span></code> is currently not able to recognize them individually.</p>
</div>
</div>
</div>
<div class="section" id="running-the-fuzzer-via-afl">
<h3>Running the Fuzzer via AFL<a class="headerlink" href="#running-the-fuzzer-via-afl" title="Permalink to this headline">¶</a></h3>
<p>Fuzzing is a technique that runs programs on more or less random inputs to find exceptional execution
states (segmentation faults, exceptions, etc). Modern fuzzers are clever and do a directed search
inside the input. We have a specialized binary called <code class="docutils literal"><span class="pre">solfuzzer</span></code> which takes source code as input
and fails whenever it encounters an internal compiler error, segmentation fault or similar, but
does not fail if e.g. the code contains an error. This way, internal problems in the compiler
can be found by fuzzing tools.</p>
<p>We mainly use <a class="reference external" href="http://lcamtuf.coredump.cx/afl/">AFL</a> for fuzzing. You need to download and
build AFL manually. Next, build Solidity (or just the <code class="docutils literal"><span class="pre">solfuzzer</span></code> binary) with AFL as your compiler:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">cd</span> <span class="nx">build</span>
<span class="err">#</span> <span class="k">if</span> <span class="nx">needed</span>
<span class="nx">make</span> <span class="nx">clean</span>
<span class="nx">cmake</span> <span class="p">..</span> <span class="o">-</span><span class="nx">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">afl</span><span class="o">-</span><span class="nx">gcc</span> <span class="o">-</span><span class="nx">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">afl</span><span class="o">-</span><span class="nx">g</span><span class="o">++</span>
<span class="nx">make</span> <span class="nx">solfuzzer</span>
</pre></div>
</div>
<p>Next, you need some example source files. This will make it much easer for the fuzzer
to find errors. You can either copy some files from the syntax tests or extract test files
from the documentation or the other tests:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">mkdir</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">test_cases</span>
<span class="nx">cd</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">test_cases</span>
<span class="err">#</span> <span class="nx">extract</span> <span class="nx">from</span> <span class="nx">tests</span><span class="o">:</span>
<span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">solidity</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">isolate_tests</span><span class="p">.</span><span class="nx">py</span> <span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">solidity</span><span class="o">/</span><span class="nx">test</span><span class="o">/</span><span class="nx">libsolidity</span><span class="o">/</span><span class="nx">SolidityEndToEndTest</span><span class="p">.</span><span class="nx">cpp</span>
<span class="err">#</span> <span class="nx">extract</span> <span class="nx">from</span> <span class="nx">documentation</span><span class="o">:</span>
<span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">solidity</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">isolate_tests</span><span class="p">.</span><span class="nx">py</span> <span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">solidity</span><span class="o">/</span><span class="nx">docs</span> <span class="nx">docs</span>
</pre></div>
</div>
<p>The AFL documentation states that the corpus (the initial input files) should not be
too large. The files themselves should not be larger than 1 kB and there should be
at most one input file per functionality, so better start with a small number of
input files. There is also a tool called <code class="docutils literal"><span class="pre">afl-cmin</span></code> that can trim input files
that result in similar behaviour of the binary.</p>
<p>Now run the fuzzer (the <code class="docutils literal"><span class="pre">-m</span></code> extends the size of memory to 60 MB):</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nx">afl</span><span class="o">-</span><span class="nx">fuzz</span> <span class="o">-</span><span class="nx">m</span> <span class="mi">60</span> <span class="o">-</span><span class="nx">i</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">test_cases</span> <span class="o">-</span><span class="nx">o</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">fuzzer_reports</span> <span class="o">--</span> <span class="err">/path/to/solfuzzer</span>
</pre></div>
</div>
<p>The fuzzer will create source files that lead to failures in <code class="docutils literal"><span class="pre">/tmp/fuzzer_reports</span></code>.
Often it finds many similar source files that produce the same error. You can
use the tool <code class="docutils literal"><span class="pre">scripts/uniqueErrors.sh</span></code> to filter out the unique errors.</p>
</div>
<div class="section" id="whiskers">
<h3>Whiskers<a class="headerlink" href="#whiskers" title="Permalink to this headline">¶</a></h3>
<p><em>Whiskers</em> is a templating system similar to <a class="reference external" href="https://mustache.github.io">Mustache</a>. It is used by the
compiler in various places to aid readability, and thus maintainability and verifiability, of the code.</p>
<p>The syntax comes with a substantial difference to Mustache: the template markers <code class="docutils literal"><span class="pre">{{</span></code> and <code class="docutils literal"><span class="pre">}}</span></code> are
replaced by <code class="docutils literal"><span class="pre">&lt;</span></code> and <code class="docutils literal"><span class="pre">&gt;</span></code> in order to aid parsing and avoid conflicts with <a class="reference internal" href="index.html#inline-assembly"><span class="std std-ref">Inline Assembly</span></a>
(The symbols <code class="docutils literal"><span class="pre">&lt;</span></code> and <code class="docutils literal"><span class="pre">&gt;</span></code> are invalid in inline assembly, while <code class="docutils literal"><span class="pre">{</span></code> and <code class="docutils literal"><span class="pre">}</span></code> are used to delimit blocks).
Another limitation is that lists are only resolved one depth and they will not recurse. This may change in the future.</p>
<p>A rough specification is the following:</p>
<p>Any occurrence of <code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> is replaced by the string-value of the supplied variable <code class="docutils literal"><span class="pre">name</span></code> without any
escaping and without iterated replacements. An area can be delimited by <code class="docutils literal"><span class="pre">&lt;#name&gt;...&lt;/name&gt;</span></code>. It is replaced
by as many concatenations of its contents as there were sets of variables supplied to the template system,
each time replacing any <code class="docutils literal"><span class="pre">&lt;inner&gt;</span></code> items by their respective value. Top-level variables can also be used
inside such areas.</p>
</div>
</div>
<span id="document-frequently-asked-questions"></span><div class="section" id="frequently-asked-questions">
<h2>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h2>
<p>This list was originally compiled by <a class="reference external" href="mailto:fivedogit&#37;&#52;&#48;gmail&#46;com">fivedogit</a>.</p>
<div class="section" id="basic-questions">
<h3>Basic Questions<a class="headerlink" href="#basic-questions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="is-it-possible-to-do-something-on-a-specific-block-number-e-g-publish-a-contract-or-execute-a-transaction">
<h4>Is it possible to do something on a specific block number? (e.g. publish a contract or execute a transaction)<a class="headerlink" href="#is-it-possible-to-do-something-on-a-specific-block-number-e-g-publish-a-contract-or-execute-a-transaction" title="Permalink to this headline">¶</a></h4>
<p>Transactions are not guaranteed to happen on the next block or any future
specific block, since it is up to the miners to include transactions and not up
to the submitter of the transaction. This applies to function calls/transactions and contract
creation transactions.</p>
<p>If you want to schedule future calls of your contract, you can use the
<a class="reference external" href="http://www.ethereum-alarm-clock.com/">alarm clock</a>.</p>
</div>
<div class="section" id="what-is-the-transaction-payload">
<h4>What is the transaction “payload”?<a class="headerlink" href="#what-is-the-transaction-payload" title="Permalink to this headline">¶</a></h4>
<p>This is just the bytecode “data” sent along with the request.</p>
</div>
<div class="section" id="is-there-a-decompiler-available">
<h4>Is there a decompiler available?<a class="headerlink" href="#is-there-a-decompiler-available" title="Permalink to this headline">¶</a></h4>
<p>There is no exact decompiler to Solidity, but
<a class="reference external" href="https://github.com/comaeio/porosity">Porosity</a> is close.
Because some information like variable names, comments, and
source code formatting is lost in the compilation process,
it is not possible to completely recover the original source code.</p>
<p>Bytecode can be disassembled to opcodes, a service that is provided by
several blockchain explorers.</p>
<p>Contracts on the blockchain should have their original source
code published if they are to be used by third parties.</p>
</div>
<div class="section" id="create-a-contract-that-can-be-killed-and-return-funds">
<h4>Create a contract that can be killed and return funds<a class="headerlink" href="#create-a-contract-that-can-be-killed-and-return-funds" title="Permalink to this headline">¶</a></h4>
<p>First, a word of warning: Killing contracts sounds like a good idea, because “cleaning up”
is always good, but as seen above, it does not really clean up. Furthermore,
if Ether is sent to removed contracts, the Ether will be forever lost.</p>
<p>If you want to deactivate your contracts, it is preferable to <strong>disable</strong> them by changing some
internal state which causes all functions to throw. This will make it impossible
to use the contract and ether sent to the contract will be returned automatically.</p>
<p>Now to answering the question: Inside a constructor, <code class="docutils literal"><span class="pre">msg.sender</span></code> is the
creator. Save it. Then <code class="docutils literal"><span class="pre">selfdestruct(creator);</span></code> to kill and return funds.</p>
<p><a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/05_greeter.sol">example</a></p>
<p>Note that if you <code class="docutils literal"><span class="pre">import</span> <span class="pre">&quot;mortal&quot;</span></code> at the top of your contracts and declare
<code class="docutils literal"><span class="pre">contract</span> <span class="pre">SomeContract</span> <span class="pre">is</span> <span class="pre">mortal</span> <span class="pre">{</span> <span class="pre">...</span></code> and compile with a compiler that already
has it (which includes <a class="reference external" href="https://remix.ethereum.org/">Remix</a>), then
<code class="docutils literal"><span class="pre">kill()</span></code> is taken care of for you. Once a contract is “mortal”, then you can
<code class="docutils literal"><span class="pre">contractname.kill.sendTransaction({from:eth.coinbase})</span></code>, just the same as my
examples.</p>
</div>
<div class="section" id="can-you-return-an-array-or-a-string-from-a-solidity-function-call">
<h4>Can you return an array or a <code class="docutils literal"><span class="pre">string</span></code> from a solidity function call?<a class="headerlink" href="#can-you-return-an-array-or-a-string-from-a-solidity-function-call" title="Permalink to this headline">¶</a></h4>
<p>Yes. See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/60_array_receiver_and_returner.sol">array_receiver_and_returner.sol</a>.</p>
<p>What is problematic, though, is returning any variably-sized data (e.g. a
variably-sized array like <code class="docutils literal"><span class="pre">uint[]</span></code>) from a fuction <strong>called from within Solidity</strong>.
This is a limitation of the EVM and will be solved with the next protocol update.</p>
<p>Returning variably-sized data as part of an external transaction or call is fine.</p>
</div>
<div class="section" id="is-it-possible-to-in-line-initialize-an-array-like-so-string-myarray-a-b">
<h4>Is it possible to in-line initialize an array like so: <code class="docutils literal"><span class="pre">string[]</span> <span class="pre">myarray</span> <span class="pre">=</span> <span class="pre">[&quot;a&quot;,</span> <span class="pre">&quot;b&quot;];</span></code><a class="headerlink" href="#is-it-possible-to-in-line-initialize-an-array-like-so-string-myarray-a-b" title="Permalink to this headline">¶</a></h4>
<p>Yes. However it should be noted that this currently only works with statically sized memory arrays. You can even create an inline memory
array in the return statement. Pretty cool, huh?</p>
<p>Example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="p">{</span>
        <span class="kt">string</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">memory</span> <span class="nx">adaArr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;This&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">];</span>
        <span class="k">return</span> <span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="can-a-contract-function-return-a-struct">
<h4>Can a contract function return a <code class="docutils literal"><span class="pre">struct</span></code>?<a class="headerlink" href="#can-a-contract-function-return-a-struct" title="Permalink to this headline">¶</a></h4>
<p>Yes, but only in <code class="docutils literal"><span class="pre">internal</span></code> function calls.</p>
</div>
<div class="section" id="if-i-return-an-enum-i-only-get-integer-values-in-web3-js-how-to-get-the-named-values">
<h4>If I return an <code class="docutils literal"><span class="pre">enum</span></code>, I only get integer values in web3.js. How to get the named values?<a class="headerlink" href="#if-i-return-an-enum-i-only-get-integer-values-in-web3-js-how-to-get-the-named-values" title="Permalink to this headline">¶</a></h4>
<p>Enums are not supported by the ABI, they are just supported by Solidity.
You have to do the mapping yourself for now, we might provide some help
later.</p>
</div>
<div class="section" id="can-state-variables-be-initialized-in-line">
<h4>Can state variables be initialized in-line?<a class="headerlink" href="#can-state-variables-be-initialized-in-line" title="Permalink to this headline">¶</a></h4>
<p>Yes, this is possible for all types (even for structs). However, for arrays it
should be noted that you must declare them as static memory arrays.</p>
<p>Examples:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="nx">S</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="nx">a</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nx">b</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">S</span> <span class="k">public</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">S</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="kt">string</span> <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Ada&quot;</span><span class="p">;</span>
    <span class="kt">string</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="nx">adaArr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;This&quot;</span><span class="p">,</span> <span class="s2">&quot;is&quot;</span><span class="p">,</span> <span class="s2">&quot;an&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="nx">C</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="how-do-structs-work">
<h4>How do structs work?<a class="headerlink" href="#how-do-structs-work" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/65_struct_and_for_loop_tester.sol">struct_and_for_loop_tester.sol</a>.</p>
</div>
<div class="section" id="how-do-for-loops-work">
<h4>How do for loops work?<a class="headerlink" href="#how-do-for-loops-work" title="Permalink to this headline">¶</a></h4>
<p>Very similar to JavaScript. There is one point to watch out for, though:</p>
<p>If you use <code class="docutils literal"><span class="pre">for</span> <span class="pre">(var</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">a.length;</span> <span class="pre">i</span> <span class="pre">++)</span> <span class="pre">{</span> <span class="pre">a[i]</span> <span class="pre">=</span> <span class="pre">i;</span> <span class="pre">}</span></code>, then
the type of <code class="docutils literal"><span class="pre">i</span></code> will be inferred only from <code class="docutils literal"><span class="pre">0</span></code>, whose type is <code class="docutils literal"><span class="pre">uint8</span></code>.
This means that if <code class="docutils literal"><span class="pre">a</span></code> has more than <code class="docutils literal"><span class="pre">255</span></code> elements, your loop will
not terminate because <code class="docutils literal"><span class="pre">i</span></code> can only hold values up to <code class="docutils literal"><span class="pre">255</span></code>.</p>
<p>Better use <code class="docutils literal"><span class="pre">for</span> <span class="pre">(uint</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">0;</span> <span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">a.length...</span></code></p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/65_struct_and_for_loop_tester.sol">struct_and_for_loop_tester.sol</a>.</p>
</div>
<div class="section" id="what-are-some-examples-of-basic-string-manipulation-substring-indexof-charat-etc">
<h4>What are some examples of basic string manipulation (<code class="docutils literal"><span class="pre">substring</span></code>, <code class="docutils literal"><span class="pre">indexOf</span></code>, <code class="docutils literal"><span class="pre">charAt</span></code>, etc)?<a class="headerlink" href="#what-are-some-examples-of-basic-string-manipulation-substring-indexof-charat-etc" title="Permalink to this headline">¶</a></h4>
<p>There are some string utility functions at <a class="reference external" href="https://github.com/ethereum/dapp-bin/blob/master/library/stringUtils.sol">stringUtils.sol</a>
which will be extended in the future. In addition, Arachnid has written <a class="reference external" href="https://github.com/Arachnid/solidity-stringutils">solidity-stringutils</a>.</p>
<p>For now, if you want to modify a string (even when you only want to know its length),
you should always convert it to a <code class="docutils literal"><span class="pre">bytes</span></code> first:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="nx">s</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">append</span><span class="p">(</span><span class="kt">byte</span> <span class="nx">c</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">bytes</span><span class="p">(</span><span class="nx">s</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">set</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">i</span><span class="p">,</span> <span class="kt">byte</span> <span class="nx">c</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">bytes</span><span class="p">(</span><span class="nx">s</span><span class="p">)[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-concatenate-two-strings">
<h4>Can I concatenate two strings?<a class="headerlink" href="#can-i-concatenate-two-strings" title="Permalink to this headline">¶</a></h4>
<p>You have to do it manually for now.</p>
</div>
<div class="section" id="why-is-the-low-level-function-call-less-favorable-than-instantiating-a-contract-with-a-variable-contractb-b-and-executing-its-functions-b-dosomething">
<h4>Why is the low-level function <code class="docutils literal"><span class="pre">.call()</span></code> less favorable than instantiating a contract with a variable (<code class="docutils literal"><span class="pre">ContractB</span> <span class="pre">b;</span></code>) and executing its functions (<code class="docutils literal"><span class="pre">b.doSomething();</span></code>)?<a class="headerlink" href="#why-is-the-low-level-function-call-less-favorable-than-instantiating-a-contract-with-a-variable-contractb-b-and-executing-its-functions-b-dosomething" title="Permalink to this headline">¶</a></h4>
<p>If you use actual functions, the compiler will tell you if the types
or your arguments do not match, if the function does not exist
or is not visible and it will do the packing of the
arguments for you.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_ping.sol">ping.sol</a> and
<a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_pong.sol">pong.sol</a>.</p>
</div>
<div class="section" id="is-unused-gas-automatically-refunded">
<h4>Is unused gas automatically refunded?<a class="headerlink" href="#is-unused-gas-automatically-refunded" title="Permalink to this headline">¶</a></h4>
<p>Yes and it is immediate, i.e. done as part of the transaction.</p>
</div>
<div class="section" id="when-returning-a-value-of-say-uint-type-is-it-possible-to-return-an-undefined-or-null-like-value">
<h4>When returning a value of say <code class="docutils literal"><span class="pre">uint</span></code> type, is it possible to return an <code class="docutils literal"><span class="pre">undefined</span></code> or “null”-like value?<a class="headerlink" href="#when-returning-a-value-of-say-uint-type-is-it-possible-to-return-an-undefined-or-null-like-value" title="Permalink to this headline">¶</a></h4>
<p>This is not possible, because all types use up the full value range.</p>
<p>You have the option to <code class="docutils literal"><span class="pre">throw</span></code> on error, which will also revert the whole
transaction, which might be a good idea if you ran into an unexpected
situation.</p>
<p>If you do not want to throw, you can return a pair:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">counters</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">getCounter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">index</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nx">counter</span><span class="p">,</span> <span class="kt">bool</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">&gt;=</span> <span class="nx">counters</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="p">(</span><span class="nx">counters</span><span class="p">[</span><span class="nx">index</span><span class="p">],</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">checkCounter</span><span class="p">(</span><span class="kt">uint</span> <span class="nx">index</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="p">(</span><span class="nx">counter</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="o">=</span> <span class="nx">getCounter</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="are-comments-included-with-deployed-contracts-and-do-they-increase-deployment-gas">
<h4>Are comments included with deployed contracts and do they increase deployment gas?<a class="headerlink" href="#are-comments-included-with-deployed-contracts-and-do-they-increase-deployment-gas" title="Permalink to this headline">¶</a></h4>
<p>No, everything that is not needed for execution is removed during compilation.
This includes, among others, comments, variable names and type names.</p>
</div>
<div class="section" id="what-happens-if-you-send-ether-along-with-a-function-call-to-a-contract">
<h4>What happens if you send ether along with a function call to a contract?<a class="headerlink" href="#what-happens-if-you-send-ether-along-with-a-function-call-to-a-contract" title="Permalink to this headline">¶</a></h4>
<p>It gets added to the total balance of the contract, just like when you send ether when creating a contract.
You can only send ether along to a function that has the <code class="docutils literal"><span class="pre">payable</span></code> modifier,
otherwise an exception is thrown.</p>
</div>
<div class="section" id="is-it-possible-to-get-a-tx-receipt-for-a-transaction-executed-contract-to-contract">
<h4>Is it possible to get a tx receipt for a transaction executed contract-to-contract?<a class="headerlink" href="#is-it-possible-to-get-a-tx-receipt-for-a-transaction-executed-contract-to-contract" title="Permalink to this headline">¶</a></h4>
<p>No, a function call from one contract to another does not create its own transaction,
you have to look in the overall transaction. This is also the reason why several
block explorer do not show Ether sent between contracts correctly.</p>
</div>
<div class="section" id="what-is-the-memory-keyword-what-does-it-do">
<h4>What is the <code class="docutils literal"><span class="pre">memory</span></code> keyword? What does it do?<a class="headerlink" href="#what-is-the-memory-keyword-what-does-it-do" title="Permalink to this headline">¶</a></h4>
<p>The Ethereum Virtual Machine has three areas where it can store items.</p>
<p>The first is “storage”, where all the contract state variables reside.
Every contract has its own storage and it is persistent between function calls
and quite expensive to use.</p>
<p>The second is “memory”, this is used to hold temporary values. It
is erased between (external) function calls and is cheaper to use.</p>
<p>The third one is the stack, which is used to hold small local variables.
It is almost free to use, but can only hold a limited amount of values.</p>
<p>For almost all types, you cannot specify where they should be stored, because
they are copied everytime they are used.</p>
<p>The types where the so-called storage location is important are structs
and arrays. If you e.g. pass such variables in function calls, their
data is not copied if it can stay in memory or stay in storage.
This means that you can modify their content in the called function
and these modifications will still be visible in the caller.</p>
<p>There are defaults for the storage location depending on which type
of variable it concerns:</p>
<ul class="simple">
<li>state variables are always in storage</li>
<li>function arguments are in memory by default</li>
<li>local variables of struct, array or mapping type reference storage by default</li>
<li>local variables of value type (i.e. neither array, nor struct nor mapping) are stored in the stack</li>
</ul>
<p>Example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data1</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data2</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">appendOne</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">append</span><span class="p">(</span><span class="nx">data1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">appendTwo</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">append</span><span class="p">(</span><span class="nx">data2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">append</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">d</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The function <code class="docutils literal"><span class="pre">append</span></code> can work both on <code class="docutils literal"><span class="pre">data1</span></code> and <code class="docutils literal"><span class="pre">data2</span></code> and its modifications will be
stored permanently. If you remove the <code class="docutils literal"><span class="pre">storage</span></code> keyword, the default
is to use <code class="docutils literal"><span class="pre">memory</span></code> for function arguments. This has the effect that
at the point where <code class="docutils literal"><span class="pre">append(data1)</span></code> or <code class="docutils literal"><span class="pre">append(data2)</span></code> is called, an
independent copy of the state variable is created in memory and
<code class="docutils literal"><span class="pre">append</span></code> operates on this copy (which does not support <code class="docutils literal"><span class="pre">.push</span></code> - but that
is another issue). The modifications to this independent copy do not
carry back to <code class="docutils literal"><span class="pre">data1</span></code> or <code class="docutils literal"><span class="pre">data2</span></code>.</p>
<p>A common mistake is to declare a local variable and assume that it will
be created in memory, although it will be created in storage:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="cs">/// THIS CONTRACT CONTAINS AN ERROR</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">someVariable</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span><span class="p">;</span>
        <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The type of the local variable <code class="docutils literal"><span class="pre">x</span></code> is <code class="docutils literal"><span class="pre">uint[]</span> <span class="pre">storage</span></code>, but since
storage is not dynamically allocated, it has to be assigned from
a state variable before it can be used. So no space in storage will be
allocated for <code class="docutils literal"><span class="pre">x</span></code>, but instead it functions only as an alias for
a pre-existing variable in storage.</p>
<p>What will happen is that the compiler interprets <code class="docutils literal"><span class="pre">x</span></code> as a storage
pointer and will make it point to the storage slot <code class="docutils literal"><span class="pre">0</span></code> by default.
This has the effect that <code class="docutils literal"><span class="pre">someVariable</span></code> (which resides at storage
slot <code class="docutils literal"><span class="pre">0</span></code>) is modified by <code class="docutils literal"><span class="pre">x.push(2)</span></code>.</p>
<p>The correct way to do this is the following:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="nx">someVariable</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="nx">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-questions">
<h3>Advanced Questions<a class="headerlink" href="#advanced-questions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="how-do-you-get-a-random-number-in-a-contract-implement-a-self-returning-gambling-contract">
<h4>How do you get a random number in a contract? (Implement a self-returning gambling contract.)<a class="headerlink" href="#how-do-you-get-a-random-number-in-a-contract-implement-a-self-returning-gambling-contract" title="Permalink to this headline">¶</a></h4>
<p>Getting randomness right is often the crucial part in a crypto project and
most failures result from bad random number generators.</p>
<p>If you do not want it to be safe, you build something similar to the <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/35_coin_flipper.sol">coin flipper</a>
but otherwise, rather use a contract that supplies randomness, like the <a class="reference external" href="https://github.com/randao/randao">RANDAO</a>.</p>
</div>
<div class="section" id="get-return-value-from-non-constant-function-from-another-contract">
<h4>Get return value from non-constant function from another contract<a class="headerlink" href="#get-return-value-from-non-constant-function-from-another-contract" title="Permalink to this headline">¶</a></h4>
<p>The key point is that the calling contract needs to know about the function it intends to call.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_ping.sol">ping.sol</a>
and <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_pong.sol">pong.sol</a>.</p>
</div>
<div class="section" id="get-contract-to-do-something-when-it-is-first-mined">
<h4>Get contract to do something when it is first mined<a class="headerlink" href="#get-contract-to-do-something-when-it-is-first-mined" title="Permalink to this headline">¶</a></h4>
<p>Use the constructor. Anything inside it will be executed when the contract is first mined.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/50_replicator.sol">replicator.sol</a>.</p>
</div>
<div class="section" id="how-do-you-create-2-dimensional-arrays">
<h4>How do you create 2-dimensional arrays?<a class="headerlink" href="#how-do-you-create-2-dimensional-arrays" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/55_2D_array.sol">2D_array.sol</a>.</p>
<p>Note that filling a 10x10 square of <code class="docutils literal"><span class="pre">uint8</span></code> + contract creation took more than <code class="docutils literal"><span class="pre">800,000</span></code>
gas at the time of this writing. 17x17 took <code class="docutils literal"><span class="pre">2,000,000</span></code> gas. With the limit at
3.14 million… well, there’s a pretty low ceiling for what you can create right
now.</p>
<p>Note that merely “creating” the array is free, the costs are in filling it.</p>
<p>Note2: Optimizing storage access can pull the gas costs down considerably, because
32 <code class="docutils literal"><span class="pre">uint8</span></code> values can be stored in a single slot. The problem is that these optimizations
currently do not work across loops and also have a problem with bounds checking.
You might get much better results in the future, though.</p>
</div>
<div class="section" id="what-happens-to-a-struct-s-mapping-when-copying-over-a-struct">
<h4>What happens to a <code class="docutils literal"><span class="pre">struct</span></code>’s mapping when copying over a <code class="docutils literal"><span class="pre">struct</span></code>?<a class="headerlink" href="#what-happens-to-a-struct-s-mapping-when-copying-over-a-struct" title="Permalink to this headline">¶</a></h4>
<p>This is a very interesting question. Suppose that we have a contract field set up like such:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="kd">struct</span> <span class="nx">User</span> <span class="p">{</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">string</span> <span class="o">=&gt;</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">comments</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">somefunction</span> <span class="k">public</span> <span class="p">{</span>
   <span class="nx">User</span> <span class="nx">user1</span><span class="p">;</span>
   <span class="nx">user1</span><span class="p">.</span><span class="nx">comments</span><span class="p">[</span><span class="s2">&quot;Hello&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;World&quot;</span><span class="p">;</span>
   <span class="nx">User</span> <span class="nx">user2</span> <span class="o">=</span> <span class="nx">user1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this case, the mapping of the struct being copied over into the userList is ignored as there is no “list of mapped keys”.
Therefore it is not possible to find out which values should be copied over.</p>
</div>
<div class="section" id="how-do-i-initialize-a-contract-with-only-a-specific-amount-of-wei">
<h4>How do I initialize a contract with only a specific amount of wei?<a class="headerlink" href="#how-do-i-initialize-a-contract-with-only-a-specific-amount-of-wei" title="Permalink to this headline">¶</a></h4>
<p>Currently the approach is a little ugly, but there is little that can be done to improve it.
In the case of a <code class="docutils literal"><span class="pre">contract</span> <span class="pre">A</span></code> calling a new instance of <code class="docutils literal"><span class="pre">contract</span> <span class="pre">B</span></code>, parentheses have to be used around
<code class="docutils literal"><span class="pre">new</span> <span class="pre">B</span></code> because <code class="docutils literal"><span class="pre">B.value</span></code> would refer to a member of <code class="docutils literal"><span class="pre">B</span></code> called <code class="docutils literal"><span class="pre">value</span></code>.
You will need to make sure that you have both contracts aware of each other’s presence and that <code class="docutils literal"><span class="pre">contract</span> <span class="pre">B</span></code> has a <code class="docutils literal"><span class="pre">payable</span></code> constructor.
In this example:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">B</span><span class="p">()</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="nx">child</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">test</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">child</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">B</span><span class="p">).</span><span class="nx">value</span><span class="p">(</span><span class="mi">10</span><span class="p">)();</span> <span class="c1">//construct a new B with 10 wei</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="can-a-contract-function-accept-a-two-dimensional-array">
<h4>Can a contract function accept a two-dimensional array?<a class="headerlink" href="#can-a-contract-function-accept-a-two-dimensional-array" title="Permalink to this headline">¶</a></h4>
<p>This is not yet implemented for external calls and dynamic arrays -
you can only use one level of dynamic arrays.</p>
</div>
<div class="section" id="what-is-the-relationship-between-bytes32-and-string-why-is-it-that-bytes32-somevar-stringliteral-works-and-what-does-the-saved-32-byte-hex-value-mean">
<h4>What is the relationship between <code class="docutils literal"><span class="pre">bytes32</span></code> and <code class="docutils literal"><span class="pre">string</span></code>? Why is it that <code class="docutils literal"><span class="pre">bytes32</span> <span class="pre">somevar</span> <span class="pre">=</span> <span class="pre">&quot;stringliteral&quot;;</span></code> works and what does the saved 32-byte hex value mean?<a class="headerlink" href="#what-is-the-relationship-between-bytes32-and-string-why-is-it-that-bytes32-somevar-stringliteral-works-and-what-does-the-saved-32-byte-hex-value-mean" title="Permalink to this headline">¶</a></h4>
<p>The type <code class="docutils literal"><span class="pre">bytes32</span></code> can hold 32 (raw) bytes. In the assignment <code class="docutils literal"><span class="pre">bytes32</span> <span class="pre">samevar</span> <span class="pre">=</span> <span class="pre">&quot;stringliteral&quot;;</span></code>,
the string literal is interpreted in its raw byte form and if you inspect <code class="docutils literal"><span class="pre">somevar</span></code> and
see a 32-byte hex value, this is just <code class="docutils literal"><span class="pre">&quot;stringliteral&quot;</span></code> in hex.</p>
<p>The type <code class="docutils literal"><span class="pre">bytes</span></code> is similar, only that it can change its length.</p>
<p>Finally, <code class="docutils literal"><span class="pre">string</span></code> is basically identical to <code class="docutils literal"><span class="pre">bytes</span></code> only that it is assumed
to hold the UTF-8 encoding of a real string. Since <code class="docutils literal"><span class="pre">string</span></code> stores the
data in UTF-8 encoding it is quite expensive to compute the number of
characters in the string (the encoding of some characters takes more
than a single byte). Because of that, <code class="docutils literal"><span class="pre">string</span> <span class="pre">s;</span> <span class="pre">s.length</span></code> is not yet
supported and not even index access <code class="docutils literal"><span class="pre">s[2]</span></code>. But if you want to access
the low-level byte encoding of the string, you can use
<code class="docutils literal"><span class="pre">bytes(s).length</span></code> and <code class="docutils literal"><span class="pre">bytes(s)[2]</span></code> which will result in the number
of bytes in the UTF-8 encoding of the string (not the number of
characters) and the second byte (not character) of the UTF-8 encoded
string, respectively.</p>
</div>
<div class="section" id="can-a-contract-pass-an-array-static-size-or-string-or-bytes-dynamic-size-to-another-contract">
<h4>Can a contract pass an array (static size) or string or <code class="docutils literal"><span class="pre">bytes</span></code> (dynamic size) to another contract?<a class="headerlink" href="#can-a-contract-pass-an-array-static-size-or-string-or-bytes-dynamic-size-to-another-contract" title="Permalink to this headline">¶</a></h4>
<p>Sure. Take care that if you cross the memory / storage boundary,
independent copies will be created:</p>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nx">x</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
        <span class="nx">g</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
        <span class="nx">h</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="nx">y</span><span class="p">)</span> <span class="k">internal</span> <span class="k">pure</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="k">storage</span> <span class="nx">y</span><span class="p">)</span> <span class="k">internal</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The call to <code class="docutils literal"><span class="pre">g(x)</span></code> will not have an effect on <code class="docutils literal"><span class="pre">x</span></code> because it needs
to create an independent copy of the storage value in memory
(the default storage location is memory). On the other hand,
<code class="docutils literal"><span class="pre">h(x)</span></code> successfully modifies <code class="docutils literal"><span class="pre">x</span></code> because only a reference
and not a copy is passed.</p>
</div>
<div class="section" id="sometimes-when-i-try-to-change-the-length-of-an-array-with-ex-arrayname-length-7-i-get-a-compiler-error-value-must-be-an-lvalue-why">
<h4>Sometimes, when I try to change the length of an array with ex: <code class="docutils literal"><span class="pre">arrayname.length</span> <span class="pre">=</span> <span class="pre">7;</span></code> I get a compiler error <code class="docutils literal"><span class="pre">Value</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">an</span> <span class="pre">lvalue</span></code>. Why?<a class="headerlink" href="#sometimes-when-i-try-to-change-the-length-of-an-array-with-ex-arrayname-length-7-i-get-a-compiler-error-value-must-be-an-lvalue-why" title="Permalink to this headline">¶</a></h4>
<p>You can resize a dynamic array in storage (i.e. an array declared at the
contract level) with <code class="docutils literal"><span class="pre">arrayname.length</span> <span class="pre">=</span> <span class="pre">&lt;some</span> <span class="pre">new</span> <span class="pre">length&gt;;</span></code>. If you get the
“lvalue” error, you are probably doing one of two things wrong.</p>
<ol class="arabic simple">
<li>You might be trying to resize an array in “memory”, or</li>
<li>You might be trying to resize a non-dynamic array.</li>
</ol>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="c1">// This will not compile</span>

<span class="k">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">18</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">C</span> <span class="p">{</span>
    <span class="kt">int8</span><span class="p">[]</span> <span class="nx">dynamicStorageArray</span><span class="p">;</span>
    <span class="kt">int8</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="nx">fixedStorageArray</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">f</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">int8</span><span class="p">[]</span> <span class="k">memory</span> <span class="nx">memArr</span><span class="p">;</span>        <span class="c1">// Case 1</span>
        <span class="nx">memArr</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>             <span class="c1">// illegal</span>

        <span class="kt">int8</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">storage</span> <span class="nx">storageArr</span> <span class="o">=</span> <span class="nx">fixedStorageArray</span><span class="p">;</span>   <span class="c1">// Case 2</span>
        <span class="nx">storageArr</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>                             <span class="c1">// illegal</span>

        <span class="kt">int8</span><span class="p">[]</span> <span class="k">storage</span> <span class="nx">storageArr2</span> <span class="o">=</span> <span class="nx">dynamicStorageArray</span><span class="p">;</span>
        <span class="nx">storageArr2</span><span class="p">.</span><span class="nx">length</span><span class="o">++</span><span class="p">;</span>                     <span class="c1">// legal</span>


    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Important note:</strong> In Solidity, array dimensions are declared backwards from the way you
might be used to declaring them in C or Java, but they are access as in
C or Java.</p>
<p>For example, <code class="docutils literal"><span class="pre">int8[][5]</span> <span class="pre">somearray;</span></code> are 5 dynamic <code class="docutils literal"><span class="pre">int8</span></code> arrays.</p>
<p>The reason for this is that <code class="docutils literal"><span class="pre">T[5]</span></code> is always an array of 5 <code class="docutils literal"><span class="pre">T</span></code>’s,
no matter whether <code class="docutils literal"><span class="pre">T</span></code> itself is an array or not (this is not the
case in C or Java).</p>
</div>
<div class="section" id="is-it-possible-to-return-an-array-of-strings-string-from-a-solidity-function">
<h4>Is it possible to return an array of strings (<code class="docutils literal"><span class="pre">string[]</span></code>) from a Solidity function?<a class="headerlink" href="#is-it-possible-to-return-an-array-of-strings-string-from-a-solidity-function" title="Permalink to this headline">¶</a></h4>
<p>Not yet, as this requires two levels of dynamic arrays (<code class="docutils literal"><span class="pre">string</span></code> is a dynamic array itself).</p>
</div>
<div class="section" id="if-you-issue-a-call-for-an-array-it-is-possible-to-retrieve-the-whole-array-or-must-you-write-a-helper-function-for-that">
<h4>If you issue a call for an array, it is possible to retrieve the whole array? Or must you write a helper function for that?<a class="headerlink" href="#if-you-issue-a-call-for-an-array-it-is-possible-to-retrieve-the-whole-array-or-must-you-write-a-helper-function-for-that" title="Permalink to this headline">¶</a></h4>
<p>The automatic <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a>  for a public state variable of array type only returns
individual elements. If you want to return the complete array, you have to
manually write a function to do that.</p>
</div>
<div class="section" id="what-could-have-happened-if-an-account-has-storage-value-s-but-no-code-example-http-test-ether-camp-account-5f740b3a43fbb99724ce93a879805f4dc89178b5">
<h4>What could have happened if an account has storage value(s) but no code?  Example: <a class="reference external" href="http://test.ether.camp/account/5f740b3a43fbb99724ce93a879805f4dc89178b5">http://test.ether.camp/account/5f740b3a43fbb99724ce93a879805f4dc89178b5</a><a class="headerlink" href="#what-could-have-happened-if-an-account-has-storage-value-s-but-no-code-example-http-test-ether-camp-account-5f740b3a43fbb99724ce93a879805f4dc89178b5" title="Permalink to this headline">¶</a></h4>
<p>The last thing a constructor does is returning the code of the contract.
The gas costs for this depend on the length of the code and it might be
that the supplied gas is not enough. This situation is the only one
where an “out of gas” exception does not revert changes to the state,
i.e. in this case the initialisation of the state variables.</p>
<p><a class="reference external" href="https://github.com/ethereum/wiki/wiki/Subtleties">https://github.com/ethereum/wiki/wiki/Subtleties</a></p>
<p>After a successful CREATE operation’s sub-execution, if the operation returns x, 5 * len(x) gas is subtracted from the remaining gas before the contract is created. If the remaining gas is less than 5 * len(x), then no gas is subtracted, the code of the created contract becomes the empty string, but this is not treated as an exceptional condition - no reverts happen.</p>
</div>
<div class="section" id="what-does-the-following-strange-check-do-in-the-custom-token-contract">
<h4>What does the following strange check do in the Custom Token contract?<a class="headerlink" href="#what-does-the-following-strange-check-do-in-the-custom-token-contract" title="Permalink to this headline">¶</a></h4>
<div class="highlight-Solidity"><div class="highlight"><pre><span></span><span class="nb">require</span><span class="p">((</span><span class="nx">balanceOf</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span> <span class="o">+</span> <span class="nx">_value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">balanceOf</span><span class="p">[</span><span class="nx">_to</span><span class="p">]);</span>
</pre></div>
</div>
<p>Integers in Solidity (and most other machine-related programming languages) are restricted to a certain range.
For <code class="docutils literal"><span class="pre">uint256</span></code>, this is <code class="docutils literal"><span class="pre">0</span></code> up to <code class="docutils literal"><span class="pre">2**256</span> <span class="pre">-</span> <span class="pre">1</span></code>. If the result of some operation on those numbers
does not fit inside this range, it is truncated. These truncations can have
<a class="reference external" href="https://en.bitcoin.it/wiki/Value_overflow_incident">serious consequences</a>, so code like the one
above is necessary to avoid certain attacks.</p>
</div>
<div class="section" id="more-questions">
<h4>More Questions?<a class="headerlink" href="#more-questions" title="Permalink to this headline">¶</a></h4>
<p>If you have more questions or your question is not answered here, please talk to us on
<a class="reference external" href="https://gitter.im/ethereum/solidity">gitter</a> or file an <a class="reference external" href="https://github.com/ethereum/solidity/issues">issue</a>.</p>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Ethereum.
      
        <span class="commit">
          Revision <code>267b605f</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
          <dd><a href="/en/stable/">stable</a></dd>
        
          <dd><a href="/en/v0.4.23/">v0.4.23</a></dd>
        
          <dd><a href="/en/v0.4.22/">v0.4.22</a></dd>
        
          <dd><a href="/en/v0.4.21/">v0.4.21</a></dd>
        
          <dd><a href="/en/v0.4.20/">v0.4.20</a></dd>
        
          <dd><a href="/en/v0.4.19/">v0.4.19</a></dd>
        
          <dd><a href="/en/v0.4.18/">v0.4.18</a></dd>
        
          <dd><a href="/en/v0.4.17/">v0.4.17</a></dd>
        
          <dd><a href="/en/v0.4.16/">v0.4.16</a></dd>
        
          <dd><a href="/en/v0.4.15/">v0.4.15</a></dd>
        
          <dd><a href="/en/v0.4.14/">v0.4.14</a></dd>
        
          <dd><a href="/en/v0.4.13/">v0.4.13</a></dd>
        
          <dd><a href="/en/v0.4.12/">v0.4.12</a></dd>
        
          <dd><a href="/en/v0.4.11/">v0.4.11</a></dd>
        
          <dd><a href="/en/v0.4.10/">v0.4.10</a></dd>
        
          <dd><a href="/en/v0.4.9/">v0.4.9</a></dd>
        
          <dd><a href="/en/v0.4.8/">v0.4.8</a></dd>
        
          <dd><a href="/en/v0.4.7/">v0.4.7</a></dd>
        
          <dd><a href="/en/v0.4.6/">v0.4.6</a></dd>
        
          <dd><a href="/en/v0.4.5/">v0.4.5</a></dd>
        
          <dd><a href="/en/v0.4.4/">v0.4.4</a></dd>
        
          <dd><a href="/en/v0.4.3/">v0.4.3</a></dd>
        
          <dd><a href="/en/v0.4.2/">v0.4.2</a></dd>
        
          <dd><a href="/en/v0.4.1/">v0.4.1</a></dd>
        
          <dd><a href="/en/v0.4.0/">v0.4.0</a></dd>
        
          <dd><a href="/en/v0.3.6/">v0.3.6</a></dd>
        
          <dd><a href="/en/v0.3.5/">v0.3.5</a></dd>
        
          <dd><a href="/en/v0.3.4/">v0.3.4</a></dd>
        
          <dd><a href="/en/v0.3.3/">v0.3.3</a></dd>
        
          <dd><a href="/en/v0.3.2/">v0.3.2</a></dd>
        
          <dd><a href="/en/v0.3.1/">v0.3.1</a></dd>
        
          <dd><a href="/en/v0.3.0/">v0.3.0</a></dd>
        
          <dd><a href="/en/v0.2.2/">v0.2.2</a></dd>
        
          <dd><a href="/en/v0.2.1/">v0.2.1</a></dd>
        
          <dd><a href="/en/v0.2.0/">v0.2.0</a></dd>
        
          <dd><a href="/en/v0.1.7/">v0.1.7</a></dd>
        
          <dd><a href="/en/v0.1.6/">v0.1.6</a></dd>
        
          <dd><a href="/en/v0.1.5/">v0.1.5</a></dd>
        
          <dd><a href="/en/v0.1.4/">v0.1.4</a></dd>
        
          <dd><a href="/en/v0.1.3/">v0.1.3</a></dd>
        
          <dd><a href="/en/v0.1.2/">v0.1.2</a></dd>
        
          <dd><a href="/en/develop/">develop</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/solidity/downloads/pdf/latest/">pdf</a></dd>
        
          <dd><a href="//readthedocs.org/projects/solidity/downloads/htmlzip/latest/">htmlzip</a></dd>
        
          <dd><a href="//readthedocs.org/projects/solidity/downloads/epub/latest/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/solidity/?fromdocs=solidity">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/solidity/?fromdocs=solidity">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.4.24',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>